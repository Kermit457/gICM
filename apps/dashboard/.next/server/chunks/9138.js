"use strict";exports.id=9138,exports.ids=[9138],exports.modules={49138:(e,t,s)=>{var r,n,i,a,o,l,h,u,c,d,f,p,m,g,y,b,w,_,v,k,S,x,R,M,P,$,T,A,E,O,j,I,q,W,N,L,U,C,D,X,F,B,H,J,K,V,z,G,Q,Y,Z,ee,et,es,er,en,ei,ea,eo,el,eh,eu,ec,ed,ef;let ep,em,eg;function ey(e,t,s,r,n){if("m"===r)throw TypeError("Private method is not writable");if("a"===r&&!n)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?n.call(e,s):n?n.value=s:t.set(e,s),s}function eb(e,t,s,r){if("a"===s&&!r)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?r:"a"===s?r.call(e):r?r.value:t.get(e)}s.d(t,{ZP:()=>sn});let ew=function(){let{crypto:e}=globalThis;if(e?.randomUUID)return ew=e.randomUUID.bind(e),e.randomUUID();let t=new Uint8Array(1),s=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(+e^s()&15>>+e/4).toString(16))};function e_(e){return"object"==typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}let ev=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){let t=Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return Error(JSON.stringify(e))}catch{}}return Error(e)};class ek extends Error{}class eS extends ek{constructor(e,t,s,r){super(`${eS.makeMessage(e,t,s)}`),this.status=e,this.headers=r,this.requestID=r?.get("request-id"),this.error=t}static makeMessage(e,t,s){let r=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,s,r){return e&&r?400===e?new eP(e,t,s,r):401===e?new e$(e,t,s,r):403===e?new eT(e,t,s,r):404===e?new eA(e,t,s,r):409===e?new eE(e,t,s,r):422===e?new eO(e,t,s,r):429===e?new ej(e,t,s,r):e>=500?new eI(e,t,s,r):new eS(e,t,s,r):new eR({message:s,cause:ev(t)})}}class ex extends eS{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class eR extends eS{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class eM extends eR{constructor({message:e}={}){super({message:e??"Request timed out."})}}class eP extends eS{}class e$ extends eS{}class eT extends eS{}class eA extends eS{}class eE extends eS{}class eO extends eS{}class ej extends eS{}class eI extends eS{}let eq=/^[a-z][a-z0-9+.-]*:/i,eW=e=>eq.test(e),eN=e=>(eN=Array.isArray)(e),eL=eN;function eU(e){return"object"!=typeof e?{}:e??{}}let eC=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new ek(`${e} must be an integer`);if(t<0)throw new ek(`${e} must be a positive integer`);return t},eD=e=>{try{return JSON.parse(e)}catch(e){return}},eX=e=>new Promise(t=>setTimeout(t,e)),eF="0.71.0",eB=()=>"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator,eH=()=>{let e="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":eF,"X-Stainless-OS":eK(Deno.build.os),"X-Stainless-Arch":eJ(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":eF,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":eF,"X-Stainless-OS":eK(globalThis.process.platform??"unknown"),"X-Stainless-Arch":eJ(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let t=function(){if("undefined"==typeof navigator||!navigator)return null;for(let{key:e,pattern:t}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let s=t.exec(navigator.userAgent);if(s){let t=s[1]||0,r=s[2]||0,n=s[3]||0;return{browser:e,version:`${t}.${r}.${n}`}}}return null}();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":eF,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":eF,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}},eJ=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",eK=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown",eV=()=>ep??(ep=eH());function ez(...e){let t=globalThis.ReadableStream;if(void 0===t)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function eG(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return ez({start(){},async pull(e){let{done:s,value:r}=await t.next();s?e.close():e.enqueue(r)},async cancel(){await t.return?.()}})}function eQ(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function eY(e){if(null===e||"object"!=typeof e)return;if(e[Symbol.asyncIterator]){await e[Symbol.asyncIterator]().return?.();return}let t=e.getReader(),s=t.cancel();t.releaseLock(),await s}let eZ=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)});function e0(e){let t;return(em??(em=(t=new globalThis.TextEncoder).encode.bind(t)))(e)}function e1(e){let t;return(eg??(eg=(t=new globalThis.TextDecoder).decode.bind(t)))(e)}class e2{constructor(){r.set(this,void 0),n.set(this,void 0),ey(this,r,new Uint8Array,"f"),ey(this,n,null,"f")}decode(e){let t;if(null==e)return[];let s=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?e0(e):e;ey(this,r,function(e){let t=0;for(let s of e)t+=s.length;let s=new Uint8Array(t),r=0;for(let t of e)s.set(t,r),r+=t.length;return s}([eb(this,r,"f"),s]),"f");let i=[];for(;null!=(t=function(e,t){for(let s=t??0;s<e.length;s++){if(10===e[s])return{preceding:s,index:s+1,carriage:!1};if(13===e[s])return{preceding:s,index:s+1,carriage:!0}}return null}(eb(this,r,"f"),eb(this,n,"f")));){if(t.carriage&&null==eb(this,n,"f")){ey(this,n,t.index,"f");continue}if(null!=eb(this,n,"f")&&(t.index!==eb(this,n,"f")+1||t.carriage)){i.push(e1(eb(this,r,"f").subarray(0,eb(this,n,"f")-1))),ey(this,r,eb(this,r,"f").subarray(eb(this,n,"f")),"f"),ey(this,n,null,"f");continue}let e=null!==eb(this,n,"f")?t.preceding-1:t.preceding,s=e1(eb(this,r,"f").subarray(0,e));i.push(s),ey(this,r,eb(this,r,"f").subarray(t.index),"f"),ey(this,n,null,"f")}return i}flush(){return eb(this,r,"f").length?this.decode("\n"):[]}}r=new WeakMap,n=new WeakMap,e2.NEWLINE_CHARS=new Set(["\n","\r"]),e2.NEWLINE_REGEXP=/\r\n|[\n\r]/g;let e4={off:0,error:200,warn:300,info:400,debug:500},e5=(e,t,s)=>{if(e){if(Object.prototype.hasOwnProperty.call(e4,e))return e;e7(s).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(e4))}`)}};function e6(){}function e3(e,t,s){return!t||e4[e]>e4[s]?e6:t[e].bind(t)}let e9={error:e6,warn:e6,info:e6,debug:e6},e8=new WeakMap;function e7(e){let t=e.logger,s=e.logLevel??"off";if(!t)return e9;let r=e8.get(t);if(r&&r[0]===s)return r[1];let n={error:e3("error",t,s),warn:e3("warn",t,s),info:e3("info",t,s),debug:e3("debug",t,s)};return e8.set(t,[s,n]),n}let te=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,"x-api-key"===e.toLowerCase()||"authorization"===e.toLowerCase()||"cookie"===e.toLowerCase()||"set-cookie"===e.toLowerCase()?"***":t]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);class tt{constructor(e,t,s){this.iterator=e,i.set(this,void 0),this.controller=t,ey(this,i,s,"f")}static fromSSEResponse(e,t,s){let r=!1,n=s?e7(s):console;return new tt(async function*(){if(r)throw new ek("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let s=!1;try{for await(let s of ts(e,t)){if("completion"===s.event)try{yield JSON.parse(s.data)}catch(e){throw n.error("Could not parse message into JSON:",s.data),n.error("From chunk:",s.raw),e}if("message_start"===s.event||"message_delta"===s.event||"message_stop"===s.event||"content_block_start"===s.event||"content_block_delta"===s.event||"content_block_stop"===s.event)try{yield JSON.parse(s.data)}catch(e){throw n.error("Could not parse message into JSON:",s.data),n.error("From chunk:",s.raw),e}if("ping"!==s.event&&"error"===s.event)throw new eS(void 0,eD(s.data)??s.data,void 0,e.headers)}s=!0}catch(e){if(e_(e))return;throw e}finally{s||t.abort()}},t,s)}static fromReadableStream(e,t,s){let r=!1;async function*n(){let t=new e2;for await(let s of eQ(e))for(let e of t.decode(s))yield e;for(let e of t.flush())yield e}return new tt(async function*(){if(r)throw new ek("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let e=!1;try{for await(let t of n())!e&&t&&(yield JSON.parse(t));e=!0}catch(e){if(e_(e))return;throw e}finally{e||t.abort()}},t,s)}[(i=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let e=[],t=[],s=this.iterator(),r=r=>({next:()=>{if(0===r.length){let r=s.next();e.push(r),t.push(r)}return r.shift()}});return[new tt(()=>r(e),this.controller,eb(this,i,"f")),new tt(()=>r(t),this.controller,eb(this,i,"f"))]}toReadableStream(){let e;let t=this;return ez({async start(){e=t[Symbol.asyncIterator]()},async pull(t){try{let{value:s,done:r}=await e.next();if(r)return t.close();let n=e0(JSON.stringify(s)+"\n");t.enqueue(n)}catch(e){t.error(e)}},async cancel(){await e.return?.()}})}}async function*ts(e,t){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new ek("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new ek("Attempted to iterate over a response with no body")}let s=new tn,r=new e2;for await(let t of tr(eQ(e.body)))for(let e of r.decode(t)){let t=s.decode(e);t&&(yield t)}for(let e of r.flush()){let t=s.decode(e);t&&(yield t)}}async function*tr(e){let t=new Uint8Array;for await(let s of e){let e;if(null==s)continue;let r=s instanceof ArrayBuffer?new Uint8Array(s):"string"==typeof s?e0(s):s,n=new Uint8Array(t.length+r.length);for(n.set(t),n.set(r,t.length),t=n;-1!==(e=function(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1]||13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return -1}(t));)yield t.slice(0,e),t=t.slice(e)}t.length>0&&(yield t)}class tn{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,s,r]=function(e,t){let s=e.indexOf(":");return -1!==s?[e.substring(0,s),":",e.substring(s+t.length)]:[e,"",""]}(e,":");return r.startsWith(" ")&&(r=r.substring(1)),"event"===t?this.event=r:"data"===t&&this.data.push(r),null}}async function ti(e,t){let{response:s,requestLogID:r,retryOfRequestLogID:n,startTime:i}=t,a=await (async()=>{if(t.options.stream)return(e7(e).debug("response",s.status,s.url,s.headers,s.body),t.options.__streamClass)?t.options.__streamClass.fromSSEResponse(s,t.controller):tt.fromSSEResponse(s,t.controller);if(204===s.status)return null;if(t.options.__binaryResponse)return s;let r=s.headers.get("content-type"),n=r?.split(";")[0]?.trim();return n?.includes("application/json")||n?.endsWith("+json")?ta(await s.json(),s):await s.text()})();return e7(e).debug(`[${r}] response parsed`,te({retryOfRequestLogID:n,url:s.url,status:s.status,body:a,durationMs:Date.now()-i})),a}function ta(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("request-id"),enumerable:!1})}class to extends Promise{constructor(e,t,s=ti){super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=s,a.set(this,void 0),ey(this,a,e,"f")}_thenUnwrap(e){return new to(eb(this,a,"f"),this.responsePromise,async(t,s)=>ta(e(await this.parseResponse(t,s),s),s.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(eb(this,a,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}a=new WeakMap;class tl{constructor(e,t,s,r){o.set(this,void 0),ey(this,o,e,"f"),this.options=r,this.response=t,this.body=s}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new ek("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await eb(this,o,"f").requestAPIList(this.constructor,e)}async *iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async *[(o=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}}class th extends to{constructor(e,t,s){super(e,t,async(e,t)=>new s(e,t.response,await ti(e,t),t.options))}async *[Symbol.asyncIterator](){for await(let e of(await this))yield e}}class tu extends tl{constructor(e,t,s,r){super(e,t,s,r),this.data=s.data||[],this.has_more=s.has_more||!1,this.first_id=s.first_id||null,this.last_id=s.last_id||null}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){if(this.options.query?.before_id){let e=this.first_id;return e?{...this.options,query:{...eU(this.options.query),before_id:e}}:null}let e=this.last_id;return e?{...this.options,query:{...eU(this.options.query),after_id:e}}:null}}class tc extends tl{constructor(e,t,s,r){super(e,t,s,r),this.data=s.data||[],this.has_more=s.has_more||!1,this.next_page=s.next_page||null}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){let e=this.next_page;return e?{...this.options,query:{...eU(this.options.query),page:e}}:null}}let td=()=>{if("undefined"==typeof File){let{process:e}=globalThis;throw Error("`File` is not defined as a global, which is required for file uploads."+("string"==typeof e?.versions?.node&&20>parseInt(e.versions.node.split("."))?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function tf(e,t,s){return td(),new File(e,t??"unknown_file",s)}function tp(e){return("object"==typeof e&&null!==e&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}let tm=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],tg=async(e,t)=>({...e,body:await tb(e.body,t)}),ty=new WeakMap,tb=async(e,t)=>{if(!await function(e){let t="function"==typeof e?e:e.fetch,s=ty.get(t);if(s)return s;let r=(async()=>{try{let e="Response"in t?t.Response:(await t("data:,")).constructor,s=new FormData;if(s.toString()===await new e(s).text())return!1;return!0}catch{return!0}})();return ty.set(t,r),r}(t))throw TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let s=new FormData;return await Promise.all(Object.entries(e||{}).map(([e,t])=>tk(s,e,t))),s},tw=e=>e instanceof Blob&&"name"in e,t_=e=>"object"==typeof e&&null!==e&&(e instanceof Response||tm(e)||tw(e)),tv=e=>{if(t_(e))return!0;if(Array.isArray(e))return e.some(tv);if(e&&"object"==typeof e){for(let t in e)if(tv(e[t]))return!0}return!1},tk=async(e,t,s)=>{if(void 0!==s){if(null==s)throw TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof s||"number"==typeof s||"boolean"==typeof s)e.append(t,String(s));else if(s instanceof Response){let r={},n=s.headers.get("Content-Type");n&&(r={type:n}),e.append(t,tf([await s.blob()],tp(s),r))}else if(tm(s))e.append(t,tf([await new Response(eG(s)).blob()],tp(s)));else if(tw(s))e.append(t,tf([s],tp(s),{type:s.type}));else if(Array.isArray(s))await Promise.all(s.map(s=>tk(e,t+"[]",s)));else if("object"==typeof s)await Promise.all(Object.entries(s).map(([s,r])=>tk(e,`${t}[${s}]`,r)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${s} instead`)}},tS=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer,tx=e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&tS(e),tR=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob;async function tM(e,t,s){if(td(),e=await e,t||(t=tp(e)),tx(e))return e instanceof File&&null==t&&null==s?e:tf([await e.arrayBuffer()],t??e.name,{type:e.type,lastModified:e.lastModified,...s});if(tR(e)){let r=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),tf(await tP(r),t,s)}let r=await tP(e);if(!s?.type){let e=r.find(e=>"object"==typeof e&&"type"in e&&e.type);"string"==typeof e&&(s={...s,type:e})}return tf(r,t,s)}async function tP(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(tS(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else if(tm(e))for await(let s of e)t.push(...await tP(s));else{let t=e?.constructor?.name;throw Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:""}${function(e){if("object"!=typeof e||null===e)return"";let t=Object.getOwnPropertyNames(e);return`; props: [${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`)}return t}class t${constructor(e){this._client=e}}let tT=Symbol.for("brand.privateNullableHeaders"),tA=e=>{let t=new Headers,s=new Set;for(let r of e){let e=new Set;for(let[n,i]of function*(e){let t;if(!e)return;if(tT in e){let{values:t,nulls:s}=e;for(let e of(yield*t.entries(),s))yield[e,null];return}let s=!1;for(let r of(e instanceof Headers?t=e.entries():eL(e)?t=e:(s=!0,t=Object.entries(e??{})),t)){let e=r[0];if("string"!=typeof e)throw TypeError("expected header name to be a string");let t=eL(r[1])?r[1]:[r[1]],n=!1;for(let r of t)void 0!==r&&(s&&!n&&(n=!0,yield[e,null]),yield[e,r])}}(r)){let r=n.toLowerCase();e.has(r)||(t.delete(n),e.add(r)),null===i?(t.delete(n),s.add(r)):(t.append(n,i),s.delete(r))}}return{[tT]:!0,values:t,nulls:s}};function tE(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}let tO=Object.freeze(Object.create(null)),tj=((e=tE)=>function(t,...s){let r;if(1===t.length)return t[0];let n=!1,i=[],a=t.reduce((t,r,a)=>{/[?#]/.test(r)&&(n=!0);let o=s[a],l=(n?encodeURIComponent:e)(""+o);return a!==s.length&&(null==o||"object"==typeof o&&o.toString===Object.getPrototypeOf(Object.getPrototypeOf(o.hasOwnProperty??tO)??tO)?.toString)&&(l=o+"",i.push({start:t.length+r.length,length:l.length,error:`Value of type ${Object.prototype.toString.call(o).slice(8,-1)} is not a valid path parameter`})),t+r+(a===s.length?"":l)},""),o=a.split(/[?#]/,1)[0],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;for(;null!==(r=l.exec(o));)i.push({start:r.index,length:r[0].length,error:`Value "${r[0]}" can't be safely passed as a path parameter`});if(i.sort((e,t)=>e.start-t.start),i.length>0){let e=0,t=i.reduce((t,s)=>{let r=" ".repeat(s.start-e),n="^".repeat(s.length);return e=s.start+s.length,t+r+n},"");throw new ek(`Path parameters result in path with invalid segments:
${i.map(e=>e.error).join("\n")}
${a}
${t}`)}return a})(tE);class tI extends t${list(e={},t){let{betas:s,...r}=e??{};return this._client.getAPIList("/v1/files",tu,{query:r,...t,headers:tA([{"anthropic-beta":[...s??[],"files-api-2025-04-14"].toString()},t?.headers])})}delete(e,t={},s){let{betas:r}=t??{};return this._client.delete(tj`/v1/files/${e}`,{...s,headers:tA([{"anthropic-beta":[...r??[],"files-api-2025-04-14"].toString()},s?.headers])})}download(e,t={},s){let{betas:r}=t??{};return this._client.get(tj`/v1/files/${e}/content`,{...s,headers:tA([{"anthropic-beta":[...r??[],"files-api-2025-04-14"].toString(),Accept:"application/binary"},s?.headers]),__binaryResponse:!0})}retrieveMetadata(e,t={},s){let{betas:r}=t??{};return this._client.get(tj`/v1/files/${e}`,{...s,headers:tA([{"anthropic-beta":[...r??[],"files-api-2025-04-14"].toString()},s?.headers])})}upload(e,t){let{betas:s,...r}=e;return this._client.post("/v1/files",tg({body:r,...t,headers:tA([{"anthropic-beta":[...s??[],"files-api-2025-04-14"].toString()},t?.headers])},this._client))}}class tq extends t${retrieve(e,t={},s){let{betas:r}=t??{};return this._client.get(tj`/v1/models/${e}?beta=true`,{...s,headers:tA([{...r?.toString()!=null?{"anthropic-beta":r?.toString()}:void 0},s?.headers])})}list(e={},t){let{betas:s,...r}=e??{};return this._client.getAPIList("/v1/models?beta=true",tu,{query:r,...t,headers:tA([{...s?.toString()!=null?{"anthropic-beta":s?.toString()}:void 0},t?.headers])})}}let tW={"claude-opus-4-20250514":8192,"claude-opus-4-0":8192,"claude-4-opus-20250514":8192,"anthropic.claude-opus-4-20250514-v1:0":8192,"claude-opus-4@20250514":8192,"claude-opus-4-1-20250805":8192,"anthropic.claude-opus-4-1-20250805-v1:0":8192,"claude-opus-4-1@20250805":8192};function tN(e,t){return t&&"parse"in(t.output_format??{})?tL(e,t):{...e,content:e.content.map(e=>"text"===e.type?{...e,parsed:null}:e),parsed_output:null}}function tL(e,t){let s=null,r=e.content.map(e=>{if("text"===e.type){let r=function(e,t){if(e.output_format?.type!=="json_schema")return null;try{if("parse"in e.output_format)return e.output_format.parse(t);return JSON.parse(t)}catch(e){throw new ek(`Failed to parse structured output: ${e}`)}}(t,e.text);return null===s&&(s=r),{...e,parsed:r}}return e});return{...e,content:r,parsed_output:s}}let tU=e=>{let t=0,s=[];for(;t<e.length;){let r=e[t];if("\\"===r){t++;continue}if("{"===r){s.push({type:"brace",value:"{"}),t++;continue}if("}"===r){s.push({type:"brace",value:"}"}),t++;continue}if("["===r){s.push({type:"paren",value:"["}),t++;continue}if("]"===r){s.push({type:"paren",value:"]"}),t++;continue}if(":"===r){s.push({type:"separator",value:":"}),t++;continue}if(","===r){s.push({type:"delimiter",value:","}),t++;continue}if('"'===r){let n="",i=!1;for(r=e[++t];'"'!==r;){if(t===e.length){i=!0;break}if("\\"===r){if(++t===e.length){i=!0;break}n+=r+e[t],r=e[++t]}else n+=r,r=e[++t]}r=e[++t],i||s.push({type:"string",value:n});continue}let n=/\s/;if(r&&n.test(r)){t++;continue}let i=/[0-9]/;if(r&&i.test(r)||"-"===r||"."===r){let n="";for("-"===r&&(n+=r,r=e[++t]);r&&i.test(r)||"."===r;)n+=r,r=e[++t];s.push({type:"number",value:n});continue}let a=/[a-z]/i;if(r&&a.test(r)){let n="";for(;r&&a.test(r)&&t!==e.length;)n+=r,r=e[++t];"true"==n||"false"==n||"null"===n?s.push({type:"name",value:n}):t++;continue}t++}return s},tC=e=>{if(0===e.length)return e;let t=e[e.length-1];switch(t.type){case"separator":return tC(e=e.slice(0,e.length-1));case"number":let s=t.value[t.value.length-1];if("."===s||"-"===s)return tC(e=e.slice(0,e.length-1));case"string":let r=e[e.length-2];if(r?.type==="delimiter"||r?.type==="brace"&&"{"===r.value)return tC(e=e.slice(0,e.length-1));break;case"delimiter":return tC(e=e.slice(0,e.length-1))}return e},tD=e=>{let t=[];return e.map(e=>{"brace"===e.type&&("{"===e.value?t.push("}"):t.splice(t.lastIndexOf("}"),1)),"paren"===e.type&&("["===e.value?t.push("]"):t.splice(t.lastIndexOf("]"),1))}),t.length>0&&t.reverse().map(t=>{"}"===t?e.push({type:"brace",value:"}"}):"]"===t&&e.push({type:"paren",value:"]"})}),e},tX=e=>{let t="";return e.map(e=>{"string"===e.type?t+='"'+e.value+'"':t+=e.value}),t},tF=e=>JSON.parse(tX(tD(tC(tU(e))))),tB="__json_buf";function tH(e){return"tool_use"===e.type||"server_tool_use"===e.type||"mcp_tool_use"===e.type}class tJ{constructor(e){l.add(this),this.messages=[],this.receivedMessages=[],h.set(this,void 0),u.set(this,null),this.controller=new AbortController,c.set(this,void 0),d.set(this,()=>{}),f.set(this,()=>{}),p.set(this,void 0),m.set(this,()=>{}),g.set(this,()=>{}),y.set(this,{}),b.set(this,!1),w.set(this,!1),_.set(this,!1),v.set(this,!1),k.set(this,void 0),S.set(this,void 0),M.set(this,e=>{if(ey(this,w,!0,"f"),e_(e)&&(e=new ex),e instanceof ex)return ey(this,_,!0,"f"),this._emit("abort",e);if(e instanceof ek)return this._emit("error",e);if(e instanceof Error){let t=new ek(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new ek(String(e)))}),ey(this,c,new Promise((e,t)=>{ey(this,d,e,"f"),ey(this,f,t,"f")}),"f"),ey(this,p,new Promise((e,t)=>{ey(this,m,e,"f"),ey(this,g,t,"f")}),"f"),eb(this,c,"f").catch(()=>{}),eb(this,p,"f").catch(()=>{}),ey(this,u,e,"f")}get response(){return eb(this,k,"f")}get request_id(){return eb(this,S,"f")}async withResponse(){let e=await eb(this,c,"f");if(!e)throw Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){let t=new tJ(null);return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,s){let r=new tJ(t);for(let e of t.messages)r._addMessageParam(e);return ey(r,u,{...t,stream:!0},"f"),r._run(()=>r._createMessage(e,{...t,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),r}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},eb(this,M,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,s){let r;let n=s?.signal;n&&(n.aborted&&this.controller.abort(),r=this.controller.abort.bind(this.controller),n.addEventListener("abort",r));try{eb(this,l,"m",P).call(this);let{response:r,data:n}=await e.create({...t,stream:!0},{...s,signal:this.controller.signal}).withResponse();for await(let e of(this._connected(r),n))eb(this,l,"m",$).call(this,e);if(n.controller.signal?.aborted)throw new ex;eb(this,l,"m",T).call(this)}finally{n&&r&&n.removeEventListener("abort",r)}}_connected(e){this.ended||(ey(this,k,e,"f"),ey(this,S,e?.headers.get("request-id"),"f"),eb(this,d,"f").call(this,e),this._emit("connect"))}get ended(){return eb(this,b,"f")}get errored(){return eb(this,w,"f")}get aborted(){return eb(this,_,"f")}abort(){this.controller.abort()}on(e,t){return(eb(this,y,"f")[e]||(eb(this,y,"f")[e]=[])).push({listener:t}),this}off(e,t){let s=eb(this,y,"f")[e];if(!s)return this;let r=s.findIndex(e=>e.listener===t);return r>=0&&s.splice(r,1),this}once(e,t){return(eb(this,y,"f")[e]||(eb(this,y,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,s)=>{ey(this,v,!0,"f"),"error"!==e&&this.once("error",s),this.once(e,t)})}async done(){ey(this,v,!0,"f"),await eb(this,p,"f")}get currentMessage(){return eb(this,h,"f")}async finalMessage(){return await this.done(),eb(this,l,"m",x).call(this)}async finalText(){return await this.done(),eb(this,l,"m",R).call(this)}_emit(e,...t){if(eb(this,b,"f"))return;"end"===e&&(ey(this,b,!0,"f"),eb(this,m,"f").call(this));let s=eb(this,y,"f")[e];if(s&&(eb(this,y,"f")[e]=s.filter(e=>!e.once),s.forEach(({listener:e})=>e(...t))),"abort"===e){let e=t[0];eb(this,v,"f")||s?.length||Promise.reject(e),eb(this,f,"f").call(this,e),eb(this,g,"f").call(this,e),this._emit("end");return}if("error"===e){let e=t[0];eb(this,v,"f")||s?.length||Promise.reject(e),eb(this,f,"f").call(this,e),eb(this,g,"f").call(this,e),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",eb(this,l,"m",x).call(this))}async _fromReadableStream(e,t){let s;let r=t?.signal;r&&(r.aborted&&this.controller.abort(),s=this.controller.abort.bind(this.controller),r.addEventListener("abort",s));try{eb(this,l,"m",P).call(this),this._connected(null);let t=tt.fromReadableStream(e,this.controller);for await(let e of t)eb(this,l,"m",$).call(this,e);if(t.controller.signal?.aborted)throw new ex;eb(this,l,"m",T).call(this)}finally{r&&s&&r.removeEventListener("abort",s)}}[(h=new WeakMap,u=new WeakMap,c=new WeakMap,d=new WeakMap,f=new WeakMap,p=new WeakMap,m=new WeakMap,g=new WeakMap,y=new WeakMap,b=new WeakMap,w=new WeakMap,_=new WeakMap,v=new WeakMap,k=new WeakMap,S=new WeakMap,M=new WeakMap,l=new WeakSet,x=function(){if(0===this.receivedMessages.length)throw new ek("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},R=function(){if(0===this.receivedMessages.length)throw new ek("stream ended without producing a Message with role=assistant");let e=this.receivedMessages.at(-1).content.filter(e=>"text"===e.type).map(e=>e.text);if(0===e.length)throw new ek("stream ended without producing a content block with type=text");return e.join(" ")},P=function(){this.ended||ey(this,h,void 0,"f")},$=function(e){if(this.ended)return;let t=eb(this,l,"m",A).call(this,e);switch(this._emit("streamEvent",e,t),e.type){case"content_block_delta":{let s=t.content.at(-1);switch(e.delta.type){case"text_delta":"text"===s.type&&this._emit("text",e.delta.text,s.text||"");break;case"citations_delta":"text"===s.type&&this._emit("citation",e.delta.citation,s.citations??[]);break;case"input_json_delta":tH(s)&&s.input&&this._emit("inputJson",e.delta.partial_json,s.input);break;case"thinking_delta":"thinking"===s.type&&this._emit("thinking",e.delta.thinking,s.thinking);break;case"signature_delta":"thinking"===s.type&&this._emit("signature",s.signature);break;default:e.delta}break}case"message_stop":this._addMessageParam(t),this._addMessage(tN(t,eb(this,u,"f")),!0);break;case"content_block_stop":this._emit("contentBlock",t.content.at(-1));break;case"message_start":ey(this,h,t,"f")}},T=function(){if(this.ended)throw new ek("stream has ended, this shouldn't happen");let e=eb(this,h,"f");if(!e)throw new ek("request ended without sending any chunks");return ey(this,h,void 0,"f"),tN(e,eb(this,u,"f"))},A=function(e){let t=eb(this,h,"f");if("message_start"===e.type){if(t)throw new ek(`Unexpected event order, got ${e.type} before receiving "message_stop"`);return e.message}if(!t)throw new ek(`Unexpected event order, got ${e.type} before "message_start"`);switch(e.type){case"message_stop":case"content_block_stop":return t;case"message_delta":return t.container=e.delta.container,t.stop_reason=e.delta.stop_reason,t.stop_sequence=e.delta.stop_sequence,t.usage.output_tokens=e.usage.output_tokens,t.context_management=e.context_management,null!=e.usage.input_tokens&&(t.usage.input_tokens=e.usage.input_tokens),null!=e.usage.cache_creation_input_tokens&&(t.usage.cache_creation_input_tokens=e.usage.cache_creation_input_tokens),null!=e.usage.cache_read_input_tokens&&(t.usage.cache_read_input_tokens=e.usage.cache_read_input_tokens),null!=e.usage.server_tool_use&&(t.usage.server_tool_use=e.usage.server_tool_use),t;case"content_block_start":return t.content.push(e.content_block),t;case"content_block_delta":{let s=t.content.at(e.index);switch(e.delta.type){case"text_delta":s?.type==="text"&&(t.content[e.index]={...s,text:(s.text||"")+e.delta.text});break;case"citations_delta":s?.type==="text"&&(t.content[e.index]={...s,citations:[...s.citations??[],e.delta.citation]});break;case"input_json_delta":if(s&&tH(s)){let r=s[tB]||"";r+=e.delta.partial_json;let n={...s};if(Object.defineProperty(n,tB,{value:r,enumerable:!1,writable:!0}),r)try{n.input=tF(r)}catch(t){let e=new ek(`Unable to parse tool parameter JSON from model. Please retry your request or adjust your prompt. Error: ${t}. JSON: ${r}`);eb(this,M,"f").call(this,e)}t.content[e.index]=n}break;case"thinking_delta":s?.type==="thinking"&&(t.content[e.index]={...s,thinking:s.thinking+e.delta.thinking});break;case"signature_delta":s?.type==="thinking"&&(t.content[e.index]={...s,signature:e.delta.signature});break;default:e.delta}return t}}},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("streamEvent",s=>{let r=t.shift();r?r.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),this.on("error",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new tt(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}let tK=`You have been working on the task described above but have not yet completed it. Write a continuation summary that will allow you (or another instance of yourself) to resume work efficiently in a future context window where the conversation history will be replaced with this summary. Your summary should be structured, concise, and actionable. Include:
1. Task Overview
The user's core request and success criteria
Any clarifications or constraints they specified
2. Current State
What has been completed so far
Files created, modified, or analyzed (with paths if relevant)
Key outputs or artifacts produced
3. Important Discoveries
Technical constraints or requirements uncovered
Decisions made and their rationale
Errors encountered and how they were resolved
What approaches were tried that didn't work (and why)
4. Next Steps
Specific actions needed to complete the task
Any blockers or open questions to resolve
Priority order if multiple steps remain
5. Context to Preserve
User preferences or style requirements
Domain-specific details that aren't obvious
Any promises made to the user
Be concise but completeâ€”err on the side of including information that would prevent duplicate work or repeated mistakes. Write in a way that enables immediate resumption of the task.
Wrap your summary in <summary></summary> tags.`;function tV(){let e,t;return{promise:new Promise((s,r)=>{e=s,t=r}),resolve:e,reject:t}}class tz{constructor(e,t,s){E.add(this),this.client=e,O.set(this,!1),j.set(this,!1),I.set(this,void 0),q.set(this,void 0),W.set(this,void 0),N.set(this,void 0),L.set(this,void 0),U.set(this,0),ey(this,I,{params:{...t,messages:structuredClone(t.messages)}},"f"),ey(this,q,{...s,headers:tA([{"x-stainless-helper":"BetaToolRunner"},s?.headers])},"f"),ey(this,L,tV(),"f")}async *[(O=new WeakMap,j=new WeakMap,I=new WeakMap,q=new WeakMap,W=new WeakMap,N=new WeakMap,L=new WeakMap,U=new WeakMap,E=new WeakSet,C=async function(){let e=eb(this,I,"f").params.compactionControl;if(!e||!e.enabled)return!1;let t=0;if(void 0!==eb(this,W,"f"))try{let e=await eb(this,W,"f");t=e.usage.input_tokens+(e.usage.cache_creation_input_tokens??0)+(e.usage.cache_read_input_tokens??0)+e.usage.output_tokens}catch{return!1}if(t<(e.contextTokenThreshold??1e5))return!1;let s=e.model??eb(this,I,"f").params.model,r=e.summaryPrompt??tK,n=eb(this,I,"f").params.messages;if("assistant"===n[n.length-1].role){let e=n[n.length-1];if(Array.isArray(e.content)){let t=e.content.filter(e=>"tool_use"!==e.type);0===t.length?n.pop():e.content=t}}let i=await this.client.beta.messages.create({model:s,messages:[...n,{role:"user",content:[{type:"text",text:r}]}],max_tokens:eb(this,I,"f").params.max_tokens},{headers:{"x-stainless-helper":"compaction"}});if(i.content[0]?.type!=="text")throw new ek("Expected text response for compaction");return eb(this,I,"f").params.messages=[{role:"user",content:i.content}],!0},Symbol.asyncIterator)](){var e;if(eb(this,O,"f"))throw new ek("Cannot iterate over a consumed stream");ey(this,O,!0,"f"),ey(this,j,!0,"f"),ey(this,N,void 0,"f");try{for(;;){let t;try{if(eb(this,I,"f").params.max_iterations&&eb(this,U,"f")>=eb(this,I,"f").params.max_iterations)break;ey(this,j,!1,"f"),ey(this,N,void 0,"f"),ey(this,U,(e=eb(this,U,"f"),++e),"f"),ey(this,W,void 0,"f");let{max_iterations:s,compactionControl:r,...n}=eb(this,I,"f").params;if(n.stream?(t=this.client.beta.messages.stream({...n},eb(this,q,"f")),ey(this,W,t.finalMessage(),"f"),eb(this,W,"f").catch(()=>{}),yield t):(ey(this,W,this.client.beta.messages.create({...n,stream:!1},eb(this,q,"f")),"f"),yield eb(this,W,"f")),!await eb(this,E,"m",C).call(this)){if(!eb(this,j,"f")){let{role:e,content:t}=await eb(this,W,"f");eb(this,I,"f").params.messages.push({role:e,content:t})}let e=await eb(this,E,"m",D).call(this,eb(this,I,"f").params.messages.at(-1));if(e)eb(this,I,"f").params.messages.push(e);else if(!eb(this,j,"f"))break}}finally{t&&t.abort()}}if(!eb(this,W,"f"))throw new ek("ToolRunner concluded without a message from the server");eb(this,L,"f").resolve(await eb(this,W,"f"))}catch(e){throw ey(this,O,!1,"f"),eb(this,L,"f").promise.catch(()=>{}),eb(this,L,"f").reject(e),ey(this,L,tV(),"f"),e}}setMessagesParams(e){"function"==typeof e?eb(this,I,"f").params=e(eb(this,I,"f").params):eb(this,I,"f").params=e,ey(this,j,!0,"f"),ey(this,N,void 0,"f")}async generateToolResponse(){let e=await eb(this,W,"f")??this.params.messages.at(-1);return e?eb(this,E,"m",D).call(this,e):null}done(){return eb(this,L,"f").promise}async runUntilDone(){if(!eb(this,O,"f"))for await(let e of this);return this.done()}get params(){return eb(this,I,"f").params}pushMessages(...e){this.setMessagesParams(t=>({...t,messages:[...t.messages,...e]}))}then(e,t){return this.runUntilDone().then(e,t)}}async function tG(e,t=e.messages.at(-1)){if(!t||"assistant"!==t.role||!t.content||"string"==typeof t.content)return null;let s=t.content.filter(e=>"tool_use"===e.type);return 0===s.length?null:{role:"user",content:await Promise.all(s.map(async t=>{let s=e.tools.find(e=>("name"in e?e.name:e.mcp_server_name)===t.name);if(!s||!("run"in s))return{type:"tool_result",tool_use_id:t.id,content:`Error: Tool '${t.name}' not found`,is_error:!0};try{let e=t.input;"parse"in s&&s.parse&&(e=s.parse(e));let r=await s.run(e);return{type:"tool_result",tool_use_id:t.id,content:r}}catch(e){return{type:"tool_result",tool_use_id:t.id,content:`Error: ${e instanceof Error?e.message:String(e)}`,is_error:!0}}}))}}D=async function(e){return void 0!==eb(this,N,"f")||ey(this,N,tG(eb(this,I,"f").params,e),"f"),eb(this,N,"f")};class tQ{constructor(e,t){this.iterator=e,this.controller=t}async *decoder(){let e=new e2;for await(let t of this.iterator)for(let s of e.decode(t))yield JSON.parse(s);for(let t of e.flush())yield JSON.parse(t)}[Symbol.asyncIterator](){return this.decoder()}static fromResponse(e,t){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new ek("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new ek("Attempted to iterate over a response with no body")}return new tQ(eQ(e.body),t)}}class tY extends t${create(e,t){let{betas:s,...r}=e;return this._client.post("/v1/messages/batches?beta=true",{body:r,...t,headers:tA([{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString()},t?.headers])})}retrieve(e,t={},s){let{betas:r}=t??{};return this._client.get(tj`/v1/messages/batches/${e}?beta=true`,{...s,headers:tA([{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString()},s?.headers])})}list(e={},t){let{betas:s,...r}=e??{};return this._client.getAPIList("/v1/messages/batches?beta=true",tu,{query:r,...t,headers:tA([{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString()},t?.headers])})}delete(e,t={},s){let{betas:r}=t??{};return this._client.delete(tj`/v1/messages/batches/${e}?beta=true`,{...s,headers:tA([{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString()},s?.headers])})}cancel(e,t={},s){let{betas:r}=t??{};return this._client.post(tj`/v1/messages/batches/${e}/cancel?beta=true`,{...s,headers:tA([{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString()},s?.headers])})}async results(e,t={},s){let r=await this.retrieve(e);if(!r.results_url)throw new ek(`No batch \`results_url\`; Has it finished processing? ${r.processing_status} - ${r.id}`);let{betas:n}=t??{};return this._client.get(r.results_url,{...s,headers:tA([{"anthropic-beta":[...n??[],"message-batches-2024-09-24"].toString(),Accept:"application/binary"},s?.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((e,t)=>tQ.fromResponse(t.response,t.controller))}}let tZ={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-3-opus-20240229":"January 5th, 2026","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025","claude-3-7-sonnet-latest":"February 19th, 2026","claude-3-7-sonnet-20250219":"February 19th, 2026"};class t0 extends t${constructor(){super(...arguments),this.batches=new tY(this._client)}create(e,t){let{betas:s,...r}=e;r.model in tZ&&console.warn(`The model '${r.model}' is deprecated and will reach end-of-life on ${tZ[r.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let n=this._client._options.timeout;if(!r.stream&&null==n){let e=tW[r.model]??void 0;n=this._client.calculateNonstreamingTimeout(r.max_tokens,e)}return this._client.post("/v1/messages?beta=true",{body:r,timeout:n??6e5,...t,headers:tA([{...s?.toString()!=null?{"anthropic-beta":s?.toString()}:void 0},t?.headers]),stream:e.stream??!1})}parse(e,t){return t={...t,headers:tA([{"anthropic-beta":[...e.betas??[],"structured-outputs-2025-11-13"].toString()},t?.headers])},this.create(e,t).then(t=>tL(t,e))}stream(e,t){return tJ.createMessage(this,e,t)}countTokens(e,t){let{betas:s,...r}=e;return this._client.post("/v1/messages/count_tokens?beta=true",{body:r,...t,headers:tA([{"anthropic-beta":[...s??[],"token-counting-2024-11-01"].toString()},t?.headers])})}toolRunner(e,t){return new tz(this._client,e,t)}}t0.Batches=tY,t0.BetaToolRunner=tz;class t1 extends t${create(e,t={},s){let{betas:r,...n}=t??{};return this._client.post(tj`/v1/skills/${e}/versions?beta=true`,tg({body:n,...s,headers:tA([{"anthropic-beta":[...r??[],"skills-2025-10-02"].toString()},s?.headers])},this._client))}retrieve(e,t,s){let{skill_id:r,betas:n}=t;return this._client.get(tj`/v1/skills/${r}/versions/${e}?beta=true`,{...s,headers:tA([{"anthropic-beta":[...n??[],"skills-2025-10-02"].toString()},s?.headers])})}list(e,t={},s){let{betas:r,...n}=t??{};return this._client.getAPIList(tj`/v1/skills/${e}/versions?beta=true`,tc,{query:n,...s,headers:tA([{"anthropic-beta":[...r??[],"skills-2025-10-02"].toString()},s?.headers])})}delete(e,t,s){let{skill_id:r,betas:n}=t;return this._client.delete(tj`/v1/skills/${r}/versions/${e}?beta=true`,{...s,headers:tA([{"anthropic-beta":[...n??[],"skills-2025-10-02"].toString()},s?.headers])})}}class t2 extends t${constructor(){super(...arguments),this.versions=new t1(this._client)}create(e={},t){let{betas:s,...r}=e??{};return this._client.post("/v1/skills?beta=true",tg({body:r,...t,headers:tA([{"anthropic-beta":[...s??[],"skills-2025-10-02"].toString()},t?.headers])},this._client))}retrieve(e,t={},s){let{betas:r}=t??{};return this._client.get(tj`/v1/skills/${e}?beta=true`,{...s,headers:tA([{"anthropic-beta":[...r??[],"skills-2025-10-02"].toString()},s?.headers])})}list(e={},t){let{betas:s,...r}=e??{};return this._client.getAPIList("/v1/skills?beta=true",tc,{query:r,...t,headers:tA([{"anthropic-beta":[...s??[],"skills-2025-10-02"].toString()},t?.headers])})}delete(e,t={},s){let{betas:r}=t??{};return this._client.delete(tj`/v1/skills/${e}?beta=true`,{...s,headers:tA([{"anthropic-beta":[...r??[],"skills-2025-10-02"].toString()},s?.headers])})}}t2.Versions=t1;class t4 extends t${constructor(){super(...arguments),this.models=new tq(this._client),this.messages=new t0(this._client),this.files=new tI(this._client),this.skills=new t2(this._client)}}t4.Models=tq,t4.Messages=t0,t4.Files=tI,t4.Skills=t2;class t5 extends t${create(e,t){let{betas:s,...r}=e;return this._client.post("/v1/complete",{body:r,timeout:this._client._options.timeout??6e5,...t,headers:tA([{...s?.toString()!=null?{"anthropic-beta":s?.toString()}:void 0},t?.headers]),stream:e.stream??!1})}}let t6="__json_buf";function t3(e){return"tool_use"===e.type||"server_tool_use"===e.type}class t9{constructor(){X.add(this),this.messages=[],this.receivedMessages=[],F.set(this,void 0),this.controller=new AbortController,B.set(this,void 0),H.set(this,()=>{}),J.set(this,()=>{}),K.set(this,void 0),V.set(this,()=>{}),z.set(this,()=>{}),G.set(this,{}),Q.set(this,!1),Y.set(this,!1),Z.set(this,!1),ee.set(this,!1),et.set(this,void 0),es.set(this,void 0),ei.set(this,e=>{if(ey(this,Y,!0,"f"),e_(e)&&(e=new ex),e instanceof ex)return ey(this,Z,!0,"f"),this._emit("abort",e);if(e instanceof ek)return this._emit("error",e);if(e instanceof Error){let t=new ek(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new ek(String(e)))}),ey(this,B,new Promise((e,t)=>{ey(this,H,e,"f"),ey(this,J,t,"f")}),"f"),ey(this,K,new Promise((e,t)=>{ey(this,V,e,"f"),ey(this,z,t,"f")}),"f"),eb(this,B,"f").catch(()=>{}),eb(this,K,"f").catch(()=>{})}get response(){return eb(this,et,"f")}get request_id(){return eb(this,es,"f")}async withResponse(){let e=await eb(this,B,"f");if(!e)throw Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){let t=new t9;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,s){let r=new t9;for(let e of t.messages)r._addMessageParam(e);return r._run(()=>r._createMessage(e,{...t,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),r}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},eb(this,ei,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,s){let r;let n=s?.signal;n&&(n.aborted&&this.controller.abort(),r=this.controller.abort.bind(this.controller),n.addEventListener("abort",r));try{eb(this,X,"m",ea).call(this);let{response:r,data:n}=await e.create({...t,stream:!0},{...s,signal:this.controller.signal}).withResponse();for await(let e of(this._connected(r),n))eb(this,X,"m",eo).call(this,e);if(n.controller.signal?.aborted)throw new ex;eb(this,X,"m",el).call(this)}finally{n&&r&&n.removeEventListener("abort",r)}}_connected(e){this.ended||(ey(this,et,e,"f"),ey(this,es,e?.headers.get("request-id"),"f"),eb(this,H,"f").call(this,e),this._emit("connect"))}get ended(){return eb(this,Q,"f")}get errored(){return eb(this,Y,"f")}get aborted(){return eb(this,Z,"f")}abort(){this.controller.abort()}on(e,t){return(eb(this,G,"f")[e]||(eb(this,G,"f")[e]=[])).push({listener:t}),this}off(e,t){let s=eb(this,G,"f")[e];if(!s)return this;let r=s.findIndex(e=>e.listener===t);return r>=0&&s.splice(r,1),this}once(e,t){return(eb(this,G,"f")[e]||(eb(this,G,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,s)=>{ey(this,ee,!0,"f"),"error"!==e&&this.once("error",s),this.once(e,t)})}async done(){ey(this,ee,!0,"f"),await eb(this,K,"f")}get currentMessage(){return eb(this,F,"f")}async finalMessage(){return await this.done(),eb(this,X,"m",er).call(this)}async finalText(){return await this.done(),eb(this,X,"m",en).call(this)}_emit(e,...t){if(eb(this,Q,"f"))return;"end"===e&&(ey(this,Q,!0,"f"),eb(this,V,"f").call(this));let s=eb(this,G,"f")[e];if(s&&(eb(this,G,"f")[e]=s.filter(e=>!e.once),s.forEach(({listener:e})=>e(...t))),"abort"===e){let e=t[0];eb(this,ee,"f")||s?.length||Promise.reject(e),eb(this,J,"f").call(this,e),eb(this,z,"f").call(this,e),this._emit("end");return}if("error"===e){let e=t[0];eb(this,ee,"f")||s?.length||Promise.reject(e),eb(this,J,"f").call(this,e),eb(this,z,"f").call(this,e),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",eb(this,X,"m",er).call(this))}async _fromReadableStream(e,t){let s;let r=t?.signal;r&&(r.aborted&&this.controller.abort(),s=this.controller.abort.bind(this.controller),r.addEventListener("abort",s));try{eb(this,X,"m",ea).call(this),this._connected(null);let t=tt.fromReadableStream(e,this.controller);for await(let e of t)eb(this,X,"m",eo).call(this,e);if(t.controller.signal?.aborted)throw new ex;eb(this,X,"m",el).call(this)}finally{r&&s&&r.removeEventListener("abort",s)}}[(F=new WeakMap,B=new WeakMap,H=new WeakMap,J=new WeakMap,K=new WeakMap,V=new WeakMap,z=new WeakMap,G=new WeakMap,Q=new WeakMap,Y=new WeakMap,Z=new WeakMap,ee=new WeakMap,et=new WeakMap,es=new WeakMap,ei=new WeakMap,X=new WeakSet,er=function(){if(0===this.receivedMessages.length)throw new ek("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},en=function(){if(0===this.receivedMessages.length)throw new ek("stream ended without producing a Message with role=assistant");let e=this.receivedMessages.at(-1).content.filter(e=>"text"===e.type).map(e=>e.text);if(0===e.length)throw new ek("stream ended without producing a content block with type=text");return e.join(" ")},ea=function(){this.ended||ey(this,F,void 0,"f")},eo=function(e){if(this.ended)return;let t=eb(this,X,"m",eh).call(this,e);switch(this._emit("streamEvent",e,t),e.type){case"content_block_delta":{let s=t.content.at(-1);switch(e.delta.type){case"text_delta":"text"===s.type&&this._emit("text",e.delta.text,s.text||"");break;case"citations_delta":"text"===s.type&&this._emit("citation",e.delta.citation,s.citations??[]);break;case"input_json_delta":t3(s)&&s.input&&this._emit("inputJson",e.delta.partial_json,s.input);break;case"thinking_delta":"thinking"===s.type&&this._emit("thinking",e.delta.thinking,s.thinking);break;case"signature_delta":"thinking"===s.type&&this._emit("signature",s.signature);break;default:e.delta}break}case"message_stop":this._addMessageParam(t),this._addMessage(t,!0);break;case"content_block_stop":this._emit("contentBlock",t.content.at(-1));break;case"message_start":ey(this,F,t,"f")}},el=function(){if(this.ended)throw new ek("stream has ended, this shouldn't happen");let e=eb(this,F,"f");if(!e)throw new ek("request ended without sending any chunks");return ey(this,F,void 0,"f"),e},eh=function(e){let t=eb(this,F,"f");if("message_start"===e.type){if(t)throw new ek(`Unexpected event order, got ${e.type} before receiving "message_stop"`);return e.message}if(!t)throw new ek(`Unexpected event order, got ${e.type} before "message_start"`);switch(e.type){case"message_stop":case"content_block_stop":return t;case"message_delta":return t.stop_reason=e.delta.stop_reason,t.stop_sequence=e.delta.stop_sequence,t.usage.output_tokens=e.usage.output_tokens,null!=e.usage.input_tokens&&(t.usage.input_tokens=e.usage.input_tokens),null!=e.usage.cache_creation_input_tokens&&(t.usage.cache_creation_input_tokens=e.usage.cache_creation_input_tokens),null!=e.usage.cache_read_input_tokens&&(t.usage.cache_read_input_tokens=e.usage.cache_read_input_tokens),null!=e.usage.server_tool_use&&(t.usage.server_tool_use=e.usage.server_tool_use),t;case"content_block_start":return t.content.push({...e.content_block}),t;case"content_block_delta":{let s=t.content.at(e.index);switch(e.delta.type){case"text_delta":s?.type==="text"&&(t.content[e.index]={...s,text:(s.text||"")+e.delta.text});break;case"citations_delta":s?.type==="text"&&(t.content[e.index]={...s,citations:[...s.citations??[],e.delta.citation]});break;case"input_json_delta":if(s&&t3(s)){let r=s[t6]||"";r+=e.delta.partial_json;let n={...s};Object.defineProperty(n,t6,{value:r,enumerable:!1,writable:!0}),r&&(n.input=tF(r)),t.content[e.index]=n}break;case"thinking_delta":s?.type==="thinking"&&(t.content[e.index]={...s,thinking:s.thinking+e.delta.thinking});break;case"signature_delta":s?.type==="thinking"&&(t.content[e.index]={...s,signature:e.delta.signature});break;default:e.delta}return t}}},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("streamEvent",s=>{let r=t.shift();r?r.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),this.on("error",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new tt(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}class t8 extends t${create(e,t){return this._client.post("/v1/messages/batches",{body:e,...t})}retrieve(e,t){return this._client.get(tj`/v1/messages/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/v1/messages/batches",tu,{query:e,...t})}delete(e,t){return this._client.delete(tj`/v1/messages/batches/${e}`,t)}cancel(e,t){return this._client.post(tj`/v1/messages/batches/${e}/cancel`,t)}async results(e,t){let s=await this.retrieve(e);if(!s.results_url)throw new ek(`No batch \`results_url\`; Has it finished processing? ${s.processing_status} - ${s.id}`);return this._client.get(s.results_url,{...t,headers:tA([{Accept:"application/binary"},t?.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((e,t)=>tQ.fromResponse(t.response,t.controller))}}class t7 extends t${constructor(){super(...arguments),this.batches=new t8(this._client)}create(e,t){e.model in se&&console.warn(`The model '${e.model}' is deprecated and will reach end-of-life on ${se[e.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let s=this._client._options.timeout;if(!e.stream&&null==s){let t=tW[e.model]??void 0;s=this._client.calculateNonstreamingTimeout(e.max_tokens,t)}return this._client.post("/v1/messages",{body:e,timeout:s??6e5,...t,stream:e.stream??!1})}stream(e,t){return t9.createMessage(this,e,t)}countTokens(e,t){return this._client.post("/v1/messages/count_tokens",{body:e,...t})}}let se={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-3-opus-20240229":"January 5th, 2026","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025","claude-3-7-sonnet-latest":"February 19th, 2026","claude-3-7-sonnet-20250219":"February 19th, 2026"};t7.Batches=t8;class st extends t${retrieve(e,t={},s){let{betas:r}=t??{};return this._client.get(tj`/v1/models/${e}`,{...s,headers:tA([{...r?.toString()!=null?{"anthropic-beta":r?.toString()}:void 0},s?.headers])})}list(e={},t){let{betas:s,...r}=e??{};return this._client.getAPIList("/v1/models",tu,{query:r,...t,headers:tA([{...s?.toString()!=null?{"anthropic-beta":s?.toString()}:void 0},t?.headers])})}}let ss=e=>void 0!==globalThis.process?globalThis.process.env?.[e]?.trim()??void 0:void 0!==globalThis.Deno?globalThis.Deno.env?.get?.(e)?.trim():void 0;class sr{constructor({baseURL:e=ss("ANTHROPIC_BASE_URL"),apiKey:t=ss("ANTHROPIC_API_KEY")??null,authToken:s=ss("ANTHROPIC_AUTH_TOKEN")??null,...r}={}){eu.add(this),ed.set(this,void 0);let n={apiKey:t,authToken:s,...r,baseURL:e||"https://api.anthropic.com"};if(!n.dangerouslyAllowBrowser&&eB())throw new ek("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew Anthropic({ apiKey, dangerouslyAllowBrowser: true });\n");this.baseURL=n.baseURL,this.timeout=n.timeout??ec.DEFAULT_TIMEOUT,this.logger=n.logger??console;let i="warn";this.logLevel=i,this.logLevel=e5(n.logLevel,"ClientOptions.logLevel",this)??e5(ss("ANTHROPIC_LOG"),"process.env['ANTHROPIC_LOG']",this)??i,this.fetchOptions=n.fetchOptions,this.maxRetries=n.maxRetries??2,this.fetch=n.fetch??function(){if("undefined"!=typeof fetch)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new Anthropic({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),ey(this,ed,eZ,"f"),this._options=n,this.apiKey="string"==typeof t?t:null,this.authToken=s}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,authToken:this.authToken,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){if(!(e.get("x-api-key")||e.get("authorization")||this.apiKey&&e.get("x-api-key")||t.has("x-api-key")||this.authToken&&e.get("authorization")||t.has("authorization")))throw Error('Could not resolve authentication method. Expected either apiKey or authToken to be set. Or for one of the "X-Api-Key" or "Authorization" headers to be explicitly omitted')}async authHeaders(e){return tA([await this.apiKeyAuth(e),await this.bearerAuth(e)])}async apiKeyAuth(e){if(null!=this.apiKey)return tA([{"X-Api-Key":this.apiKey}])}async bearerAuth(e){if(null!=this.authToken)return tA([{Authorization:`Bearer ${this.authToken}`}])}stringifyQuery(e){return Object.entries(e).filter(([e,t])=>void 0!==t).map(([e,t])=>{if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(null===t)return`${encodeURIComponent(e)}=`;throw new ek(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${eF}`}defaultIdempotencyKey(){return`stainless-node-retry-${ew()}`}makeStatusError(e,t,s,r){return eS.generate(e,t,s,r)}buildURL(e,t,s){let r=!eb(this,eu,"m",ef).call(this)&&s||this.baseURL,n=new URL(eW(e)?e:r+(r.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return!function(e){if(!e)return!0;for(let t in e)return!1;return!0}(i)&&(t={...i,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}_calculateNonstreamingTimeout(e){if(3600*e/128e3>600)throw new ek("Streaming is required for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#streaming-responses for more details");return 6e5}async prepareOptions(e){}async prepareRequest(e,{url:t,options:s}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then(s=>({method:e,path:t,...s})))}request(e,t=null){return new to(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,s){let r=await e,n=r.maxRetries??this.maxRetries;null==t&&(t=n),await this.prepareOptions(r);let{req:i,url:a,timeout:o}=await this.buildRequest(r,{retryCount:n-t});await this.prepareRequest(i,{url:a,options:r});let l="log_"+(16777216*Math.random()|0).toString(16).padStart(6,"0"),h=void 0===s?"":`, retryOf: ${s}`,u=Date.now();if(e7(this).debug(`[${l}] sending request`,te({retryOfRequestLogID:s,method:r.method,url:a,options:r,headers:i.headers})),r.signal?.aborted)throw new ex;let c=new AbortController,d=await this.fetchWithTimeout(a,i,o,c).catch(ev),f=Date.now();if(d instanceof globalThis.Error){let e=`retrying, ${t} attempts remaining`;if(r.signal?.aborted)throw new ex;let n=e_(d)||/timed? ?out/i.test(String(d)+("cause"in d?String(d.cause):""));if(t)return e7(this).info(`[${l}] connection ${n?"timed out":"failed"} - ${e}`),e7(this).debug(`[${l}] connection ${n?"timed out":"failed"} (${e})`,te({retryOfRequestLogID:s,url:a,durationMs:f-u,message:d.message})),this.retryRequest(r,t,s??l);if(e7(this).info(`[${l}] connection ${n?"timed out":"failed"} - error; no more retries left`),e7(this).debug(`[${l}] connection ${n?"timed out":"failed"} (error; no more retries left)`,te({retryOfRequestLogID:s,url:a,durationMs:f-u,message:d.message})),n)throw new eM;throw new eR({cause:d})}let p=[...d.headers.entries()].filter(([e])=>"request-id"===e).map(([e,t])=>", "+e+": "+JSON.stringify(t)).join(""),m=`[${l}${h}${p}] ${i.method} ${a} ${d.ok?"succeeded":"failed"} with status ${d.status} in ${f-u}ms`;if(!d.ok){let e=await this.shouldRetry(d);if(t&&e){let e=`retrying, ${t} attempts remaining`;return await eY(d.body),e7(this).info(`${m} - ${e}`),e7(this).debug(`[${l}] response error (${e})`,te({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:f-u})),this.retryRequest(r,t,s??l,d.headers)}let n=e?"error; no more retries left":"error; not retryable";e7(this).info(`${m} - ${n}`);let i=await d.text().catch(e=>ev(e).message),a=eD(i),o=a?void 0:i;throw e7(this).debug(`[${l}] response error (${n})`,te({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,message:o,durationMs:Date.now()-u})),this.makeStatusError(d.status,a,o,d.headers)}return e7(this).info(m),e7(this).debug(`[${l}] response start`,te({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:f-u})),{response:d,options:r,controller:c,requestLogID:l,retryOfRequestLogID:s,startTime:u}}getAPIList(e,t,s){return this.requestAPIList(t,{method:"get",path:e,...s})}requestAPIList(e,t){return new th(this,this.makeRequest(t,null,void 0),e)}async fetchWithTimeout(e,t,s,r){let{signal:n,method:i,...a}=t||{};n&&n.addEventListener("abort",()=>r.abort());let o=setTimeout(()=>r.abort(),s),l=globalThis.ReadableStream&&a.body instanceof globalThis.ReadableStream||"object"==typeof a.body&&null!==a.body&&Symbol.asyncIterator in a.body,h={signal:r.signal,...l?{duplex:"half"}:{},method:"GET",...a};i&&(h.method=i.toUpperCase());try{return await this.fetch.call(void 0,e,h)}finally{clearTimeout(o)}}async shouldRetry(e){let t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||e.status>=500)}async retryRequest(e,t,s,r){let n;let i=r?.get("retry-after-ms");if(i){let e=parseFloat(i);Number.isNaN(e)||(n=e)}let a=r?.get("retry-after");if(a&&!n){let e=parseFloat(a);n=Number.isNaN(e)?Date.parse(a)-Date.now():1e3*e}if(!(n&&0<=n&&n<6e4)){let s=e.maxRetries??this.maxRetries;n=this.calculateDefaultRetryTimeoutMillis(t,s)}return await eX(n),this.makeRequest(e,t-1,s)}calculateDefaultRetryTimeoutMillis(e,t){return Math.min(.5*Math.pow(2,t-e),8)*(1-.25*Math.random())*1e3}calculateNonstreamingTimeout(e,t){if(36e5*e/128e3>6e5||null!=t&&e>t)throw new ek("Streaming is required for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#long-requests for more details");return 6e5}async buildRequest(e,{retryCount:t=0}={}){let s={...e},{method:r,path:n,query:i,defaultBaseURL:a}=s,o=this.buildURL(n,i,a);"timeout"in s&&eC("timeout",s.timeout),s.timeout=s.timeout??this.timeout;let{bodyHeaders:l,body:h}=this.buildBody({options:s}),u=await this.buildHeaders({options:e,method:r,bodyHeaders:l,retryCount:t});return{req:{method:r,headers:u,...s.signal&&{signal:s.signal},...globalThis.ReadableStream&&h instanceof globalThis.ReadableStream&&{duplex:"half"},...h&&{body:h},...this.fetchOptions??{},...s.fetchOptions??{}},url:o,timeout:s.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:s,retryCount:r}){let n={};this.idempotencyHeader&&"get"!==t&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),n[this.idempotencyHeader]=e.idempotencyKey);let i=tA([n,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(r),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...eV(),...this._options.dangerouslyAllowBrowser?{"anthropic-dangerous-direct-browser-access":"true"}:void 0,"anthropic-version":"2023-06-01"},await this.authHeaders(e),this._options.defaultHeaders,s,e.headers]);return this.validateHeaders(i),i.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let s=tA([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||"string"==typeof e&&s.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:"object"==typeof e&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&"function"==typeof e.next)?{bodyHeaders:void 0,body:eG(e)}:eb(this,ed,"f").call(this,{body:e,headers:s})}}ec=sr,ed=new WeakMap,eu=new WeakSet,ef=function(){return"https://api.anthropic.com"!==this.baseURL},sr.Anthropic=ec,sr.HUMAN_PROMPT="\\n\\nHuman:",sr.AI_PROMPT="\\n\\nAssistant:",sr.DEFAULT_TIMEOUT=6e5,sr.AnthropicError=ek,sr.APIError=eS,sr.APIConnectionError=eR,sr.APIConnectionTimeoutError=eM,sr.APIUserAbortError=ex,sr.NotFoundError=eA,sr.ConflictError=eE,sr.RateLimitError=ej,sr.BadRequestError=eP,sr.AuthenticationError=e$,sr.InternalServerError=eI,sr.PermissionDeniedError=eT,sr.UnprocessableEntityError=eO,sr.toFile=tM;class sn extends sr{constructor(){super(...arguments),this.completions=new t5(this),this.messages=new t7(this),this.models=new st(this),this.beta=new t4(this)}}sn.Completions=t5,sn.Messages=t7,sn.Models=st,sn.Beta=t4}};