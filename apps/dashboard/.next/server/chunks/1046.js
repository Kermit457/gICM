exports.id=1046,exports.ids=[1046],exports.modules={43888:e=>{"use strict";function t(e){let t=[],i="",r=!1,s=!1,a="";for(let o=0;o<e.length;o++){let l=e[o];r||"."!==l?"["===l?(i&&(t.push(i),i=""),r=!0):"]"===l&&r?(t.push(i),i="",r=!1,s=!1):('"'===l||"'"===l)&&r?s?l===a?(s=!1,a=""):i+=l:(s=!0,a=l):i+=l:i&&(t.push(i),i="")}return i&&t.push(i),t}function i(e,t,i){let r=e;for(let e=0;e<t.length-1;e++){let i=t[e];if("object"!=typeof r||null===r||!(i in r)||"object"!=typeof r[i]||null===r[i])return!1;r=r[i]}let s=t[t.length-1];if("*"===s){if(Array.isArray(r))for(let e=0;e<r.length;e++)r[e]=i;else if("object"==typeof r&&null!==r)for(let e in r)Object.prototype.hasOwnProperty.call(r,e)&&(r[e]=i)}else"object"==typeof r&&null!==r&&s in r&&Object.prototype.hasOwnProperty.call(r,s)&&(r[s]=i);return!0}function r(e,t){let i=e;for(let e=0;e<t.length-1;e++){let r=t[e];if("object"!=typeof i||null===i||!(r in i)||"object"!=typeof i[r]||null===i[r])return!1;i=i[r]}let r=t[t.length-1];if("*"===r){if(Array.isArray(i))for(let e=0;e<i.length;e++)i[e]=void 0;else if("object"==typeof i&&null!==i)for(let e in i)Object.prototype.hasOwnProperty.call(i,e)&&delete i[e]}else"object"==typeof i&&null!==i&&r in i&&Object.prototype.hasOwnProperty.call(i,r)&&delete i[r];return!0}let s=Symbol("PATH_NOT_FOUND");e.exports=function(e={}){let{paths:a=[],censor:o="[REDACTED]",serialize:l=JSON.stringify,strict:u=!0,remove:c=!1}=e;!function(e){if(!Array.isArray(e))throw TypeError("paths must be an array");for(let t of e)!function(e){if("string"!=typeof e)throw Error("Paths must be (non-empty) strings");if(""===e)throw Error("Invalid redaction path ()");if(e.includes("..")||e.includes(","))throw Error(`Invalid redaction path (${e})`);let t=0,i=!1,r="";for(let s=0;s<e.length;s++){let a=e[s];if(('"'===a||"'"===a)&&t>0)i?a===r&&(i=!1,r=""):(i=!0,r=a);else if("["!==a||i){if("]"===a&&!i&&--t<0)throw Error(`Invalid redaction path (${e})`)}else t++}if(0!==t)throw Error(`Invalid redaction path (${e})`)}(t)}(a);let d=function(e){if(0===e.length)return null;let i=new Map;for(let r of e){let e=t(r),s=i;for(let t=0;t<e.length;t++){let i=e[t];s.has(i)||s.set(i,new Map),s=s.get(i)}}return i}(a);return function(e){if(u&&(null===e||"object"!=typeof e)&&(null==e||"object"!=typeof e))return l?l(e):e;let h=d?function e(t,i,r=0){if(!i||0===i.size||null===t||"object"!=typeof t)return t;if(t instanceof Date)return new Date(t.getTime());if(Array.isArray(t)){let r=[];for(let s=0;s<t.length;s++){let a=s.toString();i.has(a)||i.has("*")?r[s]=e(t[s],i.get(a)||i.get("*")):r[s]=t[s]}return r}let s=Object.create(Object.getPrototypeOf(t));for(let r in t)Object.prototype.hasOwnProperty.call(t,r)&&(i.has(r)||i.has("*")?s[r]=e(t[r],i.get(r)||i.get("*")):s[r]=t[r]);return s}(e,d):e,f=o;return("function"==typeof o&&(f=o),function(e,a,o,l=!1){for(let u of a){let a=t(u);if(a.includes("*"))(function e(t,s,a,o,l=!1){let u=s.indexOf("*");if(u===s.length-1){let e=s.slice(0,-1),i=t;for(let t of e){if(null==i||"object"!=typeof i||null===i)return;i=i[t]}if(Array.isArray(i)){if(l)for(let e=0;e<i.length;e++)i[e]=void 0;else for(let t=0;t<i.length;t++){let r=[...e,t.toString()],s="function"==typeof a?a(i[t],r):a;i[t]=s}}else if("object"==typeof i&&null!==i){if(l){let e=[];for(let t in i)Object.prototype.hasOwnProperty.call(i,t)&&e.push(t);for(let t of e)delete i[t]}else for(let t in i){let r=[...e,t],s="function"==typeof a?a(i[t],r):a;i[t]=s}}}else(function(t,s,a,o,l,u=!1){let c=s.slice(0,o),d=s.slice(o+1),h=[];function f(t,s){if(s===c.length){if(Array.isArray(t))for(let e=0;e<t.length;e++)h[s]=e.toString(),f(t[e],s+1);else if("object"==typeof t&&null!==t)for(let e in t)h[s]=e,f(t[e],s+1)}else if(s<c.length){let e=c[s];t&&"object"==typeof t&&null!==t&&e in t&&(h[s]=e,f(t[e],s+1))}else if(d.includes("*"))e(t,d,"function"==typeof a?(e,t)=>a(e,[...h.slice(0,s),...t]):a,l,u);else if(u)r(t,d);else{let e="function"==typeof a?a(function(e,t){let i=e;for(let e of t){if(null==i||"object"!=typeof i||null===i)return;i=i[e]}return i}(t,d),[...h.slice(0,s),...d]):a;i(t,d,e)}}if(0===c.length)f(t,0);else{let e=t;for(let t=0;t<c.length;t++){let i=c[t];if(null==e||"object"!=typeof e||null===e)return;e=e[i],h[t]=i}null!=e&&f(e,c.length)}})(t,s,a,u,o,l)})(e,a,o,u,l);else if(l)r(e,a);else{let t=function(e,t){let i=e;for(let e of t){if(null==i||"object"!=typeof i||null===i||!(e in i))return s;i=i[e]}return i}(e,a);if(t===s)continue;let r="function"==typeof o?o(t,a):o;i(e,a,r)}}}(h,a,f,c),!1===l)?(h.restore=function(){return function e(t){if(null===t||"object"!=typeof t)return t;if(t instanceof Date)return new Date(t.getTime());if(t instanceof Array){let i=[];for(let r=0;r<t.length;r++)i[r]=e(t[r]);return i}if("object"==typeof t){let i=Object.create(Object.getPrototypeOf(t));for(let r in t)Object.prototype.hasOwnProperty.call(t,r)&&(i[r]=e(t[r]));return i}return t}(e)},h):"function"==typeof l?l(h):JSON.stringify(h)}}},88910:e=>{"use strict";if("undefined"!=typeof SharedArrayBuffer&&"undefined"!=typeof Atomics){let t=new Int32Array(new SharedArrayBuffer(4));e.exports=function(e){if(!1==(e>0&&e<1/0)){if("number"!=typeof e&&"bigint"!=typeof e)throw TypeError("sleep: ms must be a number");throw RangeError("sleep: ms must be a number that is greater than 0 but less than Infinity")}Atomics.wait(t,0,0,Number(e))}}else e.exports=function(e){if(!1==(e>0&&e<1/0)){if("number"!=typeof e&&"bigint"!=typeof e)throw TypeError("sleep: ms must be a number");throw RangeError("sleep: ms must be a number that is greater than 0 but less than Infinity")}let t=Date.now()+Number(e);for(;t>Date.now(););}},32115:e=>{"use strict";var t=Object.prototype.hasOwnProperty,i="~";function r(){}function s(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function a(e,t,r,a,o){if("function"!=typeof r)throw TypeError("The listener must be a function");var l=new s(r,a||e,o),u=i?i+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],l]:e._events[u].push(l):(e._events[u]=l,e._eventsCount++),e}function o(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function l(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(i=!1)),l.prototype.eventNames=function(){var e,r,s=[];if(0===this._eventsCount)return s;for(r in e=this._events)t.call(e,r)&&s.push(i?r.slice(1):r);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(e)):s},l.prototype.listeners=function(e){var t=i?i+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var s=0,a=r.length,o=Array(a);s<a;s++)o[s]=r[s].fn;return o},l.prototype.listenerCount=function(e){var t=i?i+e:e,r=this._events[t];return r?r.fn?1:r.length:0},l.prototype.emit=function(e,t,r,s,a,o){var l=i?i+e:e;if(!this._events[l])return!1;var u,c,d=this._events[l],h=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),h){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,r),!0;case 4:return d.fn.call(d.context,t,r,s),!0;case 5:return d.fn.call(d.context,t,r,s,a),!0;case 6:return d.fn.call(d.context,t,r,s,a,o),!0}for(c=1,u=Array(h-1);c<h;c++)u[c-1]=arguments[c];d.fn.apply(d.context,u)}else{var f,p=d.length;for(c=0;c<p;c++)switch(d[c].once&&this.removeListener(e,d[c].fn,void 0,!0),h){case 1:d[c].fn.call(d[c].context);break;case 2:d[c].fn.call(d[c].context,t);break;case 3:d[c].fn.call(d[c].context,t,r);break;case 4:d[c].fn.call(d[c].context,t,r,s);break;default:if(!u)for(f=1,u=Array(h-1);f<h;f++)u[f-1]=arguments[f];d[c].fn.apply(d[c].context,u)}}return!0},l.prototype.on=function(e,t,i){return a(this,e,t,i,!1)},l.prototype.once=function(e,t,i){return a(this,e,t,i,!0)},l.prototype.removeListener=function(e,t,r,s){var a=i?i+e:e;if(!this._events[a])return this;if(!t)return o(this,a),this;var l=this._events[a];if(l.fn)l.fn!==t||s&&!l.once||r&&l.context!==r||o(this,a);else{for(var u=0,c=[],d=l.length;u<d;u++)(l[u].fn!==t||s&&!l[u].once||r&&l[u].context!==r)&&c.push(l[u]);c.length?this._events[a]=1===c.length?c[0]:c:o(this,a)}return this},l.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&o(this,t)):(this._events=new r,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=i,l.EventEmitter=l,e.exports=l},10754:e=>{"use strict";let t;let i={exit:[],beforeExit:[]},r={exit:function(){a("exit")},beforeExit:function(){a("beforeExit")}};function s(e){i[e].length>0||(process.removeListener(e,r[e]),0!==i.exit.length||0!==i.beforeExit.length||(t=void 0))}function a(e){for(let t of i[e]){let i=t.deref(),r=t.fn;void 0!==i&&r(i,e)}i[e]=[]}function o(e){for(let t of["exit","beforeExit"]){let r=i[t].indexOf(e);i[t].splice(r,r+1),s(t)}}function l(e,s,a){if(void 0===s)throw Error("the object can't be undefined");i[e].length>0||process.on(e,r[e]);let l=new WeakRef(s);l.fn=a,void 0===t&&(t=new FinalizationRegistry(o)),t.register(s,l),i[e].push(l)}e.exports={register:function(e,t){l("exit",e,t)},registerBeforeExit:function(e,t){l("beforeExit",e,t)},unregister:function(e){if(void 0!==t)for(let r of(t.unregister(e),["exit","beforeExit"]))i[r]=i[r].filter(t=>{let i=t.deref();return i&&i!==e}),s(r)}}},22630:e=>{"use strict";function t(e){try{return JSON.stringify(e)}catch(e){return'"[Circular]"'}}e.exports=function(e,i,r){var s=r&&r.stringify||t;if("object"==typeof e&&null!==e){var a=i.length+1;if(1===a)return e;var o=Array(a);o[0]=s(e);for(var l=1;l<a;l++)o[l]=s(i[l]);return o.join(" ")}if("string"!=typeof e)return e;var u=i.length;if(0===u)return e;for(var c="",d=0,h=-1,f=e&&e.length||0,p=0;p<f;){if(37===e.charCodeAt(p)&&p+1<f){switch(h=h>-1?h:0,e.charCodeAt(p+1)){case 100:case 102:if(d>=u||null==i[d])break;h<p&&(c+=e.slice(h,p)),c+=Number(i[d]),h=p+2,p++;break;case 105:if(d>=u||null==i[d])break;h<p&&(c+=e.slice(h,p)),c+=Math.floor(Number(i[d])),h=p+2,p++;break;case 79:case 111:case 106:if(d>=u||void 0===i[d])break;h<p&&(c+=e.slice(h,p));var m=typeof i[d];if("string"===m){c+="'"+i[d]+"'",h=p+2,p++;break}if("function"===m){c+=i[d].name||"<anonymous>",h=p+2,p++;break}c+=s(i[d]),h=p+2,p++;break;case 115:if(d>=u)break;h<p&&(c+=e.slice(h,p)),c+=String(i[d]),h=p+2,p++;break;case 37:h<p&&(c+=e.slice(h,p)),c+="%",h=p+2,p++,d--}++d}++p}return -1===h?e:(h<f&&(c+=e.slice(h)),c)}},70354:(e,t)=>{"use strict";let{hasOwnProperty:i}=Object.prototype,r=f();r.configure=f,r.stringify=r,r.default=r,t.stringify=r,t.configure=f,e.exports=r;let s=/[\u0000-\u001f\u0022\u005c\ud800-\udfff]/;function a(e){return e.length<5e3&&!s.test(e)?`"${e}"`:JSON.stringify(e)}function o(e,t){if(e.length>200||t)return e.sort(t);for(let t=1;t<e.length;t++){let i=e[t],r=t;for(;0!==r&&e[r-1]>i;)e[r]=e[r-1],r--;e[r]=i}return e}let l=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(Object.getPrototypeOf(new Int8Array)),Symbol.toStringTag).get;function u(e){return void 0!==l.call(e)&&0!==e.length}function c(e,t,i){e.length<i&&(i=e.length);let r=","===t?"":" ",s=`"0":${r}${e[0]}`;for(let a=1;a<i;a++)s+=`${t}"${a}":${r}${e[a]}`;return s}function d(e,t){let r;if(i.call(e,t)){if("number"!=typeof(r=e[t]))throw TypeError(`The "${t}" argument must be of type number`);if(!Number.isInteger(r))throw TypeError(`The "${t}" argument must be an integer`);if(r<1)throw RangeError(`The "${t}" argument must be >= 1`)}return void 0===r?1/0:r}function h(e){return 1===e?"1 item":`${e} items`}function f(e){let t=function(e){if(i.call(e,"strict")){let t=e.strict;if("boolean"!=typeof t)throw TypeError('The "strict" argument must be of type boolean');if(t)return e=>{let t=`Object can not safely be stringified. Received type ${typeof e}`;throw"function"!=typeof e&&(t+=` (${e.toString()})`),Error(t)}}}(e={...e});!t||(void 0===e.bigint&&(e.bigint=!1),"circularValue"in e||(e.circularValue=Error));let r=function(e){if(i.call(e,"circularValue")){let t=e.circularValue;if("string"==typeof t)return`"${t}"`;if(null==t)return t;if(t===Error||t===TypeError)return{toString(){throw TypeError("Converting circular structure to JSON")}};throw TypeError('The "circularValue" argument must be of type string or the value null or undefined')}return'"[Circular]"'}(e),s=function(e,t){let r;if(i.call(e,t)&&"boolean"!=typeof(r=e[t]))throw TypeError(`The "${t}" argument must be of type boolean`);return void 0===r||r}(e,"bigint"),l=function(e){let t;if(i.call(e,"deterministic")&&"boolean"!=typeof(t=e.deterministic)&&"function"!=typeof t)throw TypeError('The "deterministic" argument must be of type boolean or comparator function');return void 0===t||t}(e),f="function"==typeof l?l:void 0,p=d(e,"maximumDepth"),m=d(e,"maximumBreadth");return function(e,i,d){if(arguments.length>1){let g="";if("number"==typeof d?g=" ".repeat(Math.min(d,10)):"string"==typeof d&&(g=d.slice(0,10)),null!=i){if("function"==typeof i)return function e(i,c,d,g,y,v){let _=c[i];switch("object"==typeof _&&null!==_&&"function"==typeof _.toJSON&&(_=_.toJSON(i)),typeof(_=g.call(c,i,_))){case"string":return a(_);case"object":{if(null===_)return"null";if(-1!==d.indexOf(_))return r;let t="",i=",",s=v;if(Array.isArray(_)){if(0===_.length)return"[]";if(p<d.length+1)return'"[Array]"';d.push(_),""!==y&&(v+=y,t+=`
${v}`,i=`,
${v}`);let r=Math.min(_.length,m),a=0;for(;a<r-1;a++){let r=e(String(a),_,d,g,y,v);t+=(void 0!==r?r:"null")+i}let o=e(String(a),_,d,g,y,v);if(t+=void 0!==o?o:"null",_.length-1>m){let e=_.length-m-1;t+=`${i}"... ${h(e)} not stringified"`}return""!==y&&(t+=`
${s}`),d.pop(),`[${t}]`}let c=Object.keys(_),b=c.length;if(0===b)return"{}";if(p<d.length+1)return'"[Object]"';let w="",x="";""!==y&&(v+=y,i=`,
${v}`,w=" ");let k=Math.min(b,m);l&&!u(_)&&(c=o(c,f)),d.push(_);for(let r=0;r<k;r++){let s=c[r],o=e(s,_,d,g,y,v);void 0!==o&&(t+=`${x}${a(s)}:${w}${o}`,x=i)}return b>m&&(t+=`${x}"...":${w}"${h(b-m)} not stringified"`,x=i),""!==y&&x.length>1&&(t=`
${v}${t}
${s}`),d.pop(),`{${t}}`}case"number":return isFinite(_)?String(_):t?t(_):"null";case"boolean":return!0===_?"true":"false";case"undefined":return;case"bigint":if(s)return String(_);default:return t?t(_):void 0}}("",{"":e},[],i,g,"");if(Array.isArray(i))return function e(i,o,l,u,c,d){switch("object"==typeof o&&null!==o&&"function"==typeof o.toJSON&&(o=o.toJSON(i)),typeof o){case"string":return a(o);case"object":{if(null===o)return"null";if(-1!==l.indexOf(o))return r;let t=d,i="",s=",";if(Array.isArray(o)){if(0===o.length)return"[]";if(p<l.length+1)return'"[Array]"';l.push(o),""!==c&&(d+=c,i+=`
${d}`,s=`,
${d}`);let r=Math.min(o.length,m),a=0;for(;a<r-1;a++){let t=e(String(a),o[a],l,u,c,d);i+=(void 0!==t?t:"null")+s}let f=e(String(a),o[a],l,u,c,d);if(i+=void 0!==f?f:"null",o.length-1>m){let e=o.length-m-1;i+=`${s}"... ${h(e)} not stringified"`}return""!==c&&(i+=`
${t}`),l.pop(),`[${i}]`}l.push(o);let f="";""!==c&&(d+=c,s=`,
${d}`,f=" ");let g="";for(let t of u){let r=e(t,o[t],l,u,c,d);void 0!==r&&(i+=`${g}${a(t)}:${f}${r}`,g=s)}return""!==c&&g.length>1&&(i=`
${d}${i}
${t}`),l.pop(),`{${i}}`}case"number":return isFinite(o)?String(o):t?t(o):"null";case"boolean":return!0===o?"true":"false";case"undefined":return;case"bigint":if(s)return String(o);default:return t?t(o):void 0}}("",e,[],function(e){let t=new Set;for(let i of e)("string"==typeof i||"number"==typeof i)&&t.add(String(i));return t}(i),g,"")}if(0!==g.length)return function e(i,d,g,y,v){switch(typeof d){case"string":return a(d);case"object":{if(null===d)return"null";if("function"==typeof d.toJSON){if("object"!=typeof(d=d.toJSON(i)))return e(i,d,g,y,v);if(null===d)return"null"}if(-1!==g.indexOf(d))return r;let t=v;if(Array.isArray(d)){if(0===d.length)return"[]";if(p<g.length+1)return'"[Array]"';g.push(d),v+=y;let i=`
${v}`,r=`,
${v}`,s=Math.min(d.length,m),a=0;for(;a<s-1;a++){let t=e(String(a),d[a],g,y,v);i+=(void 0!==t?t:"null")+r}let o=e(String(a),d[a],g,y,v);if(i+=void 0!==o?o:"null",d.length-1>m){let e=d.length-m-1;i+=`${r}"... ${h(e)} not stringified"`}return i+=`
${t}`,g.pop(),`[${i}]`}let s=Object.keys(d),_=s.length;if(0===_)return"{}";if(p<g.length+1)return'"[Object]"';v+=y;let b=`,
${v}`,w="",x="",k=Math.min(_,m);u(d)&&(w+=c(d,b,m),s=s.slice(d.length),k-=d.length,x=b),l&&(s=o(s,f)),g.push(d);for(let t=0;t<k;t++){let i=s[t],r=e(i,d[i],g,y,v);void 0!==r&&(w+=`${x}${a(i)}: ${r}`,x=b)}return _>m&&(w+=`${x}"...": "${h(_-m)} not stringified"`,x=b),""!==x&&(w=`
${v}${w}
${t}`),g.pop(),`{${w}}`}case"number":return isFinite(d)?String(d):t?t(d):"null";case"boolean":return!0===d?"true":"false";case"undefined":return;case"bigint":if(s)return String(d);default:return t?t(d):void 0}}("",e,[],g,"")}return function e(i,d,g){switch(typeof d){case"string":return a(d);case"object":{if(null===d)return"null";if("function"==typeof d.toJSON){if("object"!=typeof(d=d.toJSON(i)))return e(i,d,g);if(null===d)return"null"}if(-1!==g.indexOf(d))return r;let t="",s=void 0!==d.length;if(s&&Array.isArray(d)){if(0===d.length)return"[]";if(p<g.length+1)return'"[Array]"';g.push(d);let i=Math.min(d.length,m),r=0;for(;r<i-1;r++){let i=e(String(r),d[r],g);t+=(void 0!==i?i:"null")+","}let s=e(String(r),d[r],g);if(t+=void 0!==s?s:"null",d.length-1>m){let e=d.length-m-1;t+=`,"... ${h(e)} not stringified"`}return g.pop(),`[${t}]`}let y=Object.keys(d),v=y.length;if(0===v)return"{}";if(p<g.length+1)return'"[Object]"';let _="",b=Math.min(v,m);s&&u(d)&&(t+=c(d,",",m),y=y.slice(d.length),b-=d.length,_=","),l&&(y=o(y,f)),g.push(d);for(let i=0;i<b;i++){let r=y[i],s=e(r,d[r],g);void 0!==s&&(t+=`${_}${a(r)}:${s}`,_=",")}return v>m&&(t+=`${_}"...":"${h(v-m)} not stringified"`),g.pop(),`{${t}}`}case"number":return isFinite(d)?String(d):t?t(d):"null";case"boolean":return!0===d?"true":"false";case"undefined":return;case"bigint":if(s)return String(d);default:return t?t(d):void 0}}("",e,[])}}},56830:(e,t,i)=>{"use strict";let{version:r}=i(42918),{EventEmitter:s}=i(17702),{Worker:a}=i(6162),{join:o}=i(55315),{pathToFileURL:l}=i(17360),{wait:u}=i(94105),{WRITE_INDEX:c,READ_INDEX:d}=i(82725),h=i(78893),f=i(27790),p=Symbol("kImpl"),m=h.constants.MAX_STRING_LENGTH;class g{constructor(e){this._value=e}deref(){return this._value}}class y{register(){}unregister(){}}let v=process.env.NODE_V8_COVERAGE?y:global.FinalizationRegistry||y,_=process.env.NODE_V8_COVERAGE?g:global.WeakRef||g,b=new v(e=>{e.exited||e.terminate()});function w(e){f(!e[p].sync),e[p].needDrain&&(e[p].needDrain=!1,e.emit("drain"))}function x(e){let t=this.stream.deref();if(void 0===t){this.exited=!0,this.terminate();return}switch(e.code){case"READY":this.stream=new _(t),t.flush(()=>{t[p].ready=!0,t.emit("ready")});break;case"ERROR":E(t,e.err);break;case"EVENT":Array.isArray(e.args)?t.emit(e.name,...e.args):t.emit(e.name,e.args);break;case"WARNING":process.emitWarning(e.err);break;default:E(t,Error("this should not happen: "+e.code))}}function k(e){let t=this.stream.deref();void 0!==t&&(b.unregister(t),t.worker.exited=!0,t.worker.off("exit",k),E(t,0!==e?Error("the worker thread exited"):null))}class A extends s{constructor(e={}){if(super(),e.bufferSize<4)throw Error("bufferSize must at least fit a 4-byte utf-8 char");this[p]={},this[p].stateBuf=new SharedArrayBuffer(128),this[p].state=new Int32Array(this[p].stateBuf),this[p].dataBuf=new SharedArrayBuffer(e.bufferSize||4194304),this[p].data=Buffer.from(this[p].dataBuf),this[p].sync=e.sync||!1,this[p].ending=!1,this[p].ended=!1,this[p].needDrain=!1,this[p].destroyed=!1,this[p].flushing=!1,this[p].ready=!1,this[p].finished=!1,this[p].errored=null,this[p].closed=!1,this[p].buf="",this.worker=function(e,t){let{filename:i,workerData:s}=t,u=new a(("__bundlerPathsOverrides"in globalThis?globalThis.__bundlerPathsOverrides:{})["thread-stream-worker"]||o(__dirname,"lib","worker.js"),{...t.workerOpts,trackUnmanagedFds:!1,workerData:{filename:0===i.indexOf("file://")?i:l(i).href,dataBuf:e[p].dataBuf,stateBuf:e[p].stateBuf,workerData:{$context:{threadStreamVersion:r},...s}}});return u.stream=new g(e),u.on("message",x),u.on("exit",k),b.register(e,u),u}(this,e),this.on("message",(e,t)=>{this.worker.postMessage(e,t)})}write(e){if(this[p].destroyed)return S(this,Error("the worker has exited")),!1;if(this[p].ending)return S(this,Error("the worker is ending")),!1;if(this[p].flushing&&this[p].buf.length+e.length>=m)try{$(this),this[p].flushing=!0}catch(e){return E(this,e),!1}if(this[p].buf+=e,this[p].sync)try{return $(this),!0}catch(e){return E(this,e),!1}return this[p].flushing||(this[p].flushing=!0,setImmediate(function e(t){let i=Atomics.load(t[p].state,c),r=t[p].data.length-i;if(r>0){if(0===t[p].buf.length){t[p].flushing=!1,t[p].ending?O(t):t[p].needDrain&&process.nextTick(w,t);return}let i=t[p].buf.slice(0,r),s=Buffer.byteLength(i);s<=r?(t[p].buf=t[p].buf.slice(r),T(t,i,e.bind(null,t))):t.flush(()=>{if(!t.destroyed){for(Atomics.store(t[p].state,d,0),Atomics.store(t[p].state,c,0);s>t[p].data.length;)r/=2,i=t[p].buf.slice(0,r),s=Buffer.byteLength(i);t[p].buf=t[p].buf.slice(r),T(t,i,e.bind(null,t))}})}else if(0===r){if(0===i&&0===t[p].buf.length)return;t.flush(()=>{Atomics.store(t[p].state,d,0),Atomics.store(t[p].state,c,0),e(t)})}else E(t,Error("overwritten"))},this)),this[p].needDrain=this[p].data.length-this[p].buf.length-Atomics.load(this[p].state,c)<=0,!this[p].needDrain}end(){this[p].destroyed||(this[p].ending=!0,O(this))}flush(e){if(this[p].destroyed){"function"==typeof e&&process.nextTick(e,Error("the worker has exited"));return}let t=Atomics.load(this[p].state,c);u(this[p].state,d,t,1/0,(t,i)=>{if(t){E(this,t),process.nextTick(e,t);return}if("not-equal"===i){this.flush(e);return}process.nextTick(e)})}flushSync(){this[p].destroyed||($(this),C(this))}unref(){this.worker.unref()}ref(){this.worker.ref()}get ready(){return this[p].ready}get destroyed(){return this[p].destroyed}get closed(){return this[p].closed}get writable(){return!this[p].destroyed&&!this[p].ending}get writableEnded(){return this[p].ending}get writableFinished(){return this[p].finished}get writableNeedDrain(){return this[p].needDrain}get writableObjectMode(){return!1}get writableErrored(){return this[p].errored}}function S(e,t){setImmediate(()=>{e.emit("error",t)})}function E(e,t){e[p].destroyed||(e[p].destroyed=!0,t&&(e[p].errored=t,S(e,t)),e.worker.exited?setImmediate(()=>{e[p].closed=!0,e.emit("close")}):e.worker.terminate().catch(()=>{}).then(()=>{e[p].closed=!0,e.emit("close")}))}function T(e,t,i){let r=Atomics.load(e[p].state,c),s=Buffer.byteLength(t);return e[p].data.write(t,r),Atomics.store(e[p].state,c,r+s),Atomics.notify(e[p].state,c),i(),!0}function O(e){if(!e[p].ended&&e[p].ending&&!e[p].flushing){e[p].ended=!0;try{e.flushSync();let t=Atomics.load(e[p].state,d);Atomics.store(e[p].state,c,-1),Atomics.notify(e[p].state,c);let i=0;for(;-1!==t;){if(Atomics.wait(e[p].state,d,t,1e3),t=Atomics.load(e[p].state,d),-2===t){E(e,Error("end() failed"));return}if(10==++i){E(e,Error("end() took too long (10s)"));return}}process.nextTick(()=>{e[p].finished=!0,e.emit("finish")})}catch(t){E(e,t)}}}function $(e){let t=()=>{e[p].ending?O(e):e[p].needDrain&&process.nextTick(w,e)};for(e[p].flushing=!1;0!==e[p].buf.length;){let i=Atomics.load(e[p].state,c),r=e[p].data.length-i;if(0===r){C(e),Atomics.store(e[p].state,d,0),Atomics.store(e[p].state,c,0);continue}if(r<0)throw Error("overwritten");let s=e[p].buf.slice(0,r),a=Buffer.byteLength(s);if(a<=r)e[p].buf=e[p].buf.slice(r),T(e,s,t);else{for(C(e),Atomics.store(e[p].state,d,0),Atomics.store(e[p].state,c,0);a>e[p].buf.length;)r/=2,s=e[p].buf.slice(0,r),a=Buffer.byteLength(s);e[p].buf=e[p].buf.slice(r),T(e,s,t)}}}function C(e){if(e[p].flushing)throw Error("unable to flush while flushing");let t=Atomics.load(e[p].state,c),i=0;for(;;){let r=Atomics.load(e[p].state,d);if(-2===r)throw Error("_flushSync failed");if(r!==t)Atomics.wait(e[p].state,d,r,1e3);else break;if(10==++i)throw Error("_flushSync took too long (10s)")}}e.exports=A},82725:e=>{"use strict";e.exports={WRITE_INDEX:4,READ_INDEX:8}},94105:e=>{"use strict";e.exports={wait:function(e,t,i,r,s){let a=Date.now()+r,o=Atomics.load(e,t);if(o===i){s(null,"ok");return}let l=o,u=r=>{Date.now()>a?s(null,"timed-out"):setTimeout(()=>{l=o,(o=Atomics.load(e,t))===l?u(r>=1e3?1e3:2*r):o===i?s(null,"ok"):s(null,"not-equal")},r)};u(1)},waitDiff:function(e,t,i,r,s){let a=Date.now()+r,o=Atomics.load(e,t);if(o!==i){s(null,"ok");return}let l=r=>{Date.now()>a?s(null,"timed-out"):setTimeout(()=>{(o=Atomics.load(e,t))!==i?s(null,"ok"):l(r>=1e3?1e3:2*r)},r)};l(1)}}},34479:(e,t,i)=>{"use strict";let r=i(35460),s=i(26202),a=i(92558),o=i(38502);e.exports={err:r,errWithCause:s,mapHttpRequest:a.mapHttpRequest,mapHttpResponse:o.mapHttpResponse,req:a.reqSerializer,res:o.resSerializer,wrapErrorSerializer:function(e){return e===r?e:function(t){return e(r(t))}},wrapRequestSerializer:function(e){return e===a.reqSerializer?e:function(t){return e(a.reqSerializer(t))}},wrapResponseSerializer:function(e){return e===o.resSerializer?e:function(t){return e(o.resSerializer(t))}}}},43850:e=>{"use strict";let t=e=>e&&"string"==typeof e.message,i=e=>{if(!e)return;let i=e.cause;if("function"!=typeof i)return t(i)?i:void 0;{let i=e.cause();return t(i)?i:void 0}},r=(e,s)=>{if(!t(e))return"";let a=e.stack||"";if(s.has(e))return a+"\ncauses have become circular...";let o=i(e);return o?(s.add(e),a+"\ncaused by: "+r(o,s)):a},s=(e,r,a)=>{if(!t(e))return"";let o=a?"":e.message||"";if(r.has(e))return o+": ...";let l=i(e);if(!l)return o;{r.add(e);let t="function"==typeof e.cause;return o+(t?"":": ")+s(l,r,t)}};e.exports={isErrorLike:t,getErrorCause:i,stackWithCauses:e=>r(e,new Set),messageWithCauses:e=>s(e,new Set)}},60546:e=>{"use strict";let t=Symbol("circular-ref-tag"),i=Symbol("pino-raw-err-ref"),r=Object.create({},{type:{enumerable:!0,writable:!0,value:void 0},message:{enumerable:!0,writable:!0,value:void 0},stack:{enumerable:!0,writable:!0,value:void 0},aggregateErrors:{enumerable:!0,writable:!0,value:void 0},raw:{enumerable:!1,get:function(){return this[i]},set:function(e){this[i]=e}}});Object.defineProperty(r,i,{writable:!0,value:{}}),e.exports={pinoErrProto:r,pinoErrorSymbols:{seen:t,rawSymbol:i}}},26202:(e,t,i)=>{"use strict";e.exports=function e(t){if(!r(t))return t;t[o]=void 0;let i=Object.create(s);for(let s in i.type="[object Function]"===l.call(t.constructor)?t.constructor.name:t.name,i.message=t.message,i.stack=t.stack,Array.isArray(t.errors)&&(i.aggregateErrors=t.errors.map(t=>e(t))),r(t.cause)&&!Object.prototype.hasOwnProperty.call(t.cause,o)&&(i.cause=e(t.cause)),t)if(void 0===i[s]){let a=t[s];r(a)?Object.prototype.hasOwnProperty.call(a,o)||(i[s]=e(a)):i[s]=a}return delete t[o],i.raw=t,i};let{isErrorLike:r}=i(43850),{pinoErrProto:s,pinoErrorSymbols:a}=i(60546),{seen:o}=a,{toString:l}=Object.prototype},35460:(e,t,i)=>{"use strict";e.exports=function e(t){if(!a(t))return t;t[u]=void 0;let i=Object.create(o);for(let o in i.type="[object Function]"===c.call(t.constructor)?t.constructor.name:t.name,i.message=r(t),i.stack=s(t),Array.isArray(t.errors)&&(i.aggregateErrors=t.errors.map(t=>e(t))),t)if(void 0===i[o]){let r=t[o];a(r)?"cause"===o||Object.prototype.hasOwnProperty.call(r,u)||(i[o]=e(r)):i[o]=r}return delete t[u],i.raw=t,i};let{messageWithCauses:r,stackWithCauses:s,isErrorLike:a}=i(43850),{pinoErrProto:o,pinoErrorSymbols:l}=i(60546),{seen:u}=l,{toString:c}=Object.prototype},92558:e=>{"use strict";e.exports={mapHttpRequest:function(e){return{req:r(e)}},reqSerializer:r};let t=Symbol("pino-raw-req-ref"),i=Object.create({},{id:{enumerable:!0,writable:!0,value:""},method:{enumerable:!0,writable:!0,value:""},url:{enumerable:!0,writable:!0,value:""},query:{enumerable:!0,writable:!0,value:""},params:{enumerable:!0,writable:!0,value:""},headers:{enumerable:!0,writable:!0,value:{}},remoteAddress:{enumerable:!0,writable:!0,value:""},remotePort:{enumerable:!0,writable:!0,value:""},raw:{enumerable:!1,get:function(){return this[t]},set:function(e){this[t]=e}}});function r(e){let t=e.info||e.socket,r=Object.create(i);if(r.id="function"==typeof e.id?e.id():e.id||(e.info?e.info.id:void 0),r.method=e.method,e.originalUrl)r.url=e.originalUrl;else{let t=e.path;r.url="string"==typeof t?t:e.url?e.url.path||e.url:void 0}return e.query&&(r.query=e.query),e.params&&(r.params=e.params),r.headers=e.headers,r.remoteAddress=t&&t.remoteAddress,r.remotePort=t&&t.remotePort,r.raw=e.raw||e,r}Object.defineProperty(i,t,{writable:!0,value:{}})},38502:e=>{"use strict";e.exports={mapHttpResponse:function(e){return{res:r(e)}},resSerializer:r};let t=Symbol("pino-raw-res-ref"),i=Object.create({},{statusCode:{enumerable:!0,writable:!0,value:0},headers:{enumerable:!0,writable:!0,value:""},raw:{enumerable:!1,get:function(){return this[t]},set:function(e){this[t]=e}}});function r(e){let t=Object.create(i);return t.statusCode=e.headersSent?e.statusCode:null,t.headers=e.getHeaders?e.getHeaders():e._headers,t.raw=e,t}Object.defineProperty(i,t,{writable:!0,value:{}})},43969:e=>{"use strict";function t(e,t){return t}e.exports=function(){let e=Error.prepareStackTrace;Error.prepareStackTrace=t;let i=Error().stack;if(Error.prepareStackTrace=e,!Array.isArray(i))return;let r=i.slice(2),s=[];for(let e of r)e&&s.push(e.getFileName());return s}},40482:e=>{e.exports={DEFAULT_LEVELS:{trace:10,debug:20,info:30,warn:40,error:50,fatal:60},SORTING_ORDER:{ASC:"ASC",DESC:"DESC"}}},11527:(e,t,i)=>{"use strict";let{lsCacheSym:r,levelValSym:s,useOnlyCustomLevelsSym:a,streamSym:o,formattersSym:l,hooksSym:u,levelCompSym:c}=i(39925),{noop:d,genLog:h}=i(35746),{DEFAULT_LEVELS:f,SORTING_ORDER:p}=i(40482),m={fatal:e=>{let t=h(f.fatal,e);return function(...e){let i=this[o];if(t.call(this,...e),"function"==typeof i.flushSync)try{i.flushSync()}catch(e){}}},error:e=>h(f.error,e),warn:e=>h(f.warn,e),info:e=>h(f.info,e),debug:e=>h(f.debug,e),trace:e=>h(f.trace,e)},g=Object.keys(f).reduce((e,t)=>(e[f[t]]=t,e),{}),y=Object.keys(g).reduce((e,t)=>(e[t]='{"level":'+Number(t),e),{});function v(e,t,i){return e===p.DESC?t<=i:t>=i}e.exports={initialLsCache:y,genLsCache:function(e){let t=e[l].level,{labels:i}=e.levels,s={};for(let e in i){let r=t(i[e],Number(e));s[e]=JSON.stringify(r).slice(0,-1)}return e[r]=s,e},levelMethods:m,getLevel:function(e){let{levels:t,levelVal:i}=this;return t&&t.labels?t.labels[i]:""},setLevel:function(e){let{labels:t,values:i}=this.levels;if("number"==typeof e){if(void 0===t[e])throw Error("unknown level value"+e);e=t[e]}if(void 0===i[e])throw Error("unknown level "+e);let r=this[s],o=this[s]=i[e],l=this[a],f=this[c],p=this[u].logMethod;for(let e in i){if(!1===f(i[e],o)){this[e]=d;continue}this[e]=!function(e,t){if(t)return!1;switch(e){case"fatal":case"error":case"warn":case"info":case"debug":case"trace":return!0;default:return!1}}(e,l)?h(i[e],p):m[e](p)}this.emit("level-change",e,o,t[r],r,this)},isLevelEnabled:function(e){let{values:t}=this.levels,i=t[e];return void 0!==i&&this[c](i,this[s])},mappings:function(e=null,t=!1){let i=e?Object.keys(e).reduce((t,i)=>(t[e[i]]=i,t),{}):null;return{labels:Object.assign(Object.create(Object.prototype,{Infinity:{value:"silent"}}),t?null:g,i),values:Object.assign(Object.create(Object.prototype,{silent:{value:1/0}}),t?null:f,e)}},assertNoLevelCollisions:function(e,t){let{labels:i,values:r}=e;for(let e in t){if(e in r)throw Error("levels cannot be overridden");if(t[e]in i)throw Error("pre-existing level values cannot be used for new levels")}},assertDefaultLevelFound:function(e,t,i){if("number"==typeof e){if(![].concat(Object.keys(t||{}).map(e=>t[e]),i?[]:Object.keys(g).map(e=>+e),1/0).includes(e))throw Error(`default level:${e} must be included in custom levels`);return}if(!(e in Object.assign(Object.create(Object.prototype,{silent:{value:1/0}}),i?null:f,t)))throw Error(`default level:${e} must be included in custom levels`)},genLevelComparison:function(e){return"string"==typeof e?v.bind(null,e):e},assertLevelComparison:function(e){if(!("function"==typeof e||"string"==typeof e&&Object.values(p).includes(e)))throw Error('Levels comparison should be one of "ASC", "DESC" or "function" type')}}},62123:e=>{"use strict";e.exports={version:"9.14.0"}},94116:(e,t,i)=>{"use strict";let r=Symbol.for("pino.metadata"),{DEFAULT_LEVELS:s}=i(40482),a=s.info;function o(e,t){return e.level-t.level}e.exports=function(e,t){e=e||[],t=t||{dedupe:!1};let i=Object.create(s);i.silent=1/0,t.levels&&"object"==typeof t.levels&&Object.keys(t.levels).forEach(e=>{i[e]=t.levels[e]});let l={write:u,add:h,remove:f,emit:c,flushSync:d,end:function(){for(let{stream:e}of this.streams)"function"==typeof e.flushSync&&e.flushSync(),e.end()},minLevel:0,lastId:0,streams:[],clone:function e(t){let i=Array(this.streams.length);for(let e=0;e<i.length;e++)i[e]={level:t,stream:this.streams[e].stream};return{write:u,add:h,remove:f,minLevel:t,streams:i,clone:e,emit:c,flushSync:d,[r]:!0}},[r]:!0,streamLevels:i};return Array.isArray(e)?e.forEach(h,l):h.call(l,e),e=null,l;function u(e){var i,s,a,o;let l,u;let c=this.lastLevel,{streams:d}=this,h=0;for(let f=(i=d.length,t.dedupe?i-1:0);s=f,a=d.length,t.dedupe?s>=0:s<a;o=f,f=t.dedupe?o-1:o+1)if((l=d[f]).level<=c){if(0!==h&&h!==l.level)break;if((u=l.stream)[r]){let{lastTime:e,lastMsg:t,lastObj:i,lastLogger:r}=this;u.lastLevel=c,u.lastTime=e,u.lastMsg=t,u.lastObj=i,u.lastLogger=r}u.write(e),t.dedupe&&(h=l.level)}else if(!t.dedupe)break}function c(...e){for(let{stream:t}of this.streams)"function"==typeof t.emit&&t.emit(...e)}function d(){for(let{stream:e}of this.streams)"function"==typeof e.flushSync&&e.flushSync()}function h(e){if(!e)return l;let t="function"==typeof e.write||e.stream,i=e.write?e:e.stream;if(!t)throw Error("stream object needs to implement either StreamEntry or DestinationStream interface");let{streams:r,streamLevels:s}=this,u={stream:i,level:"number"==typeof e.levelVal?e.levelVal:"string"==typeof e.level?s[e.level]:"number"==typeof e.level?e.level:a,levelVal:void 0,id:++l.lastId};return r.unshift(u),r.sort(o),this.minLevel=r[0].level,l}function f(e){let{streams:t}=this,i=t.findIndex(t=>t.id===e);return i>=0&&(t.splice(i,1),t.sort(o),this.minLevel=t.length>0?t[0].level:-1),l}}},4073:(e,t,i)=>{"use strict";let{EventEmitter:r}=i(15673),{lsCacheSym:s,levelValSym:a,setLevelSym:o,getLevelSym:l,chindingsSym:u,parsedChindingsSym:c,mixinSym:d,asJsonSym:h,writeSym:f,mixinMergeStrategySym:p,timeSym:m,timeSliceIndexSym:g,streamSym:y,serializersSym:v,formattersSym:_,errorKeySym:b,messageKeySym:w,useOnlyCustomLevelsSym:x,needsMetadataGsym:k,redactFmtSym:A,stringifySym:S,formatOptsSym:E,stringifiersSym:T,msgPrefixSym:O,hooksSym:$}=i(39925),{getLevel:C,setLevel:j,isLevelEnabled:I,mappings:D,initialLsCache:R,genLsCache:N,assertNoLevelCollisions:P}=i(11527),{asChindings:L,asJson:B,buildFormatters:Z,stringify:M,noop:F}=i(35746),{version:q}=i(62123),z=i(53107),U={constructor:class{},child:function(e,t){if(!e)throw Error("missing bindings for child Pino");let i=this[v],r=this[_],s=Object.create(this);if(null==t)return s[_].bindings!==V&&(s[_]=Z(r.level,V,r.log)),s[u]=L(s,e),s[o](this.level),this.onChild!==F&&this.onChild(s),s;if(!0===t.hasOwnProperty("serializers")){for(let e in s[v]=Object.create(null),i)s[v][e]=i[e];let e=Object.getOwnPropertySymbols(i);for(var a=0;a<e.length;a++){let t=e[a];s[v][t]=i[t]}for(let e in t.serializers)s[v][e]=t.serializers[e];let r=Object.getOwnPropertySymbols(t.serializers);for(var l=0;l<r.length;l++){let e=r[l];s[v][e]=t.serializers[e]}}else s[v]=i;if(t.hasOwnProperty("formatters")){let{level:e,bindings:i,log:a}=t.formatters;s[_]=Z(e||r.level,i||V,a||r.log)}else s[_]=Z(r.level,V,r.log);if(!0===t.hasOwnProperty("customLevels")&&(P(this.levels,t.customLevels),s.levels=D(t.customLevels,s[x]),N(s)),"object"==typeof t.redact&&null!==t.redact||Array.isArray(t.redact)){s.redact=t.redact;let e=z(s.redact,M),i={stringify:e[A]};s[S]=M,s[T]=e,s[E]=i}"string"==typeof t.msgPrefix&&(s[O]=(this[O]||"")+t.msgPrefix),s[u]=L(s,e);let c=t.level||this.level;return s[o](c),this.onChild(s),s},bindings:function(){let e=this[u],t=JSON.parse(`{${e.substr(1)}}`);return delete t.pid,delete t.hostname,t},setBindings:function(e){let t=L(this,e);this[u]=t,delete this[c]},flush:function(e){if(null!=e&&"function"!=typeof e)throw Error("callback must be a function");let t=this[y];"function"==typeof t.flush?t.flush(e||F):e&&e()},isLevelEnabled:I,version:q,get level(){return this[l]()},set level(lvl){this[o](lvl)},get levelVal(){return this[a]},set levelVal(n){throw Error("levelVal is read-only")},get msgPrefix(){return this[O]},get[Symbol.toStringTag](){return"Pino"},[s]:R,[f]:function(e,t,i){let r;let s=this[m](),a=this[d],o=this[b],l=this[w],u=this[p]||H,c=this[$].streamWrite;null==e?r={}:e instanceof Error?(r={[o]:e},void 0===t&&(t=e.message)):(r=e,void 0===t&&void 0===e[l]&&e[o]&&(t=e[o].message)),a&&(r=u(r,a(r,i,this)));let f=this[h](r,t,i,s),v=this[y];!0===v[k]&&(v.lastLevel=i,v.lastObj=r,v.lastMsg=t,v.lastTime=s.slice(this[g]),v.lastLogger=this),v.write(c?c(f):f)},[h]:B,[l]:C,[o]:j};Object.setPrototypeOf(U,r.prototype),e.exports=function(){return Object.create(U)};let V=e=>e;function H(e,t){return Object.assign(t,e)}},53107:(e,t,i)=>{"use strict";let r=i(43888),{redactFmtSym:s,wildcardFirstSym:a}=i(39925),o=/[^.[\]]+|\[([^[\]]*?)\]/g,l="[Redacted]";e.exports=function(e,t){let{paths:i,censor:u,remove:c}=function(e){if(Array.isArray(e))return e={paths:e,censor:l};let{paths:t,censor:i=l,remove:r}=e;if(!1===Array.isArray(t))throw Error("pino â€“ redact must contain an array of strings");return!0===r&&(i=void 0),{paths:t,censor:i,remove:r}}(e),d=i.reduce((e,t)=>{o.lastIndex=0;let i=o.exec(t),r=o.exec(t),s=void 0!==i[1]?i[1].replace(/^(?:"|'|`)(.*)(?:"|'|`)$/,"$1"):i[0];if("*"===s&&(s=a),null===r)return e[s]=null,e;if(null===e[s])return e;let{index:l}=r,u=`${t.substr(l,t.length-1)}`;return e[s]=e[s]||[],s!==a&&0===e[s].length&&e[s].push(...e[a]||[]),s===a&&Object.keys(e).forEach(function(t){e[t]&&e[t].push(u)}),e[s].push(u),e},{}),h={[s]:r({paths:i,censor:u,serialize:t,strict:!1,remove:c})},f=(...e)=>"function"==typeof u?t(u(...e)):t(u);return[...Object.keys(d),...Object.getOwnPropertySymbols(d)].reduce((e,i)=>{if(null===d[i])e[i]=e=>f(e,[i]);else{let s="function"==typeof u?(e,t)=>u(e,[i,...t]):u;e[i]=r({paths:d[i],censor:s,serialize:t,strict:!1,remove:c})}return e},h)}},39925:e=>{"use strict";let t=Symbol("pino.setLevel"),i=Symbol("pino.getLevel"),r=Symbol("pino.levelVal"),s=Symbol("pino.levelComp"),a=Symbol("pino.useLevelLabels"),o=Symbol("pino.useOnlyCustomLevels"),l=Symbol("pino.mixin"),u=Symbol("pino.lsCache"),c=Symbol("pino.chindings"),d=Symbol("pino.asJson"),h=Symbol("pino.write"),f=Symbol("pino.redactFmt"),p=Symbol("pino.time"),m=Symbol("pino.timeSliceIndex"),g=Symbol("pino.stream"),y=Symbol("pino.stringify"),v=Symbol("pino.stringifySafe"),_=Symbol("pino.stringifiers"),b=Symbol("pino.end"),w=Symbol("pino.formatOpts"),x=Symbol("pino.messageKey"),k=Symbol("pino.errorKey"),A=Symbol("pino.nestedKey"),S=Symbol("pino.nestedKeyStr"),E=Symbol("pino.mixinMergeStrategy"),T=Symbol("pino.msgPrefix"),O=Symbol("pino.wildcardFirst"),$=Symbol.for("pino.serializers"),C=Symbol.for("pino.formatters"),j=Symbol.for("pino.hooks"),I=Symbol.for("pino.metadata");e.exports={setLevelSym:t,getLevelSym:i,levelValSym:r,levelCompSym:s,useLevelLabelsSym:a,mixinSym:l,lsCacheSym:u,chindingsSym:c,asJsonSym:d,writeSym:h,serializersSym:$,redactFmtSym:f,timeSym:p,timeSliceIndexSym:m,streamSym:g,stringifySym:y,stringifySafeSym:v,stringifiersSym:_,endSym:b,formatOptsSym:w,messageKeySym:x,errorKeySym:k,nestedKeySym:A,wildcardFirstSym:O,needsMetadataGsym:I,useOnlyCustomLevelsSym:o,formattersSym:C,hooksSym:j,nestedKeyStrSym:S,mixinMergeStrategySym:E,msgPrefixSym:T}},30069:e=>{"use strict";let t=1000000n*BigInt(Date.now()),i=process.hrtime.bigint();e.exports={nullTime:()=>"",epochTime:()=>`,"time":${Date.now()}`,unixTime:()=>`,"time":${Math.round(Date.now()/1e3)}`,isoTime:()=>`,"time":"${new Date(Date.now()).toISOString()}"`,isoTimeNano:()=>{let e=t+(process.hrtime.bigint()-i),r=e%1000000000n,s=new Date(Number(e/1000000000n*1000n+r/1000000n)),a=s.getUTCFullYear(),o=(s.getUTCMonth()+1).toString().padStart(2,"0"),l=s.getUTCDate().toString().padStart(2,"0"),u=s.getUTCHours().toString().padStart(2,"0"),c=s.getUTCMinutes().toString().padStart(2,"0"),d=s.getUTCSeconds().toString().padStart(2,"0");return`,"time":"${a}-${o}-${l}T${u}:${c}:${d}.${r.toString().padStart(9,"0")}Z"`}}},35746:(e,t,i)=>{"use strict";let r;let s=i(65714),a=i(22630),{mapHttpRequest:o,mapHttpResponse:l}=i(34479),u=i(91102),c=i(10754),{lsCacheSym:d,chindingsSym:h,writeSym:f,serializersSym:p,formatOptsSym:m,endSym:g,stringifiersSym:y,stringifySym:v,stringifySafeSym:_,wildcardFirstSym:b,nestedKeySym:w,formattersSym:x,messageKeySym:k,errorKeySym:A,nestedKeyStrSym:S,msgPrefixSym:E}=i(39925),{isMainThread:T}=i(6162),O=i(80091);function $(){}function C(e){let t="",i=0,r=!1,s=255,a=e.length;if(a>100)return JSON.stringify(e);for(var o=0;o<a&&s>=32;o++)(34===(s=e.charCodeAt(o))||92===s)&&(t+=e.slice(i,o)+"\\",i=o,r=!0);return r?t+=e.slice(i):t=e,s<32?JSON.stringify(e):'"'+t+'"'}function j(e,t,i,r){let s;let a=this[v],o=this[_],l=this[y],u=this[g],c=this[h],f=this[p],m=this[x],E=this[k],T=this[A],O=this[d][i]+r;O+=c,m.log&&(e=m.log(e));let $=l[b],j="";for(let t in e)if(s=e[t],Object.prototype.hasOwnProperty.call(e,t)&&void 0!==s){f[t]?s=f[t](s):t===T&&f.err&&(s=f.err(s));let e=l[t]||$;switch(typeof s){case"undefined":case"function":continue;case"number":!1===Number.isFinite(s)&&(s=null);case"boolean":e&&(s=e(s));break;case"string":s=(e||C)(s);break;default:s=(e||a)(s,o)}if(void 0===s)continue;j+=","+C(t)+":"+s}let I="";if(void 0!==t){s=f[E]?f[E](t):t;let e=l[E]||$;switch(typeof s){case"function":break;case"number":!1===Number.isFinite(s)&&(s=null);case"boolean":e&&(s=e(s)),I=',"'+E+'":'+s;break;case"string":I=',"'+E+'":'+(s=(e||C)(s));break;default:I=',"'+E+'":'+(s=(e||a)(s,o))}}return this[w]&&j?O+this[S]+j.slice(1)+"}"+I+u:O+j+I+u}function I(e){let t=new u(e);return t.on("error",function e(i){if("EPIPE"===i.code){t.write=$,t.end=$,t.flushSync=$,t.destroy=$;return}t.removeListener("error",e),t.emit("error",i)}),!e.sync&&T&&(c.register(t,D),t.on("close",function(){c.unregister(t)})),t}function D(e,t){e.destroyed||("beforeExit"===t?(e.flush(),e.on("drain",function(){e.end()})):e.flushSync())}r="function"==typeof s.tracingChannel?s.tracingChannel("pino_asJson"):{hasSubscribers:!1,traceSync:(e,t,i,...r)=>e.call(i,...r)},e.exports={noop:$,buildSafeSonicBoom:I,asChindings:function(e,t){let i;let r=e[h],s=e[v],a=e[_],o=e[y],l=o[b],u=e[p];for(let c in t=(0,e[x].bindings)(t))if(i=t[c],!0===((c.length<5||"level"!==c&&"serializers"!==c&&"formatters"!==c&&"customLevels"!==c)&&t.hasOwnProperty(c)&&void 0!==i)){if(i=u[c]?u[c](i):i,void 0===(i=(o[c]||l||s)(i,a)))continue;r+=',"'+c+'":'+i}return r},asJson:function(e,t,i,s){return!1===r.hasSubscribers?j.call(this,e,t,i,s):r.traceSync(j,{instance:this,arguments},this,e,t,i,s)},genLog:function(e,t){if(!t)return i;return function(...r){t.call(this,r,i,e)};function i(t,...r){if("object"==typeof t){let i,s=t;null!==t&&(t.method&&t.headers&&t.socket?t=o(t):"function"==typeof t.setHeader&&(t=l(t))),null===s&&0===r.length?i=[null]:(s=r.shift(),i=r),"string"==typeof this[E]&&null!=s&&(s=this[E]+s),this[f](t,a(s,i,this[m]),e)}else{let i=void 0===t?r.shift():t;"string"==typeof this[E]&&null!=i&&(i=this[E]+i),this[f](null,a(i,r,this[m]),e)}}},createArgsNormalizer:function(e){return function(t,i,r={},s){if("string"==typeof r)s=I({dest:r}),r={};else if("string"==typeof s){if(r&&r.transport)throw Error("only one of option.transport or stream can be specified");s=I({dest:s})}else if(r instanceof u||r.writable||r._writableState)s=r,r={};else if(r.transport){let e;if(r.transport instanceof u||r.transport.writable||r.transport._writableState)throw Error("option.transport do not allow stream, please pass to option directly. e.g. pino(transport)");if(r.transport.targets&&r.transport.targets.length&&r.formatters&&"function"==typeof r.formatters.level)throw Error("option.transport.targets do not allow custom level formatters");r.customLevels&&(e=r.useOnlyCustomLevels?r.customLevels:Object.assign({},r.levels,r.customLevels)),s=O({caller:i,...r.transport,levels:e})}if((r=Object.assign({},e,r)).serializers=Object.assign({},e.serializers,r.serializers),r.formatters=Object.assign({},e.formatters,r.formatters),r.prettyPrint)throw Error("prettyPrint option is no longer supported, see the pino-pretty package (https://github.com/pinojs/pino-pretty)");let{enabled:a,onChild:o}=r;if(!1===a&&(r.level="silent"),o||(r.onChild=$),!s){var l;(l=process.stdout).write!==l.constructor.prototype.write?s=process.stdout:s=I({fd:process.stdout.fd||1})}return{opts:r,stream:s}}},stringify:function(e,t){try{return JSON.stringify(e)}catch(i){try{return(t||this[_])(e)}catch(e){return'"[unable to serialize, circular reference is too complex to analyze]"'}}},buildFormatters:function(e,t,i){return{level:e,bindings:t,log:i}},normalizeDestFileDescriptor:function(e){let t=Number(e);return"string"==typeof e&&Number.isFinite(t)?t:void 0===e?1:e}}},80091:(e,t,i)=>{"use strict";let{createRequire:r}=i(85807),s=i(43969),{join:a,isAbsolute:o,sep:l}=i(49411),u=i(88910),c=i(10754),d=i(56830);function h(e){e.ref(),e.flushSync(),e.end(),e.once("close",function(){e.unref()})}function f(e){e.flushSync()}e.exports=function(e){let{pipeline:t,targets:i,levels:p,dedupe:m,worker:g={},caller:y=s(),sync:v=!1}=e,_={...e.options},b="string"==typeof y?[y]:y,w="__bundlerPathsOverrides"in globalThis?globalThis.__bundlerPathsOverrides:{},x=e.target;if(x&&i)throw Error("only one of target or targets can be specified");return i?(x=w["pino-worker"]||a(__dirname,"worker.js"),_.targets=i.filter(e=>e.target).map(e=>({...e,target:k(e.target)})),_.pipelines=i.filter(e=>e.pipeline).map(e=>e.pipeline.map(t=>({...t,level:e.level,target:k(t.target)})))):t&&(x=w["pino-worker"]||a(__dirname,"worker.js"),_.pipelines=[t.map(e=>({...e,target:k(e.target)}))]),p&&(_.levels=p),m&&(_.dedupe=m),_.pinoWillSendConfig=!0,function(e,t,i,r){let s=new d({filename:e,workerData:t,workerOpts:i,sync:r});function a(){s.closed||(s.flushSync(),u(100),s.end())}return s.on("ready",function(){process.removeListener("exit",a),s.unref(),!1!==i.autoEnd&&(c.register(s,h),c.registerBeforeExit(s,f),s.on("close",function(){c.unregister(s)}))}),s.on("close",function(){process.removeListener("exit",a)}),process.on("exit",a),s}(k(x),_,g,v);function k(e){let t;if(o(e=w[e]||e)||0===e.indexOf("file://"))return e;if("pino/file"===e)return a(__dirname,"..","file.js");for(let i of b)try{let s="node:repl"===i?process.cwd()+l:i;t=r(s).resolve(e);break}catch(e){continue}if(!t)throw Error(`unable to determine transport target for "${e}"`);return t}}},29021:(e,t,i)=>{"use strict";let r=i(70612),s=i(34479),a=i(43969),o=i(53107),l=i(30069),u=i(4073),c=i(39925),{configure:d}=i(70354),{assertDefaultLevelFound:h,mappings:f,genLsCache:p,genLevelComparison:m,assertLevelComparison:g}=i(11527),{DEFAULT_LEVELS:y,SORTING_ORDER:v}=i(40482),{createArgsNormalizer:_,asChindings:b,buildSafeSonicBoom:w,buildFormatters:x,stringify:k,normalizeDestFileDescriptor:A,noop:S}=i(35746),{version:E}=i(62123),{chindingsSym:T,redactFmtSym:O,serializersSym:$,timeSym:C,timeSliceIndexSym:j,streamSym:I,stringifySym:D,stringifySafeSym:R,stringifiersSym:N,setLevelSym:P,endSym:L,formatOptsSym:B,messageKeySym:Z,errorKeySym:M,nestedKeySym:F,mixinSym:q,levelCompSym:z,useOnlyCustomLevelsSym:U,formattersSym:V,hooksSym:H,nestedKeyStrSym:W,mixinMergeStrategySym:K,msgPrefixSym:J}=c,{epochTime:Q,nullTime:G}=l,{pid:X}=process,Y=r.hostname(),ee=s.err,et=_({level:"info",levelComparison:v.ASC,levels:y,messageKey:"msg",errorKey:"err",nestedKey:null,enabled:!0,base:{pid:X,hostname:Y},serializers:Object.assign(Object.create(null),{err:ee}),formatters:Object.assign(Object.create(null),{bindings:e=>e,level:(e,t)=>({level:t})}),hooks:{logMethod:void 0,streamWrite:void 0},timestamp:Q,name:void 0,redact:null,customLevels:null,useOnlyCustomLevels:!1,depthLimit:5,edgeLimit:100}),ei=Object.assign(Object.create(null),s);function er(...e){let t={},{opts:i,stream:r}=et(t,a(),...e);i.level&&"string"==typeof i.level&&void 0!==y[i.level.toLowerCase()]&&(i.level=i.level.toLowerCase());let{redact:s,crlf:l,serializers:c,timestamp:v,messageKey:_,errorKey:w,nestedKey:A,base:E,name:X,level:Y,customLevels:ee,levelComparison:ei,mixin:en,mixinMergeStrategy:es,useOnlyCustomLevels:ea,formatters:eo,hooks:el,depthLimit:eu,edgeLimit:ec,onChild:ed,msgPrefix:eh}=i,ef=d({maximumDepth:eu,maximumBreadth:ec}),ep=x(eo.level,eo.bindings,eo.log),em=k.bind({[R]:ef}),eg=s?o(s,em):{},ey=s?{stringify:eg[O]}:{stringify:em},ev=b.bind(null,{[T]:"",[$]:c,[N]:eg,[D]:k,[R]:ef,[V]:ep}),e_="";null!==E&&(e_=ev(void 0===X?E:Object.assign({},E,{name:X})));let eb=v instanceof Function?v:v?Q:G,ew=eb().indexOf(":")+1;if(ea&&!ee)throw Error("customLevels is required if useOnlyCustomLevels is set true");if(en&&"function"!=typeof en)throw Error(`Unknown mixin type "${typeof en}" - expected "function"`);if(eh&&"string"!=typeof eh)throw Error(`Unknown msgPrefix type "${typeof eh}" - expected "string"`);h(Y,ee,ea);let ex=f(ee,ea);return"function"==typeof r.emit&&r.emit("message",{code:"PINO_CONFIG",config:{levels:ex,messageKey:_,errorKey:w}}),g(ei),Object.assign(t,{levels:ex,[z]:m(ei),[U]:ea,[I]:r,[C]:eb,[j]:ew,[D]:k,[R]:ef,[N]:eg,[L]:"}"+(l?"\r\n":"\n"),[B]:ey,[Z]:_,[M]:w,[F]:A,[W]:A?`,${JSON.stringify(A)}:{`:"",[$]:c,[q]:en,[K]:es,[T]:e_,[V]:ep,[H]:el,silent:S,onChild:ed,[J]:eh}),Object.setPrototypeOf(t,u()),p(t),t[P](Y),t}e.exports=er,e.exports.destination=(e=process.stdout.fd)=>"object"==typeof e?(e.dest=A(e.dest||process.stdout.fd),w(e)):w({dest:A(e),minLength:0}),e.exports.transport=i(80091),e.exports.multistream=i(94116),e.exports.levels=f(),e.exports.stdSerializers=ei,e.exports.stdTimeFunctions=Object.assign({},l),e.exports.symbols=c,e.exports.version=E,e.exports.default=er,e.exports.pino=er},91102:(e,t,i)=>{"use strict";let r=i(92048),s=i(17702),a=i(21764).inherits,o=i(55315),l=i(88910),u=i(27790),c=Buffer.allocUnsafe(0),d="buffer",h="utf8",[f,p]=(process.versions.node||"0.0").split(".").map(Number),m=f>=22&&p>=7;function g(e,t){function i(i,r){if(i){t._reopening=!1,t._writing=!1,t._opening=!1,t.sync?process.nextTick(()=>{t.listenerCount("error")>0&&t.emit("error",i)}):t.emit("error",i);return}let s=t._reopening;t.fd=r,t.file=e,t._reopening=!1,t._opening=!1,t._writing=!1,t.sync?process.nextTick(()=>t.emit("ready")):t.emit("ready"),!t.destroyed&&(!t._writing&&t._len>t.minLength||t._flushPending?t._actualWrite():s&&process.nextTick(()=>t.emit("drain")))}t._opening=!0,t._writing=!0,t._asyncDrainScheduled=!1;let s=t.append?"a":"w",a=t.mode;if(t.sync)try{t.mkdir&&r.mkdirSync(o.dirname(e),{recursive:!0});let l=r.openSync(e,s,a);i(null,l)}catch(e){throw i(e),e}else t.mkdir?r.mkdir(o.dirname(e),{recursive:!0},t=>{if(t)return i(t);r.open(e,s,a,i)}):r.open(e,s,a,i)}function y(e){let t,i;if(!(this instanceof y))return new y(e);let{fd:s,dest:a,minLength:o,maxLength:u,maxWrite:f,periodicFlush:p,sync:m,append:b=!0,mkdir:k,retryEAGAIN:j,fsync:I,contentMode:D,mode:R}=e||{};if(s=s||a,this._len=0,this.fd=-1,this._bufs=[],this._lens=[],this._writing=!1,this._ending=!1,this._reopening=!1,this._asyncDrainScheduled=!1,this._flushPending=!1,this._hwm=Math.max(o||0,16387),this.file=null,this.destroyed=!1,this.minLength=o||0,this.maxLength=u||0,this.maxWrite=f||16384,this._periodicFlush=p||0,this._periodicFlushTimer=void 0,this.sync=m||!1,this.writable=!0,this._fsync=I||!1,this.append=b||!1,this.mode=R,this.retryEAGAIN=j||(()=>!0),this.mkdir=k||!1,D===d)this._writingBuf=c,this.write=x,this.flush=S,this.flushSync=T,this._actualWrite=$,t=()=>r.writeSync(this.fd,this._writingBuf),i=()=>r.write(this.fd,this._writingBuf,this.release);else if(void 0===D||D===h)this._writingBuf="",this.write=w,this.flush=A,this.flushSync=E,this._actualWrite=O,t=()=>r.writeSync(this.fd,this._writingBuf,"utf8"),i=()=>r.write(this.fd,this._writingBuf,"utf8",this.release);else throw Error(`SonicBoom supports "${h}" and "${d}", but passed ${D}`);if("number"==typeof s)this.fd=s,process.nextTick(()=>this.emit("ready"));else if("string"==typeof s)g(s,this);else throw Error("SonicBoom supports only file descriptors and files");if(this.minLength>=this.maxWrite)throw Error(`minLength should be smaller than maxWrite (${this.maxWrite})`);this.release=(e,s)=>{if(e){if(("EAGAIN"===e.code||"EBUSY"===e.code)&&this.retryEAGAIN(e,this._writingBuf.length,this._len-this._writingBuf.length)){if(this.sync)try{l(100),this.release(void 0,0)}catch(e){this.release(e)}else setTimeout(i,100)}else this._writing=!1,this.emit("error",e);return}this.emit("write",s);let a=v(this._writingBuf,this._len,s);if(this._len=a.len,this._writingBuf=a.writingBuf,this._writingBuf.length){if(!this.sync){i();return}try{do{let e=t(),i=v(this._writingBuf,this._len,e);this._len=i.len,this._writingBuf=i.writingBuf}while(this._writingBuf.length)}catch(e){this.release(e);return}}this._fsync&&r.fsyncSync(this.fd);let o=this._len;this._reopening?(this._writing=!1,this._reopening=!1,this.reopen()):o>this.minLength?this._actualWrite():this._ending?o>0?this._actualWrite():(this._writing=!1,C(this)):(this._writing=!1,this.sync?this._asyncDrainScheduled||(this._asyncDrainScheduled=!0,process.nextTick(_,this)):this.emit("drain"))},this.on("newListener",function(e){"drain"===e&&(this._asyncDrainScheduled=!1)}),0!==this._periodicFlush&&(this._periodicFlushTimer=setInterval(()=>this.flush(null),this._periodicFlush),this._periodicFlushTimer.unref())}function v(e,t,i){return"string"==typeof e&&Buffer.byteLength(e)!==i&&(i=Buffer.from(e).subarray(0,i).toString().length),t=Math.max(t-i,0),{writingBuf:e=e.slice(i),len:t}}function _(e){e.listenerCount("drain")>0&&(e._asyncDrainScheduled=!1,e.emit("drain"))}function b(e,t){return 0===e.length?c:1===e.length?e[0]:Buffer.concat(e,t)}function w(e){if(this.destroyed)throw Error("SonicBoom destroyed");let t=this._len+e.length,i=this._bufs;return this.maxLength&&t>this.maxLength?this.emit("drop",e):(0===i.length||i[i.length-1].length+e.length>this.maxWrite?i.push(""+e):i[i.length-1]+=e,this._len=t,!this._writing&&this._len>=this.minLength&&this._actualWrite()),this._len<this._hwm}function x(e){if(this.destroyed)throw Error("SonicBoom destroyed");let t=this._len+e.length,i=this._bufs,r=this._lens;return this.maxLength&&t>this.maxLength?this.emit("drop",e):(0===i.length||r[r.length-1]+e.length>this.maxWrite?(i.push([e]),r.push(e.length)):(i[i.length-1].push(e),r[r.length-1]+=e.length),this._len=t,!this._writing&&this._len>=this.minLength&&this._actualWrite()),this._len<this._hwm}function k(e){this._flushPending=!0;let t=()=>{if(this._fsync)this._flushPending=!1,e();else try{r.fsync(this.fd,t=>{this._flushPending=!1,e(t)})}catch(t){e(t)}this.off("error",i)},i=i=>{this._flushPending=!1,e(i),this.off("drain",t)};this.once("drain",t),this.once("error",i)}function A(e){if(null!=e&&"function"!=typeof e)throw Error("flush cb must be a function");if(this.destroyed){let t=Error("SonicBoom destroyed");if(e){e(t);return}throw t}if(this.minLength<=0){e?.();return}e&&k.call(this,e),this._writing||(0===this._bufs.length&&this._bufs.push(""),this._actualWrite())}function S(e){if(null!=e&&"function"!=typeof e)throw Error("flush cb must be a function");if(this.destroyed){let t=Error("SonicBoom destroyed");if(e){e(t);return}throw t}if(this.minLength<=0){e?.();return}e&&k.call(this,e),this._writing||(0===this._bufs.length&&(this._bufs.push([]),this._lens.push(0)),this._actualWrite())}function E(){if(this.destroyed)throw Error("SonicBoom destroyed");if(this.fd<0)throw Error("sonic boom is not ready yet");!this._writing&&this._writingBuf.length>0&&(this._bufs.unshift(this._writingBuf),this._writingBuf="");let e="";for(;this._bufs.length||e;){e.length<=0&&(e=this._bufs[0]);try{let t=r.writeSync(this.fd,e,"utf8"),i=v(e,this._len,t);e=i.writingBuf,this._len=i.len,e.length<=0&&this._bufs.shift()}catch(t){if(("EAGAIN"===t.code||"EBUSY"===t.code)&&!this.retryEAGAIN(t,e.length,this._len-e.length))throw t;l(100)}}try{r.fsyncSync(this.fd)}catch{}}function T(){if(this.destroyed)throw Error("SonicBoom destroyed");if(this.fd<0)throw Error("sonic boom is not ready yet");!this._writing&&this._writingBuf.length>0&&(this._bufs.unshift([this._writingBuf]),this._writingBuf=c);let e=c;for(;this._bufs.length||e.length;){e.length<=0&&(e=b(this._bufs[0],this._lens[0]));try{let t=r.writeSync(this.fd,e);e=e.subarray(t),this._len=Math.max(this._len-t,0),e.length<=0&&(this._bufs.shift(),this._lens.shift())}catch(t){if(("EAGAIN"===t.code||"EBUSY"===t.code)&&!this.retryEAGAIN(t,e.length,this._len-e.length))throw t;l(100)}}}function O(){let e=this.release;if(this._writing=!0,this._writingBuf=this._writingBuf||this._bufs.shift()||"",this.sync)try{let t=r.writeSync(this.fd,this._writingBuf,"utf8");e(null,t)}catch(t){e(t)}else r.write(this.fd,this._writingBuf,"utf8",e)}function $(){let e=this.release;if(this._writing=!0,this._writingBuf=this._writingBuf.length?this._writingBuf:b(this._bufs.shift(),this._lens.shift()),this.sync)try{let t=r.writeSync(this.fd,this._writingBuf);e(null,t)}catch(t){e(t)}else m&&(this._writingBuf=Buffer.from(this._writingBuf)),r.write(this.fd,this._writingBuf,e)}function C(e){if(-1===e.fd){e.once("ready",C.bind(null,e));return}void 0!==e._periodicFlushTimer&&clearInterval(e._periodicFlushTimer),e.destroyed=!0,e._bufs=[],e._lens=[],u("number"==typeof e.fd,`sonic.fd must be a number, got ${typeof e.fd}`);try{r.fsync(e.fd,function(){1!==e.fd&&2!==e.fd?r.close(e.fd,t):t()})}catch{}function t(t){if(t){e.emit("error",t);return}e._ending&&!e._writing&&e.emit("finish"),e.emit("close")}}a(y,s),y.prototype.reopen=function(e){if(this.destroyed)throw Error("SonicBoom destroyed");if(this._opening){this.once("ready",()=>{this.reopen(e)});return}if(this._ending)return;if(!this.file)throw Error("Unable to reopen a file descriptor, you must pass a file to SonicBoom");if(e&&(this.file=e),this._reopening=!0,this._writing)return;let t=this.fd;this.once("ready",()=>{t!==this.fd&&r.close(t,e=>{if(e)return this.emit("error",e)})}),g(this.file,this)},y.prototype.end=function(){if(this.destroyed)throw Error("SonicBoom destroyed");if(this._opening){this.once("ready",()=>{this.end()});return}!this._ending&&(this._ending=!0,this._writing||(this._len>0&&this.fd>=0?this._actualWrite():C(this)))},y.prototype.destroy=function(){this.destroyed||C(this)},y.SonicBoom=y,y.default=y,e.exports=y},31046:(e,t,i)=>{"use strict";let r;i.d(t,{X2:()=>tS});var s,a,o,l,u={financialValue:.35,reversibility:.2,categoryRisk:.15,urgency:.15,externalVisibility:.15},c={safe:20,low:40,medium:60,high:80},d={content:15,build:35,trading:55,deployment:70,configuration:85},h={low:50,medium:100,high:500,critical:1e3},f={safe:"auto_execute",low:"auto_execute",medium:"queue_approval",high:"queue_approval",critical:"escalate"},p=["dca_buy","tweet_post","blog_draft","small_commit","log_activity"],m=["deploy_production","delete_data","transfer_funds","change_api_keys","modify_permissions"],g={low:1,normal:2,high:5,critical:10},y={ageHoursBeforeEscalation:12,ageHoursBeforeAutoReject:48,criticalRiskAutoEscalate:!0},v={maxNotificationsPerMinute:10,maxAutoExecutionsPerHour:100,cooldownAfterFailureMs:6e4},_={hashAlgorithm:"sha256",retentionDays:90,maxEntriesInMemory:1e3},b=i(29021)({level:process.env.LOG_LEVEL??"info",transport:void 0}),w=class{logger;constructor(e){this.logger=b.child({context:e})}info(e,t){t?this.logger.info(t,e):this.logger.info(e)}warn(e,t){t?this.logger.warn(t,e):this.logger.warn(e)}error(e,t){t?this.logger.error(t,e):this.logger.error(e)}debug(e,t){t?this.logger.debug(t,e):this.logger.debug(e)}},x=i(32115),k=class extends x{logger;queue;maxPendingItems;autoExpireHours;expirationTimer=null;requestCount=0;constructor(e={}){super(),this.logger=new w("ApprovalQueue"),this.queue=new Map,this.maxPendingItems=e.maxPendingItems??50,this.autoExpireHours=e.autoExpireHours??24,this.startExpirationChecker()}add(e){this.requestCount++;let t={id:`apr_${Date.now()}_${this.requestCount}`,decision:e,priority:this.calculatePriority(e),urgency:e.action.metadata.urgency,expiresAt:Date.now()+36e5*this.autoExpireHours,notificationsSent:[],status:"pending",createdAt:Date.now()};return this.queue.size>=this.maxPendingItems&&this.removeLowestPriority(),this.queue.set(t.id,t),this.logger.info(`Added to queue: ${e.action.type}`,{requestId:t.id,priority:t.priority,urgency:t.urgency}),this.emit("item:added",t),this.emit("queue:changed",this.queue.size),t}approve(e,t="human",i){let r=this.queue.get(e);return r?(r.status="approved",r.reviewedBy=t,r.reviewedAt=Date.now(),r.feedback=i,r.decision.approvedBy=t,r.decision.approvedAt=Date.now(),r.decision.outcome="auto_execute",this.queue.delete(e),this.logger.info(`Approved: ${r.decision.action.type}`,{requestId:e,approvedBy:t}),this.emit("item:approved",r,t),this.emit("queue:changed",this.queue.size),r):(this.logger.warn(`Request not found: ${e}`),null)}reject(e,t,i="human"){let r=this.queue.get(e);return r?(r.status="rejected",r.reviewedBy=i,r.reviewedAt=Date.now(),r.feedback=t,r.decision.outcome="reject",this.queue.delete(e),this.logger.info(`Rejected: ${r.decision.action.type}`,{requestId:e,reason:t}),this.emit("item:rejected",r,t),this.emit("queue:changed",this.queue.size),r):(this.logger.warn(`Request not found: ${e}`),null)}get(e){return this.queue.get(e)}getPending(){return Array.from(this.queue.values()).filter(e=>"pending"===e.status).sort((e,t)=>t.priority-e.priority)}getByUrgency(e){return this.getPending().filter(t=>t.urgency===e)}getStats(){let e=this.getPending(),t={low:0,normal:0,high:0,critical:0},i=0,r=Date.now();for(let s of e)t[s.urgency]++,i+=r-s.createdAt;let s=e.length>0?r-e[e.length-1].createdAt:0,a=e.length>0?i/e.length:0;return{total:this.queue.size,pending:e.length,byUrgency:t,oldestAge:s,avgWaitTime:a}}checkEscalations(){let e=[],t=Date.now();for(let i of this.queue.values()){if("pending"!==i.status)continue;let r=(t-i.createdAt)/36e5;r>=y.ageHoursBeforeEscalation&&!i.notificationsSent.includes("escalation")&&(i.notificationsSent.push("escalation"),e.push(i),this.emit("item:escalated",i)),r>=y.ageHoursBeforeAutoReject&&this.reject(i.id,"Auto-rejected due to age"),y.criticalRiskAutoEscalate&&"critical"===i.decision.assessment.level&&!i.notificationsSent.includes("critical_escalation")&&(i.notificationsSent.push("critical_escalation"),e.push(i),this.emit("item:escalated",i))}return e}markNotificationSent(e,t){let i=this.queue.get(e);i&&!i.notificationsSent.includes(t)&&i.notificationsSent.push(t)}get size(){return this.getPending().length}clear(){this.queue.clear(),this.emit("queue:changed",0)}stop(){this.expirationTimer&&(clearInterval(this.expirationTimer),this.expirationTimer=null)}calculatePriority(e){return 10*(g[e.action.metadata.urgency]??1)+this.riskLevelToScore(e.assessment.level)+Math.min((e.action.metadata.estimatedValue??0)/10,10)}riskLevelToScore(e){return({safe:1,low:2,medium:5,high:8,critical:10})[e]??5}removeLowestPriority(){let e=this.getPending();if(0===e.length)return;let t=e[e.length-1];this.queue.delete(t.id),this.emit("item:expired",t),this.logger.info(`Removed lowest priority item: ${t.id}`)}startExpirationChecker(){this.expirationTimer=setInterval(()=>{this.checkExpirations(),this.checkEscalations()},36e5)}checkExpirations(){let e=Date.now(),t=[];for(let[i,r]of this.queue)"pending"===r.status&&r.expiresAt<e&&(t.push(i),r.status="expired",this.emit("item:expired",r));for(let e of t)this.queue.delete(e);t.length>0&&(this.logger.info(`Expired ${t.length} items`),this.emit("queue:changed",this.queue.size))}},A=class{logger;channels;rateLimitPerMinute;messageCount=0;lastResetTime=Date.now();constructor(e){this.logger=new w("NotificationManager"),this.channels=e.channels,this.rateLimitPerMinute=e.rateLimitPerMinute??v.maxNotificationsPerMinute}async notifyApprovalNeeded(e){if(!this.checkRateLimit())return this.logger.warn("Rate limit exceeded for notifications"),!1;let t=this.formatApprovalRequest(e);return this.sendToAllChannels(t,"Approval Required")}async notifyEscalation(e){if(!this.checkRateLimit())return!1;let t=this.formatEscalation(e);return this.sendToAllChannels(t,"ESCALATION")}async notifyApprovalDecision(e,t,i){if(!this.checkRateLimit())return!1;let r=t?"Approved":"Rejected",s=this.formatDecision(e,r,i);return this.sendToAllChannels(s,r)}async sendDailySummary(e){let t=`
**Daily Autonomy Summary**

Auto-executed: ${e.autoExecuted}
Queued: ${e.queued}
Approved: ${e.approved}
Rejected: ${e.rejected}
Escalated: ${e.escalated}

Total value processed: $${e.totalValue.toFixed(2)}
    `.trim();return this.sendToAllChannels(t,"Daily Summary")}isConfigured(){return this.channels.some(e=>e.enabled)}getEnabledChannels(){return this.channels.filter(e=>e.enabled)}async sendToAllChannels(e,t){let i=!1;for(let r of this.channels)if(r.enabled)try{switch(r.type){case"discord":i=await this.sendDiscord(r,e,t)||i;break;case"telegram":i=await this.sendTelegram(r,e,t)||i;break;case"slack":i=await this.sendSlack(r,e,t)||i}}catch(e){this.logger.error(`Failed to send to ${r.type}`,{error:e instanceof Error?e.message:String(e)})}return i}async sendDiscord(e,t,i){let r=e.config.webhookUrl;if(!r)return!1;try{let e=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({embeds:[{title:i,description:t,color:this.getTitleColor(i),timestamp:new Date().toISOString(),footer:{text:"gICM Autonomy"}}]})});if(e.ok)return this.logger.debug(`Discord notification sent: ${i}`),!0;return this.logger.warn(`Discord notification failed: ${e.status}`),!1}catch(e){return this.logger.error("Discord send error",{error:e instanceof Error?e.message:String(e)}),!1}}async sendTelegram(e,t,i){let{botToken:r,chatId:s}=e.config;if(!r||!s)return!1;try{let e=`https://api.telegram.org/bot${r}/sendMessage`,a=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:s,text:`*${i}*

${t}`,parse_mode:"Markdown"})});if(a.ok)return this.logger.debug(`Telegram notification sent: ${i}`),!0;return this.logger.warn(`Telegram notification failed: ${a.status}`),!1}catch(e){return this.logger.error("Telegram send error",{error:e instanceof Error?e.message:String(e)}),!1}}async sendSlack(e,t,i){let r=e.config.webhookUrl;if(!r)return!1;try{return(await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({blocks:[{type:"header",text:{type:"plain_text",text:i}},{type:"section",text:{type:"mrkdwn",text:t}}]})})).ok}catch(e){return this.logger.error("Slack send error",{error:e instanceof Error?e.message:String(e)}),!1}}formatApprovalRequest(e){let t=e.decision.action,i=e.decision.assessment;return`
**${t.description}**

Action: \`${t.type}\`
Engine: ${t.engine}
Category: ${t.category}

Risk: ${this.getRiskEmoji(i.level)} ${i.level.toUpperCase()} (${i.score}/100)
Value: ${t.metadata.estimatedValue?`$${t.metadata.estimatedValue}`:"N/A"}
Reversible: ${t.metadata.reversible?"Yes":"No"}

ID: \`${e.id}\`
Expires: ${new Date(e.expiresAt).toLocaleString()}

\`gicm-autonomy approve ${e.id}\`
    `.trim()}formatEscalation(e){let t=e.decision.action,i=Math.round((Date.now()-e.createdAt)/6e4);return`
**REQUIRES IMMEDIATE ATTENTION**

${t.description}

Action: \`${t.type}\`
Risk: ${e.decision.assessment.level.toUpperCase()}
Waiting: ${i} minutes

ID: \`${e.id}\`

\`gicm-autonomy approve ${e.id}\`
    `.trim()}formatDecision(e,t,i){let r=e.decision.action;return`
**${t}: ${r.type}**

${r.description}

${i?`Reason: ${i}`:""}
Reviewed by: ${e.reviewedBy}
    `.trim()}getRiskEmoji(e){return({safe:"\uD83D\uDFE2",low:"\uD83D\uDFE2",medium:"\uD83D\uDFE1",high:"\uD83D\uDFE0",critical:"\uD83D\uDD34"})[e]??"âšª"}getTitleColor(e){return e.includes("ESCALATION")?16711680:e.includes("Rejected")?16739179:e.includes("Approved")?65280:e.includes("Summary")?39423:16755200}checkRateLimit(){let e=Date.now();return e-this.lastResetTime>6e4&&(this.messageCount=0,this.lastResetTime=e),!(this.messageCount>=this.rateLimitPerMinute)&&(this.messageCount++,!0)}},S=class{logger;queue;constructor(e){this.logger=new w("BatchApproval"),this.queue=e}getSummary(){let e=this.queue.getPending(),t=Date.now(),i={trading:0,content:0,build:0,deployment:0,configuration:0},r={safe:0,low:0,medium:0,high:0,critical:0},s={},a=0,o=0,l=0;for(let u of e){let e=u.decision.action,c=u.decision.assessment;i[e.category]++,r[c.level]++,s[e.engine]=(s[e.engine]??0)+1,a+=e.metadata.estimatedValue??0,o+=c.score;let d=t-u.createdAt;d>l&&(l=d)}return{total:e.length,byCategory:i,byRisk:r,byEngine:s,totalValue:a,oldestAge:l,avgScore:e.length>0?o/e.length:0}}filter(e){let t=this.queue.getPending(),i=Date.now();return t.filter(t=>{let r=t.decision.action,s=t.decision.assessment;return(!e.category||r.category===e.category)&&(!e.riskLevel||s.level===e.riskLevel)&&(!e.engine||r.engine===e.engine)&&(!e.minScore||!(s.score<e.minScore))&&(!e.maxScore||!(s.score>e.maxScore))&&(!e.olderThanHours||!((i-t.createdAt)/36e5<e.olderThanHours))})}approveFiltered(e,t="batch",i){let r=this.filter(e),s=[],a=[];for(let e of r){let r=this.queue.approve(e.id,t,i);r?s.push(r):a.push(e.id)}return this.logger.info(`Batch approved ${s.length} items`,{filter:e,failed:a.length}),{approved:s,failed:a}}rejectFiltered(e,t,i="batch"){let r=this.filter(e),s=[],a=[];for(let e of r){let r=this.queue.reject(e.id,t,i);r?s.push(r):a.push(e.id)}return this.logger.info(`Batch rejected ${s.length} items`,{filter:e,reason:t,failed:a.length}),{rejected:s,failed:a}}approveAllSafe(e="batch"){let t=this.filter({riskLevel:"safe"}),i=this.filter({riskLevel:"low"}),r=[];for(let s of[...t,...i]){let t=this.queue.approve(s.id,e,"Auto-approved (low risk)");t&&r.push(t)}return this.logger.info(`Auto-approved ${r.length} safe/low risk items`),{approved:r}}cleanupOld(e=48){let t=this.filter({olderThanHours:e}),i=[];for(let r of t){let t=this.queue.reject(r.id,`Auto-rejected: older than ${e}h`);t&&i.push(t)}return this.logger.info(`Cleaned up ${i.length} old items`),{rejected:i}}groupByCategory(){let e=this.queue.getPending(),t={trading:[],content:[],build:[],deployment:[],configuration:[]};for(let i of e)t[i.decision.action.category].push(i);return t}groupByRisk(){let e=this.queue.getPending(),t={safe:[],low:[],medium:[],high:[],critical:[]};for(let i of e)t[i.decision.assessment.level].push(i);return t}getQuickActions(){return{approveSafe:()=>this.approveAllSafe(),cleanupOld:()=>this.cleanupOld(),approveAll:e=>this.approveFiltered({},e),rejectAll:e=>this.rejectFiltered({},e)}}},E=i(84770),T=class{logger;entries;maxEntries;retentionDays;lastHash;entryCount=0;constructor(e={}){this.logger=new w("AuditLogger"),this.entries=[],this.maxEntries=e.maxEntries??_.maxEntriesInMemory,this.retentionDays=e.retentionDays??_.retentionDays,this.lastHash=""}logActionReceived(e){return this.log("action_received",e.id,void 0,{type:e.type,engine:e.engine,category:e.category,description:e.description,estimatedValue:e.metadata.estimatedValue})}logRiskAssessed(e,t){return this.log("risk_assessed",e.id,t.id,{riskLevel:t.assessment.level,riskScore:t.assessment.score,factors:t.assessment.factors.map(e=>({name:e.name,value:e.value,exceeded:e.exceeded}))})}logDecisionMade(e){return this.log("decision_made",e.actionId,e.id,{outcome:e.outcome,reason:e.reason,riskLevel:e.assessment.level,riskScore:e.assessment.score})}logQueuedApproval(e){return this.log("queued_approval",e.decision.actionId,e.decision.id,{requestId:e.id,priority:e.priority,urgency:e.urgency,expiresAt:e.expiresAt})}logApproved(e){return this.log("approved",e.decision.actionId,e.decision.id,{requestId:e.id,approvedBy:e.reviewedBy,feedback:e.feedback,waitTime:e.reviewedAt-e.createdAt})}logRejected(e,t){return this.log("rejected",e.decision.actionId,e.decision.id,{requestId:e.id,rejectedBy:e.reviewedBy,reason:t})}logExecuted(e){return this.log("executed",e.actionId,e.decisionId,{success:e.success,duration:e.duration,output:e.output})}logExecutionFailed(e){return this.log("execution_failed",e.actionId,e.decisionId,{error:e.error,duration:e.duration,rolledBack:e.rolledBack})}logRolledBack(e,t){return this.log("rolled_back",e,t,{rolledBackAt:Date.now()})}logBoundaryViolation(e,t){return this.log("boundary_violation",e.id,void 0,{violations:t,type:e.type,category:e.category})}logEscalated(e){return this.log("escalated",e.decision.actionId,e.decision.id,{requestId:e.id,reason:"Required immediate attention",riskLevel:e.decision.assessment.level})}getEntries(){return[...this.entries]}getByActionId(e){return this.entries.filter(t=>t.actionId===e)}getByType(e){return this.entries.filter(t=>t.type===e)}getByTimeRange(e,t){return this.entries.filter(i=>i.timestamp>=e&&i.timestamp<=t)}verifyIntegrity(){let e="";for(let t=0;t<this.entries.length;t++){let i=this.entries[t];if(i.previousHash!==e)return{valid:!1,brokenAt:t};let r=this.calculateHash(i);if(i.hash!==r)return{valid:!1,brokenAt:t};e=i.hash}return{valid:!0}}getStats(){let e={};for(let t of this.entries)e[t.type]=(e[t.type]??0)+1;return{totalEntries:this.entries.length,byType:e,oldestEntry:this.entries.length>0?this.entries[0].timestamp:null,newestEntry:this.entries.length>0?this.entries[this.entries.length-1].timestamp:null}}clear(){this.entries=[],this.lastHash="",this.logger.info("Audit log cleared")}export(){return JSON.stringify(this.entries,null,2)}log(e,t,i,r){this.entryCount++;let s={id:`aud_${Date.now()}_${this.entryCount}`,timestamp:Date.now(),type:e,actionId:t,decisionId:i,data:r,hash:"",previousHash:this.lastHash};return s.hash=this.calculateHash(s),this.lastHash=s.hash,this.entries.push(s),this.cleanup(),this.logger.debug(`Audit: ${e}`,{actionId:t,decisionId:i}),s}calculateHash(e){let t=JSON.stringify({id:e.id,timestamp:e.timestamp,type:e.type,actionId:e.actionId,decisionId:e.decisionId,data:e.data,previousHash:e.previousHash});return(0,E.createHash)(_.hashAlgorithm).update(t).digest("hex")}cleanup(){let e=Date.now()-864e5*this.retentionDays;this.entries=this.entries.filter(t=>t.timestamp>=e),this.entries.length>this.maxEntries&&(this.entries=this.entries.slice(-this.maxEntries))}},O=class{logger;handlers;safeTypes;dangerousTypes;constructor(e={}){this.logger=new w("SafeActions"),this.handlers=new Map,this.safeTypes=new Set([...p,...e.additionalSafeTypes??[]]),this.dangerousTypes=new Set(e.dangerousTypes??[...m]),this.registerDefaultHandlers()}registerHandler(e,t){this.handlers.set(e,t),this.logger.info(`Handler registered for: ${e}`)}isSafe(e){if(this.safeTypes.has(e))return!0;for(let t of this.safeTypes)if(e.includes(t))return!0;return!1}isDangerous(e){if(this.dangerousTypes.has(e))return!0;for(let t of this.dangerousTypes)if(e.includes(t))return!0;return!1}getHandler(e){if(this.handlers.has(e))return this.handlers.get(e);for(let[t,i]of this.handlers)if(e.includes(t)||t.includes(e))return i}async execute(e){let t=this.getHandler(e.type);if(!t)throw Error(`No handler registered for action type: ${e.type}`);return this.logger.info(`Executing: ${e.type}`,{actionId:e.id}),t(e)}getSafeTypes(){return Array.from(this.safeTypes)}getDangerousTypes(){return Array.from(this.dangerousTypes)}addSafeType(e){this.safeTypes.add(e),this.dangerousTypes.delete(e)}addDangerousType(e){this.dangerousTypes.add(e),this.safeTypes.delete(e)}registerDefaultHandlers(){this.handlers.set("log_only",async e=>(this.logger.info(`[DRY RUN] Would execute: ${e.type}`,e.params),{dryRun:!0,action:e.type})),this.handlers.set("passthrough",async e=>({passthrough:!0,actionId:e.id})),this.handlers.set("content",async e=>({scheduled:!0,type:e.type})),this.handlers.set("trading",async e=>({submitted:!0,type:e.type})),this.handlers.set("build",async e=>({queued:!0,type:e.type}))}},$=class{logger;checkpoints;handlers;maxCheckpoints;checkpointTtl;constructor(e={}){this.logger=new w("RollbackManager"),this.checkpoints=new Map,this.handlers=new Map,this.maxCheckpoints=e.maxCheckpoints??100,this.checkpointTtl=e.checkpointTtl??864e5}async createCheckpoint(e){let t=e.action;if(!t.metadata.reversible)throw this.logger.warn(`Action ${t.type} is not reversible, no checkpoint created`),Error("Cannot create checkpoint for irreversible action");this.cleanupExpired(),this.checkpoints.size>=this.maxCheckpoints&&this.removeOldest();let i={id:`ckpt_${Date.now()}_${t.id}`,actionId:t.id,decisionId:e.id,state:await this.captureState(t),createdAt:Date.now()};return this.checkpoints.set(i.id,i),this.logger.info(`Checkpoint created: ${i.id}`,{actionId:t.id,actionType:t.type}),i}async rollback(e){let t=this.checkpoints.get(e);if(!t)throw Error(`Checkpoint not found: ${e}`);this.logger.info(`Rolling back checkpoint: ${e}`);let i=this.findHandler(t);i?await i(t):this.logger.warn("No rollback handler found, logging state only",{checkpointId:e,state:t.state}),this.checkpoints.delete(e),this.logger.info(`Rollback complete: ${e}`)}async rollbackByActionId(e){let t=this.findByActionId(e);if(!t)throw Error(`No checkpoint found for action: ${e}`);await this.rollback(t.id)}registerHandler(e,t){this.handlers.set(e,t),this.logger.info(`Rollback handler registered for: ${e}`)}canRollback(e){let t=this.findByActionId(e);return!!t&&Date.now()-t.createdAt<this.checkpointTtl}getCheckpoint(e){return this.checkpoints.get(e)}findByActionId(e){for(let t of this.checkpoints.values())if(t.actionId===e)return t}getActiveCheckpoints(){return this.cleanupExpired(),Array.from(this.checkpoints.values())}clear(){this.checkpoints.clear(),this.logger.info("All checkpoints cleared")}async captureState(e){return{timestamp:Date.now(),actionType:e.type,category:e.category,params:{...e.params}}}findHandler(e){let t=e.state.actionType;if(this.handlers.has(t))return this.handlers.get(t);for(let[e,i]of this.handlers)if(t.includes(e))return i}cleanupExpired(){let e=Date.now(),t=[];for(let[i,r]of this.checkpoints)e-r.createdAt>this.checkpointTtl&&t.push(i);for(let e of t)this.checkpoints.delete(e);t.length>0&&this.logger.debug(`Cleaned up ${t.length} expired checkpoints`)}removeOldest(){let e=null;for(let t of this.checkpoints.values())(!e||t.createdAt<e.createdAt)&&(e=t);e&&(this.checkpoints.delete(e.id),this.logger.debug(`Removed oldest checkpoint: ${e.id}`))}},C=class extends x{logger;safeActions;rollbackManager;config;executing;executionCount;lastExecutionTime;failedActions;constructor(e={}){super(),this.logger=new w("AutoExecutor"),this.safeActions=new O,this.rollbackManager=new $,this.config={maxConcurrent:e.maxConcurrent??5,cooldownAfterFailureMs:e.cooldownAfterFailureMs??v.cooldownAfterFailureMs,autoRollback:e.autoRollback??!0},this.executing=new Set,this.executionCount=0,this.lastExecutionTime=0,this.failedActions=new Map}async execute(e){let t=e.action;if("auto_execute"!==e.outcome)return this.createFailedResult(e,"Decision not approved for auto-execution");if(!this.checkRateLimit())return this.emit("execution:rate_limited",t),this.createFailedResult(e,"Rate limit exceeded");if(this.executing.size>=this.config.maxConcurrent)return this.createFailedResult(e,"Maximum concurrent executions reached");if(this.isInCooldown(t.type))return this.createFailedResult(e,`Action type ${t.type} in cooldown after recent failure`);if(this.executing.has(t.id))return this.createFailedResult(e,"Action already executing");this.executing.add(t.id),this.emit("execution:started",e);let i=Date.now();this.logger.info(`Executing: ${t.type}`,{actionId:t.id,decisionId:e.id});try{t.metadata.reversible&&await this.rollbackManager.createCheckpoint(e);let r=await this.safeActions.execute(t),s={actionId:t.id,decisionId:e.id,success:!0,output:r,executedAt:Date.now(),duration:Date.now()-i,rolledBack:!1};return this.executionCount++,this.lastExecutionTime=Date.now(),this.logger.info(`Execution successful: ${t.type}`,{actionId:t.id,duration:s.duration}),this.emit("execution:completed",s),s}catch(o){let r=o instanceof Error?o.message:String(o);this.logger.error(`Execution failed: ${t.type}`,{actionId:t.id,error:r}),this.failedActions.set(t.type,Date.now());let s=!1;if(this.config.autoRollback&&t.metadata.reversible)try{await this.rollbackManager.rollbackByActionId(t.id),s=!0,this.emit("execution:rolled_back",t.id)}catch(e){this.logger.error(`Rollback failed for ${t.id}`,{error:e instanceof Error?e.message:String(e)})}let a={actionId:t.id,decisionId:e.id,success:!1,error:r,executedAt:Date.now(),duration:Date.now()-i,rolledBack:s};return this.emit("execution:failed",a),a}finally{this.executing.delete(t.id)}}async executeBatch(e){let t=[],i=[];for(let r of e){let e=await this.execute(r);e.success?t.push(e):i.push(e)}return{success:t,failed:i}}registerHandler(e,t){this.safeActions.registerHandler(e,t)}getStats(){return{totalExecutions:this.executionCount,currentlyExecuting:this.executing.size,failedInCooldown:Array.from(this.failedActions.entries()).filter(([,e])=>Date.now()-e<this.config.cooldownAfterFailureMs).length}}canRollback(e){return this.rollbackManager.canRollback(e)}async rollback(e){await this.rollbackManager.rollbackByActionId(e),this.emit("execution:rolled_back",e)}getSafeActions(){return this.safeActions}getRollbackManager(){return this.rollbackManager}checkRateLimit(){let e=v.maxAutoExecutionsPerHour;return Date.now()-this.lastExecutionTime>=36e5/e}isInCooldown(e){let t=this.failedActions.get(e);return!!t&&Date.now()-t<this.config.cooldownAfterFailureMs}createFailedResult(e,t){return{actionId:e.actionId,decisionId:e.id,success:!1,error:t,executedAt:Date.now(),duration:0,rolledBack:!1}}};(function(e){e.assertEqual=e=>{},e.assertIs=function(e){},e.assertNever=function(e){throw Error()},e.arrayToEnum=e=>{let t={};for(let i of e)t[i]=i;return t},e.getValidEnumValues=t=>{let i=e.objectKeys(t).filter(e=>"number"!=typeof t[t[e]]),r={};for(let e of i)r[e]=t[e];return e.objectValues(r)},e.objectValues=t=>e.objectKeys(t).map(function(e){return t[e]}),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{let t=[];for(let i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.push(i);return t},e.find=(e,t)=>{for(let i of e)if(t(i))return i},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&Number.isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t})(s||(s={})),(a||(a={})).mergeShapes=(e,t)=>({...e,...t});let j=s.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),I=e=>{switch(typeof e){case"undefined":return j.undefined;case"string":return j.string;case"number":return Number.isNaN(e)?j.nan:j.number;case"boolean":return j.boolean;case"function":return j.function;case"bigint":return j.bigint;case"symbol":return j.symbol;case"object":if(Array.isArray(e))return j.array;if(null===e)return j.null;if(e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch)return j.promise;if("undefined"!=typeof Map&&e instanceof Map)return j.map;if("undefined"!=typeof Set&&e instanceof Set)return j.set;if("undefined"!=typeof Date&&e instanceof Date)return j.date;return j.object;default:return j.unknown}},D=s.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class R extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(e){return e.message},i={_errors:[]},r=e=>{for(let s of e.issues)if("invalid_union"===s.code)s.unionErrors.map(r);else if("invalid_return_type"===s.code)r(s.returnTypeError);else if("invalid_arguments"===s.code)r(s.argumentsError);else if(0===s.path.length)i._errors.push(t(s));else{let e=i,r=0;for(;r<s.path.length;){let i=s.path[r];r===s.path.length-1?(e[i]=e[i]||{_errors:[]},e[i]._errors.push(t(s))):e[i]=e[i]||{_errors:[]},e=e[i],r++}}};return r(this),i}static assert(e){if(!(e instanceof R))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,s.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){let t={},i=[];for(let r of this.issues)if(r.path.length>0){let i=r.path[0];t[i]=t[i]||[],t[i].push(e(r))}else i.push(e(r));return{formErrors:i,fieldErrors:t}}get formErrors(){return this.flatten()}}R.create=e=>new R(e);let N=(e,t)=>{let i;switch(e.code){case D.invalid_type:i=e.received===j.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case D.invalid_literal:i=`Invalid literal value, expected ${JSON.stringify(e.expected,s.jsonStringifyReplacer)}`;break;case D.unrecognized_keys:i=`Unrecognized key(s) in object: ${s.joinValues(e.keys,", ")}`;break;case D.invalid_union:i="Invalid input";break;case D.invalid_union_discriminator:i=`Invalid discriminator value. Expected ${s.joinValues(e.options)}`;break;case D.invalid_enum_value:i=`Invalid enum value. Expected ${s.joinValues(e.options)}, received '${e.received}'`;break;case D.invalid_arguments:i="Invalid function arguments";break;case D.invalid_return_type:i="Invalid function return type";break;case D.invalid_date:i="Invalid date";break;case D.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(i=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(i=`${i} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?i=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?i=`Invalid input: must end with "${e.validation.endsWith}"`:s.assertNever(e.validation):i="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case D.too_small:i="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"bigint"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case D.too_big:i="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case D.custom:i="Invalid input";break;case D.invalid_intersection_types:i="Intersection results could not be merged";break;case D.not_multiple_of:i=`Number must be a multiple of ${e.multipleOf}`;break;case D.not_finite:i="Number must be finite";break;default:i=t.defaultError,s.assertNever(e)}return{message:i}};!function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:e?.message}(o||(o={}));let P=e=>{let{data:t,path:i,errorMaps:r,issueData:s}=e,a=[...i,...s.path||[]],o={...s,path:a};if(void 0!==s.message)return{...s,path:a,message:s.message};let l="";for(let e of r.filter(e=>!!e).slice().reverse())l=e(o,{data:t,defaultError:l}).message;return{...s,path:a,message:l}};function L(e,t){let i=P({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,N,N==N?void 0:N].filter(e=>!!e)});e.common.issues.push(i)}class B{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){let i=[];for(let r of t){if("aborted"===r.status)return Z;"dirty"===r.status&&e.dirty(),i.push(r.value)}return{status:e.value,value:i}}static async mergeObjectAsync(e,t){let i=[];for(let e of t){let t=await e.key,r=await e.value;i.push({key:t,value:r})}return B.mergeObjectSync(e,i)}static mergeObjectSync(e,t){let i={};for(let r of t){let{key:t,value:s}=r;if("aborted"===t.status||"aborted"===s.status)return Z;"dirty"===t.status&&e.dirty(),"dirty"===s.status&&e.dirty(),"__proto__"!==t.value&&(void 0!==s.value||r.alwaysSet)&&(i[t.value]=s.value)}return{status:e.value,value:i}}}let Z=Object.freeze({status:"aborted"}),M=e=>({status:"dirty",value:e}),F=e=>({status:"valid",value:e}),q=e=>"aborted"===e.status,z=e=>"dirty"===e.status,U=e=>"valid"===e.status,V=e=>"undefined"!=typeof Promise&&e instanceof Promise;class H{constructor(e,t,i,r){this._cachedPath=[],this.parent=e,this.data=t,this._path=i,this._key=r}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}let W=(e,t)=>{if(U(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new R(e.common.issues);return this._error=t,this._error}}};function K(e){if(!e)return{};let{errorMap:t,invalid_type_error:i,required_error:r,description:s}=e;if(t&&(i||r))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:s}:{errorMap:(t,s)=>{let{message:a}=e;return"invalid_enum_value"===t.code?{message:a??s.defaultError}:void 0===s.data?{message:a??r??s.defaultError}:"invalid_type"!==t.code?{message:s.defaultError}:{message:a??i??s.defaultError}},description:s}}class J{get description(){return this._def.description}_getType(e){return I(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:I(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new B,ctx:{common:e.parent.common,data:e.data,parsedType:I(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(V(t))throw Error("Synchronous parse encountered promise.");return t}_parseAsync(e){return Promise.resolve(this._parse(e))}parse(e,t){let i=this.safeParse(e,t);if(i.success)return i.data;throw i.error}safeParse(e,t){let i={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:I(e)},r=this._parseSync({data:e,path:i.path,parent:i});return W(i,r)}"~validate"(e){let t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:I(e)};if(!this["~standard"].async)try{let i=this._parseSync({data:e,path:[],parent:t});return U(i)?{value:i.value}:{issues:t.common.issues}}catch(e){e?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(e=>U(e)?{value:e.value}:{issues:t.common.issues})}async parseAsync(e,t){let i=await this.safeParseAsync(e,t);if(i.success)return i.data;throw i.error}async safeParseAsync(e,t){let i={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:I(e)},r=this._parse({data:e,path:i.path,parent:i});return W(i,await (V(r)?r:Promise.resolve(r)))}refine(e,t){let i=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,r)=>{let s=e(t),a=()=>r.addIssue({code:D.custom,...i(t)});return"undefined"!=typeof Promise&&s instanceof Promise?s.then(e=>!!e||(a(),!1)):!!s||(a(),!1)})}refinement(e,t){return this._refinement((i,r)=>!!e(i)||(r.addIssue("function"==typeof t?t(i,r):t),!1))}_refinement(e){return new eq({schema:this,typeName:l.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return ez.create(this,this._def)}nullable(){return eU.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return eS.create(this)}promise(){return eF.create(this,this._def)}or(e){return eT.create([this,e],this._def)}and(e){return eC.create(this,e,this._def)}transform(e){return new eq({...K(this._def),schema:this,typeName:l.ZodEffects,effect:{type:"transform",transform:e}})}default(e){return new eV({...K(this._def),innerType:this,defaultValue:"function"==typeof e?e:()=>e,typeName:l.ZodDefault})}brand(){return new eK({typeName:l.ZodBranded,type:this,...K(this._def)})}catch(e){return new eH({...K(this._def),innerType:this,catchValue:"function"==typeof e?e:()=>e,typeName:l.ZodCatch})}describe(e){return new this.constructor({...this._def,description:e})}pipe(e){return eJ.create(this,e)}readonly(){return eQ.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}let Q=/^c[^\s-]{8,}$/i,G=/^[0-9a-z]+$/,X=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Y=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,ee=/^[a-z0-9_-]{21}$/i,et=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,ei=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,er=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,en=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,es=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ea=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,eo=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,el=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,eu=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,ec="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",ed=RegExp(`^${ec}$`);function eh(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`);let i=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${i}`}class ef extends J{_parse(e){var t,i,a,o;let l;if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==j.string){let t=this._getOrReturnCtx(e);return L(t,{code:D.invalid_type,expected:j.string,received:t.parsedType}),Z}let u=new B;for(let c of this._def.checks)if("min"===c.kind)e.data.length<c.value&&(L(l=this._getOrReturnCtx(e,l),{code:D.too_small,minimum:c.value,type:"string",inclusive:!0,exact:!1,message:c.message}),u.dirty());else if("max"===c.kind)e.data.length>c.value&&(L(l=this._getOrReturnCtx(e,l),{code:D.too_big,maximum:c.value,type:"string",inclusive:!0,exact:!1,message:c.message}),u.dirty());else if("length"===c.kind){let t=e.data.length>c.value,i=e.data.length<c.value;(t||i)&&(l=this._getOrReturnCtx(e,l),t?L(l,{code:D.too_big,maximum:c.value,type:"string",inclusive:!0,exact:!0,message:c.message}):i&&L(l,{code:D.too_small,minimum:c.value,type:"string",inclusive:!0,exact:!0,message:c.message}),u.dirty())}else if("email"===c.kind)er.test(e.data)||(L(l=this._getOrReturnCtx(e,l),{validation:"email",code:D.invalid_string,message:c.message}),u.dirty());else if("emoji"===c.kind)r||(r=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),r.test(e.data)||(L(l=this._getOrReturnCtx(e,l),{validation:"emoji",code:D.invalid_string,message:c.message}),u.dirty());else if("uuid"===c.kind)Y.test(e.data)||(L(l=this._getOrReturnCtx(e,l),{validation:"uuid",code:D.invalid_string,message:c.message}),u.dirty());else if("nanoid"===c.kind)ee.test(e.data)||(L(l=this._getOrReturnCtx(e,l),{validation:"nanoid",code:D.invalid_string,message:c.message}),u.dirty());else if("cuid"===c.kind)Q.test(e.data)||(L(l=this._getOrReturnCtx(e,l),{validation:"cuid",code:D.invalid_string,message:c.message}),u.dirty());else if("cuid2"===c.kind)G.test(e.data)||(L(l=this._getOrReturnCtx(e,l),{validation:"cuid2",code:D.invalid_string,message:c.message}),u.dirty());else if("ulid"===c.kind)X.test(e.data)||(L(l=this._getOrReturnCtx(e,l),{validation:"ulid",code:D.invalid_string,message:c.message}),u.dirty());else if("url"===c.kind)try{new URL(e.data)}catch{L(l=this._getOrReturnCtx(e,l),{validation:"url",code:D.invalid_string,message:c.message}),u.dirty()}else"regex"===c.kind?(c.regex.lastIndex=0,c.regex.test(e.data)||(L(l=this._getOrReturnCtx(e,l),{validation:"regex",code:D.invalid_string,message:c.message}),u.dirty())):"trim"===c.kind?e.data=e.data.trim():"includes"===c.kind?e.data.includes(c.value,c.position)||(L(l=this._getOrReturnCtx(e,l),{code:D.invalid_string,validation:{includes:c.value,position:c.position},message:c.message}),u.dirty()):"toLowerCase"===c.kind?e.data=e.data.toLowerCase():"toUpperCase"===c.kind?e.data=e.data.toUpperCase():"startsWith"===c.kind?e.data.startsWith(c.value)||(L(l=this._getOrReturnCtx(e,l),{code:D.invalid_string,validation:{startsWith:c.value},message:c.message}),u.dirty()):"endsWith"===c.kind?e.data.endsWith(c.value)||(L(l=this._getOrReturnCtx(e,l),{code:D.invalid_string,validation:{endsWith:c.value},message:c.message}),u.dirty()):"datetime"===c.kind?(function(e){let t=`${ec}T${eh(e)}`,i=[];return i.push(e.local?"Z?":"Z"),e.offset&&i.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${i.join("|")})`,RegExp(`^${t}$`)})(c).test(e.data)||(L(l=this._getOrReturnCtx(e,l),{code:D.invalid_string,validation:"datetime",message:c.message}),u.dirty()):"date"===c.kind?ed.test(e.data)||(L(l=this._getOrReturnCtx(e,l),{code:D.invalid_string,validation:"date",message:c.message}),u.dirty()):"time"===c.kind?RegExp(`^${eh(c)}$`).test(e.data)||(L(l=this._getOrReturnCtx(e,l),{code:D.invalid_string,validation:"time",message:c.message}),u.dirty()):"duration"===c.kind?ei.test(e.data)||(L(l=this._getOrReturnCtx(e,l),{validation:"duration",code:D.invalid_string,message:c.message}),u.dirty()):"ip"===c.kind?(t=e.data,("v4"===(i=c.version)||!i)&&en.test(t)||("v6"===i||!i)&&ea.test(t)||(L(l=this._getOrReturnCtx(e,l),{validation:"ip",code:D.invalid_string,message:c.message}),u.dirty())):"jwt"===c.kind?!function(e,t){if(!et.test(e))return!1;try{let[i]=e.split(".");if(!i)return!1;let r=i.replace(/-/g,"+").replace(/_/g,"/").padEnd(i.length+(4-i.length%4)%4,"="),s=JSON.parse(atob(r));if("object"!=typeof s||null===s||"typ"in s&&s?.typ!=="JWT"||!s.alg||t&&s.alg!==t)return!1;return!0}catch{return!1}}(e.data,c.alg)&&(L(l=this._getOrReturnCtx(e,l),{validation:"jwt",code:D.invalid_string,message:c.message}),u.dirty()):"cidr"===c.kind?(a=e.data,("v4"===(o=c.version)||!o)&&es.test(a)||("v6"===o||!o)&&eo.test(a)||(L(l=this._getOrReturnCtx(e,l),{validation:"cidr",code:D.invalid_string,message:c.message}),u.dirty())):"base64"===c.kind?el.test(e.data)||(L(l=this._getOrReturnCtx(e,l),{validation:"base64",code:D.invalid_string,message:c.message}),u.dirty()):"base64url"===c.kind?eu.test(e.data)||(L(l=this._getOrReturnCtx(e,l),{validation:"base64url",code:D.invalid_string,message:c.message}),u.dirty()):s.assertNever(c);return{status:u.value,value:e.data}}_regex(e,t,i){return this.refinement(t=>e.test(t),{validation:t,code:D.invalid_string,...o.errToObj(i)})}_addCheck(e){return new ef({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...o.errToObj(e)})}url(e){return this._addCheck({kind:"url",...o.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...o.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...o.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...o.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...o.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...o.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...o.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...o.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...o.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...o.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...o.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...o.errToObj(e)})}datetime(e){return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===e?.precision?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...o.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===e?.precision?null:e?.precision,...o.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...o.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...o.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...o.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...o.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...o.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...o.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...o.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...o.errToObj(t)})}nonempty(e){return this.min(1,o.errToObj(e))}trim(){return new ef({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new ef({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new ef({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}ef.create=e=>new ef({checks:[],typeName:l.ZodString,coerce:e?.coerce??!1,...K(e)});class ep extends J{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){let t;if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==j.number){let t=this._getOrReturnCtx(e);return L(t,{code:D.invalid_type,expected:j.number,received:t.parsedType}),Z}let i=new B;for(let r of this._def.checks)"int"===r.kind?s.isInteger(e.data)||(L(t=this._getOrReturnCtx(e,t),{code:D.invalid_type,expected:"integer",received:"float",message:r.message}),i.dirty()):"min"===r.kind?(r.inclusive?e.data<r.value:e.data<=r.value)&&(L(t=this._getOrReturnCtx(e,t),{code:D.too_small,minimum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),i.dirty()):"max"===r.kind?(r.inclusive?e.data>r.value:e.data>=r.value)&&(L(t=this._getOrReturnCtx(e,t),{code:D.too_big,maximum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),i.dirty()):"multipleOf"===r.kind?0!==function(e,t){let i=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,s=i>r?i:r;return Number.parseInt(e.toFixed(s).replace(".",""))%Number.parseInt(t.toFixed(s).replace(".",""))/10**s}(e.data,r.value)&&(L(t=this._getOrReturnCtx(e,t),{code:D.not_multiple_of,multipleOf:r.value,message:r.message}),i.dirty()):"finite"===r.kind?Number.isFinite(e.data)||(L(t=this._getOrReturnCtx(e,t),{code:D.not_finite,message:r.message}),i.dirty()):s.assertNever(r);return{status:i.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,o.toString(t))}gt(e,t){return this.setLimit("min",e,!1,o.toString(t))}lte(e,t){return this.setLimit("max",e,!0,o.toString(t))}lt(e,t){return this.setLimit("max",e,!1,o.toString(t))}setLimit(e,t,i,r){return new ep({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:i,message:o.toString(r)}]})}_addCheck(e){return new ep({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:o.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:o.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:o.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:o.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:o.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:o.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:o.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:o.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:o.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&s.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let i of this._def.checks){if("finite"===i.kind||"int"===i.kind||"multipleOf"===i.kind)return!0;"min"===i.kind?(null===t||i.value>t)&&(t=i.value):"max"===i.kind&&(null===e||i.value<e)&&(e=i.value)}return Number.isFinite(t)&&Number.isFinite(e)}}ep.create=e=>new ep({checks:[],typeName:l.ZodNumber,coerce:e?.coerce||!1,...K(e)});class em extends J{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){let t;if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==j.bigint)return this._getInvalidInput(e);let i=new B;for(let r of this._def.checks)"min"===r.kind?(r.inclusive?e.data<r.value:e.data<=r.value)&&(L(t=this._getOrReturnCtx(e,t),{code:D.too_small,type:"bigint",minimum:r.value,inclusive:r.inclusive,message:r.message}),i.dirty()):"max"===r.kind?(r.inclusive?e.data>r.value:e.data>=r.value)&&(L(t=this._getOrReturnCtx(e,t),{code:D.too_big,type:"bigint",maximum:r.value,inclusive:r.inclusive,message:r.message}),i.dirty()):"multipleOf"===r.kind?e.data%r.value!==BigInt(0)&&(L(t=this._getOrReturnCtx(e,t),{code:D.not_multiple_of,multipleOf:r.value,message:r.message}),i.dirty()):s.assertNever(r);return{status:i.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return L(t,{code:D.invalid_type,expected:j.bigint,received:t.parsedType}),Z}gte(e,t){return this.setLimit("min",e,!0,o.toString(t))}gt(e,t){return this.setLimit("min",e,!1,o.toString(t))}lte(e,t){return this.setLimit("max",e,!0,o.toString(t))}lt(e,t){return this.setLimit("max",e,!1,o.toString(t))}setLimit(e,t,i,r){return new em({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:i,message:o.toString(r)}]})}_addCheck(e){return new em({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:o.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:o.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:o.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:o.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:o.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}em.create=e=>new em({checks:[],typeName:l.ZodBigInt,coerce:e?.coerce??!1,...K(e)});class eg extends J{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==j.boolean){let t=this._getOrReturnCtx(e);return L(t,{code:D.invalid_type,expected:j.boolean,received:t.parsedType}),Z}return F(e.data)}}eg.create=e=>new eg({typeName:l.ZodBoolean,coerce:e?.coerce||!1,...K(e)});class ey extends J{_parse(e){let t;if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==j.date){let t=this._getOrReturnCtx(e);return L(t,{code:D.invalid_type,expected:j.date,received:t.parsedType}),Z}if(Number.isNaN(e.data.getTime()))return L(this._getOrReturnCtx(e),{code:D.invalid_date}),Z;let i=new B;for(let r of this._def.checks)"min"===r.kind?e.data.getTime()<r.value&&(L(t=this._getOrReturnCtx(e,t),{code:D.too_small,message:r.message,inclusive:!0,exact:!1,minimum:r.value,type:"date"}),i.dirty()):"max"===r.kind?e.data.getTime()>r.value&&(L(t=this._getOrReturnCtx(e,t),{code:D.too_big,message:r.message,inclusive:!0,exact:!1,maximum:r.value,type:"date"}),i.dirty()):s.assertNever(r);return{status:i.value,value:new Date(e.data.getTime())}}_addCheck(e){return new ey({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:o.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:o.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}ey.create=e=>new ey({checks:[],coerce:e?.coerce||!1,typeName:l.ZodDate,...K(e)});class ev extends J{_parse(e){if(this._getType(e)!==j.symbol){let t=this._getOrReturnCtx(e);return L(t,{code:D.invalid_type,expected:j.symbol,received:t.parsedType}),Z}return F(e.data)}}ev.create=e=>new ev({typeName:l.ZodSymbol,...K(e)});class e_ extends J{_parse(e){if(this._getType(e)!==j.undefined){let t=this._getOrReturnCtx(e);return L(t,{code:D.invalid_type,expected:j.undefined,received:t.parsedType}),Z}return F(e.data)}}e_.create=e=>new e_({typeName:l.ZodUndefined,...K(e)});class eb extends J{_parse(e){if(this._getType(e)!==j.null){let t=this._getOrReturnCtx(e);return L(t,{code:D.invalid_type,expected:j.null,received:t.parsedType}),Z}return F(e.data)}}eb.create=e=>new eb({typeName:l.ZodNull,...K(e)});class ew extends J{constructor(){super(...arguments),this._any=!0}_parse(e){return F(e.data)}}ew.create=e=>new ew({typeName:l.ZodAny,...K(e)});class ex extends J{constructor(){super(...arguments),this._unknown=!0}_parse(e){return F(e.data)}}ex.create=e=>new ex({typeName:l.ZodUnknown,...K(e)});class ek extends J{_parse(e){let t=this._getOrReturnCtx(e);return L(t,{code:D.invalid_type,expected:j.never,received:t.parsedType}),Z}}ek.create=e=>new ek({typeName:l.ZodNever,...K(e)});class eA extends J{_parse(e){if(this._getType(e)!==j.undefined){let t=this._getOrReturnCtx(e);return L(t,{code:D.invalid_type,expected:j.void,received:t.parsedType}),Z}return F(e.data)}}eA.create=e=>new eA({typeName:l.ZodVoid,...K(e)});class eS extends J{_parse(e){let{ctx:t,status:i}=this._processInputParams(e),r=this._def;if(t.parsedType!==j.array)return L(t,{code:D.invalid_type,expected:j.array,received:t.parsedType}),Z;if(null!==r.exactLength){let e=t.data.length>r.exactLength.value,s=t.data.length<r.exactLength.value;(e||s)&&(L(t,{code:e?D.too_big:D.too_small,minimum:s?r.exactLength.value:void 0,maximum:e?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),i.dirty())}if(null!==r.minLength&&t.data.length<r.minLength.value&&(L(t,{code:D.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),i.dirty()),null!==r.maxLength&&t.data.length>r.maxLength.value&&(L(t,{code:D.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),i.dirty()),t.common.async)return Promise.all([...t.data].map((e,i)=>r.type._parseAsync(new H(t,e,t.path,i)))).then(e=>B.mergeArray(i,e));let s=[...t.data].map((e,i)=>r.type._parseSync(new H(t,e,t.path,i)));return B.mergeArray(i,s)}get element(){return this._def.type}min(e,t){return new eS({...this._def,minLength:{value:e,message:o.toString(t)}})}max(e,t){return new eS({...this._def,maxLength:{value:e,message:o.toString(t)}})}length(e,t){return new eS({...this._def,exactLength:{value:e,message:o.toString(t)}})}nonempty(e){return this.min(1,e)}}eS.create=(e,t)=>new eS({type:e,minLength:null,maxLength:null,exactLength:null,typeName:l.ZodArray,...K(t)});class eE extends J{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let e=this._def.shape(),t=s.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==j.object){let t=this._getOrReturnCtx(e);return L(t,{code:D.invalid_type,expected:j.object,received:t.parsedType}),Z}let{status:t,ctx:i}=this._processInputParams(e),{shape:r,keys:s}=this._getCached(),a=[];if(!(this._def.catchall instanceof ek&&"strip"===this._def.unknownKeys))for(let e in i.data)s.includes(e)||a.push(e);let o=[];for(let e of s){let t=r[e],s=i.data[e];o.push({key:{status:"valid",value:e},value:t._parse(new H(i,s,i.path,e)),alwaysSet:e in i.data})}if(this._def.catchall instanceof ek){let e=this._def.unknownKeys;if("passthrough"===e)for(let e of a)o.push({key:{status:"valid",value:e},value:{status:"valid",value:i.data[e]}});else if("strict"===e)a.length>0&&(L(i,{code:D.unrecognized_keys,keys:a}),t.dirty());else if("strip"===e);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let e=this._def.catchall;for(let t of a){let r=i.data[t];o.push({key:{status:"valid",value:t},value:e._parse(new H(i,r,i.path,t)),alwaysSet:t in i.data})}}return i.common.async?Promise.resolve().then(async()=>{let e=[];for(let t of o){let i=await t.key,r=await t.value;e.push({key:i,value:r,alwaysSet:t.alwaysSet})}return e}).then(e=>B.mergeObjectSync(t,e)):B.mergeObjectSync(t,o)}get shape(){return this._def.shape()}strict(e){return o.errToObj,new eE({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,i)=>{let r=this._def.errorMap?.(t,i).message??i.defaultError;return"unrecognized_keys"===t.code?{message:o.errToObj(e).message??r}:{message:r}}}:{}})}strip(){return new eE({...this._def,unknownKeys:"strip"})}passthrough(){return new eE({...this._def,unknownKeys:"passthrough"})}extend(e){return new eE({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new eE({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:l.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new eE({...this._def,catchall:e})}pick(e){let t={};for(let i of s.objectKeys(e))e[i]&&this.shape[i]&&(t[i]=this.shape[i]);return new eE({...this._def,shape:()=>t})}omit(e){let t={};for(let i of s.objectKeys(this.shape))e[i]||(t[i]=this.shape[i]);return new eE({...this._def,shape:()=>t})}deepPartial(){return function e(t){if(t instanceof eE){let i={};for(let r in t.shape){let s=t.shape[r];i[r]=ez.create(e(s))}return new eE({...t._def,shape:()=>i})}return t instanceof eS?new eS({...t._def,type:e(t.element)}):t instanceof ez?ez.create(e(t.unwrap())):t instanceof eU?eU.create(e(t.unwrap())):t instanceof ej?ej.create(t.items.map(t=>e(t))):t}(this)}partial(e){let t={};for(let i of s.objectKeys(this.shape)){let r=this.shape[i];e&&!e[i]?t[i]=r:t[i]=r.optional()}return new eE({...this._def,shape:()=>t})}required(e){let t={};for(let i of s.objectKeys(this.shape))if(e&&!e[i])t[i]=this.shape[i];else{let e=this.shape[i];for(;e instanceof ez;)e=e._def.innerType;t[i]=e}return new eE({...this._def,shape:()=>t})}keyof(){return eB(s.objectKeys(this.shape))}}eE.create=(e,t)=>new eE({shape:()=>e,unknownKeys:"strip",catchall:ek.create(),typeName:l.ZodObject,...K(t)}),eE.strictCreate=(e,t)=>new eE({shape:()=>e,unknownKeys:"strict",catchall:ek.create(),typeName:l.ZodObject,...K(t)}),eE.lazycreate=(e,t)=>new eE({shape:e,unknownKeys:"strip",catchall:ek.create(),typeName:l.ZodObject,...K(t)});class eT extends J{_parse(e){let{ctx:t}=this._processInputParams(e),i=this._def.options;if(t.common.async)return Promise.all(i.map(async e=>{let i={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:i}),ctx:i}})).then(function(e){for(let t of e)if("valid"===t.result.status)return t.result;for(let i of e)if("dirty"===i.result.status)return t.common.issues.push(...i.ctx.common.issues),i.result;let i=e.map(e=>new R(e.ctx.common.issues));return L(t,{code:D.invalid_union,unionErrors:i}),Z});{let e;let r=[];for(let s of i){let i={...t,common:{...t.common,issues:[]},parent:null},a=s._parseSync({data:t.data,path:t.path,parent:i});if("valid"===a.status)return a;"dirty"!==a.status||e||(e={result:a,ctx:i}),i.common.issues.length&&r.push(i.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;let s=r.map(e=>new R(e));return L(t,{code:D.invalid_union,unionErrors:s}),Z}}get options(){return this._def.options}}eT.create=(e,t)=>new eT({options:e,typeName:l.ZodUnion,...K(t)});let eO=e=>{if(e instanceof eP)return eO(e.schema);if(e instanceof eq)return eO(e.innerType());if(e instanceof eL)return[e.value];if(e instanceof eZ)return e.options;if(e instanceof eM)return s.objectValues(e.enum);if(e instanceof eV)return eO(e._def.innerType);if(e instanceof e_)return[void 0];else if(e instanceof eb)return[null];else if(e instanceof ez)return[void 0,...eO(e.unwrap())];else if(e instanceof eU)return[null,...eO(e.unwrap())];else if(e instanceof eK)return eO(e.unwrap());else if(e instanceof eQ)return eO(e.unwrap());else if(e instanceof eH)return eO(e._def.innerType);else return[]};class e$ extends J{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==j.object)return L(t,{code:D.invalid_type,expected:j.object,received:t.parsedType}),Z;let i=this.discriminator,r=t.data[i],s=this.optionsMap.get(r);return s?t.common.async?s._parseAsync({data:t.data,path:t.path,parent:t}):s._parseSync({data:t.data,path:t.path,parent:t}):(L(t,{code:D.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[i]}),Z)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,i){let r=new Map;for(let i of t){let t=eO(i.shape[e]);if(!t.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let s of t){if(r.has(s))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(s)}`);r.set(s,i)}}return new e$({typeName:l.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:r,...K(i)})}}class eC extends J{_parse(e){let{status:t,ctx:i}=this._processInputParams(e),r=(e,r)=>{if(q(e)||q(r))return Z;let a=function e(t,i){let r=I(t),a=I(i);if(t===i)return{valid:!0,data:t};if(r===j.object&&a===j.object){let r=s.objectKeys(i),a=s.objectKeys(t).filter(e=>-1!==r.indexOf(e)),o={...t,...i};for(let r of a){let s=e(t[r],i[r]);if(!s.valid)return{valid:!1};o[r]=s.data}return{valid:!0,data:o}}if(r===j.array&&a===j.array){if(t.length!==i.length)return{valid:!1};let r=[];for(let s=0;s<t.length;s++){let a=e(t[s],i[s]);if(!a.valid)return{valid:!1};r.push(a.data)}return{valid:!0,data:r}}return r===j.date&&a===j.date&&+t==+i?{valid:!0,data:t}:{valid:!1}}(e.value,r.value);return a.valid?((z(e)||z(r))&&t.dirty(),{status:t.value,value:a.data}):(L(i,{code:D.invalid_intersection_types}),Z)};return i.common.async?Promise.all([this._def.left._parseAsync({data:i.data,path:i.path,parent:i}),this._def.right._parseAsync({data:i.data,path:i.path,parent:i})]).then(([e,t])=>r(e,t)):r(this._def.left._parseSync({data:i.data,path:i.path,parent:i}),this._def.right._parseSync({data:i.data,path:i.path,parent:i}))}}eC.create=(e,t,i)=>new eC({left:e,right:t,typeName:l.ZodIntersection,...K(i)});class ej extends J{_parse(e){let{status:t,ctx:i}=this._processInputParams(e);if(i.parsedType!==j.array)return L(i,{code:D.invalid_type,expected:j.array,received:i.parsedType}),Z;if(i.data.length<this._def.items.length)return L(i,{code:D.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Z;!this._def.rest&&i.data.length>this._def.items.length&&(L(i,{code:D.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let r=[...i.data].map((e,t)=>{let r=this._def.items[t]||this._def.rest;return r?r._parse(new H(i,e,i.path,t)):null}).filter(e=>!!e);return i.common.async?Promise.all(r).then(e=>B.mergeArray(t,e)):B.mergeArray(t,r)}get items(){return this._def.items}rest(e){return new ej({...this._def,rest:e})}}ej.create=(e,t)=>{if(!Array.isArray(e))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new ej({items:e,typeName:l.ZodTuple,rest:null,...K(t)})};class eI extends J{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:i}=this._processInputParams(e);if(i.parsedType!==j.object)return L(i,{code:D.invalid_type,expected:j.object,received:i.parsedType}),Z;let r=[],s=this._def.keyType,a=this._def.valueType;for(let e in i.data)r.push({key:s._parse(new H(i,e,i.path,e)),value:a._parse(new H(i,i.data[e],i.path,e)),alwaysSet:e in i.data});return i.common.async?B.mergeObjectAsync(t,r):B.mergeObjectSync(t,r)}get element(){return this._def.valueType}static create(e,t,i){return new eI(t instanceof J?{keyType:e,valueType:t,typeName:l.ZodRecord,...K(i)}:{keyType:ef.create(),valueType:e,typeName:l.ZodRecord,...K(t)})}}class eD extends J{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:i}=this._processInputParams(e);if(i.parsedType!==j.map)return L(i,{code:D.invalid_type,expected:j.map,received:i.parsedType}),Z;let r=this._def.keyType,s=this._def.valueType,a=[...i.data.entries()].map(([e,t],a)=>({key:r._parse(new H(i,e,i.path,[a,"key"])),value:s._parse(new H(i,t,i.path,[a,"value"]))}));if(i.common.async){let e=new Map;return Promise.resolve().then(async()=>{for(let i of a){let r=await i.key,s=await i.value;if("aborted"===r.status||"aborted"===s.status)return Z;("dirty"===r.status||"dirty"===s.status)&&t.dirty(),e.set(r.value,s.value)}return{status:t.value,value:e}})}{let e=new Map;for(let i of a){let r=i.key,s=i.value;if("aborted"===r.status||"aborted"===s.status)return Z;("dirty"===r.status||"dirty"===s.status)&&t.dirty(),e.set(r.value,s.value)}return{status:t.value,value:e}}}}eD.create=(e,t,i)=>new eD({valueType:t,keyType:e,typeName:l.ZodMap,...K(i)});class eR extends J{_parse(e){let{status:t,ctx:i}=this._processInputParams(e);if(i.parsedType!==j.set)return L(i,{code:D.invalid_type,expected:j.set,received:i.parsedType}),Z;let r=this._def;null!==r.minSize&&i.data.size<r.minSize.value&&(L(i,{code:D.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),t.dirty()),null!==r.maxSize&&i.data.size>r.maxSize.value&&(L(i,{code:D.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),t.dirty());let s=this._def.valueType;function a(e){let i=new Set;for(let r of e){if("aborted"===r.status)return Z;"dirty"===r.status&&t.dirty(),i.add(r.value)}return{status:t.value,value:i}}let o=[...i.data.values()].map((e,t)=>s._parse(new H(i,e,i.path,t)));return i.common.async?Promise.all(o).then(e=>a(e)):a(o)}min(e,t){return new eR({...this._def,minSize:{value:e,message:o.toString(t)}})}max(e,t){return new eR({...this._def,maxSize:{value:e,message:o.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}eR.create=(e,t)=>new eR({valueType:e,minSize:null,maxSize:null,typeName:l.ZodSet,...K(t)});class eN extends J{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==j.function)return L(t,{code:D.invalid_type,expected:j.function,received:t.parsedType}),Z;function i(e,i){return P({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,N,N].filter(e=>!!e),issueData:{code:D.invalid_arguments,argumentsError:i}})}function r(e,i){return P({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,N,N].filter(e=>!!e),issueData:{code:D.invalid_return_type,returnTypeError:i}})}let s={errorMap:t.common.contextualErrorMap},a=t.data;if(this._def.returns instanceof eF){let e=this;return F(async function(...t){let o=new R([]),l=await e._def.args.parseAsync(t,s).catch(e=>{throw o.addIssue(i(t,e)),o}),u=await Reflect.apply(a,this,l);return await e._def.returns._def.type.parseAsync(u,s).catch(e=>{throw o.addIssue(r(u,e)),o})})}{let e=this;return F(function(...t){let o=e._def.args.safeParse(t,s);if(!o.success)throw new R([i(t,o.error)]);let l=Reflect.apply(a,this,o.data),u=e._def.returns.safeParse(l,s);if(!u.success)throw new R([r(l,u.error)]);return u.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new eN({...this._def,args:ej.create(e).rest(ex.create())})}returns(e){return new eN({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,i){return new eN({args:e||ej.create([]).rest(ex.create()),returns:t||ex.create(),typeName:l.ZodFunction,...K(i)})}}class eP extends J{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}eP.create=(e,t)=>new eP({getter:e,typeName:l.ZodLazy,...K(t)});class eL extends J{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return L(t,{received:t.data,code:D.invalid_literal,expected:this._def.value}),Z}return{status:"valid",value:e.data}}get value(){return this._def.value}}function eB(e,t){return new eZ({values:e,typeName:l.ZodEnum,...K(t)})}eL.create=(e,t)=>new eL({value:e,typeName:l.ZodLiteral,...K(t)});class eZ extends J{_parse(e){if("string"!=typeof e.data){let t=this._getOrReturnCtx(e),i=this._def.values;return L(t,{expected:s.joinValues(i),received:t.parsedType,code:D.invalid_type}),Z}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let t=this._getOrReturnCtx(e),i=this._def.values;return L(t,{received:t.data,code:D.invalid_enum_value,options:i}),Z}return F(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return eZ.create(e,{...this._def,...t})}exclude(e,t=this._def){return eZ.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}}eZ.create=eB;class eM extends J{_parse(e){let t=s.getValidEnumValues(this._def.values),i=this._getOrReturnCtx(e);if(i.parsedType!==j.string&&i.parsedType!==j.number){let e=s.objectValues(t);return L(i,{expected:s.joinValues(e),received:i.parsedType,code:D.invalid_type}),Z}if(this._cache||(this._cache=new Set(s.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let e=s.objectValues(t);return L(i,{received:i.data,code:D.invalid_enum_value,options:e}),Z}return F(e.data)}get enum(){return this._def.values}}eM.create=(e,t)=>new eM({values:e,typeName:l.ZodNativeEnum,...K(t)});class eF extends J{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);return t.parsedType!==j.promise&&!1===t.common.async?(L(t,{code:D.invalid_type,expected:j.promise,received:t.parsedType}),Z):F((t.parsedType===j.promise?t.data:Promise.resolve(t.data)).then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}eF.create=(e,t)=>new eF({type:e,typeName:l.ZodPromise,...K(t)});class eq extends J{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===l.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:i}=this._processInputParams(e),r=this._def.effect||null,a={addIssue:e=>{L(i,e),e.fatal?t.abort():t.dirty()},get path(){return i.path}};if(a.addIssue=a.addIssue.bind(a),"preprocess"===r.type){let e=r.transform(i.data,a);if(i.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return Z;let r=await this._def.schema._parseAsync({data:e,path:i.path,parent:i});return"aborted"===r.status?Z:"dirty"===r.status||"dirty"===t.value?M(r.value):r});{if("aborted"===t.value)return Z;let r=this._def.schema._parseSync({data:e,path:i.path,parent:i});return"aborted"===r.status?Z:"dirty"===r.status||"dirty"===t.value?M(r.value):r}}if("refinement"===r.type){let e=e=>{let t=r.refinement(e,a);if(i.common.async)return Promise.resolve(t);if(t instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1!==i.common.async)return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(i=>"aborted"===i.status?Z:("dirty"===i.status&&t.dirty(),e(i.value).then(()=>({status:t.value,value:i.value}))));{let r=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});return"aborted"===r.status?Z:("dirty"===r.status&&t.dirty(),e(r.value),{status:t.value,value:r.value})}}if("transform"===r.type){if(!1!==i.common.async)return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(e=>U(e)?Promise.resolve(r.transform(e.value,a)).then(e=>({status:t.value,value:e})):Z);{let e=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});if(!U(e))return Z;let s=r.transform(e.value,a);if(s instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:s}}}s.assertNever(r)}}eq.create=(e,t,i)=>new eq({schema:e,typeName:l.ZodEffects,effect:t,...K(i)}),eq.createWithPreprocess=(e,t,i)=>new eq({schema:t,effect:{type:"preprocess",transform:e},typeName:l.ZodEffects,...K(i)});class ez extends J{_parse(e){return this._getType(e)===j.undefined?F(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ez.create=(e,t)=>new ez({innerType:e,typeName:l.ZodOptional,...K(t)});class eU extends J{_parse(e){return this._getType(e)===j.null?F(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}eU.create=(e,t)=>new eU({innerType:e,typeName:l.ZodNullable,...K(t)});class eV extends J{_parse(e){let{ctx:t}=this._processInputParams(e),i=t.data;return t.parsedType===j.undefined&&(i=this._def.defaultValue()),this._def.innerType._parse({data:i,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}eV.create=(e,t)=>new eV({innerType:e,typeName:l.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...K(t)});class eH extends J{_parse(e){let{ctx:t}=this._processInputParams(e),i={...t,common:{...t.common,issues:[]}},r=this._def.innerType._parse({data:i.data,path:i.path,parent:{...i}});return V(r)?r.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new R(i.common.issues)},input:i.data})})):{status:"valid",value:"valid"===r.status?r.value:this._def.catchValue({get error(){return new R(i.common.issues)},input:i.data})}}removeCatch(){return this._def.innerType}}eH.create=(e,t)=>new eH({innerType:e,typeName:l.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...K(t)});class eW extends J{_parse(e){if(this._getType(e)!==j.nan){let t=this._getOrReturnCtx(e);return L(t,{code:D.invalid_type,expected:j.nan,received:t.parsedType}),Z}return{status:"valid",value:e.data}}}eW.create=e=>new eW({typeName:l.ZodNaN,...K(e)}),Symbol("zod_brand");class eK extends J{_parse(e){let{ctx:t}=this._processInputParams(e),i=t.data;return this._def.type._parse({data:i,path:t.path,parent:t})}unwrap(){return this._def.type}}class eJ extends J{_parse(e){let{status:t,ctx:i}=this._processInputParams(e);if(i.common.async)return(async()=>{let e=await this._def.in._parseAsync({data:i.data,path:i.path,parent:i});return"aborted"===e.status?Z:"dirty"===e.status?(t.dirty(),M(e.value)):this._def.out._parseAsync({data:e.value,path:i.path,parent:i})})();{let e=this._def.in._parseSync({data:i.data,path:i.path,parent:i});return"aborted"===e.status?Z:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:i.path,parent:i})}}static create(e,t){return new eJ({in:e,out:t,typeName:l.ZodPipeline})}}class eQ extends J{_parse(e){let t=this._def.innerType._parse(e),i=e=>(U(e)&&(e.value=Object.freeze(e.value)),e);return V(t)?t.then(e=>i(e)):i(t)}unwrap(){return this._def.innerType}}eQ.create=(e,t)=>new eQ({innerType:e,typeName:l.ZodReadonly,...K(t)}),eE.lazycreate,function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(l||(l={}));let eG=ef.create,eX=ep.create;eW.create,em.create;let eY=eg.create;ey.create,ev.create,e_.create,eb.create,ew.create;let e0=ex.create;ek.create,eA.create;let e1=eS.create,e2=eE.create;eE.strictCreate,eT.create,e$.create,eC.create,ej.create;let e4=eI.create;eD.create,eR.create,eN.create,eP.create,eL.create;let e9=eZ.create;eM.create,eF.create,eq.create,ez.create,eU.create,eq.createWithPreprocess,eJ.create;var e5=class{logger;config;constructor(e={}){this.logger=new w("RiskClassifier"),this.config=e}classify(e){let t=this.calculateFactors(e),i=this.calculateTotalScore(t),r=this.scoreToLevel(i),s=this.getRecommendation(e,r),a={actionId:e.id,level:r,score:Math.round(i),factors:t,recommendation:s,constraints:this.getConstraints(e,r),timestamp:Date.now()};return this.logger.debug(`Risk assessed: ${e.type}`,{score:a.score,level:a.level,recommendation:a.recommendation}),a}calculateFactors(e){let t=[];return t.push(this.calculateFinancialFactor(e)),t.push(this.calculateReversibilityFactor(e)),t.push(this.calculateCategoryFactor(e)),t.push(this.calculateUrgencyFactor(e)),t.push(this.calculateVisibilityFactor(e)),t}calculateFinancialFactor(e){let t=e.metadata.estimatedValue??0,i=0,r=!1,s="No financial value";return t>0&&(t>h.critical?(i=100,r=!0,s=`High value: $${t} exceeds critical threshold`):t>h.high?(i=70,r=!0,s=`Elevated value: $${t}`):t>h.medium?(i=40,s=`Moderate value: $${t}`):t>h.low?(i=20,s=`Low value: $${t}`):(i=5,s=`Negligible value: $${t}`)),{name:"financialValue",weight:u.financialValue,value:i,threshold:70,exceeded:r,reason:s}}calculateReversibilityFactor(e){let t=e.metadata.reversible;return{name:"reversibility",weight:u.reversibility,value:t?10:80,threshold:50,exceeded:!t,reason:t?"Action can be reversed if needed":"Action is IRREVERSIBLE"}}calculateCategoryFactor(e){let t=this.config.categoryRiskOverrides?.[e.category]??d[e.category]??50;return{name:"categoryRisk",weight:u.categoryRisk,value:t,threshold:60,exceeded:t>=60,reason:`Category "${e.category}" has base risk ${t}`}}calculateUrgencyFactor(e){let t=e.metadata.urgency;return{name:"urgency",weight:u.urgency,value:({low:10,normal:30,high:60,critical:90})[t]??30,threshold:60,exceeded:"critical"===t,reason:`Urgency level: ${t}`}}calculateVisibilityFactor(e){let t=["tweet","blog","post","publish","announce"].some(t=>e.type.includes(t));return{name:"externalVisibility",weight:u.externalVisibility,value:t?60:20,threshold:50,exceeded:t,reason:t?"Action is publicly visible":"Action is internal only"}}calculateTotalScore(e){return e.reduce((e,t)=>e+t.value*t.weight,0)}scoreToLevel(e){return e<=c.safe?"safe":e<=c.low?"low":e<=c.medium?"medium":e<=c.high?"high":"critical"}getRecommendation(e,t){return[...p,...this.config.additionalSafeActions??[]].some(t=>e.type.includes(t))?"auto_execute":m.some(t=>e.type.includes(t))?"escalate":f[t]}getConstraints(e,t){let i=[];return("critical"===t||"high"===t)&&i.push("Requires human approval"),e.metadata.reversible||i.push("Action cannot be reversed"),"trading"===e.category&&i.push("Subject to trading limits"),"deployment"===e.category&&i.push("Production deployment requires approval"),i}},e3={financial:{maxAutoExpense:50,maxQueuedExpense:200,maxDailySpend:100,maxTradeSize:500,maxDailyTradingLossPercent:5,minTreasuryBalance:1e3},content:{maxAutoPostsPerDay:10,maxAutoBlogsPerWeek:3,requireReviewForTopics:["financial_advice","controversial","competitor_criticism"]},development:{maxAutoCommitLines:100,maxAutoFilesChanged:5,requireReviewForPaths:["src/core/","src/config/",".env"],autoDeployToStaging:!0,autoDeployToProduction:!1},trading:{allowedBots:["dca"],allowedTokens:["SOL","USDC"],maxPositionPercent:20,requireApprovalForNewTokens:!0},time:{activeHoursStart:6,activeHoursEnd:22,quietHoursStart:23,quietHoursEnd:6}},e6={enabled:!0,level:2,boundaries:e3,notifications:{channels:[],rateLimitPerMinute:10},approval:{maxPendingItems:50,autoExpireHours:24,notifyOnNewItem:!0},audit:{retentionDays:90,storageDir:"./data/audit"}},e8=class{logger;boundaries;dailyUsage;constructor(e){this.logger=new w("BoundaryChecker"),this.boundaries=this.mergeBoundaries(e),this.dailyUsage=new Map}check(e,t){let i=[],r=[],s=this.getTodayKey(),a=this.getOrCreateUsage(s);switch(e.category){case"trading":this.checkTradingBoundaries(e,a,i,r);break;case"content":this.checkContentBoundaries(e,a,i,r);break;case"build":this.checkBuildBoundaries(e,a,i,r);break;case"deployment":this.checkDeploymentBoundaries(e,i,r);break;case"configuration":i.push("Configuration changes require human approval")}this.checkFinancialBoundaries(e,a,i,r),this.checkTimeBoundaries(e,i,r),"critical"===t&&i.push("Critical risk level requires escalation");let o={passed:0===i.length,violations:i,warnings:r,usageToday:a};return o.passed||this.logger.warn(`Boundary check failed for ${e.type}`,{violations:i,warnings:r}),o}checkTradingBoundaries(e,t,i,r){let s=this.boundaries.trading;t.trades>=10?i.push("Daily trade limit (10) exceeded"):t.trades>=8&&r.push(`Approaching daily trade limit (${t.trades}/10)`);let a=e.params.botType;a&&!s.allowedBots.includes(a)&&i.push(`Bot type "${a}" not in allowed list`);let o=e.params.token;o&&!s.allowedTokens.includes(o)&&(s.requireApprovalForNewTokens?i.push(`Token "${o}" requires approval for first trade`):r.push(`Trading new token: ${o}`));let l=e.params.positionPercent;l&&l>s.maxPositionPercent&&i.push(`Position size ${l}% exceeds max ${s.maxPositionPercent}%`);let u=e.metadata.estimatedValue??0;u>this.boundaries.financial.maxTradeSize&&i.push(`Trade size $${u} exceeds max $${this.boundaries.financial.maxTradeSize}`)}checkContentBoundaries(e,t,i,r){let s=this.boundaries.content;t.content>=s.maxAutoPostsPerDay?i.push(`Daily content limit (${s.maxAutoPostsPerDay}) reached`):t.content>=s.maxAutoPostsPerDay-2&&r.push(`Approaching daily content limit (${t.content}/${s.maxAutoPostsPerDay})`);let a=e.description.toLowerCase(),o=e.params.title?.toLowerCase()??"",l=`${a} ${o}`;for(let e of s.requireReviewForTopics)l.includes(e.toLowerCase())&&i.push(`Content contains restricted topic: "${e}"`);e.type.includes("blog")&&this.getWeeklyBlogCount()>=s.maxAutoBlogsPerWeek&&i.push(`Weekly blog limit (${s.maxAutoBlogsPerWeek}) reached`)}checkBuildBoundaries(e,t,i,r){let s=this.boundaries.development;t.builds>=5&&i.push("Daily build limit (5) reached");let a=e.metadata.linesChanged??0;a>s.maxAutoCommitLines&&i.push(`Lines changed (${a}) exceeds auto-commit limit (${s.maxAutoCommitLines})`);let o=e.metadata.filesChanged??0;for(let t of(o>s.maxAutoFilesChanged&&i.push(`Files changed (${o}) exceeds auto-commit limit (${s.maxAutoFilesChanged})`),e.params.paths??[]))for(let e of s.requireReviewForPaths)t.includes(e)&&i.push(`Changes to restricted path: ${e}`)}checkDeploymentBoundaries(e,t,i){let r=this.boundaries.development,s=e.params.target;("production"===s||e.type.includes("production"))&&!r.autoDeployToProduction&&t.push("Production deployments require human approval"),("staging"===s||e.type.includes("staging"))&&!r.autoDeployToStaging&&i.push("Staging deployment flagged for review")}checkFinancialBoundaries(e,t,i,r){let s=this.boundaries.financial,a=e.metadata.estimatedValue??0;a>s.maxAutoExpense&&(a>s.maxQueuedExpense?i.push(`Expense $${a} exceeds max queued limit $${s.maxQueuedExpense}`):r.push(`Expense $${a} exceeds auto-approve limit $${s.maxAutoExpense}`));let o=t.spending+a;o>s.maxDailySpend?i.push(`Daily spending would exceed limit: $${o} > $${s.maxDailySpend}`):o>.8*s.maxDailySpend&&r.push(`Approaching daily spend limit: $${o}/$${s.maxDailySpend}`)}checkTimeBoundaries(e,t,i){let r=this.boundaries.time,s=new Date().getUTCHours();(s>=r.quietHoursStart||s<r.quietHoursEnd)&&"critical"!==e.metadata.urgency&&i.push("Action during quiet hours - may be delayed"),s>=r.activeHoursStart&&s<r.activeHoursEnd||"content"!==e.category||i.push("Content posting outside active hours")}recordUsage(e){let t=this.getTodayKey(),i=this.getOrCreateUsage(t);switch(e.category){case"trading":i.trades++;break;case"content":i.content++;break;case"build":i.builds++}e.metadata.estimatedValue&&(i.spending+=e.metadata.estimatedValue),this.dailyUsage.set(t,i),this.logger.debug(`Usage recorded for ${e.type}`,i)}getUsageToday(){return this.getOrCreateUsage(this.getTodayKey())}getBoundaries(){return{...this.boundaries}}updateBoundaries(e){this.boundaries=this.mergeBoundaries(e),this.logger.info("Boundaries updated")}resetDailyUsage(){this.dailyUsage.clear(),this.logger.info("Daily usage reset")}getTodayKey(){return new Date().toISOString().split("T")[0]}getOrCreateUsage(e){return this.dailyUsage.has(e)||this.dailyUsage.set(e,{trades:0,content:0,builds:0,spending:0}),this.dailyUsage.get(e)}getWeeklyBlogCount(){return 0}mergeBoundaries(e){return e?{financial:{...e3.financial,...e.financial},content:{...e3.content,...e.content},development:{...e3.development,...e.development},trading:{...e3.trading,...e.trading},time:{...e3.time,...e.time}}:e3}},e7=class extends x{logger;riskClassifier;boundaryChecker;autonomyLevel;decisionCount=0;constructor(e={}){super(),this.logger=new w("DecisionRouter"),this.autonomyLevel=e.autonomyLevel??2,this.riskClassifier=new e5(e.riskClassifier),this.boundaryChecker=new e8(e.boundaries)}async route(e){this.logger.info(`Routing action: ${e.type}`,{engine:e.engine,category:e.category});let t=this.riskClassifier.classify(e),i=this.boundaryChecker.check(e,t.level),r=this.determineOutcome(e,t,i),s=this.createDecision(e,t,i,r);return this.emitDecisionEvents(s,i),this.logger.info(`Decision: ${r}`,{actionId:e.id,riskLevel:t.level,riskScore:t.score,boundariesPassed:i.passed}),s}determineOutcome(e,t,i){if(i.violations.some(e=>e.includes("Production")))return"escalate";if(!i.passed)return i.violations.filter(e=>e.includes("exceeds")||e.includes("limit")||e.includes("IRREVERSIBLE")).length>0?"queue_approval":"reject";switch(this.autonomyLevel){case 1:default:return"queue_approval";case 2:return this.routeLevel2(e,t);case 3:return this.routeLevel3(e,t);case 4:return this.routeLevel4(e,t)}}routeLevel2(e,t){return"safe"===t.level||"low"===t.level?"content"===e.category?"auto_execute":"trading"===e.category?e.type.includes("dca")||e.type.includes("scheduled")?"auto_execute":"queue_approval":"auto_execute":"medium"===t.level||"high"===t.level?"queue_approval":"escalate"}routeLevel3(e,t){return"safe"===t.level||"low"===t.level||"medium"===t.level?"auto_execute":"high"===t.level?"queue_approval":"escalate"}routeLevel4(e,t){return"critical"===t.level?"escalate":"auto_execute"}createDecision(e,t,i,r){this.decisionCount++;let s=this.buildReason(e,t,i,r);return{id:`dec_${Date.now()}_${this.decisionCount}`,actionId:e.id,action:e,assessment:t,outcome:r,reason:s,rollbackAvailable:e.metadata.reversible,timestamp:Date.now()}}buildReason(e,t,i,r){let s=[];switch(s.push(`Risk: ${t.level} (score: ${t.score})`),i.passed?i.warnings.length>0&&s.push(`Warnings: ${i.warnings.join(", ")}`):s.push(`Boundary violations: ${i.violations.join(", ")}`),r){case"auto_execute":s.push("Auto-executing within safe boundaries");break;case"queue_approval":s.push("Queued for human review");break;case"escalate":s.push("Escalated - requires immediate attention");break;case"reject":s.push("Rejected due to boundary violations")}return s.join(" | ")}emitDecisionEvents(e,t){switch(this.emit("decision:made",e),e.outcome){case"auto_execute":this.emit("decision:auto_execute",e);break;case"queue_approval":this.emit("decision:queued",e);break;case"escalate":this.emit("decision:escalated",e);break;case"reject":this.emit("decision:rejected",e)}t.passed||this.emit("boundary:violation",e.action,t.violations)}recordExecution(e){this.boundaryChecker.recordUsage(e)}getBoundaryChecker(){return this.boundaryChecker}getRiskClassifier(){return this.riskClassifier}setAutonomyLevel(e){this.autonomyLevel=e,this.logger.info(`Autonomy level set to ${e}`)}getAutonomyLevel(){return this.autonomyLevel}updateBoundaries(e){this.boundaryChecker.updateBoundaries(e)}},te=e2({id:eG(),tool:eG(),inputs:e4(e0()),dependsOn:e1(eG()).optional(),condition:eG().optional(),retries:eX().optional(),timeout:eX().optional()});e2({id:eG(),name:eG(),description:eG(),version:eG().optional(),steps:e1(te),inputs:e4(e2({type:eG(),description:eG(),required:eY().optional(),default:e0().optional()})).optional(),outputs:e1(eG()).optional(),metadata:e2({category:eG().optional(),tags:e1(eG()).optional(),riskLevel:e9(["safe","low","medium","high","critical"]).optional(),estimatedDuration:eX().optional()}).optional()}),e2({pipelineId:eG(),level:e9(["safe","low","medium","high","critical"]),score:eX().min(0).max(100),factors:e1(e2({name:eG(),weight:eX(),value:eX(),threshold:eX(),exceeded:eY(),reason:eG()})),stepRisks:e1(e2({stepId:eG(),tool:eG(),riskScore:eX(),reason:eG()})),recommendation:e9(["auto_execute","queue_approval","escalate","reject"]),constraints:e1(eG()),estimatedImpact:e2({financial:eX(),visibility:e9(["internal","limited","public"]),reversibility:e9(["full","partial","none"])}),timestamp:eX()});var tt=e2({hat:e9(["white","red","black","yellow","green","blue"]),verdict:e9(["proceed","caution","stop","review"]),analysis:eG(),keyPoints:e1(eG()),score:eX().min(0).max(100)}),ti=e9(["strong_proceed","proceed","mixed","caution","stop"]);e2({actionId:eG(),perspectives:e2({white:tt,red:tt,black:tt,yellow:tt,green:tt,blue:tt}),consensus:ti,overallScore:eX().min(0).max(100),recommendation:eG(),timestamp:eX()});var tr=e9(["safe","low","medium","high","critical"]),tn=e9(["auto_execute","queue_approval","escalate","reject"]),ts=e9(["trading","content","build","deployment","configuration"]),ta=e9(["money","growth","product","orchestrator"]),to=e9(["low","normal","high","critical"]),tl=e2({estimatedValue:eX().optional(),reversible:eY(),urgency:to,dependencies:e1(eG()).optional(),linesChanged:eX().optional(),filesChanged:eX().optional()}),tu=e2({id:eG(),engine:ta,category:ts,type:eG(),description:eG(),params:e4(e0()),metadata:tl,timestamp:eX()}),tc=e2({name:eG(),weight:eX().min(0).max(1),value:eX(),threshold:eX(),exceeded:eY(),reason:eG()}),td=e2({actionId:eG(),level:tr,score:eX().min(0).max(100),factors:e1(tc),recommendation:tn,constraints:e1(eG()),timestamp:eX()}),th=e2({id:eG(),actionId:eG(),action:tu,assessment:td,outcome:tn,reason:eG(),policyId:eG().optional(),approvedBy:eG().optional(),approvedAt:eX().optional(),executedAt:eX().optional(),rollbackAvailable:eY(),timestamp:eX()}),tf=e2({maxAutoExpense:eX().default(50),maxQueuedExpense:eX().default(200),maxDailySpend:eX().default(100),maxTradeSize:eX().default(500),maxDailyTradingLossPercent:eX().default(5),minTreasuryBalance:eX().default(1e3)}),tp=e2({maxAutoPostsPerDay:eX().default(10),maxAutoBlogsPerWeek:eX().default(3),requireReviewForTopics:e1(eG()).default(["financial_advice","controversial"])}),tm=e2({maxAutoCommitLines:eX().default(100),maxAutoFilesChanged:eX().default(5),requireReviewForPaths:e1(eG()).default(["src/core/","src/config/",".env"]),autoDeployToStaging:eY().default(!0),autoDeployToProduction:eY().default(!1)}),tg=e2({allowedBots:e1(eG()).default(["dca"]),allowedTokens:e1(eG()).default(["SOL","USDC"]),maxPositionPercent:eX().default(20),requireApprovalForNewTokens:eY().default(!0)}),ty=e2({activeHoursStart:eX().default(6),activeHoursEnd:eX().default(22),quietHoursStart:eX().default(23),quietHoursEnd:eX().default(6)}),tv=e2({financial:tf,content:tp,development:tm,trading:tg,time:ty}),t_=e2({trades:eX().default(0),content:eX().default(0),builds:eX().default(0),spending:eX().default(0)});e2({passed:eY(),violations:e1(eG()),warnings:e1(eG()),usageToday:t_});var tb=e9(["pending","approved","rejected","expired"]);e2({id:eG(),decision:th,priority:eX(),urgency:to,expiresAt:eX(),notificationsSent:e1(eG()),status:tb,reviewedBy:eG().optional(),reviewedAt:eX().optional(),feedback:eG().optional(),createdAt:eX()}),e2({actionId:eG(),decisionId:eG(),success:eY(),output:e0().optional(),error:eG().optional(),executedAt:eX(),duration:eX(),rolledBack:eY().default(!1)}),e2({id:eG(),actionId:eG(),decisionId:eG(),state:e4(e0()),createdAt:eX()});var tw=e9(["action_received","risk_assessed","decision_made","queued_approval","approved","rejected","executed","execution_failed","rolled_back","boundary_violation","escalated"]);e2({id:eG(),timestamp:eX(),type:tw,actionId:eG(),decisionId:eG().optional(),data:e4(e0()),hash:eG(),previousHash:eG()});var tx=e2({type:e9(["discord","telegram","slack","email"]),enabled:eY(),config:e2({webhookUrl:eG().optional(),botToken:eG().optional(),chatId:eG().optional()})});e2({enabled:eY().default(!0),level:eX().min(1).max(4).default(2),boundaries:tv,notifications:e2({channels:e1(tx).default([]),rateLimitPerMinute:eX().default(10)}),approval:e2({maxPendingItems:eX().default(50),autoExpireHours:eX().default(24),notifyOnNewItem:eY().default(!0)}),audit:e2({retentionDays:eX().default(90),storageDir:eG().default("./data/audit")})});var tk=class extends x{logger;config;router;executor;approvalQueue;batchApproval;notifications;audit;running=!1;constructor(e){super(),this.logger=new w("AutonomyEngine");let t=function(){let e={};return process.env.GICM_MAX_AUTO_EXPENSE&&(e.boundaries=e.boundaries??{},e.boundaries.financial=e.boundaries.financial??{},e.boundaries.financial.maxAutoExpense=Number(process.env.GICM_MAX_AUTO_EXPENSE)),process.env.GICM_MAX_DAILY_SPEND&&(e.boundaries=e.boundaries??{},e.boundaries.financial=e.boundaries.financial??{},e.boundaries.financial.maxDailySpend=Number(process.env.GICM_MAX_DAILY_SPEND)),process.env.GICM_MAX_TRADE_SIZE&&(e.boundaries=e.boundaries??{},e.boundaries.financial=e.boundaries.financial??{},e.boundaries.financial.maxTradeSize=Number(process.env.GICM_MAX_TRADE_SIZE)),process.env.DISCORD_WEBHOOK_URL&&(e.notifications=e.notifications??{channels:[],rateLimitPerMinute:10},e.notifications.channels.push({type:"discord",enabled:!0,config:{webhookUrl:process.env.DISCORD_WEBHOOK_URL}})),process.env.TELEGRAM_BOT_TOKEN&&process.env.TELEGRAM_CHAT_ID&&(e.notifications=e.notifications??{channels:[],rateLimitPerMinute:10},e.notifications.channels.push({type:"telegram",enabled:!0,config:{botToken:process.env.TELEGRAM_BOT_TOKEN,chatId:process.env.TELEGRAM_CHAT_ID}})),e}();this.config=function(e){return e?{...e6,...e,boundaries:{...e3,...e.boundaries,financial:{...e3.financial,...e.boundaries?.financial},content:{...e3.content,...e.boundaries?.content},development:{...e3.development,...e.boundaries?.development},trading:{...e3.trading,...e.boundaries?.trading},time:{...e3.time,...e.boundaries?.time}},notifications:{...e6.notifications,...e.notifications},approval:{...e6.approval,...e.approval},audit:{...e6.audit,...e.audit}}:e6}({...t,...e}),this.router=new e7({autonomyLevel:this.config.level,boundaries:this.config.boundaries}),this.executor=new C,this.approvalQueue=new k({maxPendingItems:this.config.approval.maxPendingItems,autoExpireHours:this.config.approval.autoExpireHours}),this.batchApproval=new S(this.approvalQueue),this.notifications=new A({channels:this.config.notifications.channels,rateLimitPerMinute:this.config.notifications.rateLimitPerMinute}),this.audit=new T({retentionDays:this.config.audit.retentionDays}),this.setupEventHandlers()}start(){this.running||(this.running=!0,this.logger.info("Autonomy engine started",{level:this.config.level,notificationsConfigured:this.notifications.isConfigured()}),this.emit("started"))}stop(){this.running&&(this.running=!1,this.approvalQueue.stop(),this.logger.info("Autonomy engine stopped"),this.emit("stopped"))}async route(e){if(!this.running)throw Error("Autonomy engine not running");this.emit("action:received",e),this.audit.logActionReceived(e);let t=await this.router.route(e);switch(this.audit.logRiskAssessed(e,t),this.audit.logDecisionMade(t),this.emit("decision:made",t),t.outcome){case"auto_execute":await this.handleAutoExecute(t);break;case"queue_approval":await this.handleQueueApproval(t);break;case"escalate":await this.handleEscalate(t);break;case"reject":this.logger.info(`Rejected: ${e.type}`,{reason:t.reason}),this.audit.logBoundaryViolation(e,[t.reason])}return t}async approve(e,t="human",i){let r=this.approvalQueue.approve(e,t,i);return r&&(this.audit.logApproved(r),this.emit("approval:granted",r),await this.notifications.notifyApprovalDecision(r,!0),await this.handleAutoExecute(r.decision)),r}async reject(e,t,i="human"){let r=this.approvalQueue.reject(e,t,i);return r&&(this.audit.logRejected(r,t),this.emit("approval:rejected",r,t),await this.notifications.notifyApprovalDecision(r,!1,t)),r}getQueue(){return this.approvalQueue.getPending()}getBatch(){return this.batchApproval}getBoundaries(){return this.router.getBoundaryChecker().getBoundaries()}updateBoundaries(e){this.router.updateBoundaries(e),this.logger.info("Boundaries updated")}getUsageToday(){return this.router.getBoundaryChecker().getUsageToday()}getQueueStats(){return this.approvalQueue.getStats()}getAuditLog(){return this.audit.getEntries()}getExecutorStats(){return this.executor.getStats()}isRunning(){return this.running}getLevel(){return this.config.level}getStatus(){return{running:this.running,level:this.config.level,queue:this.approvalQueue.getStats(),usage:this.getUsageToday(),executor:this.executor.getStats(),audit:this.audit.getStats()}}setupEventHandlers(){this.router.on("decision:auto_execute",e=>{this.logger.debug(`Auto-execute: ${e.action.type}`)}),this.router.on("boundary:violation",(e,t)=>{this.audit.logBoundaryViolation(e,t)}),this.approvalQueue.on("item:escalated",async e=>{this.audit.logEscalated(e),this.emit("escalation",e),await this.notifications.notifyEscalation(e)}),this.executor.on("execution:completed",e=>{this.audit.logExecuted(e),this.emit("execution:completed",e)}),this.executor.on("execution:failed",e=>{this.audit.logExecutionFailed(e),this.emit("execution:failed",e)}),this.executor.on("execution:rolled_back",e=>{this.audit.logRolledBack(e,"")})}async handleAutoExecute(e){this.logger.info(`Auto-executing: ${e.action.type}`),(await this.executor.execute(e)).success&&this.router.recordExecution(e.action)}async handleQueueApproval(e){let t=this.approvalQueue.add(e);this.audit.logQueuedApproval(t),this.emit("approval:queued",t),this.logger.info(`Queued for approval: ${e.action.type}`,{requestId:t.id,priority:t.priority}),this.config.approval.notifyOnNewItem&&(await this.notifications.notifyApprovalNeeded(t),this.approvalQueue.markNotificationSent(t.id,"initial"))}async handleEscalate(e){let t=this.approvalQueue.add(e);this.audit.logEscalated(t),this.emit("escalation",t),this.logger.warn(`Escalated: ${e.action.type}`,{requestId:t.id,riskLevel:e.assessment.level}),await this.notifications.notifyEscalation(t),this.approvalQueue.markNotificationSent(t.id,"escalation")}},tA=null;function tS(e){return tA||(tA=new tk(e)).start(),tA}},42918:e=>{"use strict";e.exports=JSON.parse('{"name":"thread-stream","version":"3.1.0","description":"A streaming way to send data to a Node.js Worker Thread","main":"index.js","types":"index.d.ts","dependencies":{"real-require":"^0.2.0"},"devDependencies":{"@types/node":"^20.1.0","@types/tap":"^15.0.0","@yao-pkg/pkg":"^5.11.5","desm":"^1.3.0","fastbench":"^1.0.1","husky":"^9.0.6","pino-elasticsearch":"^8.0.0","sonic-boom":"^4.0.1","standard":"^17.0.0","tap":"^16.2.0","ts-node":"^10.8.0","typescript":"^5.3.2","why-is-node-running":"^2.2.2"},"scripts":{"build":"tsc --noEmit","test":"standard && npm run build && npm run transpile && tap \\"test/**/*.test.*js\\" && tap --ts test/*.test.*ts","test:ci":"standard && npm run transpile && npm run test:ci:js && npm run test:ci:ts","test:ci:js":"tap --no-check-coverage --timeout=120 --coverage-report=lcovonly \\"test/**/*.test.*js\\"","test:ci:ts":"tap --ts --no-check-coverage --coverage-report=lcovonly \\"test/**/*.test.*ts\\"","test:yarn":"npm run transpile && tap \\"test/**/*.test.js\\" --no-check-coverage","transpile":"sh ./test/ts/transpile.sh","prepare":"husky install"},"standard":{"ignore":["test/ts/**/*","test/syntax-error.mjs"]},"repository":{"type":"git","url":"git+https://github.com/mcollina/thread-stream.git"},"keywords":["worker","thread","threads","stream"],"author":"Matteo Collina <hello@matteocollina.com>","license":"MIT","bugs":{"url":"https://github.com/mcollina/thread-stream/issues"},"homepage":"https://github.com/mcollina/thread-stream#readme"}')}};