{"version":3,"sources":["../src/decision/risk-classifier.ts","../src/core/config.ts","../src/decision/boundary-checker.ts","../src/decision/decision-router.ts","../src/decision/pipeline-classifier.ts","../src/decision/six-hats-evaluator.ts"],"sourcesContent":["/**\n * Risk Classifier for Level 2 Autonomy\n *\n * Scores actions 0-100 based on weighted risk factors:\n * - Financial value (35%)\n * - Reversibility (20%)\n * - Category base risk (15%)\n * - Urgency (15%)\n * - External visibility (15%)\n */\n\nimport type {\n  Action,\n  RiskAssessment,\n  RiskFactor,\n  RiskLevel,\n  DecisionOutcome,\n} from \"../core/types.js\";\nimport {\n  RISK_FACTOR_WEIGHTS,\n  RISK_SCORE_THRESHOLDS,\n  CATEGORY_BASE_RISK,\n  FINANCIAL_RISK_THRESHOLDS,\n  RISK_LEVEL_OUTCOMES,\n  SAFE_ACTION_TYPES,\n  DANGEROUS_ACTION_TYPES,\n} from \"../core/constants.js\";\nimport { Logger } from \"../utils/logger.js\";\n\nexport interface RiskClassifierConfig {\n  /** Override category base risks */\n  categoryRiskOverrides?: Partial<Record<string, number>>;\n  /** Additional safe action types */\n  additionalSafeActions?: string[];\n}\n\nexport class RiskClassifier {\n  private logger: Logger;\n  private config: RiskClassifierConfig;\n\n  constructor(config: RiskClassifierConfig = {}) {\n    this.logger = new Logger(\"RiskClassifier\");\n    this.config = config;\n  }\n\n  /**\n   * Classify risk level for an action\n   */\n  classify(action: Action): RiskAssessment {\n    const factors = this.calculateFactors(action);\n    const score = this.calculateTotalScore(factors);\n    const level = this.scoreToLevel(score);\n    const recommendation = this.getRecommendation(action, level);\n\n    const assessment: RiskAssessment = {\n      actionId: action.id,\n      level,\n      score: Math.round(score),\n      factors,\n      recommendation,\n      constraints: this.getConstraints(action, level),\n      timestamp: Date.now(),\n    };\n\n    this.logger.debug(`Risk assessed: ${action.type}`, {\n      score: assessment.score,\n      level: assessment.level,\n      recommendation: assessment.recommendation,\n    });\n\n    return assessment;\n  }\n\n  /**\n   * Calculate all risk factors for an action\n   */\n  private calculateFactors(action: Action): RiskFactor[] {\n    const factors: RiskFactor[] = [];\n\n    // 1. Financial Value Factor\n    factors.push(this.calculateFinancialFactor(action));\n\n    // 2. Reversibility Factor\n    factors.push(this.calculateReversibilityFactor(action));\n\n    // 3. Category Risk Factor\n    factors.push(this.calculateCategoryFactor(action));\n\n    // 4. Urgency Factor\n    factors.push(this.calculateUrgencyFactor(action));\n\n    // 5. External Visibility Factor\n    factors.push(this.calculateVisibilityFactor(action));\n\n    return factors;\n  }\n\n  /**\n   * Calculate financial risk factor\n   */\n  private calculateFinancialFactor(action: Action): RiskFactor {\n    const value = action.metadata.estimatedValue ?? 0;\n    let riskScore = 0;\n    let exceeded = false;\n    let reason = \"No financial value\";\n\n    if (value > 0) {\n      if (value > FINANCIAL_RISK_THRESHOLDS.critical) {\n        riskScore = 100;\n        exceeded = true;\n        reason = `High value: $${value} exceeds critical threshold`;\n      } else if (value > FINANCIAL_RISK_THRESHOLDS.high) {\n        riskScore = 70;\n        exceeded = true;\n        reason = `Elevated value: $${value}`;\n      } else if (value > FINANCIAL_RISK_THRESHOLDS.medium) {\n        riskScore = 40;\n        reason = `Moderate value: $${value}`;\n      } else if (value > FINANCIAL_RISK_THRESHOLDS.low) {\n        riskScore = 20;\n        reason = `Low value: $${value}`;\n      } else {\n        riskScore = 5;\n        reason = `Negligible value: $${value}`;\n      }\n    }\n\n    return {\n      name: \"financialValue\",\n      weight: RISK_FACTOR_WEIGHTS.financialValue,\n      value: riskScore,\n      threshold: 70, // Above this is concerning\n      exceeded,\n      reason,\n    };\n  }\n\n  /**\n   * Calculate reversibility factor\n   */\n  private calculateReversibilityFactor(action: Action): RiskFactor {\n    const reversible = action.metadata.reversible;\n    const riskScore = reversible ? 10 : 80;\n\n    return {\n      name: \"reversibility\",\n      weight: RISK_FACTOR_WEIGHTS.reversibility,\n      value: riskScore,\n      threshold: 50,\n      exceeded: !reversible,\n      reason: reversible\n        ? \"Action can be reversed if needed\"\n        : \"Action is IRREVERSIBLE\",\n    };\n  }\n\n  /**\n   * Calculate category base risk factor\n   */\n  private calculateCategoryFactor(action: Action): RiskFactor {\n    const baseRisk =\n      this.config.categoryRiskOverrides?.[action.category] ??\n      CATEGORY_BASE_RISK[action.category] ??\n      50;\n\n    return {\n      name: \"categoryRisk\",\n      weight: RISK_FACTOR_WEIGHTS.categoryRisk,\n      value: baseRisk,\n      threshold: 60,\n      exceeded: baseRisk >= 60,\n      reason: `Category \"${action.category}\" has base risk ${baseRisk}`,\n    };\n  }\n\n  /**\n   * Calculate urgency factor\n   */\n  private calculateUrgencyFactor(action: Action): RiskFactor {\n    const urgencyScores: Record<string, number> = {\n      low: 10,\n      normal: 30,\n      high: 60,\n      critical: 90,\n    };\n\n    const urgency = action.metadata.urgency;\n    const riskScore = urgencyScores[urgency] ?? 30;\n\n    return {\n      name: \"urgency\",\n      weight: RISK_FACTOR_WEIGHTS.urgency,\n      value: riskScore,\n      threshold: 60,\n      exceeded: urgency === \"critical\",\n      reason: `Urgency level: ${urgency}`,\n    };\n  }\n\n  /**\n   * Calculate external visibility factor\n   */\n  private calculateVisibilityFactor(action: Action): RiskFactor {\n    // Actions that are public-facing have higher risk\n    const publicActions = [\"tweet\", \"blog\", \"post\", \"publish\", \"announce\"];\n    const isPublic = publicActions.some((p) => action.type.includes(p));\n\n    const riskScore = isPublic ? 60 : 20;\n\n    return {\n      name: \"externalVisibility\",\n      weight: RISK_FACTOR_WEIGHTS.externalVisibility,\n      value: riskScore,\n      threshold: 50,\n      exceeded: isPublic,\n      reason: isPublic\n        ? \"Action is publicly visible\"\n        : \"Action is internal only\",\n    };\n  }\n\n  /**\n   * Calculate total weighted score\n   */\n  private calculateTotalScore(factors: RiskFactor[]): number {\n    return factors.reduce((sum, factor) => {\n      return sum + factor.value * factor.weight;\n    }, 0);\n  }\n\n  /**\n   * Convert score to risk level\n   */\n  private scoreToLevel(score: number): RiskLevel {\n    if (score <= RISK_SCORE_THRESHOLDS.safe) return \"safe\";\n    if (score <= RISK_SCORE_THRESHOLDS.low) return \"low\";\n    if (score <= RISK_SCORE_THRESHOLDS.medium) return \"medium\";\n    if (score <= RISK_SCORE_THRESHOLDS.high) return \"high\";\n    return \"critical\";\n  }\n\n  /**\n   * Get recommendation based on action type and risk level\n   */\n  private getRecommendation(action: Action, level: RiskLevel): DecisionOutcome {\n    // Check for explicitly safe actions\n    const safeActions = [\n      ...SAFE_ACTION_TYPES,\n      ...(this.config.additionalSafeActions ?? []),\n    ];\n    if (safeActions.some((s) => action.type.includes(s))) {\n      return \"auto_execute\";\n    }\n\n    // Check for explicitly dangerous actions\n    if (DANGEROUS_ACTION_TYPES.some((d) => action.type.includes(d))) {\n      return \"escalate\";\n    }\n\n    // Use level-based recommendation\n    return RISK_LEVEL_OUTCOMES[level] as DecisionOutcome;\n  }\n\n  /**\n   * Get constraints that apply to this action\n   */\n  private getConstraints(action: Action, level: RiskLevel): string[] {\n    const constraints: string[] = [];\n\n    if (level === \"critical\" || level === \"high\") {\n      constraints.push(\"Requires human approval\");\n    }\n\n    if (!action.metadata.reversible) {\n      constraints.push(\"Action cannot be reversed\");\n    }\n\n    if (action.category === \"trading\") {\n      constraints.push(\"Subject to trading limits\");\n    }\n\n    if (action.category === \"deployment\") {\n      constraints.push(\"Production deployment requires approval\");\n    }\n\n    return constraints;\n  }\n}\n","/**\n * Default Configuration for Level 2 Autonomy\n */\n\nimport type { AutonomyConfig, Boundaries } from \"./types.js\";\n\nexport const DEFAULT_BOUNDARIES: Boundaries = {\n  financial: {\n    maxAutoExpense: 50,\n    maxQueuedExpense: 200,\n    maxDailySpend: 100,\n    maxTradeSize: 500,\n    maxDailyTradingLossPercent: 5,\n    minTreasuryBalance: 1000,\n  },\n  content: {\n    maxAutoPostsPerDay: 10,\n    maxAutoBlogsPerWeek: 3,\n    requireReviewForTopics: [\"financial_advice\", \"controversial\", \"competitor_criticism\"],\n  },\n  development: {\n    maxAutoCommitLines: 100,\n    maxAutoFilesChanged: 5,\n    requireReviewForPaths: [\"src/core/\", \"src/config/\", \".env\"],\n    autoDeployToStaging: true,\n    autoDeployToProduction: false,\n  },\n  trading: {\n    allowedBots: [\"dca\"],\n    allowedTokens: [\"SOL\", \"USDC\"],\n    maxPositionPercent: 20,\n    requireApprovalForNewTokens: true,\n  },\n  time: {\n    activeHoursStart: 6,\n    activeHoursEnd: 22,\n    quietHoursStart: 23,\n    quietHoursEnd: 6,\n  },\n};\n\nexport const DEFAULT_CONFIG: AutonomyConfig = {\n  enabled: true,\n  level: 2,\n  boundaries: DEFAULT_BOUNDARIES,\n  notifications: {\n    channels: [],\n    rateLimitPerMinute: 10,\n  },\n  approval: {\n    maxPendingItems: 50,\n    autoExpireHours: 24,\n    notifyOnNewItem: true,\n  },\n  audit: {\n    retentionDays: 90,\n    storageDir: \"./data/audit\",\n  },\n};\n\n/**\n * Create config with defaults merged with overrides\n */\nexport function createConfig(overrides?: Partial<AutonomyConfig>): AutonomyConfig {\n  if (!overrides) return DEFAULT_CONFIG;\n\n  return {\n    ...DEFAULT_CONFIG,\n    ...overrides,\n    boundaries: {\n      ...DEFAULT_BOUNDARIES,\n      ...overrides.boundaries,\n      financial: {\n        ...DEFAULT_BOUNDARIES.financial,\n        ...overrides.boundaries?.financial,\n      },\n      content: {\n        ...DEFAULT_BOUNDARIES.content,\n        ...overrides.boundaries?.content,\n      },\n      development: {\n        ...DEFAULT_BOUNDARIES.development,\n        ...overrides.boundaries?.development,\n      },\n      trading: {\n        ...DEFAULT_BOUNDARIES.trading,\n        ...overrides.boundaries?.trading,\n      },\n      time: {\n        ...DEFAULT_BOUNDARIES.time,\n        ...overrides.boundaries?.time,\n      },\n    },\n    notifications: {\n      ...DEFAULT_CONFIG.notifications,\n      ...overrides.notifications,\n    },\n    approval: {\n      ...DEFAULT_CONFIG.approval,\n      ...overrides.approval,\n    },\n    audit: {\n      ...DEFAULT_CONFIG.audit,\n      ...overrides.audit,\n    },\n  };\n}\n\n/**\n * Load config from environment variables\n */\nexport function loadConfigFromEnv(): Partial<AutonomyConfig> {\n  const config: Partial<AutonomyConfig> = {};\n\n  // Financial boundaries from env\n  if (process.env.GICM_MAX_AUTO_EXPENSE) {\n    config.boundaries = config.boundaries ?? {} as any;\n    (config.boundaries as any).financial = (config.boundaries as any).financial ?? {};\n    (config.boundaries as any).financial.maxAutoExpense = Number(process.env.GICM_MAX_AUTO_EXPENSE);\n  }\n  if (process.env.GICM_MAX_DAILY_SPEND) {\n    config.boundaries = config.boundaries ?? {} as any;\n    (config.boundaries as any).financial = (config.boundaries as any).financial ?? {};\n    (config.boundaries as any).financial.maxDailySpend = Number(process.env.GICM_MAX_DAILY_SPEND);\n  }\n  if (process.env.GICM_MAX_TRADE_SIZE) {\n    config.boundaries = config.boundaries ?? {} as any;\n    (config.boundaries as any).financial = (config.boundaries as any).financial ?? {};\n    (config.boundaries as any).financial.maxTradeSize = Number(process.env.GICM_MAX_TRADE_SIZE);\n  }\n\n  // Notification channels from env\n  if (process.env.DISCORD_WEBHOOK_URL) {\n    config.notifications = config.notifications ?? { channels: [], rateLimitPerMinute: 10 };\n    config.notifications.channels.push({\n      type: \"discord\",\n      enabled: true,\n      config: { webhookUrl: process.env.DISCORD_WEBHOOK_URL },\n    });\n  }\n  if (process.env.TELEGRAM_BOT_TOKEN && process.env.TELEGRAM_CHAT_ID) {\n    config.notifications = config.notifications ?? { channels: [], rateLimitPerMinute: 10 };\n    config.notifications.channels.push({\n      type: \"telegram\",\n      enabled: true,\n      config: {\n        botToken: process.env.TELEGRAM_BOT_TOKEN,\n        chatId: process.env.TELEGRAM_CHAT_ID,\n      },\n    });\n  }\n\n  return config;\n}\n","/**\n * Boundary Checker for Level 2 Autonomy\n *\n * Enforces operational limits:\n * - Daily limits (trades, content, builds, spending)\n * - Value thresholds\n * - Blocked keywords/topics\n * - Time restrictions\n */\n\nimport type {\n  Action,\n  Boundaries,\n  BoundaryCheckResult,\n  DailyUsage,\n  RiskLevel,\n} from \"../core/types.js\";\nimport { DEFAULT_BOUNDARIES } from \"../core/config.js\";\nimport { Logger } from \"../utils/logger.js\";\n\nexport class BoundaryChecker {\n  private logger: Logger;\n  private boundaries: Boundaries;\n  private dailyUsage: Map<string, DailyUsage>;\n\n  constructor(boundaries?: Partial<Boundaries>) {\n    this.logger = new Logger(\"BoundaryChecker\");\n    this.boundaries = this.mergeBoundaries(boundaries);\n    this.dailyUsage = new Map();\n  }\n\n  /**\n   * Check if an action passes all boundaries\n   */\n  check(action: Action, riskLevel: RiskLevel): BoundaryCheckResult {\n    const violations: string[] = [];\n    const warnings: string[] = [];\n    const today = this.getTodayKey();\n    const usage = this.getOrCreateUsage(today);\n\n    // Check by category\n    switch (action.category) {\n      case \"trading\":\n        this.checkTradingBoundaries(action, usage, violations, warnings);\n        break;\n      case \"content\":\n        this.checkContentBoundaries(action, usage, violations, warnings);\n        break;\n      case \"build\":\n        this.checkBuildBoundaries(action, usage, violations, warnings);\n        break;\n      case \"deployment\":\n        this.checkDeploymentBoundaries(action, violations, warnings);\n        break;\n      case \"configuration\":\n        violations.push(\"Configuration changes require human approval\");\n        break;\n    }\n\n    // Check financial limits\n    this.checkFinancialBoundaries(action, usage, violations, warnings);\n\n    // Check time restrictions\n    this.checkTimeBoundaries(action, violations, warnings);\n\n    // Check risk level thresholds\n    if (riskLevel === \"critical\") {\n      violations.push(\"Critical risk level requires escalation\");\n    }\n\n    const result: BoundaryCheckResult = {\n      passed: violations.length === 0,\n      violations,\n      warnings,\n      usageToday: usage,\n    };\n\n    if (!result.passed) {\n      this.logger.warn(`Boundary check failed for ${action.type}`, {\n        violations,\n        warnings,\n      });\n    }\n\n    return result;\n  }\n\n  /**\n   * Check trading-specific boundaries\n   */\n  private checkTradingBoundaries(\n    action: Action,\n    usage: DailyUsage,\n    violations: string[],\n    warnings: string[]\n  ): void {\n    const trading = this.boundaries.trading;\n\n    // Check daily trade limit\n    if (usage.trades >= 10) {\n      violations.push(`Daily trade limit (10) exceeded`);\n    } else if (usage.trades >= 8) {\n      warnings.push(`Approaching daily trade limit (${usage.trades}/10)`);\n    }\n\n    // Check allowed bots\n    const botType = action.params.botType as string | undefined;\n    if (botType && !trading.allowedBots.includes(botType)) {\n      violations.push(`Bot type \"${botType}\" not in allowed list`);\n    }\n\n    // Check allowed tokens\n    const token = action.params.token as string | undefined;\n    if (token && !trading.allowedTokens.includes(token)) {\n      if (trading.requireApprovalForNewTokens) {\n        violations.push(`Token \"${token}\" requires approval for first trade`);\n      } else {\n        warnings.push(`Trading new token: ${token}`);\n      }\n    }\n\n    // Check position size\n    const positionPercent = action.params.positionPercent as number | undefined;\n    if (positionPercent && positionPercent > trading.maxPositionPercent) {\n      violations.push(\n        `Position size ${positionPercent}% exceeds max ${trading.maxPositionPercent}%`\n      );\n    }\n\n    // Check trade size\n    const amount = action.metadata.estimatedValue ?? 0;\n    if (amount > this.boundaries.financial.maxTradeSize) {\n      violations.push(\n        `Trade size $${amount} exceeds max $${this.boundaries.financial.maxTradeSize}`\n      );\n    }\n  }\n\n  /**\n   * Check content-specific boundaries\n   */\n  private checkContentBoundaries(\n    action: Action,\n    usage: DailyUsage,\n    violations: string[],\n    warnings: string[]\n  ): void {\n    const content = this.boundaries.content;\n\n    // Check daily content limit\n    if (usage.content >= content.maxAutoPostsPerDay) {\n      violations.push(\n        `Daily content limit (${content.maxAutoPostsPerDay}) reached`\n      );\n    } else if (usage.content >= content.maxAutoPostsPerDay - 2) {\n      warnings.push(\n        `Approaching daily content limit (${usage.content}/${content.maxAutoPostsPerDay})`\n      );\n    }\n\n    // Check for restricted topics\n    const description = action.description.toLowerCase();\n    const title = (action.params.title as string)?.toLowerCase() ?? \"\";\n    const contentText = `${description} ${title}`;\n\n    for (const topic of content.requireReviewForTopics) {\n      if (contentText.includes(topic.toLowerCase())) {\n        violations.push(`Content contains restricted topic: \"${topic}\"`);\n      }\n    }\n\n    // Check for blog weekly limit\n    if (action.type.includes(\"blog\")) {\n      const weeklyBlogs = this.getWeeklyBlogCount();\n      if (weeklyBlogs >= content.maxAutoBlogsPerWeek) {\n        violations.push(\n          `Weekly blog limit (${content.maxAutoBlogsPerWeek}) reached`\n        );\n      }\n    }\n  }\n\n  /**\n   * Check build-specific boundaries\n   */\n  private checkBuildBoundaries(\n    action: Action,\n    usage: DailyUsage,\n    violations: string[],\n    warnings: string[]\n  ): void {\n    const dev = this.boundaries.development;\n\n    // Check daily build limit\n    if (usage.builds >= 5) {\n      violations.push(\"Daily build limit (5) reached\");\n    }\n\n    // Check lines changed\n    const linesChanged = action.metadata.linesChanged ?? 0;\n    if (linesChanged > dev.maxAutoCommitLines) {\n      violations.push(\n        `Lines changed (${linesChanged}) exceeds auto-commit limit (${dev.maxAutoCommitLines})`\n      );\n    }\n\n    // Check files changed\n    const filesChanged = action.metadata.filesChanged ?? 0;\n    if (filesChanged > dev.maxAutoFilesChanged) {\n      violations.push(\n        `Files changed (${filesChanged}) exceeds auto-commit limit (${dev.maxAutoFilesChanged})`\n      );\n    }\n\n    // Check for restricted paths\n    const paths = (action.params.paths as string[]) ?? [];\n    for (const path of paths) {\n      for (const restricted of dev.requireReviewForPaths) {\n        if (path.includes(restricted)) {\n          violations.push(`Changes to restricted path: ${restricted}`);\n        }\n      }\n    }\n  }\n\n  /**\n   * Check deployment-specific boundaries\n   */\n  private checkDeploymentBoundaries(\n    action: Action,\n    violations: string[],\n    warnings: string[]\n  ): void {\n    const dev = this.boundaries.development;\n\n    // Production deployment\n    const target = action.params.target as string | undefined;\n    if (target === \"production\" || action.type.includes(\"production\")) {\n      if (!dev.autoDeployToProduction) {\n        violations.push(\"Production deployments require human approval\");\n      }\n    }\n\n    // Staging deployment\n    if (target === \"staging\" || action.type.includes(\"staging\")) {\n      if (!dev.autoDeployToStaging) {\n        warnings.push(\"Staging deployment flagged for review\");\n      }\n    }\n  }\n\n  /**\n   * Check financial boundaries\n   */\n  private checkFinancialBoundaries(\n    action: Action,\n    usage: DailyUsage,\n    violations: string[],\n    warnings: string[]\n  ): void {\n    const financial = this.boundaries.financial;\n    const amount = action.metadata.estimatedValue ?? 0;\n\n    // Check single expense limit\n    if (amount > financial.maxAutoExpense) {\n      if (amount > financial.maxQueuedExpense) {\n        violations.push(\n          `Expense $${amount} exceeds max queued limit $${financial.maxQueuedExpense}`\n        );\n      } else {\n        warnings.push(\n          `Expense $${amount} exceeds auto-approve limit $${financial.maxAutoExpense}`\n        );\n      }\n    }\n\n    // Check daily spending limit\n    const projectedSpend = usage.spending + amount;\n    if (projectedSpend > financial.maxDailySpend) {\n      violations.push(\n        `Daily spending would exceed limit: $${projectedSpend} > $${financial.maxDailySpend}`\n      );\n    } else if (projectedSpend > financial.maxDailySpend * 0.8) {\n      warnings.push(\n        `Approaching daily spend limit: $${projectedSpend}/$${financial.maxDailySpend}`\n      );\n    }\n  }\n\n  /**\n   * Check time-based restrictions\n   */\n  private checkTimeBoundaries(\n    action: Action,\n    violations: string[],\n    warnings: string[]\n  ): void {\n    const time = this.boundaries.time;\n    const hour = new Date().getUTCHours();\n\n    // Check quiet hours\n    const inQuietHours =\n      hour >= time.quietHoursStart || hour < time.quietHoursEnd;\n    if (inQuietHours) {\n      if (action.metadata.urgency !== \"critical\") {\n        warnings.push(\"Action during quiet hours - may be delayed\");\n      }\n    }\n\n    // Check active hours\n    const inActiveHours =\n      hour >= time.activeHoursStart && hour < time.activeHoursEnd;\n    if (!inActiveHours && action.category === \"content\") {\n      warnings.push(\"Content posting outside active hours\");\n    }\n  }\n\n  /**\n   * Record usage after action execution\n   */\n  recordUsage(action: Action): void {\n    const today = this.getTodayKey();\n    const usage = this.getOrCreateUsage(today);\n\n    switch (action.category) {\n      case \"trading\":\n        usage.trades++;\n        break;\n      case \"content\":\n        usage.content++;\n        break;\n      case \"build\":\n        usage.builds++;\n        break;\n    }\n\n    // Track spending\n    if (action.metadata.estimatedValue) {\n      usage.spending += action.metadata.estimatedValue;\n    }\n\n    this.dailyUsage.set(today, usage);\n    this.logger.debug(`Usage recorded for ${action.type}`, usage);\n  }\n\n  /**\n   * Get current usage for today\n   */\n  getUsageToday(): DailyUsage {\n    return this.getOrCreateUsage(this.getTodayKey());\n  }\n\n  /**\n   * Get current boundaries\n   */\n  getBoundaries(): Boundaries {\n    return { ...this.boundaries };\n  }\n\n  /**\n   * Update boundaries at runtime\n   */\n  updateBoundaries(updates: Partial<Boundaries>): void {\n    this.boundaries = this.mergeBoundaries(updates);\n    this.logger.info(\"Boundaries updated\");\n  }\n\n  /**\n   * Reset daily usage (for testing or new day)\n   */\n  resetDailyUsage(): void {\n    this.dailyUsage.clear();\n    this.logger.info(\"Daily usage reset\");\n  }\n\n  // Helper methods\n\n  private getTodayKey(): string {\n    return new Date().toISOString().split(\"T\")[0];\n  }\n\n  private getOrCreateUsage(key: string): DailyUsage {\n    if (!this.dailyUsage.has(key)) {\n      this.dailyUsage.set(key, {\n        trades: 0,\n        content: 0,\n        builds: 0,\n        spending: 0,\n      });\n    }\n    return this.dailyUsage.get(key)!;\n  }\n\n  private getWeeklyBlogCount(): number {\n    // Simplified - count blogs in last 7 days\n    // In production, this would query the audit log\n    return 0;\n  }\n\n  private mergeBoundaries(overrides?: Partial<Boundaries>): Boundaries {\n    if (!overrides) return DEFAULT_BOUNDARIES;\n\n    return {\n      financial: { ...DEFAULT_BOUNDARIES.financial, ...overrides.financial },\n      content: { ...DEFAULT_BOUNDARIES.content, ...overrides.content },\n      development: {\n        ...DEFAULT_BOUNDARIES.development,\n        ...overrides.development,\n      },\n      trading: { ...DEFAULT_BOUNDARIES.trading, ...overrides.trading },\n      time: { ...DEFAULT_BOUNDARIES.time, ...overrides.time },\n    };\n  }\n}\n","/**\n * Decision Router for Level 2 Autonomy\n *\n * Routes actions based on:\n * - Risk classification\n * - Boundary checks\n * - Autonomy level configuration\n *\n * Outcomes:\n * - auto_execute: Execute immediately\n * - queue_approval: Add to approval queue\n * - escalate: Notify human immediately\n * - reject: Deny the action\n */\n\nimport { EventEmitter } from \"eventemitter3\";\nimport type {\n  Action,\n  Decision,\n  DecisionOutcome,\n  RiskAssessment,\n  BoundaryCheckResult,\n  Boundaries,\n  AutonomyConfig,\n} from \"../core/types.js\";\nimport { RiskClassifier, type RiskClassifierConfig } from \"./risk-classifier.js\";\nimport { BoundaryChecker } from \"./boundary-checker.js\";\nimport { Logger } from \"../utils/logger.js\";\n\nexport interface DecisionRouterConfig {\n  autonomyLevel?: 1 | 2 | 3 | 4;\n  boundaries?: Partial<Boundaries>;\n  riskClassifier?: RiskClassifierConfig;\n}\n\nexport interface DecisionRouterEvents {\n  \"decision:made\": (decision: Decision) => void;\n  \"decision:auto_execute\": (decision: Decision) => void;\n  \"decision:queued\": (decision: Decision) => void;\n  \"decision:escalated\": (decision: Decision) => void;\n  \"decision:rejected\": (decision: Decision) => void;\n  \"boundary:violation\": (action: Action, violations: string[]) => void;\n}\n\nexport class DecisionRouter extends EventEmitter<DecisionRouterEvents> {\n  private logger: Logger;\n  private riskClassifier: RiskClassifier;\n  private boundaryChecker: BoundaryChecker;\n  private autonomyLevel: number;\n  private decisionCount = 0;\n\n  constructor(config: DecisionRouterConfig = {}) {\n    super();\n    this.logger = new Logger(\"DecisionRouter\");\n    this.autonomyLevel = config.autonomyLevel ?? 2;\n    this.riskClassifier = new RiskClassifier(config.riskClassifier);\n    this.boundaryChecker = new BoundaryChecker(config.boundaries);\n  }\n\n  /**\n   * Route an action through risk assessment and boundary checks\n   */\n  async route(action: Action): Promise<Decision> {\n    this.logger.info(`Routing action: ${action.type}`, {\n      engine: action.engine,\n      category: action.category,\n    });\n\n    // 1. Assess risk\n    const assessment = this.riskClassifier.classify(action);\n\n    // 2. Check boundaries\n    const boundaryResult = this.boundaryChecker.check(action, assessment.level);\n\n    // 3. Determine outcome\n    const outcome = this.determineOutcome(action, assessment, boundaryResult);\n\n    // 4. Create decision\n    const decision = this.createDecision(\n      action,\n      assessment,\n      boundaryResult,\n      outcome\n    );\n\n    // 5. Emit events\n    this.emitDecisionEvents(decision, boundaryResult);\n\n    this.logger.info(`Decision: ${outcome}`, {\n      actionId: action.id,\n      riskLevel: assessment.level,\n      riskScore: assessment.score,\n      boundariesPassed: boundaryResult.passed,\n    });\n\n    return decision;\n  }\n\n  /**\n   * Determine the routing outcome based on all factors\n   */\n  private determineOutcome(\n    action: Action,\n    assessment: RiskAssessment,\n    boundaryResult: BoundaryCheckResult\n  ): DecisionOutcome {\n    // Hard rejections\n    if (boundaryResult.violations.some((v) => v.includes(\"Production\"))) {\n      return \"escalate\";\n    }\n\n    if (!boundaryResult.passed) {\n      // Some violations can be queued, others rejected\n      const criticalViolations = boundaryResult.violations.filter(\n        (v) =>\n          v.includes(\"exceeds\") ||\n          v.includes(\"limit\") ||\n          v.includes(\"IRREVERSIBLE\")\n      );\n      if (criticalViolations.length > 0) {\n        return \"queue_approval\";\n      }\n      return \"reject\";\n    }\n\n    // Route by autonomy level\n    switch (this.autonomyLevel) {\n      case 1:\n        // Level 1: Everything requires approval\n        return \"queue_approval\";\n\n      case 2:\n        // Level 2: Auto-execute safe/low risk, queue medium+\n        return this.routeLevel2(action, assessment);\n\n      case 3:\n        // Level 3: Auto-execute up to high risk, escalate critical\n        return this.routeLevel3(action, assessment);\n\n      case 4:\n        // Level 4: Full autonomy, only escalate critical\n        return this.routeLevel4(action, assessment);\n\n      default:\n        return \"queue_approval\";\n    }\n  }\n\n  /**\n   * Level 2 routing: Bounded autonomy\n   */\n  private routeLevel2(\n    action: Action,\n    assessment: RiskAssessment\n  ): DecisionOutcome {\n    // Safe and low risk: auto-execute\n    if (assessment.level === \"safe\" || assessment.level === \"low\") {\n      // Extra check for content - auto-execute tweets/posts\n      if (action.category === \"content\") {\n        return \"auto_execute\";\n      }\n      // Extra check for trading - only auto-execute DCA\n      if (action.category === \"trading\") {\n        if (action.type.includes(\"dca\") || action.type.includes(\"scheduled\")) {\n          return \"auto_execute\";\n        }\n        return \"queue_approval\"; // Other trades need approval\n      }\n      return \"auto_execute\";\n    }\n\n    // Medium risk: queue for batch approval\n    if (assessment.level === \"medium\") {\n      return \"queue_approval\";\n    }\n\n    // High risk: queue with priority\n    if (assessment.level === \"high\") {\n      return \"queue_approval\";\n    }\n\n    // Critical: escalate immediately\n    return \"escalate\";\n  }\n\n  /**\n   * Level 3 routing: Supervised autonomy\n   */\n  private routeLevel3(\n    action: Action,\n    assessment: RiskAssessment\n  ): DecisionOutcome {\n    // Auto-execute up to high risk\n    if (\n      assessment.level === \"safe\" ||\n      assessment.level === \"low\" ||\n      assessment.level === \"medium\"\n    ) {\n      return \"auto_execute\";\n    }\n\n    // High risk: queue\n    if (assessment.level === \"high\") {\n      return \"queue_approval\";\n    }\n\n    // Critical: escalate\n    return \"escalate\";\n  }\n\n  /**\n   * Level 4 routing: Full autonomy\n   */\n  private routeLevel4(\n    action: Action,\n    assessment: RiskAssessment\n  ): DecisionOutcome {\n    // Only escalate critical\n    if (assessment.level === \"critical\") {\n      return \"escalate\";\n    }\n    return \"auto_execute\";\n  }\n\n  /**\n   * Create a decision record\n   */\n  private createDecision(\n    action: Action,\n    assessment: RiskAssessment,\n    boundaryResult: BoundaryCheckResult,\n    outcome: DecisionOutcome\n  ): Decision {\n    this.decisionCount++;\n    const reason = this.buildReason(action, assessment, boundaryResult, outcome);\n\n    return {\n      id: `dec_${Date.now()}_${this.decisionCount}`,\n      actionId: action.id,\n      action,\n      assessment,\n      outcome,\n      reason,\n      rollbackAvailable: action.metadata.reversible,\n      timestamp: Date.now(),\n    };\n  }\n\n  /**\n   * Build human-readable reason for decision\n   */\n  private buildReason(\n    action: Action,\n    assessment: RiskAssessment,\n    boundaryResult: BoundaryCheckResult,\n    outcome: DecisionOutcome\n  ): string {\n    const parts: string[] = [];\n\n    // Risk level\n    parts.push(`Risk: ${assessment.level} (score: ${assessment.score})`);\n\n    // Boundary status\n    if (!boundaryResult.passed) {\n      parts.push(`Boundary violations: ${boundaryResult.violations.join(\", \")}`);\n    } else if (boundaryResult.warnings.length > 0) {\n      parts.push(`Warnings: ${boundaryResult.warnings.join(\", \")}`);\n    }\n\n    // Outcome reason\n    switch (outcome) {\n      case \"auto_execute\":\n        parts.push(\"Auto-executing within safe boundaries\");\n        break;\n      case \"queue_approval\":\n        parts.push(\"Queued for human review\");\n        break;\n      case \"escalate\":\n        parts.push(\"Escalated - requires immediate attention\");\n        break;\n      case \"reject\":\n        parts.push(\"Rejected due to boundary violations\");\n        break;\n    }\n\n    return parts.join(\" | \");\n  }\n\n  /**\n   * Emit appropriate events for the decision\n   */\n  private emitDecisionEvents(\n    decision: Decision,\n    boundaryResult: BoundaryCheckResult\n  ): void {\n    this.emit(\"decision:made\", decision);\n\n    switch (decision.outcome) {\n      case \"auto_execute\":\n        this.emit(\"decision:auto_execute\", decision);\n        break;\n      case \"queue_approval\":\n        this.emit(\"decision:queued\", decision);\n        break;\n      case \"escalate\":\n        this.emit(\"decision:escalated\", decision);\n        break;\n      case \"reject\":\n        this.emit(\"decision:rejected\", decision);\n        break;\n    }\n\n    if (!boundaryResult.passed) {\n      this.emit(\n        \"boundary:violation\",\n        decision.action,\n        boundaryResult.violations\n      );\n    }\n  }\n\n  /**\n   * Record action was executed (updates boundary usage)\n   */\n  recordExecution(action: Action): void {\n    this.boundaryChecker.recordUsage(action);\n  }\n\n  /**\n   * Get boundary checker for direct access\n   */\n  getBoundaryChecker(): BoundaryChecker {\n    return this.boundaryChecker;\n  }\n\n  /**\n   * Get risk classifier for direct access\n   */\n  getRiskClassifier(): RiskClassifier {\n    return this.riskClassifier;\n  }\n\n  /**\n   * Update autonomy level\n   */\n  setAutonomyLevel(level: 1 | 2 | 3 | 4): void {\n    this.autonomyLevel = level;\n    this.logger.info(`Autonomy level set to ${level}`);\n  }\n\n  /**\n   * Get current autonomy level\n   */\n  getAutonomyLevel(): number {\n    return this.autonomyLevel;\n  }\n\n  /**\n   * Update boundaries at runtime\n   */\n  updateBoundaries(updates: Partial<Boundaries>): void {\n    this.boundaryChecker.updateBoundaries(updates);\n  }\n}\n","/**\n * Pipeline Risk Classifier for PTC Integration\n *\n * Extends risk classification to entire pipelines, not just individual actions.\n * Analyzes tool combinations, data flow, and cumulative risk across pipeline steps.\n */\n\nimport { z } from \"zod\";\nimport type {\n  RiskLevel,\n  DecisionOutcome,\n  RiskFactor,\n} from \"../core/types.js\";\nimport {\n  RISK_SCORE_THRESHOLDS,\n  RISK_LEVEL_OUTCOMES,\n} from \"../core/constants.js\";\nimport { Logger } from \"../utils/logger.js\";\n\n// ============================================================================\n// Pipeline Types (compatible with @gicm/ptc-coordinator)\n// ============================================================================\n\nexport const PipelineStepSchema = z.object({\n  id: z.string(),\n  tool: z.string(),\n  inputs: z.record(z.unknown()),\n  dependsOn: z.array(z.string()).optional(),\n  condition: z.string().optional(),\n  retries: z.number().optional(),\n  timeout: z.number().optional(),\n});\n\nexport type PipelineStep = z.infer<typeof PipelineStepSchema>;\n\nexport const PipelineSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  description: z.string(),\n  version: z.string().optional(),\n  steps: z.array(PipelineStepSchema),\n  inputs: z.record(z.object({\n    type: z.string(),\n    description: z.string(),\n    required: z.boolean().optional(),\n    default: z.unknown().optional(),\n  })).optional(),\n  outputs: z.array(z.string()).optional(),\n  metadata: z.object({\n    category: z.string().optional(),\n    tags: z.array(z.string()).optional(),\n    riskLevel: z.enum(['safe', 'low', 'medium', 'high', 'critical']).optional(),\n    estimatedDuration: z.number().optional(),\n  }).optional(),\n});\n\nexport type Pipeline = z.infer<typeof PipelineSchema>;\n\n// ============================================================================\n// Pipeline Risk Assessment\n// ============================================================================\n\nexport const PipelineRiskAssessmentSchema = z.object({\n  pipelineId: z.string(),\n  level: z.enum(['safe', 'low', 'medium', 'high', 'critical']),\n  score: z.number().min(0).max(100),\n  factors: z.array(z.object({\n    name: z.string(),\n    weight: z.number(),\n    value: z.number(),\n    threshold: z.number(),\n    exceeded: z.boolean(),\n    reason: z.string(),\n  })),\n  stepRisks: z.array(z.object({\n    stepId: z.string(),\n    tool: z.string(),\n    riskScore: z.number(),\n    reason: z.string(),\n  })),\n  recommendation: z.enum(['auto_execute', 'queue_approval', 'escalate', 'reject']),\n  constraints: z.array(z.string()),\n  estimatedImpact: z.object({\n    financial: z.number(),\n    visibility: z.enum(['internal', 'limited', 'public']),\n    reversibility: z.enum(['full', 'partial', 'none']),\n  }),\n  timestamp: z.number(),\n});\n\nexport type PipelineRiskAssessment = z.infer<typeof PipelineRiskAssessmentSchema>;\n\n// ============================================================================\n// Tool Risk Categories\n// ============================================================================\n\nconst TOOL_RISK_SCORES: Record<string, number> = {\n  // Safe tools (0-20)\n  'search_tools': 5,\n  'search_gicm': 5,\n  'analyzer': 10,\n  'report_generator': 10,\n  'seo_researcher': 10,\n  'analytics_agent': 15,\n\n  // Low risk tools (21-40)\n  'hunter_agent': 25,\n  'defi_agent': 30,\n  'content_generator': 30,\n  'seo_optimizer': 25,\n  'decision_agent': 30,\n\n  // Medium risk tools (41-60)\n  'wallet_agent': 50,\n  'audit_agent': 40,\n  'scheduler': 45,\n  'social_agent': 50,\n\n  // High risk tools (61-80)\n  'trading_agent': 70,\n  'deployer_agent': 75,\n  'bridge_agent': 75,\n\n  // Critical risk tools (81-100)\n  'treasury_agent': 90,\n  'admin_agent': 95,\n};\n\nconst DANGEROUS_TOOL_COMBINATIONS = [\n  ['wallet_agent', 'trading_agent'], // Financial operations\n  ['wallet_agent', 'bridge_agent'],  // Cross-chain operations\n  ['deployer_agent', 'wallet_agent'], // Deploy with funds\n];\n\n// ============================================================================\n// Pipeline Risk Classifier\n// ============================================================================\n\nexport interface PipelineClassifierConfig {\n  toolRiskOverrides?: Record<string, number>;\n  dangerousCombinations?: string[][];\n  maxStepsBeforeReview?: number;\n}\n\nexport class PipelineRiskClassifier {\n  private logger: Logger;\n  private config: PipelineClassifierConfig;\n\n  constructor(config: PipelineClassifierConfig = {}) {\n    this.logger = new Logger(\"PipelineRiskClassifier\");\n    this.config = config;\n  }\n\n  /**\n   * Classify risk level for an entire pipeline\n   */\n  classify(pipeline: Pipeline): PipelineRiskAssessment {\n    const factors = this.calculateFactors(pipeline);\n    const stepRisks = this.calculateStepRisks(pipeline);\n    const score = this.calculateTotalScore(factors);\n    const level = this.scoreToLevel(score);\n    const recommendation = this.getRecommendation(pipeline, level, stepRisks);\n\n    const assessment: PipelineRiskAssessment = {\n      pipelineId: pipeline.id,\n      level,\n      score: Math.round(score),\n      factors,\n      stepRisks,\n      recommendation,\n      constraints: this.getConstraints(pipeline, level),\n      estimatedImpact: this.estimateImpact(pipeline, stepRisks),\n      timestamp: Date.now(),\n    };\n\n    this.logger.debug(`Pipeline risk assessed: ${pipeline.name}`, {\n      score: assessment.score,\n      level: assessment.level,\n      recommendation: assessment.recommendation,\n    });\n\n    return assessment;\n  }\n\n  /**\n   * Calculate all risk factors for a pipeline\n   */\n  private calculateFactors(pipeline: Pipeline): RiskFactor[] {\n    const factors: RiskFactor[] = [];\n\n    // 1. Cumulative Tool Risk\n    factors.push(this.calculateToolRiskFactor(pipeline));\n\n    // 2. Tool Combination Risk\n    factors.push(this.calculateCombinationFactor(pipeline));\n\n    // 3. Pipeline Complexity\n    factors.push(this.calculateComplexityFactor(pipeline));\n\n    // 4. Data Flow Risk\n    factors.push(this.calculateDataFlowFactor(pipeline));\n\n    // 5. Metadata Risk Level\n    factors.push(this.calculateMetadataFactor(pipeline));\n\n    return factors;\n  }\n\n  /**\n   * Calculate cumulative risk from all tools\n   */\n  private calculateToolRiskFactor(pipeline: Pipeline): RiskFactor {\n    const toolScores = pipeline.steps.map((step) => {\n      const baseScore = this.config.toolRiskOverrides?.[step.tool] ??\n        TOOL_RISK_SCORES[step.tool] ?? 50;\n      return { tool: step.tool, score: baseScore };\n    });\n\n    // Use weighted average with diminishing returns\n    const avgScore = toolScores.reduce((sum, t, i) => {\n      const weight = 1 / (i + 1); // First tool weighs more\n      return sum + t.score * weight;\n    }, 0) / Math.log(toolScores.length + 1);\n\n    const maxScore = Math.max(...toolScores.map((t) => t.score), 0);\n\n    // Combine average and max\n    const combinedScore = avgScore * 0.6 + maxScore * 0.4;\n\n    return {\n      name: \"cumulativeToolRisk\",\n      weight: 0.35,\n      value: Math.min(combinedScore, 100),\n      threshold: 60,\n      exceeded: combinedScore > 60,\n      reason: `${pipeline.steps.length} tools, highest risk: ${maxScore}`,\n    };\n  }\n\n  /**\n   * Check for dangerous tool combinations\n   */\n  private calculateCombinationFactor(pipeline: Pipeline): RiskFactor {\n    const tools = pipeline.steps.map((s) => s.tool);\n    const dangerousCombos = [\n      ...DANGEROUS_TOOL_COMBINATIONS,\n      ...(this.config.dangerousCombinations ?? []),\n    ];\n\n    const foundCombinations: string[] = [];\n    for (const combo of dangerousCombos) {\n      if (combo.every((tool) => tools.includes(tool))) {\n        foundCombinations.push(combo.join(\" + \"));\n      }\n    }\n\n    const riskScore = foundCombinations.length > 0\n      ? Math.min(50 + foundCombinations.length * 20, 100)\n      : 10;\n\n    return {\n      name: \"dangerousCombinations\",\n      weight: 0.25,\n      value: riskScore,\n      threshold: 50,\n      exceeded: foundCombinations.length > 0,\n      reason: foundCombinations.length > 0\n        ? `Dangerous combinations: ${foundCombinations.join(\", \")}`\n        : \"No dangerous tool combinations detected\",\n    };\n  }\n\n  /**\n   * Calculate complexity-based risk\n   */\n  private calculateComplexityFactor(pipeline: Pipeline): RiskFactor {\n    const stepCount = pipeline.steps.length;\n    const hasConditions = pipeline.steps.some((s) => s.condition);\n    const hasDependencies = pipeline.steps.some((s) => s.dependsOn?.length);\n    const maxDepth = this.calculateDependencyDepth(pipeline);\n\n    let riskScore = 10;\n\n    // More steps = more risk\n    riskScore += Math.min(stepCount * 5, 30);\n\n    // Conditional logic increases risk\n    if (hasConditions) riskScore += 15;\n\n    // Deep dependency chains increase risk\n    if (maxDepth > 3) riskScore += 20;\n\n    // Many steps without review is risky\n    const maxSteps = this.config.maxStepsBeforeReview ?? 5;\n    if (stepCount > maxSteps) riskScore += 15;\n\n    return {\n      name: \"pipelineComplexity\",\n      weight: 0.15,\n      value: Math.min(riskScore, 100),\n      threshold: 50,\n      exceeded: stepCount > maxSteps || maxDepth > 3,\n      reason: `${stepCount} steps, depth ${maxDepth}, ${hasConditions ? \"has\" : \"no\"} conditions`,\n    };\n  }\n\n  /**\n   * Calculate data flow risk (sensitive data propagation)\n   */\n  private calculateDataFlowFactor(pipeline: Pipeline): RiskFactor {\n    // Check for sensitive input references\n    const sensitivePatterns = [\n      'wallet', 'token', 'key', 'secret', 'password', 'balance',\n      'private', 'transfer', 'execute', 'deploy',\n    ];\n\n    let sensitiveFlows = 0;\n    for (const step of pipeline.steps) {\n      const inputStr = JSON.stringify(step.inputs).toLowerCase();\n      for (const pattern of sensitivePatterns) {\n        if (inputStr.includes(pattern)) {\n          sensitiveFlows++;\n        }\n      }\n    }\n\n    const riskScore = Math.min(sensitiveFlows * 10, 80);\n\n    return {\n      name: \"dataFlowRisk\",\n      weight: 0.15,\n      value: riskScore,\n      threshold: 40,\n      exceeded: sensitiveFlows > 3,\n      reason: `${sensitiveFlows} sensitive data flows detected`,\n    };\n  }\n\n  /**\n   * Use pipeline metadata risk level if provided\n   */\n  private calculateMetadataFactor(pipeline: Pipeline): RiskFactor {\n    const declaredLevel = pipeline.metadata?.riskLevel;\n    const riskScores: Record<string, number> = {\n      safe: 10,\n      low: 25,\n      medium: 50,\n      high: 75,\n      critical: 95,\n    };\n\n    const riskScore = declaredLevel\n      ? riskScores[declaredLevel]\n      : 50; // Default to medium if not specified\n\n    return {\n      name: \"declaredRiskLevel\",\n      weight: 0.10,\n      value: riskScore,\n      threshold: 50,\n      exceeded: riskScore > 50,\n      reason: declaredLevel\n        ? `Pipeline declared as \"${declaredLevel}\" risk`\n        : \"No risk level declared, assuming medium\",\n    };\n  }\n\n  /**\n   * Calculate risk for each step\n   */\n  private calculateStepRisks(pipeline: Pipeline): PipelineRiskAssessment['stepRisks'] {\n    return pipeline.steps.map((step) => {\n      const baseScore = this.config.toolRiskOverrides?.[step.tool] ??\n        TOOL_RISK_SCORES[step.tool] ?? 50;\n\n      let reason = `Base tool risk: ${baseScore}`;\n\n      // Adjust for conditions\n      if (step.condition) {\n        reason += \" (+conditional execution)\";\n      }\n\n      // Adjust for timeouts\n      if (step.timeout && step.timeout > 60000) {\n        reason += \" (+long timeout)\";\n      }\n\n      return {\n        stepId: step.id,\n        tool: step.tool,\n        riskScore: baseScore,\n        reason,\n      };\n    });\n  }\n\n  /**\n   * Calculate dependency chain depth\n   */\n  private calculateDependencyDepth(pipeline: Pipeline): number {\n    const stepMap = new Map(pipeline.steps.map((s) => [s.id, s]));\n    const cache = new Map<string, number>();\n\n    const getDepth = (stepId: string): number => {\n      if (cache.has(stepId)) return cache.get(stepId)!;\n\n      const step = stepMap.get(stepId);\n      if (!step || !step.dependsOn?.length) {\n        cache.set(stepId, 0);\n        return 0;\n      }\n\n      const maxDepDep = Math.max(...step.dependsOn.map(getDepth));\n      const depth = maxDepDep + 1;\n      cache.set(stepId, depth);\n      return depth;\n    };\n\n    return Math.max(...pipeline.steps.map((s) => getDepth(s.id)), 0);\n  }\n\n  /**\n   * Calculate total weighted score\n   */\n  private calculateTotalScore(factors: RiskFactor[]): number {\n    return factors.reduce((sum, factor) => {\n      return sum + factor.value * factor.weight;\n    }, 0);\n  }\n\n  /**\n   * Convert score to risk level\n   */\n  private scoreToLevel(score: number): RiskLevel {\n    if (score <= RISK_SCORE_THRESHOLDS.safe) return \"safe\";\n    if (score <= RISK_SCORE_THRESHOLDS.low) return \"low\";\n    if (score <= RISK_SCORE_THRESHOLDS.medium) return \"medium\";\n    if (score <= RISK_SCORE_THRESHOLDS.high) return \"high\";\n    return \"critical\";\n  }\n\n  /**\n   * Get recommendation based on pipeline analysis\n   */\n  private getRecommendation(\n    pipeline: Pipeline,\n    level: RiskLevel,\n    stepRisks: PipelineRiskAssessment['stepRisks']\n  ): DecisionOutcome {\n    // If any step has critical risk, escalate\n    if (stepRisks.some((s) => s.riskScore >= 90)) {\n      return \"escalate\";\n    }\n\n    // If declared as safe in metadata, auto-execute (unless steps contradict)\n    if (pipeline.metadata?.riskLevel === 'safe' && level !== 'critical') {\n      return \"auto_execute\";\n    }\n\n    // Use level-based recommendation\n    return RISK_LEVEL_OUTCOMES[level] as DecisionOutcome;\n  }\n\n  /**\n   * Get constraints that apply to this pipeline\n   */\n  private getConstraints(pipeline: Pipeline, level: RiskLevel): string[] {\n    const constraints: string[] = [];\n\n    if (level === \"critical\" || level === \"high\") {\n      constraints.push(\"Requires human approval before execution\");\n    }\n\n    const hasFinancialTools = pipeline.steps.some((s) =>\n      ['wallet_agent', 'trading_agent', 'treasury_agent'].includes(s.tool)\n    );\n    if (hasFinancialTools) {\n      constraints.push(\"Subject to financial limits\");\n    }\n\n    const hasDeployment = pipeline.steps.some((s) =>\n      s.tool === 'deployer_agent'\n    );\n    if (hasDeployment) {\n      constraints.push(\"Deployment requires approval\");\n    }\n\n    if (pipeline.steps.length > 5) {\n      constraints.push(\"Large pipeline - monitor execution\");\n    }\n\n    return constraints;\n  }\n\n  /**\n   * Estimate pipeline impact\n   */\n  private estimateImpact(\n    pipeline: Pipeline,\n    stepRisks: PipelineRiskAssessment['stepRisks']\n  ): PipelineRiskAssessment['estimatedImpact'] {\n    // Financial impact (rough estimate based on tools)\n    let financial = 0;\n    for (const step of pipeline.steps) {\n      if (step.tool.includes('wallet') || step.tool.includes('trading')) {\n        financial += 100; // Base financial impact\n      }\n      if (step.tool.includes('treasury')) {\n        financial += 500;\n      }\n    }\n\n    // Visibility\n    const hasPublicTools = pipeline.steps.some((s) =>\n      ['social_agent', 'content_generator', 'scheduler'].includes(s.tool)\n    );\n    const visibility = hasPublicTools ? 'public' : 'internal';\n\n    // Reversibility\n    const hasIrreversible = pipeline.steps.some((s) =>\n      ['deployer_agent', 'bridge_agent', 'trading_agent'].includes(s.tool)\n    );\n    const reversibility = hasIrreversible ? 'partial' : 'full';\n\n    return { financial, visibility, reversibility };\n  }\n}\n","/**\n * Six Thinking Hats Evaluator for Autonomy Engine\n *\n * Provides multi-perspective analysis of actions using Edward de Bono's framework:\n * - White Hat: Facts, data, objective analysis\n * - Red Hat: Emotions, intuition, gut feelings\n * - Black Hat: Caution, risks, what could go wrong\n * - Yellow Hat: Benefits, optimism, advantages\n * - Green Hat: Creativity, alternatives, new ideas\n * - Blue Hat: Process, meta-thinking, next steps\n */\n\nimport { z } from \"zod\";\nimport type { Action, RiskAssessment } from \"../core/types.js\";\nimport { Logger } from \"../utils/logger.js\";\n\n// ============================================================================\n// SIX HATS TYPES\n// ============================================================================\n\nexport const HatTypeSchema = z.enum([\n  \"white\",  // Facts & Data\n  \"red\",    // Emotions & Intuition\n  \"black\",  // Caution & Risks\n  \"yellow\", // Benefits & Optimism\n  \"green\",  // Creativity & Alternatives\n  \"blue\",   // Process & Meta\n]);\nexport type HatType = z.infer<typeof HatTypeSchema>;\n\nexport const HatVerdictSchema = z.enum([\"proceed\", \"caution\", \"stop\", \"review\"]);\nexport type HatVerdict = z.infer<typeof HatVerdictSchema>;\n\nexport const HatPerspectiveSchema = z.object({\n  hat: HatTypeSchema,\n  verdict: HatVerdictSchema,\n  analysis: z.string(),\n  keyPoints: z.array(z.string()),\n  score: z.number().min(0).max(100), // 100 = strongly proceed, 0 = strongly stop\n});\nexport type HatPerspective = z.infer<typeof HatPerspectiveSchema>;\n\nexport const SixHatsConsensusSchema = z.enum([\n  \"strong_proceed\",  // 5-6 hats say proceed\n  \"proceed\",         // 4+ hats say proceed\n  \"mixed\",           // Split decision\n  \"caution\",         // 4+ hats say caution/review\n  \"stop\",            // Any hat says stop or 3+ say caution\n]);\nexport type SixHatsConsensus = z.infer<typeof SixHatsConsensusSchema>;\n\nexport const SixHatsResultSchema = z.object({\n  actionId: z.string(),\n  perspectives: z.object({\n    white: HatPerspectiveSchema,\n    red: HatPerspectiveSchema,\n    black: HatPerspectiveSchema,\n    yellow: HatPerspectiveSchema,\n    green: HatPerspectiveSchema,\n    blue: HatPerspectiveSchema,\n  }),\n  consensus: SixHatsConsensusSchema,\n  overallScore: z.number().min(0).max(100),\n  recommendation: z.string(),\n  timestamp: z.number(),\n});\nexport type SixHatsResult = z.infer<typeof SixHatsResultSchema>;\n\n// ============================================================================\n// SIX HATS EVALUATOR\n// ============================================================================\n\nexport class SixHatsEvaluator {\n  private logger: Logger;\n\n  constructor() {\n    this.logger = new Logger(\"SixHatsEvaluator\");\n  }\n\n  /**\n   * Evaluate an action using all six thinking hats\n   */\n  evaluate(action: Action, riskAssessment?: RiskAssessment): SixHatsResult {\n    this.logger.debug(`Evaluating action with Six Hats: ${action.type}`);\n\n    const perspectives = {\n      white: this.evaluateWhiteHat(action, riskAssessment),\n      red: this.evaluateRedHat(action, riskAssessment),\n      black: this.evaluateBlackHat(action, riskAssessment),\n      yellow: this.evaluateYellowHat(action, riskAssessment),\n      green: this.evaluateGreenHat(action, riskAssessment),\n      blue: this.evaluateBlueHat(action, riskAssessment),\n    };\n\n    const consensus = this.determineConsensus(perspectives);\n    const overallScore = this.calculateOverallScore(perspectives);\n    const recommendation = this.generateRecommendation(perspectives, consensus);\n\n    const result: SixHatsResult = {\n      actionId: action.id,\n      perspectives,\n      consensus,\n      overallScore,\n      recommendation,\n      timestamp: Date.now(),\n    };\n\n    this.logger.info(`Six Hats analysis complete`, {\n      actionType: action.type,\n      consensus,\n      score: overallScore,\n    });\n\n    return result;\n  }\n\n  /**\n   * White Hat: Facts, data, objective analysis\n   * Focus: What information do we have? What do we need?\n   */\n  private evaluateWhiteHat(\n    action: Action,\n    assessment?: RiskAssessment\n  ): HatPerspective {\n    const keyPoints: string[] = [];\n    let score = 50;\n\n    // Analyze available data\n    keyPoints.push(`Action type: ${action.type}`);\n    keyPoints.push(`Category: ${action.category}`);\n    keyPoints.push(`Engine: ${action.engine}`);\n\n    if (action.metadata.estimatedValue !== undefined) {\n      keyPoints.push(`Estimated value: $${action.metadata.estimatedValue}`);\n      score += action.metadata.estimatedValue < 50 ? 10 : -10;\n    } else {\n      keyPoints.push(\"Warning: No estimated value provided\");\n      score -= 15;\n    }\n\n    if (action.metadata.reversible) {\n      keyPoints.push(\"Action is reversible\");\n      score += 20;\n    } else {\n      keyPoints.push(\"Action is NOT reversible\");\n      score -= 20;\n    }\n\n    if (assessment) {\n      keyPoints.push(`Risk score: ${assessment.score}/100`);\n      keyPoints.push(`Risk level: ${assessment.level}`);\n    }\n\n    score = Math.max(0, Math.min(100, score));\n\n    return {\n      hat: \"white\",\n      verdict: score >= 60 ? \"proceed\" : score >= 40 ? \"review\" : \"caution\",\n      analysis: \"Objective data analysis of action parameters and risk factors\",\n      keyPoints,\n      score,\n    };\n  }\n\n  /**\n   * Red Hat: Emotions, intuition, gut feelings\n   * Focus: How does this feel? What's the instinct?\n   */\n  private evaluateRedHat(\n    action: Action,\n    assessment?: RiskAssessment\n  ): HatPerspective {\n    const keyPoints: string[] = [];\n    let score = 50;\n\n    // Urgency creates pressure\n    if (action.metadata.urgency === \"critical\") {\n      keyPoints.push(\"High pressure situation - feels rushed\");\n      score -= 20;\n    } else if (action.metadata.urgency === \"high\") {\n      keyPoints.push(\"Moderate urgency - some pressure\");\n      score -= 10;\n    } else {\n      keyPoints.push(\"Comfortable timeline - no rush\");\n      score += 10;\n    }\n\n    // Category intuition\n    if (action.category === \"trading\") {\n      keyPoints.push(\"Trading feels risky - market volatility\");\n      score -= 10;\n    } else if (action.category === \"content\") {\n      keyPoints.push(\"Content creation feels relatively safe\");\n      score += 10;\n    }\n\n    // Risk level intuition\n    if (assessment?.level === \"critical\" || assessment?.level === \"high\") {\n      keyPoints.push(\"Gut says: this needs human oversight\");\n      score -= 25;\n    } else if (assessment?.level === \"safe\") {\n      keyPoints.push(\"Feels like a routine operation\");\n      score += 20;\n    }\n\n    // Irreversibility concern\n    if (!action.metadata.reversible) {\n      keyPoints.push(\"Uncomfortable with irreversible actions\");\n      score -= 15;\n    }\n\n    score = Math.max(0, Math.min(100, score));\n\n    return {\n      hat: \"red\",\n      verdict: score >= 60 ? \"proceed\" : score >= 40 ? \"caution\" : \"stop\",\n      analysis: \"Intuitive response to action risk and urgency\",\n      keyPoints,\n      score,\n    };\n  }\n\n  /**\n   * Black Hat: Caution, risks, what could go wrong\n   * Focus: Identify dangers, weaknesses, threats\n   */\n  private evaluateBlackHat(\n    action: Action,\n    assessment?: RiskAssessment\n  ): HatPerspective {\n    const keyPoints: string[] = [];\n    let score = 70; // Start cautiously optimistic\n\n    // Check risk factors\n    if (assessment) {\n      for (const factor of assessment.factors) {\n        if (factor.exceeded) {\n          keyPoints.push(`Risk: ${factor.reason}`);\n          score -= 15;\n        }\n      }\n\n      // Risk level impact\n      if (assessment.level === \"critical\") {\n        keyPoints.push(\"CRITICAL: Multiple failure modes possible\");\n        score -= 30;\n      } else if (assessment.level === \"high\") {\n        keyPoints.push(\"HIGH RISK: Significant potential for issues\");\n        score -= 20;\n      }\n    }\n\n    // Check for dangerous patterns\n    if (action.metadata.estimatedValue && action.metadata.estimatedValue > 100) {\n      keyPoints.push(\"Danger: High-value operation\");\n      score -= 15;\n    }\n\n    if (!action.metadata.reversible) {\n      keyPoints.push(\"Danger: No rollback option\");\n      score -= 20;\n    }\n\n    // Category-specific dangers\n    if (action.category === \"deployment\") {\n      keyPoints.push(\"Deployment risk: Could affect production\");\n      score -= 15;\n    }\n\n    if (action.category === \"trading\") {\n      keyPoints.push(\"Trading risk: Market conditions unknown\");\n      score -= 10;\n    }\n\n    score = Math.max(0, Math.min(100, score));\n\n    return {\n      hat: \"black\",\n      verdict: score >= 60 ? \"proceed\" : score >= 30 ? \"caution\" : \"stop\",\n      analysis: \"Critical analysis of risks and potential failure modes\",\n      keyPoints,\n      score,\n    };\n  }\n\n  /**\n   * Yellow Hat: Benefits, optimism, advantages\n   * Focus: What are the potential gains?\n   */\n  private evaluateYellowHat(\n    action: Action,\n    _assessment?: RiskAssessment\n  ): HatPerspective {\n    const keyPoints: string[] = [];\n    let score = 50;\n\n    // Positive outcomes by category\n    if (action.category === \"content\") {\n      keyPoints.push(\"Benefit: Increases platform visibility\");\n      keyPoints.push(\"Benefit: Builds community engagement\");\n      score += 20;\n    }\n\n    if (action.category === \"build\") {\n      keyPoints.push(\"Benefit: Expands platform capabilities\");\n      keyPoints.push(\"Benefit: Creates value for users\");\n      score += 20;\n    }\n\n    if (action.category === \"trading\") {\n      keyPoints.push(\"Benefit: Potential for profit\");\n      keyPoints.push(\"Benefit: Grows treasury\");\n      score += 15;\n    }\n\n    // Low value = low-stakes experimentation\n    if (action.metadata.estimatedValue !== undefined && action.metadata.estimatedValue < 20) {\n      keyPoints.push(\"Benefit: Low-stakes action for learning\");\n      score += 15;\n    }\n\n    // Reversible = safe to try\n    if (action.metadata.reversible) {\n      keyPoints.push(\"Benefit: Can be undone if needed\");\n      score += 15;\n    }\n\n    // Automation benefit\n    keyPoints.push(\"Benefit: Autonomous execution saves time\");\n    score += 10;\n\n    score = Math.max(0, Math.min(100, score));\n\n    return {\n      hat: \"yellow\",\n      verdict: score >= 60 ? \"proceed\" : \"caution\",\n      analysis: \"Optimistic view of potential benefits and positive outcomes\",\n      keyPoints,\n      score,\n    };\n  }\n\n  /**\n   * Green Hat: Creativity, alternatives, new ideas\n   * Focus: What other approaches could work?\n   */\n  private evaluateGreenHat(\n    action: Action,\n    assessment?: RiskAssessment\n  ): HatPerspective {\n    const keyPoints: string[] = [];\n    let score = 60;\n\n    // Suggest alternatives based on risk\n    if (assessment?.level === \"high\" || assessment?.level === \"critical\") {\n      keyPoints.push(\"Alternative: Break into smaller, lower-risk steps\");\n      keyPoints.push(\"Alternative: Add manual checkpoint before execution\");\n      score -= 10;\n    }\n\n    // Category-specific alternatives\n    if (action.category === \"trading\" && action.metadata.estimatedValue && action.metadata.estimatedValue > 50) {\n      keyPoints.push(\"Alternative: Reduce trade size to minimize risk\");\n      keyPoints.push(\"Alternative: Use paper trading mode first\");\n    }\n\n    if (action.category === \"content\") {\n      keyPoints.push(\"Alternative: Queue for batch review before posting\");\n    }\n\n    if (action.category === \"deployment\") {\n      keyPoints.push(\"Alternative: Deploy to staging first\");\n      keyPoints.push(\"Alternative: Use canary deployment pattern\");\n    }\n\n    // General creative suggestions\n    keyPoints.push(\"Idea: Log action for learning/improvement\");\n\n    if (!action.metadata.reversible) {\n      keyPoints.push(\"Idea: Create a snapshot before executing\");\n    }\n\n    score = Math.max(0, Math.min(100, score));\n\n    return {\n      hat: \"green\",\n      verdict: \"review\",\n      analysis: \"Creative alternatives and process improvements\",\n      keyPoints,\n      score,\n    };\n  }\n\n  /**\n   * Blue Hat: Process, meta-thinking, next steps\n   * Focus: What's the overall process recommendation?\n   */\n  private evaluateBlueHat(\n    action: Action,\n    assessment?: RiskAssessment\n  ): HatPerspective {\n    const keyPoints: string[] = [];\n    let score = 60;\n\n    // Process recommendations based on risk\n    if (assessment) {\n      if (assessment.level === \"safe\" || assessment.level === \"low\") {\n        keyPoints.push(\"Process: Auto-execute is appropriate\");\n        score += 20;\n      } else if (assessment.level === \"medium\") {\n        keyPoints.push(\"Process: Queue for batch approval recommended\");\n        score += 5;\n      } else {\n        keyPoints.push(\"Process: Escalate for immediate human review\");\n        score -= 20;\n      }\n    }\n\n    // Audit trail recommendation\n    keyPoints.push(\"Process: Log all actions for audit trail\");\n\n    // Category-specific process\n    if (action.category === \"trading\") {\n      keyPoints.push(\"Process: Verify trading limits before execution\");\n    }\n\n    if (action.category === \"deployment\") {\n      keyPoints.push(\"Process: Run tests before deployment\");\n    }\n\n    // Meta-observation\n    keyPoints.push(`Process: Current autonomy level determines execution path`);\n\n    score = Math.max(0, Math.min(100, score));\n\n    return {\n      hat: \"blue\",\n      verdict: score >= 60 ? \"proceed\" : \"review\",\n      analysis: \"Process control and meta-analysis of decision-making\",\n      keyPoints,\n      score,\n    };\n  }\n\n  /**\n   * Determine consensus from all perspectives\n   */\n  private determineConsensus(perspectives: Record<HatType, HatPerspective>): SixHatsConsensus {\n    const verdicts = Object.values(perspectives).map((p) => p.verdict);\n\n    const proceedCount = verdicts.filter((v) => v === \"proceed\").length;\n    const stopCount = verdicts.filter((v) => v === \"stop\").length;\n    const cautionCount = verdicts.filter((v) => v === \"caution\").length;\n\n    if (stopCount > 0 || cautionCount >= 3) {\n      return \"stop\";\n    }\n\n    if (proceedCount >= 5) {\n      return \"strong_proceed\";\n    }\n\n    if (proceedCount >= 4) {\n      return \"proceed\";\n    }\n\n    if (cautionCount >= 3 || (cautionCount + (6 - proceedCount - stopCount)) >= 4) {\n      return \"caution\";\n    }\n\n    return \"mixed\";\n  }\n\n  /**\n   * Calculate overall score from all perspectives\n   */\n  private calculateOverallScore(perspectives: Record<HatType, HatPerspective>): number {\n    const weights = {\n      white: 0.20,  // Data matters\n      red: 0.10,    // Intuition matters less\n      black: 0.25,  // Caution is important\n      yellow: 0.15, // Benefits considered\n      green: 0.10,  // Alternatives are nice to have\n      blue: 0.20,   // Process matters\n    };\n\n    let weightedSum = 0;\n    for (const [hat, perspective] of Object.entries(perspectives)) {\n      weightedSum += perspective.score * weights[hat as HatType];\n    }\n\n    return Math.round(weightedSum);\n  }\n\n  /**\n   * Generate final recommendation\n   */\n  private generateRecommendation(\n    perspectives: Record<HatType, HatPerspective>,\n    consensus: SixHatsConsensus\n  ): string {\n    const blackHat = perspectives.black;\n    const yellowHat = perspectives.yellow;\n\n    switch (consensus) {\n      case \"strong_proceed\":\n        return \"All perspectives align: proceed with confidence.\";\n      case \"proceed\":\n        return `Most perspectives favor proceeding. Yellow hat highlights: ${yellowHat.keyPoints[0] || \"benefits exist\"}.`;\n      case \"mixed\":\n        return `Mixed signals. Consider: ${blackHat.keyPoints[0] || \"risks\"} vs ${yellowHat.keyPoints[0] || \"benefits\"}.`;\n      case \"caution\":\n        return `Multiple cautions raised. Primary concern: ${blackHat.keyPoints[0] || \"risk factors\"}.`;\n      case \"stop\":\n        return `Stop recommended. Critical issue: ${blackHat.keyPoints[0] || \"high risk detected\"}.`;\n    }\n  }\n}\n"],"mappings":"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","names":["z","z"]}