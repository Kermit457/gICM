{"version":3,"sources":["../src/approval/approval-queue.ts","../src/approval/notification-manager.ts","../src/approval/batch-approval.ts"],"sourcesContent":["/**\n * Approval Queue for Level 2 Autonomy\n *\n * Priority queue for pending approvals with:\n * - Priority ordering (risk level, urgency)\n * - Auto-expiration\n * - Batch operations\n */\n\nimport { EventEmitter } from \"eventemitter3\";\nimport type {\n  Decision,\n  ApprovalRequest,\n  ApprovalStatus,\n  Urgency,\n} from \"../core/types.js\";\nimport { URGENCY_PRIORITY, ESCALATION_RULES } from \"../core/constants.js\";\nimport { Logger } from \"../utils/logger.js\";\n\nexport interface ApprovalQueueConfig {\n  maxPendingItems?: number;\n  autoExpireHours?: number;\n}\n\nexport interface ApprovalQueueEvents {\n  \"item:added\": (request: ApprovalRequest) => void;\n  \"item:approved\": (request: ApprovalRequest, by: string) => void;\n  \"item:rejected\": (request: ApprovalRequest, reason: string) => void;\n  \"item:expired\": (request: ApprovalRequest) => void;\n  \"item:escalated\": (request: ApprovalRequest) => void;\n  \"queue:changed\": (count: number) => void;\n}\n\nexport class ApprovalQueue extends EventEmitter<ApprovalQueueEvents> {\n  private logger: Logger;\n  private queue: Map<string, ApprovalRequest>;\n  private maxPendingItems: number;\n  private autoExpireHours: number;\n  private expirationTimer: ReturnType<typeof setInterval> | null = null;\n  private requestCount = 0;\n\n  constructor(config: ApprovalQueueConfig = {}) {\n    super();\n    this.logger = new Logger(\"ApprovalQueue\");\n    this.queue = new Map();\n    this.maxPendingItems = config.maxPendingItems ?? 50;\n    this.autoExpireHours = config.autoExpireHours ?? 24;\n\n    // Start expiration checker\n    this.startExpirationChecker();\n  }\n\n  /**\n   * Add a decision to the approval queue\n   */\n  add(decision: Decision): ApprovalRequest {\n    this.requestCount++;\n\n    const request: ApprovalRequest = {\n      id: `apr_${Date.now()}_${this.requestCount}`,\n      decision,\n      priority: this.calculatePriority(decision),\n      urgency: decision.action.metadata.urgency,\n      expiresAt: Date.now() + this.autoExpireHours * 60 * 60 * 1000,\n      notificationsSent: [],\n      status: \"pending\",\n      createdAt: Date.now(),\n    };\n\n    // Check queue limit\n    if (this.queue.size >= this.maxPendingItems) {\n      // Remove lowest priority expired or oldest\n      this.removeLowestPriority();\n    }\n\n    this.queue.set(request.id, request);\n\n    this.logger.info(`Added to queue: ${decision.action.type}`, {\n      requestId: request.id,\n      priority: request.priority,\n      urgency: request.urgency,\n    });\n\n    this.emit(\"item:added\", request);\n    this.emit(\"queue:changed\", this.queue.size);\n\n    return request;\n  }\n\n  /**\n   * Approve a request\n   */\n  approve(requestId: string, approvedBy = \"human\", feedback?: string): ApprovalRequest | null {\n    const request = this.queue.get(requestId);\n    if (!request) {\n      this.logger.warn(`Request not found: ${requestId}`);\n      return null;\n    }\n\n    request.status = \"approved\";\n    request.reviewedBy = approvedBy;\n    request.reviewedAt = Date.now();\n    request.feedback = feedback;\n\n    // Update decision\n    request.decision.approvedBy = approvedBy;\n    request.decision.approvedAt = Date.now();\n    request.decision.outcome = \"auto_execute\"; // Now approved for execution\n\n    this.queue.delete(requestId);\n\n    this.logger.info(`Approved: ${request.decision.action.type}`, {\n      requestId,\n      approvedBy,\n    });\n\n    this.emit(\"item:approved\", request, approvedBy);\n    this.emit(\"queue:changed\", this.queue.size);\n\n    return request;\n  }\n\n  /**\n   * Reject a request\n   */\n  reject(requestId: string, reason: string, rejectedBy = \"human\"): ApprovalRequest | null {\n    const request = this.queue.get(requestId);\n    if (!request) {\n      this.logger.warn(`Request not found: ${requestId}`);\n      return null;\n    }\n\n    request.status = \"rejected\";\n    request.reviewedBy = rejectedBy;\n    request.reviewedAt = Date.now();\n    request.feedback = reason;\n\n    // Update decision\n    request.decision.outcome = \"reject\";\n\n    this.queue.delete(requestId);\n\n    this.logger.info(`Rejected: ${request.decision.action.type}`, {\n      requestId,\n      reason,\n    });\n\n    this.emit(\"item:rejected\", request, reason);\n    this.emit(\"queue:changed\", this.queue.size);\n\n    return request;\n  }\n\n  /**\n   * Get a request by ID\n   */\n  get(requestId: string): ApprovalRequest | undefined {\n    return this.queue.get(requestId);\n  }\n\n  /**\n   * Get all pending requests, sorted by priority\n   */\n  getPending(): ApprovalRequest[] {\n    return Array.from(this.queue.values())\n      .filter((r) => r.status === \"pending\")\n      .sort((a, b) => b.priority - a.priority);\n  }\n\n  /**\n   * Get pending requests by urgency\n   */\n  getByUrgency(urgency: Urgency): ApprovalRequest[] {\n    return this.getPending().filter((r) => r.urgency === urgency);\n  }\n\n  /**\n   * Get queue statistics\n   */\n  getStats(): {\n    total: number;\n    pending: number;\n    byUrgency: Record<Urgency, number>;\n    oldestAge: number;\n    avgWaitTime: number;\n  } {\n    const pending = this.getPending();\n    const byUrgency: Record<Urgency, number> = {\n      low: 0,\n      normal: 0,\n      high: 0,\n      critical: 0,\n    };\n\n    let totalAge = 0;\n    const now = Date.now();\n\n    for (const request of pending) {\n      byUrgency[request.urgency]++;\n      totalAge += now - request.createdAt;\n    }\n\n    const oldestAge =\n      pending.length > 0 ? now - pending[pending.length - 1].createdAt : 0;\n    const avgWaitTime = pending.length > 0 ? totalAge / pending.length : 0;\n\n    return {\n      total: this.queue.size,\n      pending: pending.length,\n      byUrgency,\n      oldestAge,\n      avgWaitTime,\n    };\n  }\n\n  /**\n   * Check for items that need escalation\n   */\n  checkEscalations(): ApprovalRequest[] {\n    const escalated: ApprovalRequest[] = [];\n    const now = Date.now();\n\n    for (const request of this.queue.values()) {\n      if (request.status !== \"pending\") continue;\n\n      const ageHours = (now - request.createdAt) / (60 * 60 * 1000);\n\n      // Check age-based escalation\n      if (ageHours >= ESCALATION_RULES.ageHoursBeforeEscalation) {\n        if (!request.notificationsSent.includes(\"escalation\")) {\n          request.notificationsSent.push(\"escalation\");\n          escalated.push(request);\n          this.emit(\"item:escalated\", request);\n        }\n      }\n\n      // Check auto-reject\n      if (ageHours >= ESCALATION_RULES.ageHoursBeforeAutoReject) {\n        this.reject(request.id, \"Auto-rejected due to age\");\n      }\n\n      // Check critical risk escalation\n      if (\n        ESCALATION_RULES.criticalRiskAutoEscalate &&\n        request.decision.assessment.level === \"critical\"\n      ) {\n        if (!request.notificationsSent.includes(\"critical_escalation\")) {\n          request.notificationsSent.push(\"critical_escalation\");\n          escalated.push(request);\n          this.emit(\"item:escalated\", request);\n        }\n      }\n    }\n\n    return escalated;\n  }\n\n  /**\n   * Mark notification as sent\n   */\n  markNotificationSent(requestId: string, channel: string): void {\n    const request = this.queue.get(requestId);\n    if (request && !request.notificationsSent.includes(channel)) {\n      request.notificationsSent.push(channel);\n    }\n  }\n\n  /**\n   * Get count of pending items\n   */\n  get size(): number {\n    return this.getPending().length;\n  }\n\n  /**\n   * Clear all pending items\n   */\n  clear(): void {\n    this.queue.clear();\n    this.emit(\"queue:changed\", 0);\n  }\n\n  /**\n   * Stop the queue (cleanup)\n   */\n  stop(): void {\n    if (this.expirationTimer) {\n      clearInterval(this.expirationTimer);\n      this.expirationTimer = null;\n    }\n  }\n\n  // Private methods\n\n  private calculatePriority(decision: Decision): number {\n    const urgencyScore = URGENCY_PRIORITY[decision.action.metadata.urgency] ?? 1;\n    const riskScore = this.riskLevelToScore(decision.assessment.level);\n    const valueScore = Math.min(\n      (decision.action.metadata.estimatedValue ?? 0) / 10,\n      10\n    );\n\n    return urgencyScore * 10 + riskScore + valueScore;\n  }\n\n  private riskLevelToScore(level: string): number {\n    const scores: Record<string, number> = {\n      safe: 1,\n      low: 2,\n      medium: 5,\n      high: 8,\n      critical: 10,\n    };\n    return scores[level] ?? 5;\n  }\n\n  private removeLowestPriority(): void {\n    const pending = this.getPending();\n    if (pending.length === 0) return;\n\n    // Remove lowest priority (last in sorted array)\n    const lowest = pending[pending.length - 1];\n    this.queue.delete(lowest.id);\n    this.emit(\"item:expired\", lowest);\n    this.logger.info(`Removed lowest priority item: ${lowest.id}`);\n  }\n\n  private startExpirationChecker(): void {\n    // Check every hour\n    this.expirationTimer = setInterval(() => {\n      this.checkExpirations();\n      this.checkEscalations();\n    }, 60 * 60 * 1000);\n  }\n\n  private checkExpirations(): void {\n    const now = Date.now();\n    const expired: string[] = [];\n\n    for (const [id, request] of this.queue) {\n      if (request.status === \"pending\" && request.expiresAt < now) {\n        expired.push(id);\n        request.status = \"expired\";\n        this.emit(\"item:expired\", request);\n      }\n    }\n\n    for (const id of expired) {\n      this.queue.delete(id);\n    }\n\n    if (expired.length > 0) {\n      this.logger.info(`Expired ${expired.length} items`);\n      this.emit(\"queue:changed\", this.queue.size);\n    }\n  }\n}\n","/**\n * Notification Manager for Level 2 Autonomy\n *\n * Sends alerts to Discord/Telegram for:\n * - New approval requests\n * - Escalations\n * - Daily summaries\n */\n\nimport type {\n  ApprovalRequest,\n  Decision,\n  NotificationChannel,\n  RiskLevel,\n} from \"../core/types.js\";\nimport { RATE_LIMITS } from \"../core/constants.js\";\nimport { Logger } from \"../utils/logger.js\";\n\nexport interface NotificationManagerConfig {\n  channels: NotificationChannel[];\n  rateLimitPerMinute?: number;\n}\n\nexport class NotificationManager {\n  private logger: Logger;\n  private channels: NotificationChannel[];\n  private rateLimitPerMinute: number;\n  private messageCount = 0;\n  private lastResetTime = Date.now();\n\n  constructor(config: NotificationManagerConfig) {\n    this.logger = new Logger(\"NotificationManager\");\n    this.channels = config.channels;\n    this.rateLimitPerMinute =\n      config.rateLimitPerMinute ?? RATE_LIMITS.maxNotificationsPerMinute;\n  }\n\n  /**\n   * Notify about a new approval request\n   */\n  async notifyApprovalNeeded(request: ApprovalRequest): Promise<boolean> {\n    if (!this.checkRateLimit()) {\n      this.logger.warn(\"Rate limit exceeded for notifications\");\n      return false;\n    }\n\n    const message = this.formatApprovalRequest(request);\n    return this.sendToAllChannels(message, \"Approval Required\");\n  }\n\n  /**\n   * Notify about an escalation\n   */\n  async notifyEscalation(request: ApprovalRequest): Promise<boolean> {\n    if (!this.checkRateLimit()) return false;\n\n    const message = this.formatEscalation(request);\n    return this.sendToAllChannels(message, \"ESCALATION\");\n  }\n\n  /**\n   * Notify about approval decision\n   */\n  async notifyApprovalDecision(\n    request: ApprovalRequest,\n    approved: boolean,\n    reason?: string\n  ): Promise<boolean> {\n    if (!this.checkRateLimit()) return false;\n\n    const status = approved ? \"Approved\" : \"Rejected\";\n    const message = this.formatDecision(request, status, reason);\n    return this.sendToAllChannels(message, status);\n  }\n\n  /**\n   * Send daily summary\n   */\n  async sendDailySummary(summary: {\n    autoExecuted: number;\n    queued: number;\n    approved: number;\n    rejected: number;\n    escalated: number;\n    totalValue: number;\n  }): Promise<boolean> {\n    const message = `\n**Daily Autonomy Summary**\n\nAuto-executed: ${summary.autoExecuted}\nQueued: ${summary.queued}\nApproved: ${summary.approved}\nRejected: ${summary.rejected}\nEscalated: ${summary.escalated}\n\nTotal value processed: $${summary.totalValue.toFixed(2)}\n    `.trim();\n\n    return this.sendToAllChannels(message, \"Daily Summary\");\n  }\n\n  /**\n   * Check if notifications are configured\n   */\n  isConfigured(): boolean {\n    return this.channels.some((c) => c.enabled);\n  }\n\n  /**\n   * Get enabled channels\n   */\n  getEnabledChannels(): NotificationChannel[] {\n    return this.channels.filter((c) => c.enabled);\n  }\n\n  // Private methods\n\n  private async sendToAllChannels(\n    message: string,\n    title: string\n  ): Promise<boolean> {\n    let success = false;\n\n    for (const channel of this.channels) {\n      if (!channel.enabled) continue;\n\n      try {\n        switch (channel.type) {\n          case \"discord\":\n            success = (await this.sendDiscord(channel, message, title)) || success;\n            break;\n          case \"telegram\":\n            success = (await this.sendTelegram(channel, message, title)) || success;\n            break;\n          case \"slack\":\n            success = (await this.sendSlack(channel, message, title)) || success;\n            break;\n        }\n      } catch (error) {\n        this.logger.error(`Failed to send to ${channel.type}`, {\n          error: error instanceof Error ? error.message : String(error),\n        });\n      }\n    }\n\n    return success;\n  }\n\n  private async sendDiscord(\n    channel: NotificationChannel,\n    message: string,\n    title: string\n  ): Promise<boolean> {\n    const webhookUrl = channel.config.webhookUrl;\n    if (!webhookUrl) return false;\n\n    try {\n      const response = await fetch(webhookUrl, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          embeds: [\n            {\n              title,\n              description: message,\n              color: this.getTitleColor(title),\n              timestamp: new Date().toISOString(),\n              footer: { text: \"gICM Autonomy\" },\n            },\n          ],\n        }),\n      });\n\n      if (response.ok) {\n        this.logger.debug(`Discord notification sent: ${title}`);\n        return true;\n      } else {\n        this.logger.warn(`Discord notification failed: ${response.status}`);\n        return false;\n      }\n    } catch (error) {\n      this.logger.error(\"Discord send error\", {\n        error: error instanceof Error ? error.message : String(error),\n      });\n      return false;\n    }\n  }\n\n  private async sendTelegram(\n    channel: NotificationChannel,\n    message: string,\n    title: string\n  ): Promise<boolean> {\n    const { botToken, chatId } = channel.config;\n    if (!botToken || !chatId) return false;\n\n    try {\n      const url = `https://api.telegram.org/bot${botToken}/sendMessage`;\n      const response = await fetch(url, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          chat_id: chatId,\n          text: `*${title}*\\n\\n${message}`,\n          parse_mode: \"Markdown\",\n        }),\n      });\n\n      if (response.ok) {\n        this.logger.debug(`Telegram notification sent: ${title}`);\n        return true;\n      } else {\n        this.logger.warn(`Telegram notification failed: ${response.status}`);\n        return false;\n      }\n    } catch (error) {\n      this.logger.error(\"Telegram send error\", {\n        error: error instanceof Error ? error.message : String(error),\n      });\n      return false;\n    }\n  }\n\n  private async sendSlack(\n    channel: NotificationChannel,\n    message: string,\n    title: string\n  ): Promise<boolean> {\n    const webhookUrl = channel.config.webhookUrl;\n    if (!webhookUrl) return false;\n\n    try {\n      const response = await fetch(webhookUrl, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          blocks: [\n            {\n              type: \"header\",\n              text: { type: \"plain_text\", text: title },\n            },\n            {\n              type: \"section\",\n              text: { type: \"mrkdwn\", text: message },\n            },\n          ],\n        }),\n      });\n\n      return response.ok;\n    } catch (error) {\n      this.logger.error(\"Slack send error\", {\n        error: error instanceof Error ? error.message : String(error),\n      });\n      return false;\n    }\n  }\n\n  private formatApprovalRequest(request: ApprovalRequest): string {\n    const action = request.decision.action;\n    const assessment = request.decision.assessment;\n\n    return `\n**${action.description}**\n\nAction: \\`${action.type}\\`\nEngine: ${action.engine}\nCategory: ${action.category}\n\nRisk: ${this.getRiskEmoji(assessment.level)} ${assessment.level.toUpperCase()} (${assessment.score}/100)\nValue: ${action.metadata.estimatedValue ? `$${action.metadata.estimatedValue}` : \"N/A\"}\nReversible: ${action.metadata.reversible ? \"Yes\" : \"No\"}\n\nID: \\`${request.id}\\`\nExpires: ${new Date(request.expiresAt).toLocaleString()}\n\n\\`gicm-autonomy approve ${request.id}\\`\n    `.trim();\n  }\n\n  private formatEscalation(request: ApprovalRequest): string {\n    const action = request.decision.action;\n    const ageMinutes = Math.round(\n      (Date.now() - request.createdAt) / (60 * 1000)\n    );\n\n    return `\n**REQUIRES IMMEDIATE ATTENTION**\n\n${action.description}\n\nAction: \\`${action.type}\\`\nRisk: ${request.decision.assessment.level.toUpperCase()}\nWaiting: ${ageMinutes} minutes\n\nID: \\`${request.id}\\`\n\n\\`gicm-autonomy approve ${request.id}\\`\n    `.trim();\n  }\n\n  private formatDecision(\n    request: ApprovalRequest,\n    status: string,\n    reason?: string\n  ): string {\n    const action = request.decision.action;\n\n    return `\n**${status}: ${action.type}**\n\n${action.description}\n\n${reason ? `Reason: ${reason}` : \"\"}\nReviewed by: ${request.reviewedBy}\n    `.trim();\n  }\n\n  private getRiskEmoji(level: RiskLevel): string {\n    const emojis: Record<RiskLevel, string> = {\n      safe: \"ðŸŸ¢\",\n      low: \"ðŸŸ¢\",\n      medium: \"ðŸŸ¡\",\n      high: \"ðŸŸ \",\n      critical: \"ðŸ”´\",\n    };\n    return emojis[level] ?? \"âšª\";\n  }\n\n  private getTitleColor(title: string): number {\n    if (title.includes(\"ESCALATION\")) return 0xff0000; // Red\n    if (title.includes(\"Rejected\")) return 0xff6b6b; // Light red\n    if (title.includes(\"Approved\")) return 0x00ff00; // Green\n    if (title.includes(\"Summary\")) return 0x0099ff; // Blue\n    return 0xffaa00; // Orange (default for approvals)\n  }\n\n  private checkRateLimit(): boolean {\n    const now = Date.now();\n    if (now - this.lastResetTime > 60000) {\n      this.messageCount = 0;\n      this.lastResetTime = now;\n    }\n\n    if (this.messageCount >= this.rateLimitPerMinute) {\n      return false;\n    }\n\n    this.messageCount++;\n    return true;\n  }\n}\n","/**\n * Batch Approval for Level 2 Autonomy\n *\n * Enables efficient batch review of pending approvals:\n * - Group by category, risk, or engine\n * - Approve/reject multiple items at once\n * - Summary statistics\n */\n\nimport type { ApprovalRequest, ActionCategory, RiskLevel } from \"../core/types.js\";\nimport { ApprovalQueue } from \"./approval-queue.js\";\nimport { Logger } from \"../utils/logger.js\";\n\nexport interface BatchSummary {\n  total: number;\n  byCategory: Record<ActionCategory, number>;\n  byRisk: Record<RiskLevel, number>;\n  byEngine: Record<string, number>;\n  totalValue: number;\n  oldestAge: number;\n  avgScore: number;\n}\n\nexport interface BatchFilter {\n  category?: ActionCategory;\n  riskLevel?: RiskLevel;\n  engine?: string;\n  minScore?: number;\n  maxScore?: number;\n  olderThanHours?: number;\n}\n\nexport class BatchApproval {\n  private logger: Logger;\n  private queue: ApprovalQueue;\n\n  constructor(queue: ApprovalQueue) {\n    this.logger = new Logger(\"BatchApproval\");\n    this.queue = queue;\n  }\n\n  /**\n   * Get summary of all pending items\n   */\n  getSummary(): BatchSummary {\n    const pending = this.queue.getPending();\n    const now = Date.now();\n\n    const byCategory: Record<ActionCategory, number> = {\n      trading: 0,\n      content: 0,\n      build: 0,\n      deployment: 0,\n      configuration: 0,\n    };\n    const byRisk: Record<RiskLevel, number> = {\n      safe: 0,\n      low: 0,\n      medium: 0,\n      high: 0,\n      critical: 0,\n    };\n    const byEngine: Record<string, number> = {};\n\n    let totalValue = 0;\n    let totalScore = 0;\n    let oldestAge = 0;\n\n    for (const request of pending) {\n      const action = request.decision.action;\n      const assessment = request.decision.assessment;\n\n      byCategory[action.category]++;\n      byRisk[assessment.level]++;\n      byEngine[action.engine] = (byEngine[action.engine] ?? 0) + 1;\n\n      totalValue += action.metadata.estimatedValue ?? 0;\n      totalScore += assessment.score;\n\n      const age = now - request.createdAt;\n      if (age > oldestAge) oldestAge = age;\n    }\n\n    return {\n      total: pending.length,\n      byCategory,\n      byRisk,\n      byEngine,\n      totalValue,\n      oldestAge,\n      avgScore: pending.length > 0 ? totalScore / pending.length : 0,\n    };\n  }\n\n  /**\n   * Get items matching a filter\n   */\n  filter(filter: BatchFilter): ApprovalRequest[] {\n    const pending = this.queue.getPending();\n    const now = Date.now();\n\n    return pending.filter((request) => {\n      const action = request.decision.action;\n      const assessment = request.decision.assessment;\n\n      if (filter.category && action.category !== filter.category) return false;\n      if (filter.riskLevel && assessment.level !== filter.riskLevel) return false;\n      if (filter.engine && action.engine !== filter.engine) return false;\n      if (filter.minScore && assessment.score < filter.minScore) return false;\n      if (filter.maxScore && assessment.score > filter.maxScore) return false;\n\n      if (filter.olderThanHours) {\n        const ageHours = (now - request.createdAt) / (60 * 60 * 1000);\n        if (ageHours < filter.olderThanHours) return false;\n      }\n\n      return true;\n    });\n  }\n\n  /**\n   * Approve all items matching a filter\n   */\n  approveFiltered(\n    filter: BatchFilter,\n    approvedBy = \"batch\",\n    feedback?: string\n  ): { approved: ApprovalRequest[]; failed: string[] } {\n    const items = this.filter(filter);\n    const approved: ApprovalRequest[] = [];\n    const failed: string[] = [];\n\n    for (const item of items) {\n      const result = this.queue.approve(item.id, approvedBy, feedback);\n      if (result) {\n        approved.push(result);\n      } else {\n        failed.push(item.id);\n      }\n    }\n\n    this.logger.info(`Batch approved ${approved.length} items`, {\n      filter,\n      failed: failed.length,\n    });\n\n    return { approved, failed };\n  }\n\n  /**\n   * Reject all items matching a filter\n   */\n  rejectFiltered(\n    filter: BatchFilter,\n    reason: string,\n    rejectedBy = \"batch\"\n  ): { rejected: ApprovalRequest[]; failed: string[] } {\n    const items = this.filter(filter);\n    const rejected: ApprovalRequest[] = [];\n    const failed: string[] = [];\n\n    for (const item of items) {\n      const result = this.queue.reject(item.id, reason, rejectedBy);\n      if (result) {\n        rejected.push(result);\n      } else {\n        failed.push(item.id);\n      }\n    }\n\n    this.logger.info(`Batch rejected ${rejected.length} items`, {\n      filter,\n      reason,\n      failed: failed.length,\n    });\n\n    return { rejected, failed };\n  }\n\n  /**\n   * Approve all safe/low risk items\n   */\n  approveAllSafe(approvedBy = \"batch\"): { approved: ApprovalRequest[] } {\n    const safeItems = this.filter({ riskLevel: \"safe\" });\n    const lowItems = this.filter({ riskLevel: \"low\" });\n\n    const approved: ApprovalRequest[] = [];\n\n    for (const item of [...safeItems, ...lowItems]) {\n      const result = this.queue.approve(item.id, approvedBy, \"Auto-approved (low risk)\");\n      if (result) approved.push(result);\n    }\n\n    this.logger.info(`Auto-approved ${approved.length} safe/low risk items`);\n\n    return { approved };\n  }\n\n  /**\n   * Reject all expired or very old items\n   */\n  cleanupOld(olderThanHours = 48): { rejected: ApprovalRequest[] } {\n    const oldItems = this.filter({ olderThanHours });\n    const rejected: ApprovalRequest[] = [];\n\n    for (const item of oldItems) {\n      const result = this.queue.reject(item.id, `Auto-rejected: older than ${olderThanHours}h`);\n      if (result) rejected.push(result);\n    }\n\n    this.logger.info(`Cleaned up ${rejected.length} old items`);\n\n    return { rejected };\n  }\n\n  /**\n   * Get items grouped by category\n   */\n  groupByCategory(): Record<ActionCategory, ApprovalRequest[]> {\n    const pending = this.queue.getPending();\n    const grouped: Record<ActionCategory, ApprovalRequest[]> = {\n      trading: [],\n      content: [],\n      build: [],\n      deployment: [],\n      configuration: [],\n    };\n\n    for (const request of pending) {\n      grouped[request.decision.action.category].push(request);\n    }\n\n    return grouped;\n  }\n\n  /**\n   * Get items grouped by risk level\n   */\n  groupByRisk(): Record<RiskLevel, ApprovalRequest[]> {\n    const pending = this.queue.getPending();\n    const grouped: Record<RiskLevel, ApprovalRequest[]> = {\n      safe: [],\n      low: [],\n      medium: [],\n      high: [],\n      critical: [],\n    };\n\n    for (const request of pending) {\n      grouped[request.decision.assessment.level].push(request);\n    }\n\n    return grouped;\n  }\n\n  /**\n   * Get quick actions for common batch operations\n   */\n  getQuickActions(): {\n    approveSafe: () => { approved: ApprovalRequest[] };\n    cleanupOld: () => { rejected: ApprovalRequest[] };\n    approveAll: (by: string) => { approved: ApprovalRequest[]; failed: string[] };\n    rejectAll: (reason: string) => { rejected: ApprovalRequest[]; failed: string[] };\n  } {\n    return {\n      approveSafe: () => this.approveAllSafe(),\n      cleanupOld: () => this.cleanupOld(),\n      approveAll: (by) => this.approveFiltered({}, by),\n      rejectAll: (reason) => this.rejectFiltered({}, reason),\n    };\n  }\n}\n"],"mappings":"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","names":[]}