{"version":3,"sources":["../../src/brain/cli.ts"],"sourcesContent":["#!/usr/bin/env node\n/**\n * gICM Brain CLI\n *\n * Command-line interface for the autonomous brain.\n */\n\n// Prevent MaxListenersExceededWarning from pino-pretty and event emitters\nprocess.setMaxListeners(25);\n\n// Load environment variables\nimport dotenv from \"dotenv\";\ndotenv.config();\n\nimport { GicmBrain, createGicmBrain } from \"./gicm-brain.js\";\nimport { goalSystem } from \"./goal-system.js\";\n\nasync function main(): Promise<void> {\n  const args = process.argv.slice(2);\n  const command = args[0];\n\n  switch (command) {\n    case \"start\":\n      await startBrain(args.includes(\"--live\"));\n      break;\n\n    case \"status\":\n      showStatus();\n      break;\n\n    case \"phase\":\n      const phase = args[1];\n      if (!phase) {\n        console.log(\"Usage: brain phase <morning_scan|decision_planning|execution|reflection|maintenance>\");\n        process.exit(1);\n      }\n      await runPhase(phase as any, args.includes(\"--live\"));\n      break;\n\n    case \"goals\":\n      showGoals();\n      break;\n\n    case \"metrics\":\n      showMetrics();\n      break;\n\n    case \"help\":\n    default:\n      showHelp();\n      break;\n  }\n}\n\nasync function startBrain(live: boolean): Promise<void> {\n  console.log(\"\\n=== gICM BRAIN ===\\n\");\n\n  const brain = createGicmBrain({\n    dryRun: !live,\n    tradingApiUrl: process.env.TRADING_API_URL || \"http://localhost:4000\",\n  });\n\n  await brain.initialize();\n  \n  // Register with Integration Hub\n  const hubUrl = process.env.HUB_URL || \"http://localhost:3001\";\n  await registerWithHub(hubUrl);\n  \n  // Start heartbeat loop\n  const heartbeatInterval = setInterval(async () => {\n    await sendHeartbeat(hubUrl);\n  }, 30000); // Every 30 seconds\n\n  brain.start();\n\n  const status = brain.getStatus();\n  console.log(`\\nMode: ${status.dryRun ? \"DRY RUN (safe)\" : \"LIVE (real actions)\"}`);\n  console.log(`Today's Focus: ${status.todayFocus}`);\n  console.log(`Current Phase: ${status.currentPhase || \"Between phases\"}`);\n  console.log(`\\nRegistered with Integration Hub: ${hubUrl}`);\n  console.log(\"\\nPress Ctrl+C to stop\\n\");\n\n  // Keep running\n  process.on(\"SIGINT\", async () => {\n    console.log(\"\\n\\nStopping brain...\");\n    clearInterval(heartbeatInterval);\n    await unregisterFromHub(hubUrl);\n    brain.stop();\n    console.log(\"Brain stopped. Final status:\");\n    const finalStatus = brain.getStatus();\n    console.log(`  Phases completed today: ${finalStatus.metrics.todayPhases}`);\n    console.log(`  Actions taken: ${finalStatus.metrics.todayActions}`);\n    console.log(`  Errors: ${finalStatus.metrics.todayErrors}`);\n    process.exit(0);\n  });\n\n  // Keep process alive\n  await new Promise(() => {});\n}\n\nasync function registerWithHub(hubUrl: string): Promise<void> {\n  try {\n    const response = await fetch(`${hubUrl}/api/engines/register`, {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ engineId: \"brain\" }),\n    });\n    if (response.ok) {\n      console.log(\"[BRAIN] Registered with Integration Hub\");\n    } else {\n      console.warn(`[BRAIN] Failed to register with Hub: ${response.statusText}`);\n    }\n  } catch (error) {\n    console.warn(`[BRAIN] Could not register with Hub (may not be running): ${error instanceof Error ? error.message : String(error)}`);\n  }\n}\n\nasync function sendHeartbeat(hubUrl: string): Promise<void> {\n  try {\n    await fetch(`${hubUrl}/api/engines/heartbeat`, {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ engineId: \"brain\" }),\n    });\n  } catch (error) {\n    // Silently fail - Hub may not be running\n  }\n}\n\nasync function unregisterFromHub(hubUrl: string): Promise<void> {\n  try {\n    await fetch(`${hubUrl}/api/engines/unregister`, {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ engineId: \"brain\" }),\n    });\n  } catch (error) {\n    // Ignore errors on shutdown\n  }\n}\n\nfunction showStatus(): void {\n  console.log(\"\\n=== gICM BRAIN STATUS ===\\n\");\n\n  const phase = goalSystem.getCurrentPhase();\n  const focus = goalSystem.getTodayFocus();\n  const level = goalSystem.getCurrentAutonomyLevel();\n\n  console.log(`Prime Directive: ${goalSystem.getPrimeDirective()}`);\n  console.log(`Autonomy Level: ${level} - ${goalSystem.getAutonomyDescription(level)}`);\n  console.log(`Current Phase: ${phase?.name || \"Between phases\"}`);\n  console.log(`Today's Focus: ${focus}`);\n  console.log(`Trading Mode: ${goalSystem.getDefaultTradingMode()}`);\n\n  console.log(\"\\nCore Values:\");\n  goalSystem.getCoreValues().forEach((v, i) => {\n    console.log(`  ${i + 1}. ${v.name} - ${v.description}`);\n  });\n\n  console.log(\"\\nCompetitors to Monitor:\");\n  goalSystem.getCompetitors().forEach((c) => {\n    console.log(`  - ${c.name} (${c.category})`);\n  });\n}\n\nfunction showGoals(): void {\n  console.log(\"\\n=== gICM GOALS ===\\n\");\n\n  console.log(\"Daily Targets:\");\n  const daily = goalSystem.getDailyMetrics();\n  for (const [key, value] of Object.entries(daily)) {\n    console.log(`  ${key}: ${value.target} - ${value.description}`);\n  }\n\n  console.log(\"\\nWeekly Targets:\");\n  const weekly = goalSystem.getWeeklyMetrics();\n  for (const [key, value] of Object.entries(weekly)) {\n    console.log(`  ${key}: ${value.target} - ${value.description}`);\n  }\n\n  console.log(\"\\nDecision Thresholds:\");\n  const thresholds = goalSystem.getDecisionThresholds();\n  console.log(`  Auto-approve: ${thresholds.auto_approve_score}+`);\n  console.log(`  Manual review: ${thresholds.manual_review_score}-${thresholds.auto_approve_score}`);\n  console.log(`  Auto-reject: <${thresholds.auto_reject_score}`);\n}\n\nfunction showMetrics(): void {\n  console.log(\"\\n=== gICM METRICS ===\\n\");\n\n  console.log(\"Treasury Allocations:\");\n  const allocations = goalSystem.getTreasuryAllocations();\n  for (const [key, value] of Object.entries(allocations)) {\n    console.log(`  ${key}: ${(value * 100).toFixed(0)}%`);\n  }\n\n  console.log(\"\\nTrading Risk Limits:\");\n  const limits = goalSystem.getTradingRiskLimits();\n  for (const [key, value] of Object.entries(limits)) {\n    console.log(`  ${key}: ${value}`);\n  }\n}\n\nasync function runPhase(\n  phase: \"morning_scan\" | \"decision_planning\" | \"execution\" | \"reflection\" | \"maintenance\",\n  live: boolean\n): Promise<void> {\n  console.log(`\\n=== Running Phase: ${phase.toUpperCase()} ===\\n`);\n\n  const brain = createGicmBrain({\n    dryRun: !live,\n    tradingApiUrl: process.env.TRADING_API_URL || \"http://localhost:4000\",\n  });\n\n  await brain.initialize();\n\n  console.log(`Mode: ${live ? \"LIVE\" : \"DRY RUN\"}\\n`);\n\n  const result = await brain.triggerPhase(phase);\n\n  console.log(`\\n=== Phase Complete ===`);\n  console.log(`Duration: ${((result.completedAt - result.startedAt) / 1000).toFixed(1)}s`);\n  console.log(`Success: ${result.success}`);\n  console.log(`Actions: ${result.actions.length}`);\n  console.log(`Errors: ${result.errors.length}`);\n\n  if (result.actions.length > 0) {\n    console.log(\"\\nActions:\");\n    result.actions.forEach((a) => {\n      const icon = a.result === \"success\" ? \"✓\" : a.result === \"failed\" ? \"✗\" : \"○\";\n      console.log(`  ${icon} [${a.engine}] ${a.action}${a.details ? ` - ${a.details}` : \"\"}`);\n    });\n  }\n\n  if (result.errors.length > 0) {\n    console.log(\"\\nErrors:\");\n    result.errors.forEach((e) => {\n      console.log(`  ✗ ${e}`);\n    });\n  }\n\n  if (Object.keys(result.metrics).length > 0) {\n    console.log(\"\\nMetrics:\");\n    for (const [key, value] of Object.entries(result.metrics)) {\n      console.log(`  ${key}: ${value}`);\n    }\n  }\n}\n\nfunction showHelp(): void {\n  console.log(`\ngICM Brain CLI - Autonomous Control Center\n\nUsage:\n  brain start [--live]     Start the autonomous cycle (default: dry run)\n  brain status             Show current brain status\n  brain phase <name>       Run a specific phase manually\n  brain goals              Show goal targets\n  brain metrics            Show metric configurations\n  brain help               Show this help\n\nPhases:\n  morning_scan             Discovery, market analysis (00:00-04:00 UTC)\n  decision_planning        Prioritize, plan executions (04:00-06:00 UTC)\n  execution                Trading, content, building (06:00-20:00 UTC)\n  reflection               Review performance (20:00-22:00 UTC)\n  maintenance              Cleanup, prepare (22:00-00:00 UTC)\n\nExamples:\n  brain start              Start in dry run mode (safe)\n  brain start --live       Start with real actions (careful!)\n  brain phase morning_scan Run morning scan now\n  brain status             Check current status\n`);\n}\n\nmain().catch((error) => {\n  console.error(`Error: ${error.message || error}`);\n  process.exit(1);\n});\n"],"mappings":"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","names":[]}