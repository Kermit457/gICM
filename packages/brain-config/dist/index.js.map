{"version":3,"sources":["../src/types.ts","../src/presets.ts","../src/brain-manager.ts"],"sourcesContent":["/**\n * gICM Brain Configuration Types\n * Opus 4.5 optimizations for token efficiency, extended thinking, and tool management\n */\n\nimport { z } from \"zod\";\n\n// =============================================================================\n// EFFORT LEVELS - Control token usage vs quality tradeoff\n// =============================================================================\n\nexport const EffortLevelSchema = z.enum([\"low\", \"medium\", \"high\"]);\nexport type EffortLevel = z.infer<typeof EffortLevelSchema>;\n\nexport const EFFORT_DESCRIPTIONS: Record<EffortLevel, string> = {\n  low: \"Fast responses, minimal reasoning. Best for simple queries. ~76% token savings.\",\n  medium: \"Balanced quality and efficiency. Recommended default. ~50% token savings.\",\n  high: \"Maximum quality, thorough reasoning. For complex tasks. Full token usage.\",\n};\n\nexport const EFFORT_TOKEN_MULTIPLIER: Record<EffortLevel, number> = {\n  low: 0.25,\n  medium: 0.5,\n  high: 1.0,\n};\n\n// =============================================================================\n// EXTENDED THINKING - Deep reasoning for complex problems\n// =============================================================================\n\nexport const ExtendedThinkingConfigSchema = z.object({\n  enabled: z.boolean().default(false),\n  budgetTokens: z.number().min(1000).max(128000).default(8000),\n  preserveHistory: z.boolean().default(true), // Keep thinking blocks in context\n});\nexport type ExtendedThinkingConfig = z.infer<typeof ExtendedThinkingConfigSchema>;\n\n// =============================================================================\n// TOOL SEARCH - Dynamic tool loading for large tool libraries\n// =============================================================================\n\nexport const ToolSearchConfigSchema = z.object({\n  enabled: z.boolean().default(false),\n  maxToolsPerRequest: z.number().min(1).max(50).default(10),\n  catalogPath: z.string().optional(), // Path to tool catalog\n  lazyLoad: z.boolean().default(true), // Load tools on-demand\n});\nexport type ToolSearchConfig = z.infer<typeof ToolSearchConfigSchema>;\n\n// =============================================================================\n// MEMORY - External memory for long-running agents\n// =============================================================================\n\nexport const MemoryConfigSchema = z.object({\n  enabled: z.boolean().default(false),\n  provider: z.enum([\"local\", \"redis\", \"supabase\"]).default(\"local\"),\n  maxEntries: z.number().min(10).max(10000).default(1000),\n  ttlSeconds: z.number().min(60).max(86400 * 30).default(86400), // 1 day default\n  autoSummarize: z.boolean().default(true), // Summarize before context overflow\n});\nexport type MemoryConfig = z.infer<typeof MemoryConfigSchema>;\n\n// =============================================================================\n// CONTEXT MANAGEMENT - Prevent context overflow\n// =============================================================================\n\nexport const ContextManagementSchema = z.object({\n  maxContextTokens: z.number().min(1000).max(1000000).default(200000),\n  warningThreshold: z.number().min(0.5).max(0.95).default(0.8), // Warn at 80%\n  autoTruncate: z.boolean().default(true),\n  truncationStrategy: z.enum([\"oldest_first\", \"summary\", \"sliding_window\"]).default(\"sliding_window\"),\n  preserveSystemPrompt: z.boolean().default(true),\n});\nexport type ContextManagement = z.infer<typeof ContextManagementSchema>;\n\n// =============================================================================\n// PRICING - Cost tracking and budgets\n// =============================================================================\n\nexport const ModelPricingSchema = z.object({\n  inputPer1M: z.number(), // $ per 1M input tokens\n  outputPer1M: z.number(), // $ per 1M output tokens\n  cachedInputPer1M: z.number().optional(), // $ per 1M cached input tokens\n});\nexport type ModelPricing = z.infer<typeof ModelPricingSchema>;\n\nexport const MODEL_PRICING: Record<string, ModelPricing> = {\n  \"claude-opus-4-5-20251101\": { inputPer1M: 5, outputPer1M: 25, cachedInputPer1M: 0.5 },\n  \"claude-sonnet-4-20250514\": { inputPer1M: 3, outputPer1M: 15, cachedInputPer1M: 0.3 },\n  \"claude-haiku-3-5-20241022\": { inputPer1M: 0.25, outputPer1M: 1.25, cachedInputPer1M: 0.025 },\n  \"gpt-4o\": { inputPer1M: 2.5, outputPer1M: 10 },\n  \"gpt-4o-mini\": { inputPer1M: 0.15, outputPer1M: 0.6 },\n  \"gemini-1.5-pro\": { inputPer1M: 1.25, outputPer1M: 5 },\n  \"gemini-2.0-flash\": { inputPer1M: 0.075, outputPer1M: 0.3 },\n};\n\nexport const BudgetConfigSchema = z.object({\n  enabled: z.boolean().default(true),\n  dailyLimitUSD: z.number().min(0).default(10),\n  monthlyLimitUSD: z.number().min(0).default(100),\n  alertThreshold: z.number().min(0.5).max(1).default(0.8), // Alert at 80% usage\n  pauseOnLimit: z.boolean().default(false), // Pause operations on limit\n});\nexport type BudgetConfig = z.infer<typeof BudgetConfigSchema>;\n\n// =============================================================================\n// BRAIN CONFIG - Master configuration\n// =============================================================================\n\nexport const BrainConfigSchema = z.object({\n  // Model selection\n  provider: z.enum([\"anthropic\", \"openai\", \"gemini\"]).default(\"anthropic\"),\n  model: z.string().default(\"claude-opus-4-5-20251101\"),\n\n  // Token efficiency\n  effort: EffortLevelSchema.default(\"medium\"),\n  temperature: z.number().min(0).max(2).default(0.7),\n  maxTokens: z.number().min(100).max(64000).default(8192),\n\n  // Advanced features\n  extendedThinking: ExtendedThinkingConfigSchema.optional(),\n  toolSearch: ToolSearchConfigSchema.optional(),\n  memory: MemoryConfigSchema.optional(),\n  context: ContextManagementSchema.optional(),\n  budget: BudgetConfigSchema.optional(),\n\n  // Prompt caching (90% savings on repeated prompts)\n  promptCaching: z.object({\n    enabled: z.boolean().default(true),\n    minCacheableTokens: z.number().min(100).default(1024),\n  }).optional(),\n\n  // Batch processing (50% savings)\n  batchProcessing: z.object({\n    enabled: z.boolean().default(false),\n    maxBatchSize: z.number().min(1).max(100).default(10),\n    maxWaitMs: z.number().min(100).max(60000).default(5000),\n  }).optional(),\n});\n\nexport type BrainConfig = z.infer<typeof BrainConfigSchema>;\n\n// =============================================================================\n// USAGE METRICS\n// =============================================================================\n\nexport interface UsageMetrics {\n  requestId: string;\n  timestamp: Date;\n  model: string;\n  effort: EffortLevel;\n\n  // Token counts\n  inputTokens: number;\n  outputTokens: number;\n  thinkingTokens?: number;\n  cachedInputTokens?: number;\n\n  // Cost\n  costUSD: number;\n\n  // Performance\n  latencyMs: number;\n\n  // Savings vs high effort\n  tokensSaved?: number;\n  costSavedUSD?: number;\n}\n\nexport interface AggregatedMetrics {\n  period: \"day\" | \"week\" | \"month\";\n  startDate: Date;\n  endDate: Date;\n\n  // Totals\n  totalRequests: number;\n  totalInputTokens: number;\n  totalOutputTokens: number;\n  totalCostUSD: number;\n\n  // Savings\n  totalTokensSaved: number;\n  totalCostSavedUSD: number;\n\n  // Averages\n  avgLatencyMs: number;\n  avgTokensPerRequest: number;\n\n  // By model\n  byModel: Record<string, {\n    requests: number;\n    tokens: number;\n    costUSD: number;\n  }>;\n\n  // By effort level\n  byEffort: Record<EffortLevel, {\n    requests: number;\n    tokens: number;\n    costUSD: number;\n  }>;\n}\n\n// =============================================================================\n// PRESET TYPES\n// =============================================================================\n\nexport interface BrainPreset {\n  id: string;\n  name: string;\n  description: string;\n  icon: string;\n  tags: string[];\n  config: Partial<BrainConfig>;\n  estimatedSavings: string; // e.g., \"~65% token savings\"\n  bestFor: string[];\n}\n","/**\n * gICM Brain Presets\n * Pre-configured brain settings optimized for different use cases\n */\n\nimport type { BrainConfig, BrainPreset } from \"./types.js\";\nexport type { BrainPreset } from \"./types.js\";\n\n// =============================================================================\n// EFFICIENCY PRESETS - Optimize for cost/speed\n// =============================================================================\n\nexport const PRESET_TURBO: BrainPreset = {\n  id: \"turbo\",\n  name: \"Turbo Mode\",\n  description: \"Maximum speed, minimal tokens. Fast responses for simple tasks.\",\n  icon: \"Zap\",\n  tags: [\"speed\", \"cost-saving\", \"simple-tasks\"],\n  config: {\n    provider: \"anthropic\",\n    model: \"claude-haiku-3-5-20241022\",\n    effort: \"low\",\n    temperature: 0.3,\n    maxTokens: 2048,\n    promptCaching: { enabled: true, minCacheableTokens: 512 },\n  },\n  estimatedSavings: \"~85% cost reduction vs Opus high\",\n  bestFor: [\"Quick queries\", \"Simple code fixes\", \"Data formatting\", \"Status checks\"],\n};\n\nexport const PRESET_BALANCED: BrainPreset = {\n  id: \"balanced\",\n  name: \"Balanced\",\n  description: \"Optimal balance of quality, speed, and cost. Recommended default.\",\n  icon: \"Scale\",\n  tags: [\"recommended\", \"balanced\", \"default\"],\n  config: {\n    provider: \"anthropic\",\n    model: \"claude-sonnet-4-20250514\",\n    effort: \"medium\",\n    temperature: 0.7,\n    maxTokens: 8192,\n    promptCaching: { enabled: true, minCacheableTokens: 1024 },\n    context: {\n      maxContextTokens: 200000,\n      warningThreshold: 0.8,\n      autoTruncate: true,\n      truncationStrategy: \"sliding_window\",\n      preserveSystemPrompt: true,\n    },\n  },\n  estimatedSavings: \"~50% token savings vs high effort\",\n  bestFor: [\"Daily coding\", \"Code reviews\", \"Research\", \"Documentation\"],\n};\n\nexport const PRESET_POWERHOUSE: BrainPreset = {\n  id: \"powerhouse\",\n  name: \"Powerhouse\",\n  description: \"Maximum intelligence with Opus 4.5. For complex reasoning tasks.\",\n  icon: \"Brain\",\n  tags: [\"max-quality\", \"complex\", \"reasoning\"],\n  config: {\n    provider: \"anthropic\",\n    model: \"claude-opus-4-5-20251101\",\n    effort: \"high\",\n    temperature: 0.5,\n    maxTokens: 16384,\n    extendedThinking: {\n      enabled: true,\n      budgetTokens: 16000,\n      preserveHistory: true,\n    },\n    promptCaching: { enabled: true, minCacheableTokens: 1024 },\n  },\n  estimatedSavings: \"Full token usage, maximum quality\",\n  bestFor: [\"Architecture decisions\", \"Complex debugging\", \"Algorithm design\", \"Security audits\"],\n};\n\n// =============================================================================\n// USE CASE PRESETS - Optimized for specific workflows\n// =============================================================================\n\nexport const PRESET_TRADING: BrainPreset = {\n  id: \"trading\",\n  name: \"Trading Agent\",\n  description: \"Optimized for DeFi trading decisions. Fast, precise, risk-aware.\",\n  icon: \"TrendingUp\",\n  tags: [\"trading\", \"defi\", \"fast-decisions\"],\n  config: {\n    provider: \"anthropic\",\n    model: \"claude-sonnet-4-20250514\",\n    effort: \"medium\",\n    temperature: 0.2, // Low for consistency\n    maxTokens: 4096,\n    memory: {\n      enabled: true,\n      provider: \"local\",\n      maxEntries: 500,\n      ttlSeconds: 3600, // 1 hour for trading context\n      autoSummarize: true,\n    },\n    budget: {\n      enabled: true,\n      dailyLimitUSD: 20,\n      monthlyLimitUSD: 200,\n      alertThreshold: 0.8,\n      pauseOnLimit: false,\n    },\n  },\n  estimatedSavings: \"~40% vs unoptimized\",\n  bestFor: [\"Token analysis\", \"Risk assessment\", \"Trade execution\", \"Market monitoring\"],\n};\n\nexport const PRESET_HUNTER: BrainPreset = {\n  id: \"hunter\",\n  name: \"Hunter Agent\",\n  description: \"Optimized for opportunity discovery. Broad search, quick analysis.\",\n  icon: \"Search\",\n  tags: [\"discovery\", \"research\", \"scanning\"],\n  config: {\n    provider: \"anthropic\",\n    model: \"claude-sonnet-4-20250514\",\n    effort: \"low\", // Fast scanning\n    temperature: 0.5,\n    maxTokens: 2048,\n    toolSearch: {\n      enabled: true,\n      maxToolsPerRequest: 15,\n      lazyLoad: true,\n    },\n    batchProcessing: {\n      enabled: true,\n      maxBatchSize: 20,\n      maxWaitMs: 3000,\n    },\n  },\n  estimatedSavings: \"~70% with batch processing\",\n  bestFor: [\"Token discovery\", \"Trend analysis\", \"Social scanning\", \"GitHub monitoring\"],\n};\n\nexport const PRESET_BUILDER: BrainPreset = {\n  id: \"builder\",\n  name: \"Builder Agent\",\n  description: \"Optimized for code generation. High quality, extended thinking.\",\n  icon: \"Code\",\n  tags: [\"coding\", \"generation\", \"quality\"],\n  config: {\n    provider: \"anthropic\",\n    model: \"claude-opus-4-5-20251101\",\n    effort: \"high\",\n    temperature: 0.3,\n    maxTokens: 32000,\n    extendedThinking: {\n      enabled: true,\n      budgetTokens: 24000,\n      preserveHistory: true,\n    },\n    context: {\n      maxContextTokens: 200000,\n      warningThreshold: 0.75,\n      autoTruncate: true,\n      truncationStrategy: \"summary\",\n      preserveSystemPrompt: true,\n    },\n  },\n  estimatedSavings: \"Quality over cost\",\n  bestFor: [\"Feature development\", \"Refactoring\", \"Test generation\", \"Architecture\"],\n};\n\nexport const PRESET_GROWTH: BrainPreset = {\n  id: \"growth\",\n  name: \"Growth Engine\",\n  description: \"Optimized for content generation. Creative, consistent, cost-effective.\",\n  icon: \"Megaphone\",\n  tags: [\"content\", \"marketing\", \"social\"],\n  config: {\n    provider: \"anthropic\",\n    model: \"claude-sonnet-4-20250514\",\n    effort: \"medium\",\n    temperature: 0.8, // Higher for creativity\n    maxTokens: 4096,\n    batchProcessing: {\n      enabled: true,\n      maxBatchSize: 10,\n      maxWaitMs: 10000,\n    },\n    budget: {\n      enabled: true,\n      dailyLimitUSD: 5,\n      monthlyLimitUSD: 50,\n      alertThreshold: 0.9,\n      pauseOnLimit: true,\n    },\n  },\n  estimatedSavings: \"~60% with batching\",\n  bestFor: [\"Blog posts\", \"Tweets\", \"SEO content\", \"Discord messages\"],\n};\n\nexport const PRESET_AUTONOMY: BrainPreset = {\n  id: \"autonomy\",\n  name: \"Autonomy Engine\",\n  description: \"Optimized for autonomous operations. Careful reasoning, bounded actions.\",\n  icon: \"Shield\",\n  tags: [\"autonomy\", \"safety\", \"oversight\"],\n  config: {\n    provider: \"anthropic\",\n    model: \"claude-sonnet-4-20250514\",\n    effort: \"medium\",\n    temperature: 0.3, // Low for predictability\n    maxTokens: 4096,\n    extendedThinking: {\n      enabled: true,\n      budgetTokens: 8000,\n      preserveHistory: true,\n    },\n    memory: {\n      enabled: true,\n      provider: \"local\",\n      maxEntries: 1000,\n      ttlSeconds: 86400,\n      autoSummarize: true,\n    },\n  },\n  estimatedSavings: \"~45% vs unoptimized\",\n  bestFor: [\"Risk classification\", \"Boundary checking\", \"Decision routing\", \"Audit logging\"],\n};\n\n// =============================================================================\n// SPECIAL PRESETS\n// =============================================================================\n\nexport const PRESET_DEEP_RESEARCH: BrainPreset = {\n  id: \"deep-research\",\n  name: \"Deep Research\",\n  description: \"Maximum context for research. 1M token context window.\",\n  icon: \"BookOpen\",\n  tags: [\"research\", \"analysis\", \"long-context\"],\n  config: {\n    provider: \"anthropic\",\n    model: \"claude-sonnet-4-20250514\", // 1M context available\n    effort: \"high\",\n    temperature: 0.5,\n    maxTokens: 16384,\n    context: {\n      maxContextTokens: 1000000, // 1M tokens!\n      warningThreshold: 0.9,\n      autoTruncate: false,\n      truncationStrategy: \"summary\",\n      preserveSystemPrompt: true,\n    },\n    memory: {\n      enabled: true,\n      provider: \"local\",\n      maxEntries: 5000,\n      ttlSeconds: 604800, // 1 week\n      autoSummarize: true,\n    },\n  },\n  estimatedSavings: \"Context-heavy, quality-focused\",\n  bestFor: [\"Codebase analysis\", \"Documentation review\", \"Audit reports\", \"Trend research\"],\n};\n\nexport const PRESET_ULTRA_SAVER: BrainPreset = {\n  id: \"ultra-saver\",\n  name: \"Ultra Saver\",\n  description: \"Maximum cost savings. For high-volume, low-complexity tasks.\",\n  icon: \"PiggyBank\",\n  tags: [\"budget\", \"high-volume\", \"cost\"],\n  config: {\n    provider: \"gemini\",\n    model: \"gemini-2.0-flash\",\n    effort: \"low\",\n    temperature: 0.3,\n    maxTokens: 1024,\n    batchProcessing: {\n      enabled: true,\n      maxBatchSize: 50,\n      maxWaitMs: 10000,\n    },\n    budget: {\n      enabled: true,\n      dailyLimitUSD: 1,\n      monthlyLimitUSD: 10,\n      alertThreshold: 0.7,\n      pauseOnLimit: true,\n    },\n  },\n  estimatedSavings: \"~95% vs Opus high\",\n  bestFor: [\"Data extraction\", \"Simple formatting\", \"Bulk processing\", \"Validation\"],\n};\n\n// =============================================================================\n// ALL PRESETS\n// =============================================================================\n\nexport const ALL_PRESETS: BrainPreset[] = [\n  // Efficiency\n  PRESET_TURBO,\n  PRESET_BALANCED,\n  PRESET_POWERHOUSE,\n  // Use cases\n  PRESET_TRADING,\n  PRESET_HUNTER,\n  PRESET_BUILDER,\n  PRESET_GROWTH,\n  PRESET_AUTONOMY,\n  // Special\n  PRESET_DEEP_RESEARCH,\n  PRESET_ULTRA_SAVER,\n];\n\nexport const PRESETS_BY_ID: Record<string, BrainPreset> = Object.fromEntries(\n  ALL_PRESETS.map((p) => [p.id, p])\n);\n\n// =============================================================================\n// HELPER FUNCTIONS\n// =============================================================================\n\nexport function getPresetById(id: string): BrainPreset | undefined {\n  return PRESETS_BY_ID[id];\n}\n\nexport function getPresetsByTag(tag: string): BrainPreset[] {\n  return ALL_PRESETS.filter((p) => p.tags.includes(tag));\n}\n\nexport function getRecommendedPreset(useCase: string): BrainPreset {\n  const lowerCase = useCase.toLowerCase();\n\n  if (lowerCase.includes(\"trad\") || lowerCase.includes(\"defi\")) return PRESET_TRADING;\n  if (lowerCase.includes(\"hunt\") || lowerCase.includes(\"discover\")) return PRESET_HUNTER;\n  if (lowerCase.includes(\"build\") || lowerCase.includes(\"code\")) return PRESET_BUILDER;\n  if (lowerCase.includes(\"growth\") || lowerCase.includes(\"content\")) return PRESET_GROWTH;\n  if (lowerCase.includes(\"research\") || lowerCase.includes(\"analyz\")) return PRESET_DEEP_RESEARCH;\n  if (lowerCase.includes(\"budget\") || lowerCase.includes(\"cheap\")) return PRESET_ULTRA_SAVER;\n  if (lowerCase.includes(\"fast\") || lowerCase.includes(\"quick\")) return PRESET_TURBO;\n  if (lowerCase.includes(\"complex\") || lowerCase.includes(\"reason\")) return PRESET_POWERHOUSE;\n\n  return PRESET_BALANCED;\n}\n\nexport function createCustomPreset(\n  base: BrainPreset,\n  overrides: Partial<BrainConfig>,\n  meta: { name: string; description: string }\n): BrainPreset {\n  return {\n    ...base,\n    id: `custom-${Date.now()}`,\n    name: meta.name,\n    description: meta.description,\n    tags: [...base.tags, \"custom\"],\n    config: { ...base.config, ...overrides },\n  };\n}\n","/**\n * gICM Brain Manager\n * Central management for AI configuration, metrics tracking, and cost optimization\n */\n\nimport { EventEmitter } from \"eventemitter3\";\nimport {\n  type BrainConfig,\n  type UsageMetrics,\n  type AggregatedMetrics,\n  type EffortLevel,\n  BrainConfigSchema,\n  MODEL_PRICING,\n  EFFORT_TOKEN_MULTIPLIER,\n} from \"./types.js\";\nimport { PRESET_BALANCED, getPresetById, type BrainPreset } from \"./presets.js\";\n\n// =============================================================================\n// EVENTS\n// =============================================================================\n\nexport interface BrainManagerEvents {\n  \"config:updated\": (config: BrainConfig) => void;\n  \"config:preset-applied\": (preset: BrainPreset) => void;\n  \"usage:recorded\": (metrics: UsageMetrics) => void;\n  \"budget:warning\": (used: number, limit: number, type: \"daily\" | \"monthly\") => void;\n  \"budget:exceeded\": (used: number, limit: number, type: \"daily\" | \"monthly\") => void;\n  \"context:warning\": (used: number, max: number) => void;\n  \"error\": (error: Error) => void;\n}\n\n// =============================================================================\n// BRAIN MANAGER\n// =============================================================================\n\nexport class BrainManager extends EventEmitter<BrainManagerEvents> {\n  private config: BrainConfig;\n  private usageHistory: UsageMetrics[] = [];\n  private dailyUsageUSD = 0;\n  private monthlyUsageUSD = 0;\n  private lastDayReset: Date;\n  private lastMonthReset: Date;\n\n  constructor(initialConfig?: Partial<BrainConfig>) {\n    super();\n    this.config = BrainConfigSchema.parse({\n      ...PRESET_BALANCED.config,\n      ...initialConfig,\n    });\n    this.lastDayReset = new Date();\n    this.lastMonthReset = new Date();\n  }\n\n  // ===========================================================================\n  // CONFIG MANAGEMENT\n  // ===========================================================================\n\n  getConfig(): BrainConfig {\n    return { ...this.config };\n  }\n\n  updateConfig(updates: Partial<BrainConfig>): BrainConfig {\n    this.config = BrainConfigSchema.parse({ ...this.config, ...updates });\n    this.emit(\"config:updated\", this.config);\n    return this.config;\n  }\n\n  applyPreset(presetId: string): BrainConfig {\n    const preset = getPresetById(presetId);\n    if (!preset) {\n      throw new Error(`Unknown preset: ${presetId}`);\n    }\n    this.config = BrainConfigSchema.parse({ ...this.config, ...preset.config });\n    this.emit(\"config:preset-applied\", preset);\n    this.emit(\"config:updated\", this.config);\n    return this.config;\n  }\n\n  // ===========================================================================\n  // USAGE TRACKING\n  // ===========================================================================\n\n  recordUsage(metrics: Omit<UsageMetrics, \"costUSD\" | \"tokensSaved\" | \"costSavedUSD\">): UsageMetrics {\n    this.resetBudgetsIfNeeded();\n\n    const pricing = MODEL_PRICING[metrics.model] ?? { inputPer1M: 5, outputPer1M: 25 };\n    const inputCost = (metrics.inputTokens / 1_000_000) * pricing.inputPer1M;\n    const outputCost = (metrics.outputTokens / 1_000_000) * pricing.outputPer1M;\n    const cachedCost = metrics.cachedInputTokens\n      ? (metrics.cachedInputTokens / 1_000_000) * (pricing.cachedInputPer1M ?? pricing.inputPer1M * 0.1)\n      : 0;\n    const thinkingCost = metrics.thinkingTokens\n      ? (metrics.thinkingTokens / 1_000_000) * pricing.outputPer1M\n      : 0;\n\n    const costUSD = inputCost + outputCost + cachedCost + thinkingCost;\n\n    // Calculate savings vs high effort\n    const highEffortMultiplier = EFFORT_TOKEN_MULTIPLIER.high;\n    const actualMultiplier = EFFORT_TOKEN_MULTIPLIER[metrics.effort];\n    const potentialTokens = (metrics.inputTokens + metrics.outputTokens) * (highEffortMultiplier / actualMultiplier);\n    const tokensSaved = Math.max(0, potentialTokens - (metrics.inputTokens + metrics.outputTokens));\n    const costSavedUSD = (tokensSaved / 1_000_000) * ((pricing.inputPer1M + pricing.outputPer1M) / 2);\n\n    const fullMetrics: UsageMetrics = {\n      ...metrics,\n      costUSD,\n      tokensSaved,\n      costSavedUSD,\n    };\n\n    this.usageHistory.push(fullMetrics);\n    this.dailyUsageUSD += costUSD;\n    this.monthlyUsageUSD += costUSD;\n\n    this.emit(\"usage:recorded\", fullMetrics);\n    this.checkBudgetLimits();\n\n    return fullMetrics;\n  }\n\n  private resetBudgetsIfNeeded(): void {\n    const now = new Date();\n\n    // Reset daily\n    if (now.toDateString() !== this.lastDayReset.toDateString()) {\n      this.dailyUsageUSD = 0;\n      this.lastDayReset = now;\n    }\n\n    // Reset monthly\n    if (now.getMonth() !== this.lastMonthReset.getMonth()) {\n      this.monthlyUsageUSD = 0;\n      this.lastMonthReset = now;\n    }\n  }\n\n  private checkBudgetLimits(): void {\n    const budget = this.config.budget;\n    if (!budget?.enabled) return;\n\n    // Daily check\n    const dailyThreshold = budget.dailyLimitUSD * budget.alertThreshold;\n    if (this.dailyUsageUSD >= budget.dailyLimitUSD) {\n      this.emit(\"budget:exceeded\", this.dailyUsageUSD, budget.dailyLimitUSD, \"daily\");\n    } else if (this.dailyUsageUSD >= dailyThreshold) {\n      this.emit(\"budget:warning\", this.dailyUsageUSD, budget.dailyLimitUSD, \"daily\");\n    }\n\n    // Monthly check\n    const monthlyThreshold = budget.monthlyLimitUSD * budget.alertThreshold;\n    if (this.monthlyUsageUSD >= budget.monthlyLimitUSD) {\n      this.emit(\"budget:exceeded\", this.monthlyUsageUSD, budget.monthlyLimitUSD, \"monthly\");\n    } else if (this.monthlyUsageUSD >= monthlyThreshold) {\n      this.emit(\"budget:warning\", this.monthlyUsageUSD, budget.monthlyLimitUSD, \"monthly\");\n    }\n  }\n\n  // ===========================================================================\n  // METRICS & ANALYTICS\n  // ===========================================================================\n\n  getUsageMetrics(): UsageMetrics[] {\n    return [...this.usageHistory];\n  }\n\n  getAggregatedMetrics(period: \"day\" | \"week\" | \"month\"): AggregatedMetrics {\n    const now = new Date();\n    const startDate = new Date(now);\n\n    switch (period) {\n      case \"day\":\n        startDate.setHours(0, 0, 0, 0);\n        break;\n      case \"week\":\n        startDate.setDate(now.getDate() - 7);\n        break;\n      case \"month\":\n        startDate.setMonth(now.getMonth() - 1);\n        break;\n    }\n\n    const filtered = this.usageHistory.filter((m) => m.timestamp >= startDate);\n\n    const byModel: Record<string, { requests: number; tokens: number; costUSD: number }> = {};\n    const byEffort: Record<EffortLevel, { requests: number; tokens: number; costUSD: number }> = {\n      low: { requests: 0, tokens: 0, costUSD: 0 },\n      medium: { requests: 0, tokens: 0, costUSD: 0 },\n      high: { requests: 0, tokens: 0, costUSD: 0 },\n    };\n\n    let totalLatency = 0;\n    let totalTokensSaved = 0;\n    let totalCostSavedUSD = 0;\n\n    for (const m of filtered) {\n      const tokens = m.inputTokens + m.outputTokens + (m.thinkingTokens ?? 0);\n\n      // By model\n      if (!byModel[m.model]) {\n        byModel[m.model] = { requests: 0, tokens: 0, costUSD: 0 };\n      }\n      byModel[m.model].requests++;\n      byModel[m.model].tokens += tokens;\n      byModel[m.model].costUSD += m.costUSD;\n\n      // By effort\n      byEffort[m.effort].requests++;\n      byEffort[m.effort].tokens += tokens;\n      byEffort[m.effort].costUSD += m.costUSD;\n\n      // Totals\n      totalLatency += m.latencyMs;\n      totalTokensSaved += m.tokensSaved ?? 0;\n      totalCostSavedUSD += m.costSavedUSD ?? 0;\n    }\n\n    const totalTokens = filtered.reduce(\n      (sum, m) => sum + m.inputTokens + m.outputTokens + (m.thinkingTokens ?? 0),\n      0\n    );\n\n    return {\n      period,\n      startDate,\n      endDate: now,\n      totalRequests: filtered.length,\n      totalInputTokens: filtered.reduce((sum, m) => sum + m.inputTokens, 0),\n      totalOutputTokens: filtered.reduce((sum, m) => sum + m.outputTokens, 0),\n      totalCostUSD: filtered.reduce((sum, m) => sum + m.costUSD, 0),\n      totalTokensSaved,\n      totalCostSavedUSD,\n      avgLatencyMs: filtered.length > 0 ? totalLatency / filtered.length : 0,\n      avgTokensPerRequest: filtered.length > 0 ? totalTokens / filtered.length : 0,\n      byModel,\n      byEffort,\n    };\n  }\n\n  getCurrentBudgetStatus(): {\n    daily: { used: number; limit: number; percent: number };\n    monthly: { used: number; limit: number; percent: number };\n  } {\n    this.resetBudgetsIfNeeded();\n    const budget = this.config.budget ?? { dailyLimitUSD: 10, monthlyLimitUSD: 100 };\n\n    return {\n      daily: {\n        used: this.dailyUsageUSD,\n        limit: budget.dailyLimitUSD,\n        percent: (this.dailyUsageUSD / budget.dailyLimitUSD) * 100,\n      },\n      monthly: {\n        used: this.monthlyUsageUSD,\n        limit: budget.monthlyLimitUSD,\n        percent: (this.monthlyUsageUSD / budget.monthlyLimitUSD) * 100,\n      },\n    };\n  }\n\n  // ===========================================================================\n  // COST ESTIMATION\n  // ===========================================================================\n\n  estimateCost(\n    inputTokens: number,\n    outputTokens: number,\n    model?: string,\n    options?: { thinking?: number; cached?: number }\n  ): number {\n    const modelId = model ?? this.config.model;\n    const pricing = MODEL_PRICING[modelId] ?? { inputPer1M: 5, outputPer1M: 25 };\n\n    let cost = 0;\n    cost += (inputTokens / 1_000_000) * pricing.inputPer1M;\n    cost += (outputTokens / 1_000_000) * pricing.outputPer1M;\n\n    if (options?.thinking) {\n      cost += (options.thinking / 1_000_000) * pricing.outputPer1M;\n    }\n    if (options?.cached && pricing.cachedInputPer1M) {\n      cost += (options.cached / 1_000_000) * pricing.cachedInputPer1M;\n    }\n\n    return cost;\n  }\n\n  estimateSavings(\n    inputTokens: number,\n    outputTokens: number,\n    fromEffort: EffortLevel,\n    toEffort: EffortLevel,\n    model?: string\n  ): { tokensSaved: number; costSavedUSD: number; percentSaved: number } {\n    const fromMultiplier = EFFORT_TOKEN_MULTIPLIER[fromEffort];\n    const toMultiplier = EFFORT_TOKEN_MULTIPLIER[toEffort];\n\n    const originalTokens = inputTokens + outputTokens;\n    const newTokens = originalTokens * (toMultiplier / fromMultiplier);\n    const tokensSaved = Math.max(0, originalTokens - newTokens);\n\n    const modelId = model ?? this.config.model;\n    const pricing = MODEL_PRICING[modelId] ?? { inputPer1M: 5, outputPer1M: 25 };\n    const avgPricePer1M = (pricing.inputPer1M + pricing.outputPer1M) / 2;\n    const costSavedUSD = (tokensSaved / 1_000_000) * avgPricePer1M;\n\n    const percentSaved = originalTokens > 0 ? (tokensSaved / originalTokens) * 100 : 0;\n\n    return { tokensSaved, costSavedUSD, percentSaved };\n  }\n\n  // ===========================================================================\n  // SERIALIZATION\n  // ===========================================================================\n\n  toJSON(): {\n    config: BrainConfig;\n    budgetStatus: ReturnType<BrainManager[\"getCurrentBudgetStatus\"]>;\n    recentMetrics: AggregatedMetrics;\n  } {\n    return {\n      config: this.config,\n      budgetStatus: this.getCurrentBudgetStatus(),\n      recentMetrics: this.getAggregatedMetrics(\"day\"),\n    };\n  }\n\n  static fromJSON(data: { config: BrainConfig }): BrainManager {\n    return new BrainManager(data.config);\n  }\n}\n\n// =============================================================================\n// SINGLETON INSTANCE\n// =============================================================================\n\nlet defaultManager: BrainManager | null = null;\n\nexport function getDefaultBrainManager(): BrainManager {\n  if (!defaultManager) {\n    defaultManager = new BrainManager();\n  }\n  return defaultManager;\n}\n\nexport function setDefaultBrainManager(manager: BrainManager): void {\n  defaultManager = manager;\n}\n"],"mappings":"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","names":[]}