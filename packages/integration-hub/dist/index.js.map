{"version":3,"sources":["../src/scheduler/schedule-manager.ts","../src/scheduler/types.ts","../src/cache/types.ts","../src/cache/cache-manager.ts","../src/cache/middleware.ts","../src/plugins/types.ts","../src/plugins/plugin-manager.ts","../src/recycling/index.ts","../src/sdk/types.ts","../src/sdk/client.ts","../src/performance/types.ts","../src/performance/performance-manager.ts","../src/intelligence/types.ts","../src/intelligence/suggestion-engine.ts","../src/intelligence/anomaly-detector.ts","../src/intelligence/nl-builder.ts","../src/intelligence/predictive-analytics.ts","../src/reliability/types.ts","../src/reliability/circuit-breaker.ts","../src/reliability/retry-strategy.ts","../src/reliability/timeout-manager.ts","../src/reliability/health-aggregator.ts","../src/secrets/types.ts","../src/secrets/secrets-manager.ts","../src/ratelimit/types.ts","../src/ratelimit/rate-limiter.ts","../src/apiauth/types.ts","../src/apiauth/auth-manager.ts","../src/security/types.ts","../src/security/security-headers.ts","../src/telemetry/types.ts","../src/telemetry/tracer.ts","../src/logging/types.ts","../src/logging/log-aggregator.ts","../src/metrics/types.ts","../src/metrics/metrics-registry.ts","../src/slo/types.ts","../src/slo/slo-manager.ts","../src/flags/types.ts","../src/flags/feature-flags.ts","../src/config/types.ts","../src/config/config-manager.ts","../src/multiregion/types.ts","../src/multiregion/region-manager.ts","../src/deployment/types.ts","../src/deployment/deployment-manager.ts","../src/llm/types.ts","../src/llm/cost-tracker.ts","../src/analytics/types.ts","../src/analytics/token-analytics.ts","../src/prompts/types.ts","../src/prompts/prompt-manager.ts","../src/evaluation/types.ts","../src/evaluation/model-evaluator.ts"],"sourcesContent":["/**\n * Pipeline Schedule Manager\n *\n * Manages cron-based pipeline scheduling with node-cron and Bull integration.\n * Supports timezones, retries, and real-time schedule updates.\n */\n\nimport { EventEmitter } from \"eventemitter3\";\nimport { randomUUID } from \"crypto\";\nimport {\n  type Schedule,\n  type ScheduleConfig,\n  type ScheduledRun,\n  type ScheduleExecution,\n  type ScheduleStats,\n  type SchedulerEvents,\n  ScheduleConfigSchema,\n} from \"./types.js\";\n\n// =========================================================================\n// CRON UTILITIES\n// =========================================================================\n\n/**\n * Parse cron expression into next run date\n */\nfunction getNextRunDate(cronExpression: string, timezone: string, after: Date = new Date()): Date {\n  // Simple cron parser - for production use node-cron or cronstrue\n  const parts = cronExpression.split(\" \");\n  if (parts.length !== 5) {\n    throw new Error(\"Invalid cron expression\");\n  }\n\n  const [minute, hour, dayOfMonth, month, dayOfWeek] = parts;\n  const next = new Date(after);\n  next.setSeconds(0);\n  next.setMilliseconds(0);\n\n  // Add 1 minute to ensure we get the next occurrence\n  next.setMinutes(next.getMinutes() + 1);\n\n  // Simple logic for common patterns\n  if (minute === \"*\" && hour === \"*\") {\n    // Every minute - next minute\n    return next;\n  }\n\n  if (minute.startsWith(\"*/\")) {\n    const interval = parseInt(minute.slice(2));\n    const currentMinute = next.getMinutes();\n    const nextMinute = Math.ceil(currentMinute / interval) * interval;\n    if (nextMinute >= 60) {\n      next.setHours(next.getHours() + 1);\n      next.setMinutes(nextMinute % 60);\n    } else {\n      next.setMinutes(nextMinute);\n    }\n    return next;\n  }\n\n  if (minute !== \"*\" && hour !== \"*\") {\n    // Specific time - set to that time\n    const targetMinute = parseInt(minute);\n    const targetHour = parseInt(hour);\n    next.setMinutes(targetMinute);\n    next.setHours(targetHour);\n    if (next <= after) {\n      next.setDate(next.getDate() + 1);\n    }\n    return next;\n  }\n\n  if (minute !== \"*\" && hour === \"*\") {\n    // Every hour at specific minute\n    const targetMinute = parseInt(minute);\n    next.setMinutes(targetMinute);\n    if (next <= after) {\n      next.setHours(next.getHours() + 1);\n    }\n    return next;\n  }\n\n  // Default: next minute\n  return next;\n}\n\n/**\n * Convert cron expression to human-readable string\n */\nexport function cronToHuman(cronExpression: string): string {\n  const parts = cronExpression.split(\" \");\n  if (parts.length !== 5) return cronExpression;\n\n  const [minute, hour, dayOfMonth, month, dayOfWeek] = parts;\n\n  // Every minute\n  if (minute === \"*\" && hour === \"*\" && dayOfMonth === \"*\" && month === \"*\" && dayOfWeek === \"*\") {\n    return \"Every minute\";\n  }\n\n  // Every N minutes\n  if (minute.startsWith(\"*/\") && hour === \"*\") {\n    return `Every ${minute.slice(2)} minutes`;\n  }\n\n  // Hourly\n  if (minute !== \"*\" && hour === \"*\" && dayOfMonth === \"*\") {\n    return `Every hour at :${minute.padStart(2, \"0\")}`;\n  }\n\n  // Daily\n  if (minute !== \"*\" && hour !== \"*\" && dayOfMonth === \"*\" && month === \"*\" && dayOfWeek === \"*\") {\n    return `Daily at ${hour.padStart(2, \"0\")}:${minute.padStart(2, \"0\")}`;\n  }\n\n  // Weekly\n  if (dayOfWeek !== \"*\" && dayOfMonth === \"*\") {\n    const days = [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"];\n    const dayName = days[parseInt(dayOfWeek)] || dayOfWeek;\n    return `Weekly on ${dayName} at ${hour.padStart(2, \"0\")}:${minute.padStart(2, \"0\")}`;\n  }\n\n  // Monthly\n  if (dayOfMonth !== \"*\" && month === \"*\") {\n    return `Monthly on day ${dayOfMonth} at ${hour.padStart(2, \"0\")}:${minute.padStart(2, \"0\")}`;\n  }\n\n  return cronExpression;\n}\n\n// =========================================================================\n// SCHEDULE MANAGER\n// =========================================================================\n\nexport interface ScheduleManagerConfig {\n  /** Check interval in ms (default: 60000 = 1 minute) */\n  checkInterval?: number;\n  /** Max concurrent scheduled runs (default: 10) */\n  maxConcurrent?: number;\n  /** Auto-disable after N consecutive failures (default: 5) */\n  autoDisableAfterFailures?: number;\n  /** Pipeline executor function */\n  executor?: (schedule: Schedule) => Promise<{ executionId: string; result: unknown }>;\n}\n\nexport class ScheduleManager extends EventEmitter<SchedulerEvents> {\n  private schedules: Map<string, Schedule> = new Map();\n  private executions: Map<string, ScheduleExecution> = new Map();\n  private runningExecutions: Set<string> = new Set();\n  private checkTimer: NodeJS.Timeout | null = null;\n  private isRunning = false;\n  private config: Required<ScheduleManagerConfig>;\n\n  constructor(config: ScheduleManagerConfig = {}) {\n    super();\n    this.config = {\n      checkInterval: config.checkInterval || 60000,\n      maxConcurrent: config.maxConcurrent || 10,\n      autoDisableAfterFailures: config.autoDisableAfterFailures || 5,\n      executor: config.executor || (async () => ({ executionId: \"\", result: null })),\n    };\n  }\n\n  /**\n   * Start the scheduler\n   */\n  async start(): Promise<void> {\n    if (this.isRunning) return;\n\n    this.isRunning = true;\n    console.log(\"[Scheduler] Starting schedule manager...\");\n\n    // Initial check\n    await this.checkSchedules();\n\n    // Start periodic check\n    this.checkTimer = setInterval(() => {\n      this.checkSchedules().catch((err) => {\n        console.error(\"[Scheduler] Check error:\", err);\n        this.emit(\"error\", err);\n      });\n    }, this.config.checkInterval);\n\n    console.log(\"[Scheduler] Schedule manager started\");\n  }\n\n  /**\n   * Stop the scheduler\n   */\n  async stop(): Promise<void> {\n    this.isRunning = false;\n\n    if (this.checkTimer) {\n      clearInterval(this.checkTimer);\n      this.checkTimer = null;\n    }\n\n    console.log(\"[Scheduler] Schedule manager stopped\");\n  }\n\n  /**\n   * Create a new schedule\n   */\n  async createSchedule(config: ScheduleConfig): Promise<Schedule> {\n    // Validate config\n    const validated = ScheduleConfigSchema.parse(config);\n\n    const schedule: Schedule = {\n      ...validated,\n      id: randomUUID(),\n      status: validated.enabled ? \"active\" : \"disabled\",\n      nextRun: validated.enabled ? getNextRunDate(validated.cronExpression, validated.timezone) : null,\n      lastRun: null,\n      lastStatus: null,\n      runCount: 0,\n      consecutiveFailures: 0,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    };\n\n    this.schedules.set(schedule.id, schedule);\n    this.emit(\"schedule:created\", schedule);\n\n    console.log(`[Scheduler] Created schedule: ${schedule.name} (${schedule.id})`);\n    return schedule;\n  }\n\n  /**\n   * Update an existing schedule\n   */\n  async updateSchedule(id: string, updates: Partial<ScheduleConfig>): Promise<Schedule> {\n    const existing = this.schedules.get(id);\n    if (!existing) {\n      throw new Error(`Schedule not found: ${id}`);\n    }\n\n    const updated: Schedule = {\n      ...existing,\n      ...updates,\n      id: existing.id,\n      updatedAt: new Date(),\n    };\n\n    // Recalculate next run if cron or enabled changed\n    if (updates.cronExpression || updates.enabled !== undefined || updates.timezone) {\n      updated.nextRun =\n        updated.enabled && updated.status === \"active\"\n          ? getNextRunDate(updated.cronExpression, updated.timezone)\n          : null;\n    }\n\n    this.schedules.set(id, updated);\n    this.emit(\"schedule:updated\", updated);\n\n    return updated;\n  }\n\n  /**\n   * Delete a schedule\n   */\n  async deleteSchedule(id: string): Promise<boolean> {\n    const schedule = this.schedules.get(id);\n    if (!schedule) return false;\n\n    this.schedules.delete(id);\n    this.emit(\"schedule:deleted\", id);\n\n    console.log(`[Scheduler] Deleted schedule: ${schedule.name} (${id})`);\n    return true;\n  }\n\n  /**\n   * Get a schedule by ID\n   */\n  getSchedule(id: string): Schedule | undefined {\n    return this.schedules.get(id);\n  }\n\n  /**\n   * Get all schedules\n   */\n  getAllSchedules(): Schedule[] {\n    return Array.from(this.schedules.values());\n  }\n\n  /**\n   * Get schedules by pipeline ID\n   */\n  getSchedulesByPipeline(pipelineId: string): Schedule[] {\n    return this.getAllSchedules().filter((s) => s.pipelineId === pipelineId);\n  }\n\n  /**\n   * Enable a schedule\n   */\n  async enableSchedule(id: string): Promise<Schedule> {\n    const schedule = this.schedules.get(id);\n    if (!schedule) {\n      throw new Error(`Schedule not found: ${id}`);\n    }\n\n    schedule.enabled = true;\n    schedule.status = \"active\";\n    schedule.nextRun = getNextRunDate(schedule.cronExpression, schedule.timezone);\n    schedule.consecutiveFailures = 0;\n    schedule.updatedAt = new Date();\n\n    this.emit(\"schedule:enabled\", schedule);\n    return schedule;\n  }\n\n  /**\n   * Disable a schedule\n   */\n  async disableSchedule(id: string): Promise<Schedule> {\n    const schedule = this.schedules.get(id);\n    if (!schedule) {\n      throw new Error(`Schedule not found: ${id}`);\n    }\n\n    schedule.enabled = false;\n    schedule.status = \"disabled\";\n    schedule.nextRun = null;\n    schedule.updatedAt = new Date();\n\n    this.emit(\"schedule:disabled\", schedule);\n    return schedule;\n  }\n\n  /**\n   * Pause a schedule (temporary)\n   */\n  async pauseSchedule(id: string): Promise<Schedule> {\n    const schedule = this.schedules.get(id);\n    if (!schedule) {\n      throw new Error(`Schedule not found: ${id}`);\n    }\n\n    schedule.status = \"paused\";\n    schedule.updatedAt = new Date();\n\n    this.emit(\"schedule:paused\", schedule);\n    return schedule;\n  }\n\n  /**\n   * Resume a paused schedule\n   */\n  async resumeSchedule(id: string): Promise<Schedule> {\n    const schedule = this.schedules.get(id);\n    if (!schedule) {\n      throw new Error(`Schedule not found: ${id}`);\n    }\n\n    schedule.status = \"active\";\n    schedule.nextRun = getNextRunDate(schedule.cronExpression, schedule.timezone);\n    schedule.updatedAt = new Date();\n\n    this.emit(\"schedule:resumed\", schedule);\n    return schedule;\n  }\n\n  /**\n   * Trigger a schedule manually (run now)\n   */\n  async triggerSchedule(id: string): Promise<ScheduleExecution> {\n    const schedule = this.schedules.get(id);\n    if (!schedule) {\n      throw new Error(`Schedule not found: ${id}`);\n    }\n\n    return this.executeSchedule(schedule);\n  }\n\n  /**\n   * Get upcoming scheduled runs\n   */\n  getNextRuns(limit = 10): ScheduledRun[] {\n    const runs: ScheduledRun[] = [];\n\n    for (const schedule of this.schedules.values()) {\n      if (schedule.status === \"active\" && schedule.enabled && schedule.nextRun) {\n        runs.push({\n          scheduleId: schedule.id,\n          scheduleName: schedule.name,\n          pipelineId: schedule.pipelineId,\n          pipelineName: schedule.pipelineName,\n          scheduledTime: schedule.nextRun,\n          cronExpression: schedule.cronExpression,\n          timezone: schedule.timezone,\n          inputs: schedule.inputs,\n        });\n      }\n    }\n\n    return runs\n      .sort((a, b) => a.scheduledTime.getTime() - b.scheduledTime.getTime())\n      .slice(0, limit);\n  }\n\n  /**\n   * Get execution history for a schedule\n   */\n  getExecutions(scheduleId: string, limit = 20): ScheduleExecution[] {\n    return Array.from(this.executions.values())\n      .filter((e) => e.scheduleId === scheduleId)\n      .sort((a, b) => b.scheduledAt.getTime() - a.scheduledAt.getTime())\n      .slice(0, limit);\n  }\n\n  /**\n   * Get scheduler statistics\n   */\n  getStats(): ScheduleStats {\n    const schedules = this.getAllSchedules();\n    const executions = Array.from(this.executions.values());\n\n    const activeSchedules = schedules.filter((s) => s.status === \"active\" && s.enabled).length;\n    const pausedSchedules = schedules.filter((s) => s.status === \"paused\").length;\n\n    const completedExecutions = executions.filter((e) => e.status === \"completed\");\n    const failedExecutions = executions.filter((e) => e.status === \"failed\");\n\n    const totalRuns = completedExecutions.length + failedExecutions.length;\n    const successRate = totalRuns > 0 ? (completedExecutions.length / totalRuns) * 100 : 0;\n\n    const durations = completedExecutions\n      .filter((e) => e.startedAt && e.completedAt)\n      .map((e) => e.completedAt!.getTime() - e.startedAt!.getTime());\n\n    const avgDurationMs =\n      durations.length > 0 ? durations.reduce((a, b) => a + b, 0) / durations.length : 0;\n\n    return {\n      totalSchedules: schedules.length,\n      activeSchedules,\n      pausedSchedules,\n      totalRuns,\n      successfulRuns: completedExecutions.length,\n      failedRuns: failedExecutions.length,\n      successRate: Math.round(successRate * 100) / 100,\n      avgDurationMs: Math.round(avgDurationMs),\n      nextScheduledRuns: this.getNextRuns(5),\n    };\n  }\n\n  // =========================================================================\n  // PRIVATE METHODS\n  // =========================================================================\n\n  private async checkSchedules(): Promise<void> {\n    const now = new Date();\n\n    for (const schedule of this.schedules.values()) {\n      // Skip if not active or already running\n      if (schedule.status !== \"active\" || !schedule.enabled || !schedule.nextRun) {\n        continue;\n      }\n\n      // Skip if already at max concurrent\n      if (this.runningExecutions.size >= this.config.maxConcurrent) {\n        continue;\n      }\n\n      // Check if it's time to run\n      if (schedule.nextRun <= now) {\n        // Execute in background\n        this.executeSchedule(schedule).catch((err) => {\n          console.error(`[Scheduler] Execution error for ${schedule.name}:`, err);\n        });\n\n        // Calculate next run\n        schedule.nextRun = getNextRunDate(schedule.cronExpression, schedule.timezone, now);\n        schedule.updatedAt = new Date();\n      }\n    }\n  }\n\n  private async executeSchedule(schedule: Schedule): Promise<ScheduleExecution> {\n    const executionId = randomUUID();\n\n    const execution: ScheduleExecution = {\n      id: executionId,\n      scheduleId: schedule.id,\n      pipelineId: schedule.pipelineId,\n      executionId: null,\n      status: \"pending\",\n      scheduledAt: new Date(),\n      startedAt: null,\n      completedAt: null,\n      error: null,\n      attempt: 1,\n      result: null,\n    };\n\n    this.executions.set(executionId, execution);\n    this.runningExecutions.add(executionId);\n\n    this.emit(\"run:scheduled\", {\n      scheduleId: schedule.id,\n      scheduleName: schedule.name,\n      pipelineId: schedule.pipelineId,\n      pipelineName: schedule.pipelineName,\n      scheduledTime: execution.scheduledAt,\n      cronExpression: schedule.cronExpression,\n      timezone: schedule.timezone,\n      inputs: schedule.inputs,\n    });\n\n    try {\n      execution.status = \"running\";\n      execution.startedAt = new Date();\n      this.emit(\"run:started\", execution);\n\n      // Execute the pipeline\n      const result = await this.config.executor(schedule);\n      execution.executionId = result.executionId;\n      execution.result = result.result;\n\n      // Success\n      execution.status = \"completed\";\n      execution.completedAt = new Date();\n\n      schedule.lastRun = execution.completedAt;\n      schedule.lastStatus = \"completed\";\n      schedule.runCount++;\n      schedule.consecutiveFailures = 0;\n\n      this.emit(\"run:completed\", execution);\n      console.log(`[Scheduler] Completed: ${schedule.name} (execution: ${result.executionId})`);\n    } catch (error) {\n      // Failure\n      execution.status = \"failed\";\n      execution.completedAt = new Date();\n      execution.error = error instanceof Error ? error.message : String(error);\n\n      schedule.lastRun = execution.completedAt;\n      schedule.lastStatus = \"failed\";\n      schedule.runCount++;\n      schedule.consecutiveFailures++;\n\n      this.emit(\"run:failed\", execution, error instanceof Error ? error : new Error(String(error)));\n      console.error(`[Scheduler] Failed: ${schedule.name}:`, error);\n\n      // Auto-disable if too many consecutive failures\n      if (schedule.consecutiveFailures >= this.config.autoDisableAfterFailures) {\n        schedule.status = \"error\";\n        schedule.enabled = false;\n        console.warn(`[Scheduler] Auto-disabled ${schedule.name} after ${schedule.consecutiveFailures} failures`);\n        this.emit(\"schedule:disabled\", schedule);\n      }\n    } finally {\n      this.runningExecutions.delete(executionId);\n    }\n\n    return execution;\n  }\n}\n\n// =========================================================================\n// SINGLETON\n// =========================================================================\n\nlet managerInstance: ScheduleManager | null = null;\n\n/**\n * Get or create schedule manager singleton\n */\nexport function getScheduleManager(config?: ScheduleManagerConfig): ScheduleManager {\n  if (!managerInstance) {\n    managerInstance = new ScheduleManager(config);\n  }\n  return managerInstance;\n}\n\n/**\n * Create a new schedule manager instance\n */\nexport function createScheduleManager(config?: ScheduleManagerConfig): ScheduleManager {\n  return new ScheduleManager(config);\n}\n","/**\n * Pipeline Scheduler Types\n *\n * Zod schemas and TypeScript types for cron-based pipeline scheduling.\n */\n\nimport { z } from \"zod\";\n\n// =========================================================================\n// ZOD SCHEMAS\n// =========================================================================\n\n/**\n * Cron expression validation\n * Supports: minute hour day-of-month month day-of-week\n */\nexport const CronExpressionSchema = z\n  .string()\n  .regex(\n    /^(\\*|([0-5]?\\d)(,([0-5]?\\d))*(-([0-5]?\\d))?|(\\*\\/([0-5]?\\d)))\\s+(\\*|([01]?\\d|2[0-3])(,([01]?\\d|2[0-3]))*(-([01]?\\d|2[0-3]))?|(\\*\\/([01]?\\d|2[0-3])))\\s+(\\*|([1-9]|[12]\\d|3[01])(,([1-9]|[12]\\d|3[01]))*(-([1-9]|[12]\\d|3[01]))?|(\\*\\/([1-9]|[12]\\d|3[01])))\\s+(\\*|(1[0-2]|[1-9])(,(1[0-2]|[1-9]))*(-(1[0-2]|[1-9]))?|(\\*\\/(1[0-2]|[1-9])))\\s+(\\*|[0-6](,[0-6])*(-[0-6])?|(\\*\\/[0-6]))$/,\n    { message: \"Invalid cron expression\" }\n  )\n  .describe(\"Cron expression (minute hour day-of-month month day-of-week)\");\n\nexport const TimezoneSchema = z\n  .string()\n  .default(\"UTC\")\n  .describe(\"IANA timezone identifier\");\n\nexport const ScheduleStatusSchema = z.enum([\"active\", \"paused\", \"disabled\", \"error\"]);\n\nexport const ScheduleConfigSchema = z.object({\n  pipelineId: z.string().min(1),\n  pipelineName: z.string().min(1),\n  name: z.string().min(1).max(100),\n  description: z.string().max(500).optional(),\n  cronExpression: CronExpressionSchema,\n  timezone: TimezoneSchema,\n  enabled: z.boolean().default(true),\n  inputs: z.record(z.unknown()).default({}),\n  maxRetries: z.number().int().min(0).max(10).default(3),\n  timeoutMs: z.number().int().min(1000).max(3600000).default(300000),\n  webhookUrl: z.string().url().optional(),\n  tags: z.array(z.string()).default([]),\n  metadata: z.record(z.unknown()).default({}),\n});\n\nexport const ScheduleSchema = ScheduleConfigSchema.extend({\n  id: z.string().uuid(),\n  status: ScheduleStatusSchema.default(\"active\"),\n  nextRun: z.date().nullable(),\n  lastRun: z.date().nullable(),\n  lastStatus: z.enum([\"completed\", \"failed\", \"cancelled\"]).nullable(),\n  runCount: z.number().int().default(0),\n  consecutiveFailures: z.number().int().default(0),\n  createdAt: z.date(),\n  updatedAt: z.date(),\n});\n\nexport const ScheduledRunSchema = z.object({\n  scheduleId: z.string().uuid(),\n  scheduleName: z.string(),\n  pipelineId: z.string(),\n  pipelineName: z.string(),\n  scheduledTime: z.date(),\n  cronExpression: z.string(),\n  timezone: z.string(),\n  inputs: z.record(z.unknown()),\n});\n\nexport const ScheduleExecutionSchema = z.object({\n  id: z.string().uuid(),\n  scheduleId: z.string().uuid(),\n  pipelineId: z.string(),\n  executionId: z.string().nullable(),\n  status: z.enum([\"pending\", \"running\", \"completed\", \"failed\", \"cancelled\"]),\n  scheduledAt: z.date(),\n  startedAt: z.date().nullable(),\n  completedAt: z.date().nullable(),\n  error: z.string().nullable(),\n  attempt: z.number().int().default(1),\n  result: z.unknown().nullable(),\n});\n\nexport const ScheduleStatsSchema = z.object({\n  totalSchedules: z.number().int(),\n  activeSchedules: z.number().int(),\n  pausedSchedules: z.number().int(),\n  totalRuns: z.number().int(),\n  successfulRuns: z.number().int(),\n  failedRuns: z.number().int(),\n  successRate: z.number(),\n  avgDurationMs: z.number(),\n  nextScheduledRuns: z.array(ScheduledRunSchema),\n});\n\n// =========================================================================\n// TYPES\n// =========================================================================\n\nexport type CronExpression = z.infer<typeof CronExpressionSchema>;\nexport type Timezone = z.infer<typeof TimezoneSchema>;\nexport type ScheduleStatus = z.infer<typeof ScheduleStatusSchema>;\nexport type ScheduleConfig = z.infer<typeof ScheduleConfigSchema>;\nexport type Schedule = z.infer<typeof ScheduleSchema>;\nexport type ScheduledRun = z.infer<typeof ScheduledRunSchema>;\nexport type ScheduleExecution = z.infer<typeof ScheduleExecutionSchema>;\nexport type ScheduleStats = z.infer<typeof ScheduleStatsSchema>;\n\n// =========================================================================\n// EVENT TYPES\n// =========================================================================\n\nexport interface SchedulerEvents {\n  \"schedule:created\": (schedule: Schedule) => void;\n  \"schedule:updated\": (schedule: Schedule) => void;\n  \"schedule:deleted\": (scheduleId: string) => void;\n  \"schedule:enabled\": (schedule: Schedule) => void;\n  \"schedule:disabled\": (schedule: Schedule) => void;\n  \"schedule:paused\": (schedule: Schedule) => void;\n  \"schedule:resumed\": (schedule: Schedule) => void;\n  \"run:scheduled\": (run: ScheduledRun) => void;\n  \"run:started\": (execution: ScheduleExecution) => void;\n  \"run:completed\": (execution: ScheduleExecution) => void;\n  \"run:failed\": (execution: ScheduleExecution, error: Error) => void;\n  \"run:cancelled\": (execution: ScheduleExecution) => void;\n  \"error\": (error: Error) => void;\n}\n\n// =========================================================================\n// COMMON CRON PRESETS\n// =========================================================================\n\nexport const CRON_PRESETS = {\n  everyMinute: \"* * * * *\",\n  every5Minutes: \"*/5 * * * *\",\n  every15Minutes: \"*/15 * * * *\",\n  every30Minutes: \"*/30 * * * *\",\n  hourly: \"0 * * * *\",\n  every2Hours: \"0 */2 * * *\",\n  every4Hours: \"0 */4 * * *\",\n  every6Hours: \"0 */6 * * *\",\n  every12Hours: \"0 */12 * * *\",\n  daily: \"0 0 * * *\",\n  dailyAt9am: \"0 9 * * *\",\n  dailyAt6pm: \"0 18 * * *\",\n  weekly: \"0 0 * * 0\",\n  weekdays: \"0 9 * * 1-5\",\n  weekends: \"0 10 * * 0,6\",\n  monthly: \"0 0 1 * *\",\n  quarterly: \"0 0 1 */3 *\",\n} as const;\n\nexport type CronPreset = keyof typeof CRON_PRESETS;\n","/**\n * Cache Types & Schemas\n * Phase 9C: Advanced Caching Layer\n */\n\nimport { z } from \"zod\";\n\n// ============================================================================\n// CACHE STRATEGIES\n// ============================================================================\n\nexport const CacheStrategySchema = z.enum([\n  \"none\",           // No caching\n  \"memory\",         // In-memory only\n  \"redis\",          // Redis only\n  \"tiered\",         // Memory + Redis (L1 + L2)\n  \"distributed\",    // Distributed cache with replication\n]);\nexport type CacheStrategy = z.infer<typeof CacheStrategySchema>;\n\n// ============================================================================\n// EVICTION POLICIES\n// ============================================================================\n\nexport const EvictionPolicySchema = z.enum([\n  \"lru\",            // Least Recently Used\n  \"lfu\",            // Least Frequently Used\n  \"fifo\",           // First In First Out\n  \"ttl\",            // Time To Live only\n  \"random\",         // Random eviction\n]);\nexport type EvictionPolicy = z.infer<typeof EvictionPolicySchema>;\n\n// ============================================================================\n// CACHE ENTRY\n// ============================================================================\n\nexport const CacheEntrySchema = z.object({\n  key: z.string(),\n  value: z.unknown(),\n  metadata: z.object({\n    createdAt: z.number(),\n    accessedAt: z.number(),\n    expiresAt: z.number().optional(),\n    ttl: z.number().optional(),\n    accessCount: z.number().default(0),\n    size: z.number().optional(),\n    tags: z.array(z.string()).default([]),\n  }),\n});\nexport type CacheEntry = z.infer<typeof CacheEntrySchema>;\n\n// ============================================================================\n// CACHE OPTIONS\n// ============================================================================\n\nexport const CacheOptionsSchema = z.object({\n  ttl: z.number().optional(),               // Time to live in seconds\n  tags: z.array(z.string()).optional(),     // Tags for invalidation\n  compress: z.boolean().optional(),         // Compress large values\n  skipL1: z.boolean().optional(),           // Skip memory cache\n  skipL2: z.boolean().optional(),           // Skip Redis cache\n  staleWhileRevalidate: z.number().optional(), // Serve stale while refreshing\n  onMiss: z.function().optional(),          // Function to call on cache miss\n});\nexport type CacheOptions = z.infer<typeof CacheOptionsSchema>;\n\n// ============================================================================\n// CACHE RESULT\n// ============================================================================\n\nexport const CacheResultSchema = z.object({\n  hit: z.boolean(),\n  value: z.unknown().optional(),\n  source: z.enum([\"memory\", \"redis\", \"origin\"]).optional(),\n  stale: z.boolean().default(false),\n  latencyMs: z.number(),\n});\nexport type CacheResult = z.infer<typeof CacheResultSchema>;\n\n// ============================================================================\n// CACHE STATS\n// ============================================================================\n\nexport const CacheStatsSchema = z.object({\n  hits: z.number(),\n  misses: z.number(),\n  hitRate: z.number(),\n  entries: z.number(),\n  memoryUsage: z.number(),\n  evictions: z.number(),\n  latency: z.object({\n    avg: z.number(),\n    p50: z.number(),\n    p95: z.number(),\n    p99: z.number(),\n  }),\n  byTag: z.record(z.object({\n    hits: z.number(),\n    misses: z.number(),\n    entries: z.number(),\n  })).optional(),\n});\nexport type CacheStats = z.infer<typeof CacheStatsSchema>;\n\n// ============================================================================\n// CACHE CONFIG\n// ============================================================================\n\nexport const MemoryCacheConfigSchema = z.object({\n  maxSize: z.number().default(1000),        // Max entries\n  maxMemory: z.number().default(100 * 1024 * 1024), // 100MB\n  evictionPolicy: EvictionPolicySchema.default(\"lru\"),\n  checkPeriod: z.number().default(60000),   // Cleanup interval\n});\nexport type MemoryCacheConfig = z.infer<typeof MemoryCacheConfigSchema>;\n\nexport const RedisCacheConfigSchema = z.object({\n  url: z.string().default(\"redis://localhost:6379\"),\n  prefix: z.string().default(\"gicm:cache:\"),\n  maxRetriesPerRequest: z.number().default(3),\n  enableOfflineQueue: z.boolean().default(true),\n  connectTimeout: z.number().default(5000),\n  commandTimeout: z.number().default(5000),\n});\nexport type RedisCacheConfig = z.infer<typeof RedisCacheConfigSchema>;\n\nexport const CacheManagerConfigSchema = z.object({\n  strategy: CacheStrategySchema.default(\"memory\"),\n  defaultTtl: z.number().default(300),      // 5 minutes\n  memory: MemoryCacheConfigSchema.optional(),\n  redis: RedisCacheConfigSchema.optional(),\n  compression: z.object({\n    enabled: z.boolean().default(false),\n    threshold: z.number().default(1024),    // Min size to compress\n  }).optional(),\n  metrics: z.object({\n    enabled: z.boolean().default(true),\n    sampleRate: z.number().default(1),      // 0-1\n  }).optional(),\n});\nexport type CacheManagerConfig = z.infer<typeof CacheManagerConfigSchema>;\n\n// ============================================================================\n// CACHE KEY PATTERNS\n// ============================================================================\n\nexport const CacheKeyPatternSchema = z.object({\n  pattern: z.string(),\n  ttl: z.number().optional(),\n  tags: z.array(z.string()).optional(),\n  compression: z.boolean().optional(),\n});\nexport type CacheKeyPattern = z.infer<typeof CacheKeyPatternSchema>;\n\n// ============================================================================\n// CACHE EVENTS\n// ============================================================================\n\nexport interface CacheEvents {\n  \"hit\": (key: string, source: \"memory\" | \"redis\") => void;\n  \"miss\": (key: string) => void;\n  \"set\": (key: string, ttl?: number) => void;\n  \"delete\": (key: string) => void;\n  \"evict\": (key: string, reason: \"ttl\" | \"memory\" | \"manual\") => void;\n  \"invalidate\": (pattern: string, count: number) => void;\n  \"error\": (error: Error) => void;\n  \"connected\": (backend: \"redis\") => void;\n  \"disconnected\": (backend: \"redis\") => void;\n}\n\n// ============================================================================\n// CACHE DECORATORS (for method caching)\n// ============================================================================\n\nexport interface CacheDecoratorOptions {\n  key?: string | ((...args: unknown[]) => string);\n  ttl?: number;\n  tags?: string[];\n  condition?: (...args: unknown[]) => boolean;\n  unless?: (result: unknown) => boolean;\n}\n\n// ============================================================================\n// COMMON KEY BUILDERS\n// ============================================================================\n\nexport const CacheKeys = {\n  // Organization\n  org: (orgId: string) => `org:${orgId}`,\n  orgMembers: (orgId: string) => `org:${orgId}:members`,\n  orgSettings: (orgId: string) => `org:${orgId}:settings`,\n\n  // Pipeline\n  pipeline: (pipelineId: string) => `pipeline:${pipelineId}`,\n  pipelineList: (orgId: string) => `pipelines:${orgId}`,\n  pipelineExecution: (executionId: string) => `execution:${executionId}`,\n\n  // Schedule\n  schedule: (scheduleId: string) => `schedule:${scheduleId}`,\n  scheduleList: (orgId: string) => `schedules:${orgId}`,\n\n  // Budget\n  budget: (budgetId: string) => `budget:${budgetId}`,\n  budgetList: (orgId: string) => `budgets:${orgId}`,\n  budgetUsage: (budgetId: string) => `budget:${budgetId}:usage`,\n\n  // Analytics\n  analytics: (orgId: string, period: string) => `analytics:${orgId}:${period}`,\n  analyticsSummary: (orgId: string) => `analytics:${orgId}:summary`,\n\n  // User\n  user: (userId: string) => `user:${userId}`,\n  userPermissions: (userId: string, orgId: string) => `user:${userId}:perms:${orgId}`,\n\n  // API\n  apiRateLimit: (key: string) => `rate:${key}`,\n\n  // Content\n  content: (contentId: string) => `content:${contentId}`,\n  contentList: (orgId: string, type: string) => `content:${orgId}:${type}`,\n\n  // Marketplace\n  marketplaceItem: (itemId: string) => `marketplace:${itemId}`,\n  marketplaceList: (category: string) => `marketplace:list:${category}`,\n};\n\n// ============================================================================\n// TTL PRESETS\n// ============================================================================\n\nexport const TTL = {\n  VERY_SHORT: 30,        // 30 seconds\n  SHORT: 60,             // 1 minute\n  MEDIUM: 300,           // 5 minutes\n  LONG: 900,             // 15 minutes\n  VERY_LONG: 3600,       // 1 hour\n  DAY: 86400,            // 24 hours\n  WEEK: 604800,          // 7 days\n\n  // Specific use cases\n  RATE_LIMIT: 60,\n  SESSION: 86400,\n  API_RESPONSE: 60,\n  ANALYTICS: 300,\n  USER_PERMISSIONS: 300,\n  ORG_SETTINGS: 600,\n  PIPELINE_LIST: 60,\n  MARKETPLACE: 300,\n};\n\n// ============================================================================\n// CACHE TAGS\n// ============================================================================\n\nexport const CacheTags = {\n  // Invalidation groups\n  ORG: (orgId: string) => `org:${orgId}`,\n  USER: (userId: string) => `user:${userId}`,\n  PIPELINE: (pipelineId: string) => `pipeline:${pipelineId}`,\n  SCHEDULE: (scheduleId: string) => `schedule:${scheduleId}`,\n  BUDGET: (budgetId: string) => `budget:${budgetId}`,\n\n  // Resource types\n  PIPELINES: \"type:pipelines\",\n  SCHEDULES: \"type:schedules\",\n  BUDGETS: \"type:budgets\",\n  ANALYTICS: \"type:analytics\",\n  MARKETPLACE: \"type:marketplace\",\n  CONTENT: \"type:content\",\n};\n","/**\n * Cache Manager Implementation\n * Phase 9C: Advanced Caching Layer\n */\n\nimport { EventEmitter } from \"eventemitter3\";\nimport {\n  CacheEntry,\n  CacheEvents,\n  CacheManagerConfig,\n  CacheOptions,\n  CacheResult,\n  CacheStats,\n  CacheStrategy,\n  EvictionPolicy,\n  TTL,\n} from \"./types.js\";\n\n// ============================================================================\n// MEMORY CACHE (L1)\n// ============================================================================\n\nclass MemoryCache {\n  private cache: Map<string, CacheEntry> = new Map();\n  private accessOrder: string[] = []; // For LRU\n  private maxSize: number;\n  private maxMemory: number;\n  private evictionPolicy: EvictionPolicy;\n  private currentMemory = 0;\n\n  constructor(config: { maxSize: number; maxMemory: number; evictionPolicy: EvictionPolicy }) {\n    this.maxSize = config.maxSize;\n    this.maxMemory = config.maxMemory;\n    this.evictionPolicy = config.evictionPolicy;\n  }\n\n  get(key: string): CacheEntry | undefined {\n    const entry = this.cache.get(key);\n    if (!entry) return undefined;\n\n    // Check TTL\n    if (entry.metadata.expiresAt && Date.now() > entry.metadata.expiresAt) {\n      this.delete(key);\n      return undefined;\n    }\n\n    // Update access tracking\n    entry.metadata.accessedAt = Date.now();\n    entry.metadata.accessCount++;\n\n    // Update LRU order\n    const idx = this.accessOrder.indexOf(key);\n    if (idx > -1) {\n      this.accessOrder.splice(idx, 1);\n    }\n    this.accessOrder.push(key);\n\n    return entry;\n  }\n\n  set(key: string, value: unknown, options?: CacheOptions): void {\n    const size = this.estimateSize(value);\n\n    // Evict if needed\n    while (\n      this.cache.size >= this.maxSize ||\n      this.currentMemory + size > this.maxMemory\n    ) {\n      if (!this.evict()) break;\n    }\n\n    const now = Date.now();\n    const entry: CacheEntry = {\n      key,\n      value,\n      metadata: {\n        createdAt: now,\n        accessedAt: now,\n        expiresAt: options?.ttl ? now + options.ttl * 1000 : undefined,\n        ttl: options?.ttl,\n        accessCount: 0,\n        size,\n        tags: options?.tags || [],\n      },\n    };\n\n    // Remove old entry if exists\n    const existing = this.cache.get(key);\n    if (existing) {\n      this.currentMemory -= existing.metadata.size || 0;\n    }\n\n    this.cache.set(key, entry);\n    this.currentMemory += size;\n    this.accessOrder.push(key);\n  }\n\n  delete(key: string): boolean {\n    const entry = this.cache.get(key);\n    if (!entry) return false;\n\n    this.cache.delete(key);\n    this.currentMemory -= entry.metadata.size || 0;\n\n    const idx = this.accessOrder.indexOf(key);\n    if (idx > -1) {\n      this.accessOrder.splice(idx, 1);\n    }\n\n    return true;\n  }\n\n  has(key: string): boolean {\n    const entry = this.cache.get(key);\n    if (!entry) return false;\n\n    if (entry.metadata.expiresAt && Date.now() > entry.metadata.expiresAt) {\n      this.delete(key);\n      return false;\n    }\n\n    return true;\n  }\n\n  clear(): void {\n    this.cache.clear();\n    this.accessOrder = [];\n    this.currentMemory = 0;\n  }\n\n  keys(): string[] {\n    return Array.from(this.cache.keys());\n  }\n\n  size(): number {\n    return this.cache.size;\n  }\n\n  memoryUsage(): number {\n    return this.currentMemory;\n  }\n\n  deleteByTag(tag: string): number {\n    let count = 0;\n    for (const [key, entry] of this.cache.entries()) {\n      if (entry.metadata.tags.includes(tag)) {\n        this.delete(key);\n        count++;\n      }\n    }\n    return count;\n  }\n\n  deleteByPattern(pattern: string): number {\n    const regex = new RegExp(pattern.replace(/\\*/g, \".*\"));\n    let count = 0;\n\n    for (const key of this.cache.keys()) {\n      if (regex.test(key)) {\n        this.delete(key);\n        count++;\n      }\n    }\n\n    return count;\n  }\n\n  private evict(): boolean {\n    if (this.cache.size === 0) return false;\n\n    let keyToEvict: string | null = null;\n\n    switch (this.evictionPolicy) {\n      case \"lru\":\n        keyToEvict = this.accessOrder[0] || null;\n        break;\n\n      case \"lfu\":\n        let minAccess = Infinity;\n        for (const [key, entry] of this.cache.entries()) {\n          if (entry.metadata.accessCount < minAccess) {\n            minAccess = entry.metadata.accessCount;\n            keyToEvict = key;\n          }\n        }\n        break;\n\n      case \"fifo\":\n        keyToEvict = this.cache.keys().next().value || null;\n        break;\n\n      case \"ttl\":\n        let earliestExpiry = Infinity;\n        for (const [key, entry] of this.cache.entries()) {\n          const expiry = entry.metadata.expiresAt || Infinity;\n          if (expiry < earliestExpiry) {\n            earliestExpiry = expiry;\n            keyToEvict = key;\n          }\n        }\n        break;\n\n      case \"random\":\n        const keys = Array.from(this.cache.keys());\n        keyToEvict = keys[Math.floor(Math.random() * keys.length)] || null;\n        break;\n    }\n\n    if (keyToEvict) {\n      this.delete(keyToEvict);\n      return true;\n    }\n\n    return false;\n  }\n\n  private estimateSize(value: unknown): number {\n    try {\n      return JSON.stringify(value).length * 2; // Rough estimate in bytes\n    } catch {\n      return 1024; // Default 1KB\n    }\n  }\n\n  cleanup(): number {\n    const now = Date.now();\n    let cleaned = 0;\n\n    for (const [key, entry] of this.cache.entries()) {\n      if (entry.metadata.expiresAt && entry.metadata.expiresAt < now) {\n        this.delete(key);\n        cleaned++;\n      }\n    }\n\n    return cleaned;\n  }\n}\n\n// ============================================================================\n// REDIS CACHE (L2) - Mock implementation\n// ============================================================================\n\nclass RedisCache {\n  private connected = false;\n  private prefix: string;\n  private mockStorage: Map<string, { value: string; expiresAt?: number }> = new Map();\n\n  constructor(config: { url: string; prefix: string }) {\n    this.prefix = config.prefix;\n    // In production, connect to actual Redis\n    this.connected = true;\n  }\n\n  async get(key: string): Promise<string | null> {\n    const prefixedKey = this.prefix + key;\n    const entry = this.mockStorage.get(prefixedKey);\n\n    if (!entry) return null;\n\n    if (entry.expiresAt && Date.now() > entry.expiresAt) {\n      this.mockStorage.delete(prefixedKey);\n      return null;\n    }\n\n    return entry.value;\n  }\n\n  async set(key: string, value: string, ttlSeconds?: number): Promise<void> {\n    const prefixedKey = this.prefix + key;\n    this.mockStorage.set(prefixedKey, {\n      value,\n      expiresAt: ttlSeconds ? Date.now() + ttlSeconds * 1000 : undefined,\n    });\n  }\n\n  async delete(key: string): Promise<boolean> {\n    const prefixedKey = this.prefix + key;\n    return this.mockStorage.delete(prefixedKey);\n  }\n\n  async deleteByPattern(pattern: string): Promise<number> {\n    const regex = new RegExp((this.prefix + pattern).replace(/\\*/g, \".*\"));\n    let count = 0;\n\n    for (const key of this.mockStorage.keys()) {\n      if (regex.test(key)) {\n        this.mockStorage.delete(key);\n        count++;\n      }\n    }\n\n    return count;\n  }\n\n  async exists(key: string): Promise<boolean> {\n    const value = await this.get(key);\n    return value !== null;\n  }\n\n  async clear(): Promise<void> {\n    for (const key of this.mockStorage.keys()) {\n      if (key.startsWith(this.prefix)) {\n        this.mockStorage.delete(key);\n      }\n    }\n  }\n\n  isConnected(): boolean {\n    return this.connected;\n  }\n\n  async disconnect(): Promise<void> {\n    this.connected = false;\n  }\n}\n\n// ============================================================================\n// CACHE MANAGER\n// ============================================================================\n\nexport class CacheManager extends EventEmitter<CacheEvents> {\n  private config: CacheManagerConfig;\n  private memory: MemoryCache;\n  private redis?: RedisCache;\n  private stats = {\n    hits: 0,\n    misses: 0,\n    evictions: 0,\n    latencies: [] as number[],\n  };\n  private cleanupTimer?: ReturnType<typeof setInterval>;\n\n  constructor(config: Partial<CacheManagerConfig> = {}) {\n    super();\n\n    this.config = {\n      strategy: config.strategy || \"memory\",\n      defaultTtl: config.defaultTtl || TTL.MEDIUM,\n      memory: {\n        maxSize: config.memory?.maxSize || 1000,\n        maxMemory: config.memory?.maxMemory || 100 * 1024 * 1024,\n        evictionPolicy: config.memory?.evictionPolicy || \"lru\",\n        checkPeriod: config.memory?.checkPeriod || 60000,\n      },\n      redis: config.redis,\n      compression: config.compression,\n      metrics: config.metrics,\n    };\n\n    // Initialize L1 (memory)\n    this.memory = new MemoryCache({\n      maxSize: this.config.memory!.maxSize,\n      maxMemory: this.config.memory!.maxMemory,\n      evictionPolicy: this.config.memory!.evictionPolicy,\n    });\n\n    // Initialize L2 (Redis) if configured\n    if (this.config.strategy === \"redis\" || this.config.strategy === \"tiered\") {\n      this.redis = new RedisCache({\n        url: this.config.redis?.url || \"redis://localhost:6379\",\n        prefix: this.config.redis?.prefix || \"gicm:cache:\",\n      });\n    }\n\n    // Start cleanup timer\n    this.startCleanup();\n  }\n\n  // ==========================================================================\n  // CORE OPERATIONS\n  // ==========================================================================\n\n  /**\n   * Get value from cache\n   */\n  async get<T>(key: string): Promise<CacheResult> {\n    const start = Date.now();\n\n    try {\n      // Try L1 (memory) first\n      if (this.config.strategy !== \"redis\") {\n        const memEntry = this.memory.get(key);\n        if (memEntry) {\n          this.recordHit(key, \"memory\", start);\n          return {\n            hit: true,\n            value: memEntry.value as T,\n            source: \"memory\",\n            stale: false,\n            latencyMs: Date.now() - start,\n          };\n        }\n      }\n\n      // Try L2 (Redis)\n      if (this.redis && this.config.strategy !== \"memory\") {\n        const redisValue = await this.redis.get(key);\n        if (redisValue) {\n          const value = JSON.parse(redisValue);\n\n          // Promote to L1 if tiered\n          if (this.config.strategy === \"tiered\") {\n            this.memory.set(key, value);\n          }\n\n          this.recordHit(key, \"redis\", start);\n          return {\n            hit: true,\n            value: value as T,\n            source: \"redis\",\n            stale: false,\n            latencyMs: Date.now() - start,\n          };\n        }\n      }\n\n      // Cache miss\n      this.recordMiss(key, start);\n      return {\n        hit: false,\n        source: \"origin\",\n        stale: false,\n        latencyMs: Date.now() - start,\n      };\n    } catch (error) {\n      this.emit(\"error\", error as Error);\n      return {\n        hit: false,\n        source: \"origin\",\n        stale: false,\n        latencyMs: Date.now() - start,\n      };\n    }\n  }\n\n  /**\n   * Set value in cache\n   */\n  async set<T>(key: string, value: T, options?: CacheOptions): Promise<void> {\n    const ttl = options?.ttl ?? this.config.defaultTtl;\n\n    try {\n      // Set in L1 (memory)\n      if (this.config.strategy !== \"redis\" && !options?.skipL1) {\n        this.memory.set(key, value, { ...options, ttl });\n      }\n\n      // Set in L2 (Redis)\n      if (this.redis && this.config.strategy !== \"memory\" && !options?.skipL2) {\n        const serialized = JSON.stringify(value);\n        await this.redis.set(key, serialized, ttl);\n      }\n\n      this.emit(\"set\", key, ttl);\n    } catch (error) {\n      this.emit(\"error\", error as Error);\n    }\n  }\n\n  /**\n   * Delete value from cache\n   */\n  async delete(key: string): Promise<boolean> {\n    let deleted = false;\n\n    // Delete from L1\n    if (this.memory.delete(key)) {\n      deleted = true;\n    }\n\n    // Delete from L2\n    if (this.redis) {\n      if (await this.redis.delete(key)) {\n        deleted = true;\n      }\n    }\n\n    if (deleted) {\n      this.emit(\"delete\", key);\n    }\n\n    return deleted;\n  }\n\n  /**\n   * Check if key exists\n   */\n  async has(key: string): Promise<boolean> {\n    if (this.memory.has(key)) return true;\n    if (this.redis) {\n      return await this.redis.exists(key);\n    }\n    return false;\n  }\n\n  /**\n   * Get or set with factory function\n   */\n  async getOrSet<T>(\n    key: string,\n    factory: () => Promise<T>,\n    options?: CacheOptions\n  ): Promise<T> {\n    const result = await this.get<T>(key);\n\n    if (result.hit) {\n      return result.value as T;\n    }\n\n    const value = await factory();\n    await this.set(key, value, options);\n    return value;\n  }\n\n  /**\n   * Clear all cache\n   */\n  async clear(): Promise<void> {\n    this.memory.clear();\n    if (this.redis) {\n      await this.redis.clear();\n    }\n  }\n\n  // ==========================================================================\n  // INVALIDATION\n  // ==========================================================================\n\n  /**\n   * Invalidate by tag\n   */\n  async invalidateByTag(tag: string): Promise<number> {\n    let count = this.memory.deleteByTag(tag);\n\n    // Note: Redis tag invalidation requires additional data structure\n    // In production, use Redis Sets to track tags\n\n    this.emit(\"invalidate\", `tag:${tag}`, count);\n    return count;\n  }\n\n  /**\n   * Invalidate by pattern\n   */\n  async invalidateByPattern(pattern: string): Promise<number> {\n    let count = this.memory.deleteByPattern(pattern);\n\n    if (this.redis) {\n      count += await this.redis.deleteByPattern(pattern);\n    }\n\n    this.emit(\"invalidate\", pattern, count);\n    return count;\n  }\n\n  /**\n   * Invalidate multiple keys\n   */\n  async invalidateMany(keys: string[]): Promise<number> {\n    let count = 0;\n    for (const key of keys) {\n      if (await this.delete(key)) {\n        count++;\n      }\n    }\n    return count;\n  }\n\n  // ==========================================================================\n  // STATS & MONITORING\n  // ==========================================================================\n\n  /**\n   * Get cache statistics\n   */\n  getStats(): CacheStats {\n    const total = this.stats.hits + this.stats.misses;\n    const latencies = [...this.stats.latencies].sort((a, b) => a - b);\n\n    return {\n      hits: this.stats.hits,\n      misses: this.stats.misses,\n      hitRate: total > 0 ? this.stats.hits / total : 0,\n      entries: this.memory.size(),\n      memoryUsage: this.memory.memoryUsage(),\n      evictions: this.stats.evictions,\n      latency: {\n        avg: latencies.length > 0\n          ? latencies.reduce((a, b) => a + b, 0) / latencies.length\n          : 0,\n        p50: this.percentile(latencies, 50),\n        p95: this.percentile(latencies, 95),\n        p99: this.percentile(latencies, 99),\n      },\n    };\n  }\n\n  /**\n   * Reset statistics\n   */\n  resetStats(): void {\n    this.stats = {\n      hits: 0,\n      misses: 0,\n      evictions: 0,\n      latencies: [],\n    };\n  }\n\n  // ==========================================================================\n  // UTILITIES\n  // ==========================================================================\n\n  /**\n   * Wrap a function with caching\n   */\n  wrap<T extends (...args: unknown[]) => Promise<unknown>>(\n    fn: T,\n    keyFn: (...args: Parameters<T>) => string,\n    options?: CacheOptions\n  ): T {\n    return (async (...args: Parameters<T>) => {\n      const key = keyFn(...args);\n      return this.getOrSet(key, () => fn(...args), options);\n    }) as T;\n  }\n\n  /**\n   * Create a memoized version of a function\n   */\n  memoize<T extends (...args: unknown[]) => Promise<unknown>>(\n    fn: T,\n    options?: CacheOptions & { keyPrefix?: string }\n  ): T {\n    const prefix = options?.keyPrefix || fn.name || \"memo\";\n\n    return this.wrap(\n      fn,\n      (...args) => `${prefix}:${JSON.stringify(args)}`,\n      options\n    );\n  }\n\n  // ==========================================================================\n  // PRIVATE METHODS\n  // ==========================================================================\n\n  private recordHit(key: string, source: \"memory\" | \"redis\", startTime: number): void {\n    this.stats.hits++;\n    this.recordLatency(startTime);\n    this.emit(\"hit\", key, source);\n  }\n\n  private recordMiss(key: string, startTime: number): void {\n    this.stats.misses++;\n    this.recordLatency(startTime);\n    this.emit(\"miss\", key);\n  }\n\n  private recordLatency(startTime: number): void {\n    const latency = Date.now() - startTime;\n    this.stats.latencies.push(latency);\n\n    // Keep only last 1000 latencies\n    if (this.stats.latencies.length > 1000) {\n      this.stats.latencies.shift();\n    }\n  }\n\n  private percentile(sortedArr: number[], p: number): number {\n    if (sortedArr.length === 0) return 0;\n    const idx = Math.ceil((p / 100) * sortedArr.length) - 1;\n    return sortedArr[Math.max(0, Math.min(idx, sortedArr.length - 1))];\n  }\n\n  private startCleanup(): void {\n    const checkPeriod = this.config.memory?.checkPeriod || 60000;\n\n    this.cleanupTimer = setInterval(() => {\n      const cleaned = this.memory.cleanup();\n      if (cleaned > 0) {\n        this.stats.evictions += cleaned;\n      }\n    }, checkPeriod);\n  }\n\n  // ==========================================================================\n  // LIFECYCLE\n  // ==========================================================================\n\n  /**\n   * Stop the cache manager\n   */\n  async stop(): Promise<void> {\n    if (this.cleanupTimer) {\n      clearInterval(this.cleanupTimer);\n    }\n\n    if (this.redis) {\n      await this.redis.disconnect();\n      this.emit(\"disconnected\", \"redis\");\n    }\n  }\n\n  /**\n   * Get current strategy\n   */\n  getStrategy(): CacheStrategy {\n    return this.config.strategy;\n  }\n\n  /**\n   * Check Redis connection\n   */\n  isRedisConnected(): boolean {\n    return this.redis?.isConnected() ?? false;\n  }\n}\n\n// ============================================================================\n// SINGLETON & FACTORY\n// ============================================================================\n\nlet cacheManagerInstance: CacheManager | null = null;\n\nexport function getCacheManager(): CacheManager {\n  if (!cacheManagerInstance) {\n    cacheManagerInstance = new CacheManager();\n  }\n  return cacheManagerInstance;\n}\n\nexport function createCacheManager(config?: Partial<CacheManagerConfig>): CacheManager {\n  return new CacheManager(config);\n}\n","/**\n * Cache Middleware for Fastify\n * Phase 9C: Advanced Caching Layer\n */\n\nimport { FastifyRequest, FastifyReply, FastifyInstance } from \"fastify\";\nimport { CacheManager, getCacheManager } from \"./cache-manager.js\";\nimport { CacheOptions, TTL, CacheKeys } from \"./types.js\";\n\n// ============================================================================\n// TYPES\n// ============================================================================\n\nexport interface CacheMiddlewareOptions {\n  // Cache manager instance (optional, uses singleton if not provided)\n  cacheManager?: CacheManager;\n\n  // Default TTL for cached responses\n  defaultTtl?: number;\n\n  // Methods to cache (default: GET only)\n  methods?: string[];\n\n  // Paths to exclude from caching\n  excludePaths?: (string | RegExp)[];\n\n  // Include user ID in cache key\n  varyByUser?: boolean;\n\n  // Include org ID in cache key\n  varyByOrg?: boolean;\n\n  // Custom key generator\n  keyGenerator?: (request: FastifyRequest) => string;\n\n  // Condition to check before caching\n  condition?: (request: FastifyRequest) => boolean;\n\n  // Response status codes to cache\n  statusCodes?: number[];\n\n  // Skip caching based on response headers\n  skipIfHeader?: string;\n\n  // Add cache status header\n  addStatusHeader?: boolean;\n}\n\nconst DEFAULT_OPTIONS: CacheMiddlewareOptions = {\n  defaultTtl: TTL.SHORT,\n  methods: [\"GET\"],\n  excludePaths: [\"/health\", \"/metrics\", \"/api/auth\"],\n  varyByUser: true,\n  varyByOrg: true,\n  statusCodes: [200],\n  addStatusHeader: true,\n};\n\n// ============================================================================\n// KEY GENERATION\n// ============================================================================\n\nfunction generateCacheKey(request: FastifyRequest, options: CacheMiddlewareOptions): string {\n  if (options.keyGenerator) {\n    return options.keyGenerator(request);\n  }\n\n  const parts: string[] = [\n    request.method,\n    request.url,\n  ];\n\n  // Add user variation\n  if (options.varyByUser && (request as any).userId) {\n    parts.push(`user:${(request as any).userId}`);\n  }\n\n  // Add org variation\n  if (options.varyByOrg && (request as any).orgId) {\n    parts.push(`org:${(request as any).orgId}`);\n  }\n\n  // Add query string\n  const queryString = new URL(request.url, \"http://localhost\").search;\n  if (queryString) {\n    parts.push(queryString);\n  }\n\n  return `api:${parts.join(\":\")}`;\n}\n\n// ============================================================================\n// MIDDLEWARE FACTORY\n// ============================================================================\n\nexport function createCacheMiddleware(options: CacheMiddlewareOptions = {}) {\n  const opts = { ...DEFAULT_OPTIONS, ...options };\n  const cache = opts.cacheManager || getCacheManager();\n\n  return async function cacheMiddleware(\n    request: FastifyRequest,\n    reply: FastifyReply\n  ): Promise<void> {\n    // Skip if method not cacheable\n    if (!opts.methods?.includes(request.method)) {\n      return;\n    }\n\n    // Check excluded paths\n    const url = request.url.split(\"?\")[0];\n    for (const pattern of opts.excludePaths || []) {\n      if (typeof pattern === \"string\" && url.startsWith(pattern)) {\n        return;\n      }\n      if (pattern instanceof RegExp && pattern.test(url)) {\n        return;\n      }\n    }\n\n    // Check custom condition\n    if (opts.condition && !opts.condition(request)) {\n      return;\n    }\n\n    // Generate cache key\n    const cacheKey = generateCacheKey(request, opts);\n\n    // Try to get from cache\n    const result = await cache.get(cacheKey);\n\n    if (result.hit) {\n      // Add cache status header\n      if (opts.addStatusHeader) {\n        reply.header(\"X-Cache\", \"HIT\");\n        reply.header(\"X-Cache-Source\", result.source || \"unknown\");\n      }\n\n      // Return cached response\n      reply.send(result.value);\n      return;\n    }\n\n    // Add cache status header for miss\n    if (opts.addStatusHeader) {\n      reply.header(\"X-Cache\", \"MISS\");\n    }\n\n    // Store original send method\n    const originalSend = reply.send.bind(reply);\n\n    // Override send to cache the response\n    reply.send = function (payload: unknown) {\n      // Only cache successful responses\n      if (opts.statusCodes?.includes(reply.statusCode)) {\n        // Skip if specific header is set\n        if (opts.skipIfHeader && reply.getHeader(opts.skipIfHeader)) {\n          return originalSend(payload);\n        }\n\n        // Cache the response\n        cache.set(cacheKey, payload, {\n          ttl: opts.defaultTtl,\n          tags: [(request as any).orgId ? `org:${(request as any).orgId}` : \"global\"],\n        }).catch(() => {\n          // Ignore cache errors\n        });\n      }\n\n      return originalSend(payload);\n    };\n  };\n}\n\n// ============================================================================\n// ROUTE-SPECIFIC CACHING\n// ============================================================================\n\nexport interface RouteCacheOptions extends CacheOptions {\n  // Override default TTL\n  ttl?: number;\n\n  // Add stale-while-revalidate behavior\n  staleWhileRevalidate?: number;\n\n  // Custom cache key parts\n  keyParts?: string[];\n\n  // Vary by specific headers\n  varyByHeaders?: string[];\n}\n\n/**\n * Cache decorator for specific routes\n */\nexport function cacheRoute(options: RouteCacheOptions = {}) {\n  const cache = getCacheManager();\n\n  return async function (\n    request: FastifyRequest,\n    reply: FastifyReply\n  ): Promise<void> {\n    // Build cache key\n    const keyParts = [\n      request.method,\n      request.url,\n      ...(options.keyParts || []),\n    ];\n\n    // Add header variations\n    for (const header of options.varyByHeaders || []) {\n      const value = request.headers[header.toLowerCase()];\n      if (value) {\n        keyParts.push(`${header}:${value}`);\n      }\n    }\n\n    const cacheKey = `route:${keyParts.join(\":\")}`;\n\n    // Try cache\n    const result = await cache.get(cacheKey);\n\n    if (result.hit) {\n      reply.header(\"X-Cache\", \"HIT\");\n      reply.send(result.value);\n      return;\n    }\n\n    // Store original send\n    const originalSend = reply.send.bind(reply);\n\n    reply.send = function (payload: unknown) {\n      if (reply.statusCode === 200) {\n        cache.set(cacheKey, payload, {\n          ttl: options.ttl || TTL.SHORT,\n          tags: options.tags,\n        }).catch(() => {});\n      }\n      return originalSend(payload);\n    };\n  };\n}\n\n// ============================================================================\n// CACHE INVALIDATION HELPERS\n// ============================================================================\n\n/**\n * Invalidate cache after mutations\n */\nexport async function invalidateOnMutation(\n  resourceType: string,\n  resourceId: string,\n  orgId?: string\n): Promise<void> {\n  const cache = getCacheManager();\n\n  // Invalidate specific resource\n  await cache.delete(`${resourceType}:${resourceId}`);\n\n  // Invalidate list caches\n  if (orgId) {\n    await cache.invalidateByPattern(`*${resourceType}*${orgId}*`);\n  }\n\n  // Invalidate by tag\n  await cache.invalidateByTag(`type:${resourceType}s`);\n}\n\n/**\n * Create cache invalidation middleware for mutations\n */\nexport function invalidationMiddleware(\n  resourceType: string,\n  getResourceId: (request: FastifyRequest) => string | undefined,\n  getOrgId?: (request: FastifyRequest) => string | undefined\n) {\n  return async function (\n    request: FastifyRequest,\n    reply: FastifyReply\n  ): Promise<void> {\n    // Only run after successful mutations\n    reply.addHook(\"onSend\", async (req, rep, payload) => {\n      if (rep.statusCode >= 200 && rep.statusCode < 300) {\n        const resourceId = getResourceId(request);\n        const orgId = getOrgId?.(request);\n\n        if (resourceId) {\n          await invalidateOnMutation(resourceType, resourceId, orgId);\n        }\n      }\n      return payload;\n    });\n  };\n}\n\n// ============================================================================\n// FASTIFY PLUGIN\n// ============================================================================\n\nexport async function cachePlugin(\n  fastify: FastifyInstance,\n  options: CacheMiddlewareOptions = {}\n): Promise<void> {\n  const cache = options.cacheManager || getCacheManager();\n\n  // Add cache manager to request\n  fastify.decorateRequest(\"cache\", null);\n  fastify.addHook(\"onRequest\", async (request) => {\n    (request as any).cache = cache;\n  });\n\n  // Add global cache middleware\n  fastify.addHook(\"preHandler\", createCacheMiddleware(options));\n\n  // Add cache stats endpoint\n  fastify.get(\"/api/cache/stats\", async () => {\n    return {\n      ok: true,\n      stats: cache.getStats(),\n      strategy: cache.getStrategy(),\n      redisConnected: cache.isRedisConnected(),\n    };\n  });\n\n  // Add cache clear endpoint (admin only)\n  fastify.delete(\"/api/cache\", async (request, reply) => {\n    // Check admin role\n    if ((request as any).userRole !== \"owner\" && (request as any).userRole !== \"admin\") {\n      reply.code(403);\n      return { ok: false, error: \"Admin access required\" };\n    }\n\n    await cache.clear();\n    return { ok: true, message: \"Cache cleared\" };\n  });\n\n  // Add pattern invalidation endpoint\n  fastify.delete<{ Querystring: { pattern: string } }>(\n    \"/api/cache/invalidate\",\n    async (request, reply) => {\n      if ((request as any).userRole !== \"owner\" && (request as any).userRole !== \"admin\") {\n        reply.code(403);\n        return { ok: false, error: \"Admin access required\" };\n      }\n\n      const { pattern } = request.query;\n      if (!pattern) {\n        reply.code(400);\n        return { ok: false, error: \"Pattern required\" };\n      }\n\n      const count = await cache.invalidateByPattern(pattern);\n      return { ok: true, invalidated: count };\n    }\n  );\n}\n\n// ============================================================================\n// SINGLETON MIDDLEWARE\n// ============================================================================\n\nexport const cacheMiddleware = createCacheMiddleware();\n","/**\n * Plugin System Types & Schemas\n * Phase 9D: Enterprise Plugin Architecture\n */\n\nimport { z } from \"zod\";\n\n// ============================================================================\n// PLUGIN METADATA\n// ============================================================================\n\nexport const PluginMetadataSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  version: z.string(),\n  description: z.string().optional(),\n  author: z.string().optional(),\n  license: z.string().optional(),\n  homepage: z.string().url().optional(),\n  repository: z.string().url().optional(),\n  keywords: z.array(z.string()).default([]),\n  category: z.enum([\n    \"integration\",    // External service integrations\n    \"tool\",           // Pipeline tools\n    \"transform\",      // Data transformers\n    \"notification\",   // Notification channels\n    \"analytics\",      // Analytics extensions\n    \"security\",       // Security features\n    \"ui\",             // UI components\n    \"other\",\n  ]).default(\"other\"),\n});\nexport type PluginMetadata = z.infer<typeof PluginMetadataSchema>;\n\n// ============================================================================\n// PLUGIN CAPABILITIES\n// ============================================================================\n\nexport const PluginCapabilitySchema = z.enum([\n  \"tools\",            // Provides pipeline tools\n  \"hooks\",            // Provides lifecycle hooks\n  \"routes\",           // Provides API routes\n  \"middleware\",       // Provides middleware\n  \"storage\",          // Provides storage adapters\n  \"notifications\",    // Provides notification channels\n  \"transforms\",       // Provides data transformers\n  \"validators\",       // Provides validators\n  \"ui_components\",    // Provides UI components\n]);\nexport type PluginCapability = z.infer<typeof PluginCapabilitySchema>;\n\n// ============================================================================\n// PLUGIN STATUS\n// ============================================================================\n\nexport const PluginStatusSchema = z.enum([\n  \"registered\",       // Plugin registered but not installed\n  \"installing\",       // Plugin being installed\n  \"installed\",        // Plugin installed but not enabled\n  \"enabled\",          // Plugin enabled and active\n  \"disabled\",         // Plugin disabled\n  \"error\",            // Plugin in error state\n  \"uninstalling\",     // Plugin being uninstalled\n]);\nexport type PluginStatus = z.infer<typeof PluginStatusSchema>;\n\n// ============================================================================\n// PLUGIN CONFIG\n// ============================================================================\n\nexport const PluginConfigFieldSchema = z.object({\n  key: z.string(),\n  type: z.enum([\"string\", \"number\", \"boolean\", \"select\", \"multiselect\", \"secret\"]),\n  label: z.string(),\n  description: z.string().optional(),\n  required: z.boolean().default(false),\n  default: z.unknown().optional(),\n  options: z.array(z.object({\n    value: z.string(),\n    label: z.string(),\n  })).optional(),\n  validation: z.object({\n    min: z.number().optional(),\n    max: z.number().optional(),\n    pattern: z.string().optional(),\n  }).optional(),\n});\nexport type PluginConfigField = z.infer<typeof PluginConfigFieldSchema>;\n\nexport const PluginConfigSchema = z.object({\n  fields: z.array(PluginConfigFieldSchema),\n  values: z.record(z.unknown()).default({}),\n});\nexport type PluginConfig = z.infer<typeof PluginConfigSchema>;\n\n// ============================================================================\n// PLUGIN HOOK\n// ============================================================================\n\nexport const PluginHookTypeSchema = z.enum([\n  // Lifecycle hooks\n  \"onInit\",\n  \"onStart\",\n  \"onStop\",\n  \"onDestroy\",\n\n  // Pipeline hooks\n  \"beforePipelineExecute\",\n  \"afterPipelineExecute\",\n  \"onPipelineError\",\n\n  // Step hooks\n  \"beforeStepExecute\",\n  \"afterStepExecute\",\n  \"onStepError\",\n\n  // Tool hooks\n  \"beforeToolCall\",\n  \"afterToolCall\",\n  \"onToolError\",\n\n  // Auth hooks\n  \"onLogin\",\n  \"onLogout\",\n  \"onPermissionCheck\",\n\n  // Data hooks\n  \"beforeSave\",\n  \"afterSave\",\n  \"beforeDelete\",\n  \"afterDelete\",\n\n  // Custom hooks\n  \"custom\",\n]);\nexport type PluginHookType = z.infer<typeof PluginHookTypeSchema>;\n\nexport const PluginHookSchema = z.object({\n  type: PluginHookTypeSchema,\n  priority: z.number().default(100),\n  handler: z.function().args(z.unknown()).returns(z.promise(z.unknown())),\n});\nexport type PluginHook = z.infer<typeof PluginHookSchema>;\n\n// ============================================================================\n// PLUGIN TOOL\n// ============================================================================\n\nexport const PluginToolSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  description: z.string(),\n  category: z.string().default(\"custom\"),\n  inputs: z.array(z.object({\n    name: z.string(),\n    type: z.string(),\n    description: z.string().optional(),\n    required: z.boolean().default(true),\n    default: z.unknown().optional(),\n  })),\n  outputs: z.array(z.object({\n    name: z.string(),\n    type: z.string(),\n    description: z.string().optional(),\n  })).optional(),\n  execute: z.function().args(z.unknown()).returns(z.promise(z.unknown())),\n});\nexport type PluginTool = z.infer<typeof PluginToolSchema>;\n\n// ============================================================================\n// PLUGIN ROUTE\n// ============================================================================\n\nexport const PluginRouteMethodSchema = z.enum([\"GET\", \"POST\", \"PUT\", \"PATCH\", \"DELETE\"]);\nexport type PluginRouteMethod = z.infer<typeof PluginRouteMethodSchema>;\n\nexport const PluginRouteSchema = z.object({\n  method: PluginRouteMethodSchema,\n  path: z.string(),\n  handler: z.function().args(z.unknown(), z.unknown()).returns(z.promise(z.unknown())),\n  auth: z.boolean().default(true),\n  permissions: z.array(z.string()).optional(),\n});\nexport type PluginRoute = z.infer<typeof PluginRouteSchema>;\n\n// ============================================================================\n// PLUGIN DEFINITION\n// ============================================================================\n\nexport const PluginDefinitionSchema = z.object({\n  // Metadata\n  metadata: PluginMetadataSchema,\n\n  // Capabilities\n  capabilities: z.array(PluginCapabilitySchema).default([]),\n\n  // Dependencies\n  dependencies: z.array(z.object({\n    pluginId: z.string(),\n    version: z.string().optional(),\n    optional: z.boolean().default(false),\n  })).default([]),\n\n  // Configuration schema\n  configSchema: PluginConfigSchema.optional(),\n\n  // Resources provided\n  tools: z.array(PluginToolSchema).optional(),\n  hooks: z.array(PluginHookSchema).optional(),\n  routes: z.array(PluginRouteSchema).optional(),\n\n  // Lifecycle methods\n  onInstall: z.function().returns(z.promise(z.void())).optional(),\n  onUninstall: z.function().returns(z.promise(z.void())).optional(),\n  onEnable: z.function().returns(z.promise(z.void())).optional(),\n  onDisable: z.function().returns(z.promise(z.void())).optional(),\n  onConfigChange: z.function().args(z.unknown()).returns(z.promise(z.void())).optional(),\n});\nexport type PluginDefinition = z.infer<typeof PluginDefinitionSchema>;\n\n// ============================================================================\n// INSTALLED PLUGIN\n// ============================================================================\n\nexport const InstalledPluginSchema = z.object({\n  id: z.string(),\n  metadata: PluginMetadataSchema,\n  status: PluginStatusSchema,\n  capabilities: z.array(PluginCapabilitySchema),\n  config: z.record(z.unknown()).default({}),\n  installedAt: z.date(),\n  enabledAt: z.date().optional(),\n  lastError: z.string().optional(),\n  stats: z.object({\n    hooksCalled: z.number().default(0),\n    toolsExecuted: z.number().default(0),\n    routesHit: z.number().default(0),\n    errors: z.number().default(0),\n  }).default({}),\n});\nexport type InstalledPlugin = z.infer<typeof InstalledPluginSchema>;\n\n// ============================================================================\n// PLUGIN EVENTS\n// ============================================================================\n\nexport interface PluginEvents {\n  \"plugin:registered\": (pluginId: string) => void;\n  \"plugin:installed\": (pluginId: string) => void;\n  \"plugin:enabled\": (pluginId: string) => void;\n  \"plugin:disabled\": (pluginId: string) => void;\n  \"plugin:uninstalled\": (pluginId: string) => void;\n  \"plugin:error\": (pluginId: string, error: Error) => void;\n  \"plugin:config_changed\": (pluginId: string, config: Record<string, unknown>) => void;\n  \"hook:executed\": (pluginId: string, hookType: PluginHookType) => void;\n  \"tool:executed\": (pluginId: string, toolId: string) => void;\n}\n\n// ============================================================================\n// PLUGIN REGISTRY ENTRY\n// ============================================================================\n\nexport const PluginRegistryEntrySchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  description: z.string(),\n  author: z.string(),\n  version: z.string(),\n  category: z.string(),\n  downloads: z.number().default(0),\n  rating: z.number().min(0).max(5).default(0),\n  verified: z.boolean().default(false),\n  featured: z.boolean().default(false),\n  packageUrl: z.string().url(),\n  iconUrl: z.string().url().optional(),\n  capabilities: z.array(PluginCapabilitySchema),\n  createdAt: z.date(),\n  updatedAt: z.date(),\n});\nexport type PluginRegistryEntry = z.infer<typeof PluginRegistryEntrySchema>;\n\n// ============================================================================\n// PLUGIN MANAGER CONFIG\n// ============================================================================\n\nexport const PluginManagerConfigSchema = z.object({\n  // Storage location for plugins\n  pluginsDir: z.string().default(\"./plugins\"),\n\n  // Registry URL for discovering plugins\n  registryUrl: z.string().url().optional(),\n\n  // Auto-enable plugins on install\n  autoEnable: z.boolean().default(false),\n\n  // Sandbox plugin execution\n  sandboxed: z.boolean().default(true),\n\n  // Max plugins allowed\n  maxPlugins: z.number().default(50),\n\n  // Plugin timeout (ms)\n  timeout: z.number().default(30000),\n});\nexport type PluginManagerConfig = z.infer<typeof PluginManagerConfigSchema>;\n\n// ============================================================================\n// HOOK CONTEXT\n// ============================================================================\n\nexport interface HookContext {\n  pluginId: string;\n  hookType: PluginHookType;\n  timestamp: number;\n  data: unknown;\n  metadata: Record<string, unknown>;\n}\n\n// ============================================================================\n// TOOL EXECUTION CONTEXT\n// ============================================================================\n\nexport interface ToolExecutionContext {\n  pluginId: string;\n  toolId: string;\n  inputs: Record<string, unknown>;\n  executionId: string;\n  pipelineId?: string;\n  stepId?: string;\n  userId?: string;\n  orgId?: string;\n}\n","/**\n * Plugin Manager Implementation\n * Phase 9D: Enterprise Plugin Architecture\n */\n\nimport { EventEmitter } from \"eventemitter3\";\nimport {\n  PluginDefinition,\n  PluginEvents,\n  PluginManagerConfig,\n  InstalledPlugin,\n  PluginStatus,\n  PluginHookType,\n  PluginHook,\n  PluginTool,\n  PluginRoute,\n  HookContext,\n  ToolExecutionContext,\n  PluginCapability,\n} from \"./types.js\";\n\n// ============================================================================\n// PLUGIN MANAGER\n// ============================================================================\n\nexport class PluginManager extends EventEmitter<PluginEvents> {\n  private config: PluginManagerConfig;\n  private definitions: Map<string, PluginDefinition> = new Map();\n  private installed: Map<string, InstalledPlugin> = new Map();\n  private hooks: Map<PluginHookType, Array<{ pluginId: string; hook: PluginHook }>> = new Map();\n  private tools: Map<string, { pluginId: string; tool: PluginTool }> = new Map();\n  private routes: Map<string, { pluginId: string; route: PluginRoute }> = new Map();\n\n  constructor(config: Partial<PluginManagerConfig> = {}) {\n    super();\n\n    this.config = {\n      pluginsDir: config.pluginsDir || \"./plugins\",\n      autoEnable: config.autoEnable ?? false,\n      sandboxed: config.sandboxed ?? true,\n      maxPlugins: config.maxPlugins || 50,\n      timeout: config.timeout || 30000,\n    };\n  }\n\n  // ==========================================================================\n  // REGISTRATION\n  // ==========================================================================\n\n  /**\n   * Register a plugin definition\n   */\n  register(definition: PluginDefinition): void {\n    const { id } = definition.metadata;\n\n    if (this.definitions.has(id)) {\n      throw new Error(`Plugin ${id} is already registered`);\n    }\n\n    // Validate definition\n    this.validateDefinition(definition);\n\n    this.definitions.set(id, definition);\n    this.emit(\"plugin:registered\", id);\n  }\n\n  /**\n   * Unregister a plugin definition\n   */\n  unregister(pluginId: string): void {\n    if (!this.definitions.has(pluginId)) {\n      throw new Error(`Plugin ${pluginId} is not registered`);\n    }\n\n    // Ensure plugin is uninstalled first\n    if (this.installed.has(pluginId)) {\n      throw new Error(`Plugin ${pluginId} must be uninstalled before unregistering`);\n    }\n\n    this.definitions.delete(pluginId);\n  }\n\n  // ==========================================================================\n  // INSTALLATION\n  // ==========================================================================\n\n  /**\n   * Install a registered plugin\n   */\n  async install(pluginId: string, config?: Record<string, unknown>): Promise<InstalledPlugin> {\n    const definition = this.definitions.get(pluginId);\n    if (!definition) {\n      throw new Error(`Plugin ${pluginId} is not registered`);\n    }\n\n    if (this.installed.has(pluginId)) {\n      throw new Error(`Plugin ${pluginId} is already installed`);\n    }\n\n    if (this.installed.size >= this.config.maxPlugins) {\n      throw new Error(`Maximum plugin limit (${this.config.maxPlugins}) reached`);\n    }\n\n    // Check dependencies\n    await this.checkDependencies(definition);\n\n    // Create installed plugin record\n    const plugin: InstalledPlugin = {\n      id: pluginId,\n      metadata: definition.metadata,\n      status: \"installing\",\n      capabilities: definition.capabilities,\n      config: config || {},\n      installedAt: new Date(),\n      stats: {\n        hooksCalled: 0,\n        toolsExecuted: 0,\n        routesHit: 0,\n        errors: 0,\n      },\n    };\n\n    this.installed.set(pluginId, plugin);\n\n    try {\n      // Run installation hook\n      if (definition.onInstall) {\n        await this.runWithTimeout(definition.onInstall, this.config.timeout);\n      }\n\n      // Register plugin resources\n      this.registerPluginResources(pluginId, definition);\n\n      plugin.status = \"installed\";\n      this.emit(\"plugin:installed\", pluginId);\n\n      // Auto-enable if configured\n      if (this.config.autoEnable) {\n        await this.enable(pluginId);\n      }\n\n      return plugin;\n    } catch (error) {\n      plugin.status = \"error\";\n      plugin.lastError = error instanceof Error ? error.message : String(error);\n      this.emit(\"plugin:error\", pluginId, error as Error);\n      throw error;\n    }\n  }\n\n  /**\n   * Uninstall a plugin\n   */\n  async uninstall(pluginId: string): Promise<void> {\n    const plugin = this.installed.get(pluginId);\n    if (!plugin) {\n      throw new Error(`Plugin ${pluginId} is not installed`);\n    }\n\n    const definition = this.definitions.get(pluginId);\n\n    // Disable first if enabled\n    if (plugin.status === \"enabled\") {\n      await this.disable(pluginId);\n    }\n\n    plugin.status = \"uninstalling\";\n\n    try {\n      // Run uninstallation hook\n      if (definition?.onUninstall) {\n        await this.runWithTimeout(definition.onUninstall, this.config.timeout);\n      }\n\n      // Unregister plugin resources\n      this.unregisterPluginResources(pluginId);\n\n      this.installed.delete(pluginId);\n      this.emit(\"plugin:uninstalled\", pluginId);\n    } catch (error) {\n      plugin.status = \"error\";\n      plugin.lastError = error instanceof Error ? error.message : String(error);\n      this.emit(\"plugin:error\", pluginId, error as Error);\n      throw error;\n    }\n  }\n\n  // ==========================================================================\n  // ENABLE / DISABLE\n  // ==========================================================================\n\n  /**\n   * Enable a plugin\n   */\n  async enable(pluginId: string): Promise<void> {\n    const plugin = this.installed.get(pluginId);\n    if (!plugin) {\n      throw new Error(`Plugin ${pluginId} is not installed`);\n    }\n\n    if (plugin.status === \"enabled\") {\n      return; // Already enabled\n    }\n\n    const definition = this.definitions.get(pluginId);\n\n    try {\n      // Run enable hook\n      if (definition?.onEnable) {\n        await this.runWithTimeout(definition.onEnable, this.config.timeout);\n      }\n\n      plugin.status = \"enabled\";\n      plugin.enabledAt = new Date();\n      this.emit(\"plugin:enabled\", pluginId);\n    } catch (error) {\n      plugin.status = \"error\";\n      plugin.lastError = error instanceof Error ? error.message : String(error);\n      this.emit(\"plugin:error\", pluginId, error as Error);\n      throw error;\n    }\n  }\n\n  /**\n   * Disable a plugin\n   */\n  async disable(pluginId: string): Promise<void> {\n    const plugin = this.installed.get(pluginId);\n    if (!plugin) {\n      throw new Error(`Plugin ${pluginId} is not installed`);\n    }\n\n    if (plugin.status !== \"enabled\") {\n      return; // Not enabled\n    }\n\n    const definition = this.definitions.get(pluginId);\n\n    try {\n      // Run disable hook\n      if (definition?.onDisable) {\n        await this.runWithTimeout(definition.onDisable, this.config.timeout);\n      }\n\n      plugin.status = \"disabled\";\n      plugin.enabledAt = undefined;\n      this.emit(\"plugin:disabled\", pluginId);\n    } catch (error) {\n      plugin.status = \"error\";\n      plugin.lastError = error instanceof Error ? error.message : String(error);\n      this.emit(\"plugin:error\", pluginId, error as Error);\n      throw error;\n    }\n  }\n\n  // ==========================================================================\n  // CONFIGURATION\n  // ==========================================================================\n\n  /**\n   * Update plugin configuration\n   */\n  async configure(pluginId: string, config: Record<string, unknown>): Promise<void> {\n    const plugin = this.installed.get(pluginId);\n    if (!plugin) {\n      throw new Error(`Plugin ${pluginId} is not installed`);\n    }\n\n    const definition = this.definitions.get(pluginId);\n\n    // Validate config against schema\n    if (definition?.configSchema) {\n      this.validateConfig(config, definition.configSchema.fields);\n    }\n\n    const oldConfig = { ...plugin.config };\n    plugin.config = { ...plugin.config, ...config };\n\n    try {\n      // Run config change hook\n      if (definition?.onConfigChange) {\n        await definition.onConfigChange({ old: oldConfig, new: plugin.config });\n      }\n\n      this.emit(\"plugin:config_changed\", pluginId, plugin.config);\n    } catch (error) {\n      // Rollback config\n      plugin.config = oldConfig;\n      throw error;\n    }\n  }\n\n  // ==========================================================================\n  // HOOKS\n  // ==========================================================================\n\n  /**\n   * Execute hooks for a given type\n   */\n  async executeHooks(hookType: PluginHookType, context: Partial<HookContext>): Promise<unknown[]> {\n    const hookEntries = this.hooks.get(hookType) || [];\n    const results: unknown[] = [];\n\n    // Sort by priority (lower = higher priority)\n    const sorted = [...hookEntries].sort((a, b) => a.hook.priority - b.hook.priority);\n\n    for (const entry of sorted) {\n      const plugin = this.installed.get(entry.pluginId);\n\n      // Skip if plugin not enabled\n      if (!plugin || plugin.status !== \"enabled\") {\n        continue;\n      }\n\n      try {\n        const fullContext: HookContext = {\n          pluginId: entry.pluginId,\n          hookType,\n          timestamp: Date.now(),\n          data: context.data,\n          metadata: context.metadata || {},\n        };\n\n        const result = await this.runWithTimeout(\n          () => entry.hook.handler(fullContext),\n          this.config.timeout\n        );\n\n        results.push(result);\n        plugin.stats.hooksCalled++;\n        this.emit(\"hook:executed\", entry.pluginId, hookType);\n      } catch (error) {\n        plugin.stats.errors++;\n        this.emit(\"plugin:error\", entry.pluginId, error as Error);\n        // Continue executing other hooks\n      }\n    }\n\n    return results;\n  }\n\n  // ==========================================================================\n  // TOOLS\n  // ==========================================================================\n\n  /**\n   * Execute a plugin tool\n   */\n  async executeTool(toolId: string, context: Partial<ToolExecutionContext>): Promise<unknown> {\n    const toolEntry = this.tools.get(toolId);\n    if (!toolEntry) {\n      throw new Error(`Tool ${toolId} not found`);\n    }\n\n    const plugin = this.installed.get(toolEntry.pluginId);\n    if (!plugin || plugin.status !== \"enabled\") {\n      throw new Error(`Plugin ${toolEntry.pluginId} is not enabled`);\n    }\n\n    const fullContext: ToolExecutionContext = {\n      pluginId: toolEntry.pluginId,\n      toolId,\n      inputs: context.inputs || {},\n      executionId: context.executionId || `exec_${Date.now()}`,\n      pipelineId: context.pipelineId,\n      stepId: context.stepId,\n      userId: context.userId,\n      orgId: context.orgId,\n    };\n\n    try {\n      const result = await this.runWithTimeout(\n        () => toolEntry.tool.execute(fullContext),\n        this.config.timeout\n      );\n\n      plugin.stats.toolsExecuted++;\n      this.emit(\"tool:executed\", toolEntry.pluginId, toolId);\n\n      return result;\n    } catch (error) {\n      plugin.stats.errors++;\n      this.emit(\"plugin:error\", toolEntry.pluginId, error as Error);\n      throw error;\n    }\n  }\n\n  /**\n   * Get all available tools\n   */\n  getTools(): Array<{ pluginId: string; tool: PluginTool }> {\n    return Array.from(this.tools.values()).filter(entry => {\n      const plugin = this.installed.get(entry.pluginId);\n      return plugin && plugin.status === \"enabled\";\n    });\n  }\n\n  /**\n   * Get tool by ID\n   */\n  getTool(toolId: string): PluginTool | undefined {\n    return this.tools.get(toolId)?.tool;\n  }\n\n  // ==========================================================================\n  // ROUTES\n  // ==========================================================================\n\n  /**\n   * Get all plugin routes\n   */\n  getRoutes(): Array<{ pluginId: string; route: PluginRoute }> {\n    return Array.from(this.routes.values()).filter(entry => {\n      const plugin = this.installed.get(entry.pluginId);\n      return plugin && plugin.status === \"enabled\";\n    });\n  }\n\n  // ==========================================================================\n  // QUERIES\n  // ==========================================================================\n\n  /**\n   * Get all registered plugins\n   */\n  getRegistered(): PluginDefinition[] {\n    return Array.from(this.definitions.values());\n  }\n\n  /**\n   * Get all installed plugins\n   */\n  getInstalled(): InstalledPlugin[] {\n    return Array.from(this.installed.values());\n  }\n\n  /**\n   * Get plugin by ID\n   */\n  getPlugin(pluginId: string): InstalledPlugin | undefined {\n    return this.installed.get(pluginId);\n  }\n\n  /**\n   * Get plugins by capability\n   */\n  getByCapability(capability: PluginCapability): InstalledPlugin[] {\n    return this.getInstalled().filter(p => p.capabilities.includes(capability));\n  }\n\n  /**\n   * Get enabled plugins\n   */\n  getEnabled(): InstalledPlugin[] {\n    return this.getInstalled().filter(p => p.status === \"enabled\");\n  }\n\n  /**\n   * Check if plugin is installed\n   */\n  isInstalled(pluginId: string): boolean {\n    return this.installed.has(pluginId);\n  }\n\n  /**\n   * Check if plugin is enabled\n   */\n  isEnabled(pluginId: string): boolean {\n    const plugin = this.installed.get(pluginId);\n    return plugin?.status === \"enabled\";\n  }\n\n  // ==========================================================================\n  // PRIVATE METHODS\n  // ==========================================================================\n\n  private validateDefinition(definition: PluginDefinition): void {\n    const { metadata } = definition;\n\n    if (!metadata.id || !metadata.name || !metadata.version) {\n      throw new Error(\"Plugin must have id, name, and version\");\n    }\n\n    // Validate version format (semver-like)\n    if (!/^\\d+\\.\\d+\\.\\d+/.test(metadata.version)) {\n      throw new Error(\"Plugin version must be semver format (x.y.z)\");\n    }\n  }\n\n  private validateConfig(config: Record<string, unknown>, fields: any[]): void {\n    for (const field of fields) {\n      if (field.required && !(field.key in config)) {\n        throw new Error(`Missing required config field: ${field.key}`);\n      }\n\n      const value = config[field.key];\n      if (value !== undefined) {\n        // Type validation\n        switch (field.type) {\n          case \"number\":\n            if (typeof value !== \"number\") {\n              throw new Error(`Config field ${field.key} must be a number`);\n            }\n            if (field.validation?.min !== undefined && value < field.validation.min) {\n              throw new Error(`Config field ${field.key} must be >= ${field.validation.min}`);\n            }\n            if (field.validation?.max !== undefined && value > field.validation.max) {\n              throw new Error(`Config field ${field.key} must be <= ${field.validation.max}`);\n            }\n            break;\n          case \"boolean\":\n            if (typeof value !== \"boolean\") {\n              throw new Error(`Config field ${field.key} must be a boolean`);\n            }\n            break;\n          case \"string\":\n          case \"secret\":\n            if (typeof value !== \"string\") {\n              throw new Error(`Config field ${field.key} must be a string`);\n            }\n            if (field.validation?.pattern) {\n              const regex = new RegExp(field.validation.pattern);\n              if (!regex.test(value)) {\n                throw new Error(`Config field ${field.key} doesn't match pattern`);\n              }\n            }\n            break;\n        }\n      }\n    }\n  }\n\n  private async checkDependencies(definition: PluginDefinition): Promise<void> {\n    for (const dep of definition.dependencies || []) {\n      const depPlugin = this.installed.get(dep.pluginId);\n\n      if (!depPlugin) {\n        if (dep.optional) {\n          continue;\n        }\n        throw new Error(`Missing required dependency: ${dep.pluginId}`);\n      }\n\n      if (depPlugin.status !== \"enabled\") {\n        if (dep.optional) {\n          continue;\n        }\n        throw new Error(`Dependency ${dep.pluginId} is not enabled`);\n      }\n    }\n  }\n\n  private registerPluginResources(pluginId: string, definition: PluginDefinition): void {\n    // Register hooks\n    for (const hook of definition.hooks || []) {\n      const hookList = this.hooks.get(hook.type) || [];\n      hookList.push({ pluginId, hook });\n      this.hooks.set(hook.type, hookList);\n    }\n\n    // Register tools\n    for (const tool of definition.tools || []) {\n      const toolId = `${pluginId}:${tool.id}`;\n      this.tools.set(toolId, { pluginId, tool: { ...tool, id: toolId } });\n    }\n\n    // Register routes\n    for (const route of definition.routes || []) {\n      const routeKey = `${route.method}:${route.path}`;\n      this.routes.set(routeKey, { pluginId, route });\n    }\n  }\n\n  private unregisterPluginResources(pluginId: string): void {\n    // Unregister hooks\n    for (const [hookType, hooks] of this.hooks.entries()) {\n      this.hooks.set(hookType, hooks.filter(h => h.pluginId !== pluginId));\n    }\n\n    // Unregister tools\n    for (const [toolId, entry] of this.tools.entries()) {\n      if (entry.pluginId === pluginId) {\n        this.tools.delete(toolId);\n      }\n    }\n\n    // Unregister routes\n    for (const [routeKey, entry] of this.routes.entries()) {\n      if (entry.pluginId === pluginId) {\n        this.routes.delete(routeKey);\n      }\n    }\n  }\n\n  private async runWithTimeout<T>(fn: () => Promise<T>, timeout: number): Promise<T> {\n    return Promise.race([\n      fn(),\n      new Promise<T>((_, reject) =>\n        setTimeout(() => reject(new Error(\"Plugin operation timed out\")), timeout)\n      ),\n    ]);\n  }\n}\n\n// ============================================================================\n// SINGLETON & FACTORY\n// ============================================================================\n\nlet pluginManagerInstance: PluginManager | null = null;\n\nexport function getPluginManager(): PluginManager {\n  if (!pluginManagerInstance) {\n    pluginManagerInstance = new PluginManager();\n  }\n  return pluginManagerInstance;\n}\n\nexport function createPluginManager(config?: Partial<PluginManagerConfig>): PluginManager {\n  return new PluginManager(config);\n}\n","/**\n * Content Recycling Engine\n *\n * Transforms long-form content into multiple formats for distribution:\n * - Article  Thread (Twitter, Farcaster, Bluesky)\n * - Article  Short posts (LinkedIn, Mastodon, Threads)\n * - Article  Bullet summaries (Reddit, HN)\n * - Article  Email digest\n * - Article  RSS entry\n *\n * Also handles:\n * - Re-purposing old content for new channels\n * - A/B testing different angles\n * - Scheduling recycled content\n */\n\nimport type {\n  ContentArticle,\n  ContentBrief,\n  DistributionPacket,\n  RSSEntry,\n  EmailDigest,\n} from \"../types/content.js\";\n\n// =============================================================================\n// TYPES\n// =============================================================================\n\nexport interface RecyclingConfig {\n  // Character limits per platform\n  limits?: {\n    twitter?: number;      // 280\n    farcaster?: number;    // 1024\n    bluesky?: number;      // 300\n    linkedin?: number;     // 3000\n    mastodon?: number;     // 500\n    threads?: number;      // 500\n  };\n\n  // Include links in recycled content\n  includeLinks?: boolean;\n\n  // Include hashtags\n  includeHashtags?: boolean;\n\n  // Max hashtags per post\n  maxHashtags?: number;\n\n  // Brand voice settings\n  brandVoice?: \"professional\" | \"casual\" | \"technical\" | \"friendly\";\n\n  // Add call-to-action\n  ctaEnabled?: boolean;\n  ctaText?: string;\n}\n\nexport interface RecycledContent {\n  // Thread formats (array of posts)\n  twitterThread: string[];\n  farcasterThread: string[];\n  blueskyThread: string[];\n\n  // Single post formats\n  linkedinPost: string;\n  mastodonPost: string;\n  threadsPost: string;\n  farcasterCast: string;\n  blueskyPost: string;\n  lensPost: string;\n  paragraphPost: string;\n\n  // Long-form\n  redditPost: string;\n  hnPost: string;\n\n  // Email/RSS\n  emailDigest: EmailDigest;\n  rssEntry: RSSEntry;\n\n  // Metadata\n  hashtags: string[];\n  keyPoints: string[];\n  title: string;\n  slug: string;\n}\n\n// =============================================================================\n// DEFAULT CONFIG\n// =============================================================================\n\nconst DEFAULT_LIMITS = {\n  twitter: 280,\n  farcaster: 1024,\n  bluesky: 300,\n  linkedin: 3000,\n  mastodon: 500,\n  threads: 500,\n};\n\nconst DEFAULT_CONFIG: RecyclingConfig = {\n  limits: DEFAULT_LIMITS,\n  includeLinks: true,\n  includeHashtags: true,\n  maxHashtags: 5,\n  brandVoice: \"professional\",\n  ctaEnabled: true,\n  ctaText: \"Read more:\",\n};\n\n// =============================================================================\n// CONTENT RECYCLING ENGINE\n// =============================================================================\n\nexport class ContentRecycler {\n  private config: RecyclingConfig;\n\n  constructor(config: Partial<RecyclingConfig> = {}) {\n    this.config = { ...DEFAULT_CONFIG, ...config };\n  }\n\n  /**\n   * Recycle an article into all distribution formats\n   */\n  async recycle(\n    article: ContentArticle,\n    brief: ContentBrief,\n    canonicalUrl?: string\n  ): Promise<RecycledContent> {\n    // Extract key information\n    const title = brief.keyIdea || this.extractTitle(article.markdown);\n    const slug = article.seo?.slug || this.generateSlug(title);\n    const keyPoints = this.extractKeyPoints(article.markdown);\n    const hashtags = this.generateHashtags(brief, article);\n\n    // Generate all formats\n    const [\n      twitterThread,\n      farcasterThread,\n      blueskyThread,\n      linkedinPost,\n      mastodonPost,\n      threadsPost,\n      farcasterCast,\n      blueskyPost,\n      lensPost,\n      paragraphPost,\n      redditPost,\n      hnPost,\n      emailDigest,\n      rssEntry,\n    ] = await Promise.all([\n      this.generateTwitterThread(article, brief, keyPoints, hashtags, canonicalUrl),\n      this.generateFarcasterThread(article, brief, keyPoints, canonicalUrl),\n      this.generateBlueskyThread(article, brief, keyPoints, canonicalUrl),\n      this.generateLinkedInPost(article, brief, keyPoints, hashtags, canonicalUrl),\n      this.generateMastodonPost(article, brief, keyPoints, hashtags, canonicalUrl),\n      this.generateThreadsPost(article, brief, keyPoints, canonicalUrl),\n      this.generateFarcasterCast(article, brief, keyPoints, canonicalUrl),\n      this.generateBlueskyPost(article, brief, keyPoints, canonicalUrl),\n      this.generateLensPost(article, brief, keyPoints, canonicalUrl),\n      this.generateParagraphPost(article, brief),\n      this.generateRedditPost(article, brief, keyPoints, canonicalUrl),\n      this.generateHNPost(article, brief, canonicalUrl),\n      this.generateEmailDigest(article, brief, keyPoints, canonicalUrl),\n      this.generateRSSEntry(article, brief, canonicalUrl),\n    ]);\n\n    return {\n      twitterThread,\n      farcasterThread,\n      blueskyThread,\n      linkedinPost,\n      mastodonPost,\n      threadsPost,\n      farcasterCast,\n      blueskyPost,\n      lensPost,\n      paragraphPost,\n      redditPost,\n      hnPost,\n      emailDigest,\n      rssEntry,\n      hashtags,\n      keyPoints,\n      title,\n      slug,\n    };\n  }\n\n  /**\n   * Create a distribution packet from recycled content\n   */\n  createDistributionPacket(\n    recycled: RecycledContent,\n    article: ContentArticle,\n    canonicalUrl?: string\n  ): Omit<DistributionPacket, \"id\" | \"createdAt\"> {\n    return {\n      articleId: article.id,\n      baseSlug: recycled.slug,\n      canonicalUrl,\n      blogPost: article.markdown,\n      substackBody: article.markdown,\n      mirrorBody: article.markdown,\n      mediumBody: article.markdown,\n      devtoBody: article.markdown,\n      hashnodeBody: article.markdown,\n      githubReadme: this.generateReadme(article, recycled),\n      rssEntry: recycled.rssEntry,\n      emailDigest: recycled.emailDigest,\n      farcasterCast: recycled.farcasterCast,\n      lensPost: recycled.lensPost,\n      paragraphPost: recycled.paragraphPost,\n      blueskyPost: recycled.blueskyPost,\n      mastodonPost: recycled.mastodonPost,\n      twitterThread: recycled.twitterThread,\n      linkedinPost: recycled.linkedinPost,\n      redditDraft: recycled.redditPost,\n      threadsDraft: recycled.threadsPost,\n      status: \"ready\",\n    };\n  }\n\n  // ===========================================================================\n  // THREAD GENERATORS\n  // ===========================================================================\n\n  private async generateTwitterThread(\n    article: ContentArticle,\n    brief: ContentBrief,\n    keyPoints: string[],\n    hashtags: string[],\n    canonicalUrl?: string\n  ): Promise<string[]> {\n    const limit = this.config.limits?.twitter || 280;\n    const thread: string[] = [];\n\n    // Hook tweet\n    const hook = this.generateHook(brief, \"twitter\");\n    thread.push(this.truncate(hook, limit));\n\n    // Key points as individual tweets\n    for (const point of keyPoints.slice(0, 5)) {\n      const tweet = ` ${point}`;\n      thread.push(this.truncate(tweet, limit));\n    }\n\n    // CTA tweet\n    if (this.config.ctaEnabled && canonicalUrl) {\n      const hashtagStr = this.config.includeHashtags\n        ? `\\n\\n${hashtags.slice(0, 3).map(h => `#${h}`).join(\" \")}`\n        : \"\";\n      const cta = `${this.config.ctaText || \"Read more:\"}\\n${canonicalUrl}${hashtagStr}`;\n      thread.push(this.truncate(cta, limit));\n    }\n\n    return thread;\n  }\n\n  private async generateFarcasterThread(\n    article: ContentArticle,\n    brief: ContentBrief,\n    keyPoints: string[],\n    canonicalUrl?: string\n  ): Promise<string[]> {\n    const limit = this.config.limits?.farcaster || 1024;\n    const thread: string[] = [];\n\n    // Farcaster allows longer posts, so we can be more detailed\n    const hook = this.generateHook(brief, \"farcaster\");\n    const intro = `${hook}\\n\\nKey takeaways:`;\n    thread.push(this.truncate(intro, limit));\n\n    // Combine key points into fewer, longer posts\n    let currentPost = \"\";\n    for (const point of keyPoints) {\n      const addition = `\\n ${point}`;\n      if ((currentPost + addition).length > limit - 100) {\n        thread.push(currentPost.trim());\n        currentPost = addition;\n      } else {\n        currentPost += addition;\n      }\n    }\n    if (currentPost.trim()) {\n      thread.push(currentPost.trim());\n    }\n\n    // CTA\n    if (canonicalUrl) {\n      thread.push(`Read the full article: ${canonicalUrl}`);\n    }\n\n    return thread;\n  }\n\n  private async generateBlueskyThread(\n    article: ContentArticle,\n    brief: ContentBrief,\n    keyPoints: string[],\n    canonicalUrl?: string\n  ): Promise<string[]> {\n    const limit = this.config.limits?.bluesky || 300;\n    const thread: string[] = [];\n\n    // Hook\n    const hook = this.generateHook(brief, \"bluesky\");\n    thread.push(this.truncate(hook, limit));\n\n    // Key points\n    for (const point of keyPoints.slice(0, 4)) {\n      thread.push(this.truncate(` ${point}`, limit));\n    }\n\n    // CTA\n    if (canonicalUrl) {\n      thread.push(this.truncate(`Full article: ${canonicalUrl}`, limit));\n    }\n\n    return thread;\n  }\n\n  // ===========================================================================\n  // SINGLE POST GENERATORS\n  // ===========================================================================\n\n  private async generateLinkedInPost(\n    article: ContentArticle,\n    brief: ContentBrief,\n    keyPoints: string[],\n    hashtags: string[],\n    canonicalUrl?: string\n  ): Promise<string> {\n    const limit = this.config.limits?.linkedin || 3000;\n\n    const hook = this.generateHook(brief, \"linkedin\");\n    const pointsList = keyPoints.map(p => ` ${p}`).join(\"\\n\");\n    const hashtagStr = this.config.includeHashtags\n      ? `\\n\\n${hashtags.slice(0, 5).map(h => `#${h}`).join(\" \")}`\n      : \"\";\n    const link = canonicalUrl ? `\\n\\n ${canonicalUrl}` : \"\";\n\n    const post = `${hook}\\n\\n${pointsList}${link}${hashtagStr}`;\n    return this.truncate(post, limit);\n  }\n\n  private async generateMastodonPost(\n    article: ContentArticle,\n    brief: ContentBrief,\n    keyPoints: string[],\n    hashtags: string[],\n    canonicalUrl?: string\n  ): Promise<string> {\n    const limit = this.config.limits?.mastodon || 500;\n\n    const hook = this.generateHook(brief, \"mastodon\");\n    const points = keyPoints.slice(0, 2).map(p => ` ${p}`).join(\"\\n\");\n    const hashtagStr = this.config.includeHashtags\n      ? `\\n\\n${hashtags.slice(0, 3).map(h => `#${h}`).join(\" \")}`\n      : \"\";\n    const link = canonicalUrl ? `\\n\\n${canonicalUrl}` : \"\";\n\n    const post = `${hook}\\n\\n${points}${link}${hashtagStr}`;\n    return this.truncate(post, limit);\n  }\n\n  private async generateThreadsPost(\n    article: ContentArticle,\n    brief: ContentBrief,\n    keyPoints: string[],\n    canonicalUrl?: string\n  ): Promise<string> {\n    const limit = this.config.limits?.threads || 500;\n\n    const hook = this.generateHook(brief, \"threads\");\n    const points = keyPoints.slice(0, 2).map(p => ` ${p}`).join(\"\\n\");\n    const link = canonicalUrl ? `\\n\\n${canonicalUrl}` : \"\";\n\n    const post = `${hook}\\n\\n${points}${link}`;\n    return this.truncate(post, limit);\n  }\n\n  private async generateFarcasterCast(\n    article: ContentArticle,\n    brief: ContentBrief,\n    keyPoints: string[],\n    canonicalUrl?: string\n  ): Promise<string> {\n    const limit = this.config.limits?.farcaster || 1024;\n\n    const hook = this.generateHook(brief, \"farcaster\");\n    const points = keyPoints.slice(0, 3).map(p => ` ${p}`).join(\"\\n\");\n    const link = canonicalUrl ? `\\n\\n${canonicalUrl}` : \"\";\n\n    const post = `${hook}\\n\\n${points}${link}`;\n    return this.truncate(post, limit);\n  }\n\n  private async generateBlueskyPost(\n    article: ContentArticle,\n    brief: ContentBrief,\n    keyPoints: string[],\n    canonicalUrl?: string\n  ): Promise<string> {\n    const limit = this.config.limits?.bluesky || 300;\n\n    const hook = this.generateHook(brief, \"bluesky\");\n    const link = canonicalUrl ? `\\n\\n${canonicalUrl}` : \"\";\n\n    const post = `${hook}${link}`;\n    return this.truncate(post, limit);\n  }\n\n  private async generateLensPost(\n    article: ContentArticle,\n    brief: ContentBrief,\n    keyPoints: string[],\n    canonicalUrl?: string\n  ): Promise<string> {\n    // Lens supports longer posts (up to 10KB)\n    const limit = 5000;\n\n    const hook = this.generateHook(brief, \"lens\");\n    const points = keyPoints.map(p => ` ${p}`).join(\"\\n\");\n    const link = canonicalUrl ? `\\n\\nRead more: ${canonicalUrl}` : \"\";\n\n    const post = `${hook}\\n\\n${points}${link}`;\n    return this.truncate(post, limit);\n  }\n\n  private async generateParagraphPost(\n    article: ContentArticle,\n    brief: ContentBrief\n  ): Promise<string> {\n    // Paragraph is a publishing platform - use the full article\n    return article.markdown;\n  }\n\n  // ===========================================================================\n  // LONG-FORM GENERATORS\n  // ===========================================================================\n\n  private async generateRedditPost(\n    article: ContentArticle,\n    brief: ContentBrief,\n    keyPoints: string[],\n    canonicalUrl?: string\n  ): Promise<string> {\n    const title = brief.keyIdea;\n    const tldr = keyPoints.slice(0, 3).map(p => `- ${p}`).join(\"\\n\");\n    const link = canonicalUrl ? `\\n\\n[Full article](${canonicalUrl})` : \"\";\n\n    return `# ${title}\\n\\n**TL;DR:**\\n${tldr}\\n\\n---\\n\\n${article.markdown.slice(0, 5000)}${link}`;\n  }\n\n  private async generateHNPost(\n    article: ContentArticle,\n    brief: ContentBrief,\n    canonicalUrl?: string\n  ): Promise<string> {\n    // HN prefers links to articles, minimal commentary\n    return canonicalUrl || brief.keyIdea;\n  }\n\n  // ===========================================================================\n  // EMAIL/RSS GENERATORS\n  // ===========================================================================\n\n  private async generateEmailDigest(\n    article: ContentArticle,\n    brief: ContentBrief,\n    keyPoints: string[],\n    canonicalUrl?: string\n  ): Promise<EmailDigest> {\n    const title = brief.keyIdea;\n\n    const htmlBody = `\n<!DOCTYPE html>\n<html>\n<head><meta charset=\"utf-8\"></head>\n<body style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;\">\n  <h1 style=\"color: #1a1a1a;\">${title}</h1>\n\n  <h2 style=\"color: #666;\">Key Takeaways</h2>\n  <ul>\n    ${keyPoints.map(p => `<li>${p}</li>`).join(\"\\n    \")}\n  </ul>\n\n  ${canonicalUrl ? `<p><a href=\"${canonicalUrl}\" style=\"color: #0066cc;\">Read the full article </a></p>` : \"\"}\n\n  <hr style=\"border: none; border-top: 1px solid #eee; margin: 30px 0;\">\n  <p style=\"color: #999; font-size: 12px;\">You're receiving this because you subscribed to gICM updates.</p>\n</body>\n</html>`;\n\n    const textBody = `${title}\\n\\n${keyPoints.map(p => ` ${p}`).join(\"\\n\")}\\n\\n${canonicalUrl ? `Read more: ${canonicalUrl}` : \"\"}`;\n\n    return {\n      subject: title,\n      previewText: keyPoints[0] || title,\n      htmlBody,\n      textBody,\n    };\n  }\n\n  private async generateRSSEntry(\n    article: ContentArticle,\n    brief: ContentBrief,\n    canonicalUrl?: string\n  ): Promise<RSSEntry> {\n    const title = brief.keyIdea;\n    const link = canonicalUrl || `https://gicm.dev/blog/${article.seo?.slug || \"post\"}`;\n\n    return {\n      title,\n      link,\n      description: article.seo?.metaDescription || article.markdown.slice(0, 500),\n      pubDate: new Date().toISOString(),\n      guid: article.id,\n      categories: brief.seedKeywords,\n    };\n  }\n\n  // ===========================================================================\n  // HELPERS\n  // ===========================================================================\n\n  private generateHook(brief: ContentBrief, platform: string): string {\n    const hooks: Record<string, string> = {\n      twitter: ` ${brief.keyIdea}`,\n      farcaster: `${brief.keyIdea}`,\n      bluesky: `${brief.keyIdea}`,\n      linkedin: `${brief.keyIdea}\\n\\nHere's what you need to know:`,\n      mastodon: `${brief.keyIdea}`,\n      threads: `${brief.keyIdea}`,\n      lens: `${brief.keyIdea}`,\n    };\n\n    return hooks[platform] || brief.keyIdea;\n  }\n\n  private extractTitle(markdown: string): string {\n    const match = markdown.match(/^#\\s+(.+)$/m);\n    return match ? match[1] : \"Untitled\";\n  }\n\n  private extractKeyPoints(markdown: string): string[] {\n    const points: string[] = [];\n\n    // Extract bullet points\n    const bulletMatches = markdown.match(/^[-*]\\s+(.+)$/gm);\n    if (bulletMatches) {\n      points.push(...bulletMatches.slice(0, 10).map(m => m.replace(/^[-*]\\s+/, \"\").trim()));\n    }\n\n    // Extract numbered lists\n    const numberedMatches = markdown.match(/^\\d+\\.\\s+(.+)$/gm);\n    if (numberedMatches) {\n      points.push(...numberedMatches.slice(0, 10).map(m => m.replace(/^\\d+\\.\\s+/, \"\").trim()));\n    }\n\n    // If no lists found, extract first sentences of paragraphs\n    if (points.length === 0) {\n      const paragraphs = markdown.split(/\\n\\n+/).filter(p => !p.startsWith(\"#\") && p.length > 50);\n      for (const para of paragraphs.slice(0, 5)) {\n        const firstSentence = para.match(/^[^.!?]+[.!?]/);\n        if (firstSentence) {\n          points.push(firstSentence[0].trim());\n        }\n      }\n    }\n\n    return points.slice(0, 7);\n  }\n\n  private generateHashtags(brief: ContentBrief, article: ContentArticle): string[] {\n    const hashtags = new Set<string>();\n\n    // From brief keywords\n    for (const keyword of brief.seedKeywords || []) {\n      hashtags.add(keyword.replace(/\\s+/g, \"\").toLowerCase());\n    }\n\n    // From SEO keywords\n    for (const keyword of article.seo?.keywords || []) {\n      hashtags.add(keyword.replace(/\\s+/g, \"\").toLowerCase());\n    }\n\n    // Default crypto/AI hashtags\n    const defaults = [\"web3\", \"crypto\", \"ai\", \"defi\", \"solana\"];\n    for (const d of defaults) {\n      if (hashtags.size < (this.config.maxHashtags || 5)) {\n        hashtags.add(d);\n      }\n    }\n\n    return Array.from(hashtags).slice(0, this.config.maxHashtags || 5);\n  }\n\n  private generateSlug(title: string): string {\n    return title\n      .toLowerCase()\n      .replace(/[^a-z0-9]+/g, \"-\")\n      .replace(/^-|-$/g, \"\")\n      .slice(0, 60);\n  }\n\n  private generateReadme(article: ContentArticle, recycled: RecycledContent): string {\n    return `# ${recycled.title}\\n\\n${article.markdown}`;\n  }\n\n  private truncate(text: string, maxLength: number): string {\n    if (text.length <= maxLength) return text;\n    return text.slice(0, maxLength - 3) + \"...\";\n  }\n}\n\n// =============================================================================\n// SINGLETON\n// =============================================================================\n\nlet instance: ContentRecycler | null = null;\n\nexport function getContentRecycler(config?: Partial<RecyclingConfig>): ContentRecycler {\n  if (!instance) {\n    instance = new ContentRecycler(config);\n  }\n  return instance;\n}\n\nexport function createContentRecycler(config?: Partial<RecyclingConfig>): ContentRecycler {\n  return new ContentRecycler(config);\n}\n\nexport default ContentRecycler;\n","/**\n * SDK Types & Schemas\n * Phase 9E: SDK Generation\n */\n\nimport { z } from \"zod\";\n\n// ============================================================================\n// SDK CONFIG\n// ============================================================================\n\nexport const SDKConfigSchema = z.object({\n  baseUrl: z.string().url(),\n  apiKey: z.string().optional(),\n  timeout: z.number().default(30000),\n  retries: z.number().default(3),\n  headers: z.record(z.string()).optional(),\n});\nexport type SDKConfig = z.infer<typeof SDKConfigSchema>;\n\n// ============================================================================\n// API RESPONSE TYPES\n// ============================================================================\n\nexport const ApiResponseSchema = <T extends z.ZodTypeAny>(dataSchema: T) =>\n  z.object({\n    ok: z.boolean(),\n    data: dataSchema.optional(),\n    error: z.string().optional(),\n    message: z.string().optional(),\n  });\n\nexport const PaginatedResponseSchema = <T extends z.ZodTypeAny>(itemSchema: T) =>\n  z.object({\n    ok: z.boolean(),\n    items: z.array(itemSchema),\n    total: z.number(),\n    page: z.number(),\n    pageSize: z.number(),\n    hasMore: z.boolean(),\n  });\n\n// ============================================================================\n// RESOURCE SCHEMAS (for SDK client generation)\n// ============================================================================\n\n// Pipeline\nexport const PipelineSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  description: z.string().optional(),\n  status: z.enum([\"draft\", \"active\", \"paused\", \"archived\"]),\n  steps: z.array(z.object({\n    id: z.string(),\n    tool: z.string(),\n    name: z.string().optional(),\n    inputs: z.record(z.unknown()),\n    dependsOn: z.array(z.string()).optional(),\n  })),\n  createdAt: z.string(),\n  updatedAt: z.string(),\n});\nexport type Pipeline = z.infer<typeof PipelineSchema>;\n\n// Pipeline Execution\nexport const ExecutionSchema = z.object({\n  id: z.string(),\n  pipelineId: z.string(),\n  pipelineName: z.string(),\n  status: z.enum([\"pending\", \"running\", \"completed\", \"failed\", \"cancelled\"]),\n  progress: z.number(),\n  currentStep: z.string().nullable(),\n  steps: z.array(z.object({\n    id: z.string(),\n    name: z.string(),\n    status: z.enum([\"pending\", \"running\", \"completed\", \"failed\", \"skipped\"]),\n    startedAt: z.number().nullable(),\n    completedAt: z.number().nullable(),\n    output: z.unknown().nullable(),\n    error: z.string().nullable(),\n  })),\n  startedAt: z.number(),\n  completedAt: z.number().nullable(),\n  result: z.unknown().nullable(),\n  error: z.string().nullable(),\n});\nexport type Execution = z.infer<typeof ExecutionSchema>;\n\n// Schedule\nexport const ScheduleSchema = z.object({\n  id: z.string(),\n  pipelineId: z.string(),\n  name: z.string(),\n  description: z.string().optional(),\n  cron: z.string(),\n  timezone: z.string(),\n  status: z.enum([\"active\", \"paused\", \"disabled\"]),\n  nextRunAt: z.string().optional(),\n  lastRunAt: z.string().optional(),\n  createdAt: z.string(),\n  updatedAt: z.string(),\n});\nexport type Schedule = z.infer<typeof ScheduleSchema>;\n\n// Budget\nexport const BudgetSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  description: z.string().optional(),\n  limit: z.number(),\n  spent: z.number(),\n  period: z.enum([\"daily\", \"weekly\", \"monthly\"]),\n  scope: z.enum([\"global\", \"pipeline\", \"user\"]),\n  scopeId: z.string().optional(),\n  status: z.enum([\"active\", \"paused\", \"exceeded\"]),\n  alertThresholds: z.array(z.number()),\n  autoPause: z.boolean(),\n  createdAt: z.string(),\n  updatedAt: z.string(),\n});\nexport type Budget = z.infer<typeof BudgetSchema>;\n\n// Webhook\nexport const WebhookSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  url: z.string().url(),\n  events: z.array(z.string()),\n  enabled: z.boolean(),\n  lastTriggeredAt: z.string().optional(),\n  lastStatus: z.number().optional(),\n  failureCount: z.number(),\n  createdAt: z.string(),\n  updatedAt: z.string(),\n});\nexport type Webhook = z.infer<typeof WebhookSchema>;\n\n// Analytics Summary\nexport const AnalyticsSummarySchema = z.object({\n  period: z.string(),\n  totalExecutions: z.number(),\n  successRate: z.number(),\n  avgDuration: z.number(),\n  totalTokens: z.number(),\n  totalCost: z.number(),\n  executionTrend: z.number(),\n  costTrend: z.number(),\n  topPipelines: z.array(z.object({\n    id: z.string(),\n    name: z.string(),\n    count: z.number(),\n    successRate: z.number(),\n  })),\n});\nexport type AnalyticsSummary = z.infer<typeof AnalyticsSummarySchema>;\n\n// Queue Job\nexport const QueueJobSchema = z.object({\n  id: z.string(),\n  pipelineId: z.string(),\n  pipelineName: z.string(),\n  status: z.enum([\"waiting\", \"active\", \"completed\", \"failed\", \"delayed\"]),\n  priority: z.enum([\"low\", \"normal\", \"high\", \"critical\"]),\n  progress: z.number(),\n  createdAt: z.string(),\n  startedAt: z.string().optional(),\n  completedAt: z.string().optional(),\n});\nexport type QueueJob = z.infer<typeof QueueJobSchema>;\n\n// Organization\nexport const OrganizationSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  slug: z.string(),\n  plan: z.enum([\"free\", \"pro\", \"team\", \"enterprise\"]),\n  settings: z.record(z.unknown()),\n  createdAt: z.string(),\n  updatedAt: z.string(),\n});\nexport type Organization = z.infer<typeof OrganizationSchema>;\n\n// Member\nexport const MemberSchema = z.object({\n  id: z.string(),\n  userId: z.string(),\n  email: z.string(),\n  displayName: z.string(),\n  avatarUrl: z.string().optional(),\n  role: z.enum([\"owner\", \"admin\", \"editor\", \"viewer\"]),\n  status: z.enum([\"active\", \"inactive\", \"suspended\"]),\n  joinedAt: z.string(),\n  lastActiveAt: z.string().optional(),\n});\nexport type Member = z.infer<typeof MemberSchema>;\n\n// Audit Event\nexport const AuditEventSchema = z.object({\n  id: z.string(),\n  timestamp: z.string(),\n  category: z.string(),\n  action: z.string(),\n  severity: z.enum([\"debug\", \"info\", \"warning\", \"error\", \"critical\"]),\n  result: z.enum([\"success\", \"failure\", \"partial\", \"pending\"]),\n  description: z.string(),\n  context: z.object({\n    userId: z.string().optional(),\n    userEmail: z.string().optional(),\n    orgId: z.string().optional(),\n    ipAddress: z.string().optional(),\n  }),\n  resource: z.object({\n    type: z.string(),\n    id: z.string(),\n    name: z.string().optional(),\n  }).optional(),\n});\nexport type AuditEvent = z.infer<typeof AuditEventSchema>;\n\n// ============================================================================\n// REQUEST TYPES\n// ============================================================================\n\n// Pipeline Create/Update\nexport const CreatePipelineInputSchema = z.object({\n  name: z.string(),\n  description: z.string().optional(),\n  steps: z.array(z.object({\n    id: z.string(),\n    tool: z.string(),\n    name: z.string().optional(),\n    inputs: z.record(z.unknown()),\n    dependsOn: z.array(z.string()).optional(),\n  })),\n});\nexport type CreatePipelineInput = z.infer<typeof CreatePipelineInputSchema>;\n\n// Execute Pipeline\nexport const ExecutePipelineInputSchema = z.object({\n  pipelineId: z.string(),\n  inputs: z.record(z.unknown()).optional(),\n});\nexport type ExecutePipelineInput = z.infer<typeof ExecutePipelineInputSchema>;\n\n// Schedule Create\nexport const CreateScheduleInputSchema = z.object({\n  pipelineId: z.string(),\n  name: z.string(),\n  description: z.string().optional(),\n  cron: z.string(),\n  timezone: z.string().optional(),\n});\nexport type CreateScheduleInput = z.infer<typeof CreateScheduleInputSchema>;\n\n// Budget Create\nexport const CreateBudgetInputSchema = z.object({\n  name: z.string(),\n  description: z.string().optional(),\n  limit: z.number().positive(),\n  period: z.enum([\"daily\", \"weekly\", \"monthly\"]),\n  scope: z.enum([\"global\", \"pipeline\", \"user\"]).optional(),\n  scopeId: z.string().optional(),\n  alertThresholds: z.array(z.number()).optional(),\n  autoPause: z.boolean().optional(),\n});\nexport type CreateBudgetInput = z.infer<typeof CreateBudgetInputSchema>;\n\n// Webhook Create\nexport const CreateWebhookInputSchema = z.object({\n  name: z.string(),\n  url: z.string().url(),\n  secret: z.string().optional(),\n  events: z.array(z.string()),\n  enabled: z.boolean().optional(),\n});\nexport type CreateWebhookInput = z.infer<typeof CreateWebhookInputSchema>;\n\n// Queue Job Create\nexport const CreateQueueJobInputSchema = z.object({\n  pipelineId: z.string(),\n  pipelineName: z.string(),\n  inputs: z.record(z.unknown()).optional(),\n  steps: z.array(z.object({\n    id: z.string(),\n    tool: z.string(),\n    inputs: z.record(z.unknown()).optional(),\n    dependsOn: z.array(z.string()).optional(),\n  })),\n  priority: z.enum([\"low\", \"normal\", \"high\", \"critical\"]).optional(),\n  webhookUrl: z.string().url().optional(),\n});\nexport type CreateQueueJobInput = z.infer<typeof CreateQueueJobInputSchema>;\n\n// Invite Member\nexport const InviteMemberInputSchema = z.object({\n  email: z.string().email(),\n  role: z.enum([\"admin\", \"editor\", \"viewer\"]),\n  message: z.string().optional(),\n});\nexport type InviteMemberInput = z.infer<typeof InviteMemberInputSchema>;\n","/**\n * SDK Client Implementation\n * Phase 9E: SDK Generation\n */\n\nimport {\n  SDKConfig,\n  Pipeline,\n  Execution,\n  Schedule,\n  Budget,\n  Webhook,\n  AnalyticsSummary,\n  QueueJob,\n  Organization,\n  Member,\n  AuditEvent,\n  CreatePipelineInput,\n  ExecutePipelineInput,\n  CreateScheduleInput,\n  CreateBudgetInput,\n  CreateWebhookInput,\n  CreateQueueJobInput,\n  InviteMemberInput,\n} from \"./types.js\";\n\n// ============================================================================\n// HTTP CLIENT\n// ============================================================================\n\nclass HttpClient {\n  private baseUrl: string;\n  private headers: Record<string, string>;\n  private timeout: number;\n  private retries: number;\n\n  constructor(config: SDKConfig) {\n    this.baseUrl = config.baseUrl.replace(/\\/$/, \"\");\n    this.timeout = config.timeout || 30000;\n    this.retries = config.retries || 3;\n    this.headers = {\n      \"Content-Type\": \"application/json\",\n      ...(config.apiKey && { Authorization: `Bearer ${config.apiKey}` }),\n      ...config.headers,\n    };\n  }\n\n  async request<T>(\n    method: string,\n    path: string,\n    options?: { body?: unknown; query?: Record<string, string> }\n  ): Promise<T> {\n    let url = `${this.baseUrl}${path}`;\n\n    if (options?.query) {\n      const params = new URLSearchParams(options.query);\n      url += `?${params.toString()}`;\n    }\n\n    let lastError: Error | null = null;\n\n    for (let attempt = 0; attempt <= this.retries; attempt++) {\n      try {\n        const controller = new AbortController();\n        const timeoutId = setTimeout(() => controller.abort(), this.timeout);\n\n        const response = await fetch(url, {\n          method,\n          headers: this.headers,\n          body: options?.body ? JSON.stringify(options.body) : undefined,\n          signal: controller.signal,\n        });\n\n        clearTimeout(timeoutId);\n\n        if (!response.ok) {\n          const errorData = await response.json().catch(() => ({}));\n          throw new SDKError(\n            errorData.error || `HTTP ${response.status}`,\n            response.status,\n            errorData\n          );\n        }\n\n        return await response.json();\n      } catch (error) {\n        lastError = error as Error;\n\n        // Don't retry on client errors\n        if (error instanceof SDKError && error.status >= 400 && error.status < 500) {\n          throw error;\n        }\n\n        // Wait before retry\n        if (attempt < this.retries) {\n          await new Promise((r) => setTimeout(r, Math.pow(2, attempt) * 1000));\n        }\n      }\n    }\n\n    throw lastError;\n  }\n\n  get<T>(path: string, query?: Record<string, string>): Promise<T> {\n    return this.request<T>(\"GET\", path, { query });\n  }\n\n  post<T>(path: string, body?: unknown): Promise<T> {\n    return this.request<T>(\"POST\", path, { body });\n  }\n\n  put<T>(path: string, body?: unknown): Promise<T> {\n    return this.request<T>(\"PUT\", path, { body });\n  }\n\n  patch<T>(path: string, body?: unknown): Promise<T> {\n    return this.request<T>(\"PATCH\", path, { body });\n  }\n\n  delete<T>(path: string): Promise<T> {\n    return this.request<T>(\"DELETE\", path);\n  }\n}\n\n// ============================================================================\n// ERROR CLASS\n// ============================================================================\n\nexport class SDKError extends Error {\n  constructor(\n    message: string,\n    public status: number,\n    public data?: unknown\n  ) {\n    super(message);\n    this.name = \"SDKError\";\n  }\n}\n\n// ============================================================================\n// RESOURCE CLIENTS\n// ============================================================================\n\nclass PipelinesClient {\n  constructor(private http: HttpClient) {}\n\n  async list(options?: { page?: number; pageSize?: number }): Promise<{ pipelines: Pipeline[]; total: number }> {\n    return this.http.get(\"/api/pipelines\", {\n      page: String(options?.page || 1),\n      pageSize: String(options?.pageSize || 20),\n    });\n  }\n\n  async get(id: string): Promise<Pipeline> {\n    const response = await this.http.get<{ ok: boolean; pipeline: Pipeline }>(`/api/pipelines/${id}`);\n    return response.pipeline;\n  }\n\n  async create(input: CreatePipelineInput): Promise<Pipeline> {\n    const response = await this.http.post<{ ok: boolean; pipeline: Pipeline }>(\"/api/pipelines\", input);\n    return response.pipeline;\n  }\n\n  async update(id: string, input: Partial<CreatePipelineInput>): Promise<Pipeline> {\n    const response = await this.http.patch<{ ok: boolean; pipeline: Pipeline }>(`/api/pipelines/${id}`, input);\n    return response.pipeline;\n  }\n\n  async delete(id: string): Promise<void> {\n    await this.http.delete(`/api/pipelines/${id}`);\n  }\n\n  async execute(input: ExecutePipelineInput): Promise<Execution> {\n    const response = await this.http.post<{ ok: boolean; executionId: string }>(\"/api/pipelines/execute\", {\n      pipeline: { id: input.pipelineId, name: \"\", steps: [] },\n      inputs: input.inputs,\n    });\n    return this.getExecution(response.executionId);\n  }\n\n  async getExecution(executionId: string): Promise<Execution> {\n    const response = await this.http.get<{ ok: boolean; execution: Execution }>(`/api/pipelines/${executionId}/status`);\n    return response.execution;\n  }\n\n  async listExecutions(options?: { status?: string; limit?: number }): Promise<Execution[]> {\n    const response = await this.http.get<{ ok: boolean; executions: Execution[] }>(\"/api/pipelines/executions\", {\n      ...(options?.status && { status: options.status }),\n      ...(options?.limit && { limit: String(options.limit) }),\n    });\n    return response.executions;\n  }\n\n  async cancelExecution(executionId: string): Promise<void> {\n    await this.http.post(`/api/pipelines/${executionId}/cancel`);\n  }\n}\n\nclass SchedulesClient {\n  constructor(private http: HttpClient) {}\n\n  async list(): Promise<Schedule[]> {\n    const response = await this.http.get<{ ok: boolean; schedules: Schedule[] }>(\"/api/schedules\");\n    return response.schedules;\n  }\n\n  async get(id: string): Promise<Schedule> {\n    const response = await this.http.get<{ ok: boolean; schedule: Schedule }>(`/api/schedules/${id}`);\n    return response.schedule;\n  }\n\n  async create(input: CreateScheduleInput): Promise<Schedule> {\n    const response = await this.http.post<{ ok: boolean; schedule: Schedule }>(\"/api/schedules\", input);\n    return response.schedule;\n  }\n\n  async update(id: string, input: Partial<CreateScheduleInput>): Promise<Schedule> {\n    const response = await this.http.patch<{ ok: boolean; schedule: Schedule }>(`/api/schedules/${id}`, input);\n    return response.schedule;\n  }\n\n  async delete(id: string): Promise<void> {\n    await this.http.delete(`/api/schedules/${id}`);\n  }\n\n  async pause(id: string): Promise<void> {\n    await this.http.post(`/api/schedules/${id}/pause`);\n  }\n\n  async resume(id: string): Promise<void> {\n    await this.http.post(`/api/schedules/${id}/resume`);\n  }\n\n  async trigger(id: string): Promise<void> {\n    await this.http.post(`/api/schedules/${id}/trigger`);\n  }\n}\n\nclass BudgetsClient {\n  constructor(private http: HttpClient) {}\n\n  async list(): Promise<Budget[]> {\n    const response = await this.http.get<{ ok: boolean; budgets: Budget[] }>(\"/api/budgets\");\n    return response.budgets;\n  }\n\n  async get(id: string): Promise<Budget> {\n    const response = await this.http.get<{ ok: boolean; budget: Budget }>(`/api/budgets/${id}`);\n    return response.budget;\n  }\n\n  async create(input: CreateBudgetInput): Promise<Budget> {\n    const response = await this.http.post<{ ok: boolean; budget: Budget }>(\"/api/budgets\", input);\n    return response.budget;\n  }\n\n  async update(id: string, input: Partial<CreateBudgetInput>): Promise<Budget> {\n    const response = await this.http.patch<{ ok: boolean; budget: Budget }>(`/api/budgets/${id}`, input);\n    return response.budget;\n  }\n\n  async delete(id: string): Promise<void> {\n    await this.http.delete(`/api/budgets/${id}`);\n  }\n\n  async pause(id: string): Promise<void> {\n    await this.http.post(`/api/budgets/${id}/pause`);\n  }\n\n  async resume(id: string): Promise<void> {\n    await this.http.post(`/api/budgets/${id}/resume`);\n  }\n\n  async reset(id: string): Promise<void> {\n    await this.http.post(`/api/budgets/${id}/reset`);\n  }\n}\n\nclass WebhooksClient {\n  constructor(private http: HttpClient) {}\n\n  async list(): Promise<Webhook[]> {\n    const response = await this.http.get<{ ok: boolean; webhooks: Webhook[] }>(\"/api/webhooks\");\n    return response.webhooks;\n  }\n\n  async get(id: string): Promise<Webhook> {\n    const response = await this.http.get<{ ok: boolean; webhook: Webhook }>(`/api/webhooks/${id}`);\n    return response.webhook;\n  }\n\n  async create(input: CreateWebhookInput): Promise<Webhook> {\n    const response = await this.http.post<{ ok: boolean; webhook: Webhook }>(\"/api/webhooks\", input);\n    return response.webhook;\n  }\n\n  async update(id: string, input: Partial<CreateWebhookInput>): Promise<Webhook> {\n    const response = await this.http.patch<{ ok: boolean; webhook: Webhook }>(`/api/webhooks/${id}`, input);\n    return response.webhook;\n  }\n\n  async delete(id: string): Promise<void> {\n    await this.http.delete(`/api/webhooks/${id}`);\n  }\n\n  async test(id: string): Promise<void> {\n    await this.http.post(`/api/webhooks/${id}/test`);\n  }\n}\n\nclass AnalyticsClient {\n  constructor(private http: HttpClient) {}\n\n  async getSummary(period?: \"day\" | \"week\" | \"month\"): Promise<AnalyticsSummary> {\n    const response = await this.http.get<{ ok: boolean; summary: AnalyticsSummary }>(\"/api/analytics/summary\", {\n      ...(period && { period }),\n    });\n    return response.summary;\n  }\n\n  async getExecutions(options?: { limit?: number; pipelineId?: string }): Promise<Execution[]> {\n    const response = await this.http.get<{ ok: boolean; executions: Execution[] }>(\"/api/analytics/executions\", {\n      ...(options?.limit && { limit: String(options.limit) }),\n      ...(options?.pipelineId && { pipelineId: options.pipelineId }),\n    });\n    return response.executions;\n  }\n\n  async getTokenUsage(period?: \"day\" | \"week\" | \"month\"): Promise<{ total: number; byPipeline: Record<string, number> }> {\n    return this.http.get(\"/api/analytics/tokens\", { ...(period && { period }) });\n  }\n\n  async getCosts(period?: \"day\" | \"week\" | \"month\"): Promise<{ totalCost: number; costTrend: number }> {\n    return this.http.get(\"/api/analytics/costs\", { ...(period && { period }) });\n  }\n}\n\nclass QueueClient {\n  constructor(private http: HttpClient) {}\n\n  async getStats(): Promise<{ pending: number; active: number; completed: number; failed: number }> {\n    const response = await this.http.get<{ ok: boolean; stats: any }>(\"/api/queue/stats\");\n    return response.stats;\n  }\n\n  async addJob(input: CreateQueueJobInput): Promise<string> {\n    const response = await this.http.post<{ ok: boolean; jobId: string }>(\"/api/queue/jobs\", input);\n    return response.jobId;\n  }\n\n  async getJob(id: string): Promise<QueueJob> {\n    const response = await this.http.get<{ ok: boolean; job: QueueJob }>(`/api/queue/jobs/${id}`);\n    return response.job;\n  }\n\n  async pause(): Promise<void> {\n    await this.http.post(\"/api/queue/pause\");\n  }\n\n  async resume(): Promise<void> {\n    await this.http.post(\"/api/queue/resume\");\n  }\n}\n\nclass OrganizationsClient {\n  constructor(private http: HttpClient) {}\n\n  async getCurrent(): Promise<Organization> {\n    const response = await this.http.get<{ ok: boolean; organization: Organization }>(\"/api/orgs/current\");\n    return response.organization;\n  }\n\n  async update(input: Partial<{ name: string; settings: Record<string, unknown> }>): Promise<Organization> {\n    const response = await this.http.patch<{ ok: boolean; organization: Organization }>(\"/api/orgs/current\", input);\n    return response.organization;\n  }\n\n  async listMembers(): Promise<Member[]> {\n    const response = await this.http.get<{ ok: boolean; members: Member[] }>(\"/api/orgs/current/members\");\n    return response.members;\n  }\n\n  async inviteMember(input: InviteMemberInput): Promise<{ inviteId: string }> {\n    return this.http.post(\"/api/orgs/current/invites\", input);\n  }\n\n  async updateMemberRole(memberId: string, role: \"admin\" | \"editor\" | \"viewer\"): Promise<Member> {\n    const response = await this.http.patch<{ ok: boolean; member: Member }>(`/api/orgs/current/members/${memberId}`, { role });\n    return response.member;\n  }\n\n  async removeMember(memberId: string): Promise<void> {\n    await this.http.delete(`/api/orgs/current/members/${memberId}`);\n  }\n}\n\nclass AuditClient {\n  constructor(private http: HttpClient) {}\n\n  async list(options?: {\n    category?: string;\n    severity?: string;\n    startDate?: string;\n    endDate?: string;\n    limit?: number;\n    offset?: number;\n  }): Promise<{ events: AuditEvent[]; total: number }> {\n    return this.http.get(\"/api/audit\", {\n      ...(options?.category && { category: options.category }),\n      ...(options?.severity && { severity: options.severity }),\n      ...(options?.startDate && { startDate: options.startDate }),\n      ...(options?.endDate && { endDate: options.endDate }),\n      ...(options?.limit && { limit: String(options.limit) }),\n      ...(options?.offset && { offset: String(options.offset) }),\n    });\n  }\n\n  async get(id: string): Promise<AuditEvent> {\n    return this.http.get(`/api/audit/${id}`);\n  }\n\n  async getStats(days?: number): Promise<Record<string, unknown>> {\n    return this.http.get(\"/api/audit/stats\", { ...(days && { days: String(days) }) });\n  }\n\n  async getSecurityEvents(options?: { severity?: string; limit?: number }): Promise<AuditEvent[]> {\n    const response = await this.http.get<{ events: AuditEvent[] }>(\"/api/audit/security\", {\n      ...(options?.severity && { severity: options.severity }),\n      ...(options?.limit && { limit: String(options.limit) }),\n    });\n    return response.events;\n  }\n\n  async export(format: \"json\" | \"csv\", options?: {\n    startDate?: string;\n    endDate?: string;\n    category?: string;\n  }): Promise<string> {\n    return this.http.post(\"/api/audit/export\", { format, ...options });\n  }\n}\n\n// ============================================================================\n// MAIN SDK CLIENT\n// ============================================================================\n\nexport class IntegrationHubSDK {\n  public readonly pipelines: PipelinesClient;\n  public readonly schedules: SchedulesClient;\n  public readonly budgets: BudgetsClient;\n  public readonly webhooks: WebhooksClient;\n  public readonly analytics: AnalyticsClient;\n  public readonly queue: QueueClient;\n  public readonly organizations: OrganizationsClient;\n  public readonly audit: AuditClient;\n\n  private http: HttpClient;\n\n  constructor(config: SDKConfig) {\n    this.http = new HttpClient(config);\n\n    this.pipelines = new PipelinesClient(this.http);\n    this.schedules = new SchedulesClient(this.http);\n    this.budgets = new BudgetsClient(this.http);\n    this.webhooks = new WebhooksClient(this.http);\n    this.analytics = new AnalyticsClient(this.http);\n    this.queue = new QueueClient(this.http);\n    this.organizations = new OrganizationsClient(this.http);\n    this.audit = new AuditClient(this.http);\n  }\n\n  /**\n   * Get system status\n   */\n  async getStatus(): Promise<{ ok: boolean; engines: unknown }> {\n    return this.http.get(\"/api/status\");\n  }\n\n  /**\n   * Health check\n   */\n  async health(): Promise<boolean> {\n    try {\n      const response = await this.http.get<{ ok: boolean }>(\"/api/status\");\n      return response.ok;\n    } catch {\n      return false;\n    }\n  }\n}\n\n// ============================================================================\n// FACTORY\n// ============================================================================\n\nexport function createSDK(config: SDKConfig): IntegrationHubSDK {\n  return new IntegrationHubSDK(config);\n}\n","/**\n * Performance Monitoring Types\n * Phase 9F: Performance Dashboard\n */\n\nimport { z } from \"zod\";\n\n// ============================================================================\n// METRIC TYPES\n// ============================================================================\n\nexport const MetricTypeSchema = z.enum([\n  \"counter\",\n  \"gauge\",\n  \"histogram\",\n  \"summary\",\n]);\nexport type MetricType = z.infer<typeof MetricTypeSchema>;\n\nexport const MetricUnitSchema = z.enum([\n  \"ms\",\n  \"seconds\",\n  \"bytes\",\n  \"percent\",\n  \"count\",\n  \"requests\",\n  \"errors\",\n  \"tokens\",\n  \"dollars\",\n]);\nexport type MetricUnit = z.infer<typeof MetricUnitSchema>;\n\nexport const MetricSchema = z.object({\n  name: z.string(),\n  type: MetricTypeSchema,\n  value: z.number(),\n  unit: MetricUnitSchema,\n  labels: z.record(z.string()).optional(),\n  timestamp: z.date(),\n});\nexport type Metric = z.infer<typeof MetricSchema>;\n\n// ============================================================================\n// TRACE & SPAN\n// ============================================================================\n\nexport const SpanStatusSchema = z.enum([\"ok\", \"error\", \"timeout\", \"cancelled\"]);\nexport type SpanStatus = z.infer<typeof SpanStatusSchema>;\n\nexport const SpanSchema = z.object({\n  spanId: z.string(),\n  traceId: z.string(),\n  parentSpanId: z.string().optional(),\n  name: z.string(),\n  service: z.string(),\n  operation: z.string(),\n  startTime: z.date(),\n  endTime: z.date().optional(),\n  duration: z.number().optional(), // ms\n  status: SpanStatusSchema,\n  attributes: z.record(z.unknown()).optional(),\n  events: z\n    .array(\n      z.object({\n        name: z.string(),\n        timestamp: z.date(),\n        attributes: z.record(z.unknown()).optional(),\n      })\n    )\n    .optional(),\n});\nexport type Span = z.infer<typeof SpanSchema>;\n\nexport const TraceSchema = z.object({\n  traceId: z.string(),\n  rootSpan: SpanSchema,\n  spans: z.array(SpanSchema),\n  startTime: z.date(),\n  endTime: z.date().optional(),\n  totalDuration: z.number().optional(), // ms\n  services: z.array(z.string()),\n  status: SpanStatusSchema,\n});\nexport type Trace = z.infer<typeof TraceSchema>;\n\n// ============================================================================\n// PERFORMANCE SUMMARY\n// ============================================================================\n\nexport const LatencyPercentilesSchema = z.object({\n  p50: z.number(),\n  p75: z.number(),\n  p90: z.number(),\n  p95: z.number(),\n  p99: z.number(),\n});\nexport type LatencyPercentiles = z.infer<typeof LatencyPercentilesSchema>;\n\nexport const ServiceStatsSchema = z.object({\n  service: z.string(),\n  requestCount: z.number(),\n  errorCount: z.number(),\n  errorRate: z.number(), // percentage\n  avgLatency: z.number(), // ms\n  latencyPercentiles: LatencyPercentilesSchema,\n  throughput: z.number(), // requests/sec\n});\nexport type ServiceStats = z.infer<typeof ServiceStatsSchema>;\n\nexport const EndpointStatsSchema = z.object({\n  endpoint: z.string(),\n  method: z.string(),\n  requestCount: z.number(),\n  errorCount: z.number(),\n  errorRate: z.number(),\n  avgLatency: z.number(),\n  latencyPercentiles: LatencyPercentilesSchema,\n  cacheHitRate: z.number().optional(),\n});\nexport type EndpointStats = z.infer<typeof EndpointStatsSchema>;\n\nexport const PipelineStatsSchema = z.object({\n  pipelineId: z.string(),\n  pipelineName: z.string(),\n  executionCount: z.number(),\n  successCount: z.number(),\n  failureCount: z.number(),\n  successRate: z.number(),\n  avgDuration: z.number(), // ms\n  avgTokenUsage: z.number(),\n  avgCost: z.number(), // dollars\n});\nexport type PipelineStats = z.infer<typeof PipelineStatsSchema>;\n\nexport const SystemHealthSchema = z.object({\n  status: z.enum([\"healthy\", \"degraded\", \"unhealthy\"]),\n  uptime: z.number(), // seconds\n  cpuUsage: z.number().optional(), // percentage\n  memoryUsage: z.number().optional(), // percentage\n  activeConnections: z.number(),\n  queueDepth: z.number(),\n  cacheHitRate: z.number(),\n  errorRate: z.number(),\n});\nexport type SystemHealth = z.infer<typeof SystemHealthSchema>;\n\nexport const PerformanceSummarySchema = z.object({\n  period: z.enum([\"hour\", \"day\", \"week\", \"month\"]),\n  startTime: z.date(),\n  endTime: z.date(),\n  systemHealth: SystemHealthSchema,\n  services: z.array(ServiceStatsSchema),\n  endpoints: z.array(EndpointStatsSchema),\n  pipelines: z.array(PipelineStatsSchema),\n  totalRequests: z.number(),\n  totalErrors: z.number(),\n  totalTokens: z.number(),\n  totalCost: z.number(),\n});\nexport type PerformanceSummary = z.infer<typeof PerformanceSummarySchema>;\n\n// ============================================================================\n// TIME SERIES\n// ============================================================================\n\nexport const TimeSeriesPointSchema = z.object({\n  timestamp: z.date(),\n  value: z.number(),\n});\nexport type TimeSeriesPoint = z.infer<typeof TimeSeriesPointSchema>;\n\nexport const TimeSeriesSchema = z.object({\n  name: z.string(),\n  unit: MetricUnitSchema,\n  points: z.array(TimeSeriesPointSchema),\n  aggregation: z.enum([\"sum\", \"avg\", \"min\", \"max\", \"count\"]),\n});\nexport type TimeSeries = z.infer<typeof TimeSeriesSchema>;\n\n// ============================================================================\n// ALERTS\n// ============================================================================\n\nexport const AlertSeveritySchema = z.enum([\"info\", \"warning\", \"error\", \"critical\"]);\nexport type AlertSeverity = z.infer<typeof AlertSeveritySchema>;\n\nexport const AlertStatusSchema = z.enum([\"firing\", \"resolved\", \"acknowledged\"]);\nexport type AlertStatus = z.infer<typeof AlertStatusSchema>;\n\nexport const AlertRuleSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  description: z.string().optional(),\n  metric: z.string(),\n  condition: z.enum([\"gt\", \"gte\", \"lt\", \"lte\", \"eq\", \"neq\"]),\n  threshold: z.number(),\n  duration: z.number(), // seconds - how long condition must be true\n  severity: AlertSeveritySchema,\n  labels: z.record(z.string()).optional(),\n  enabled: z.boolean(),\n});\nexport type AlertRule = z.infer<typeof AlertRuleSchema>;\n\nexport const AlertSchema = z.object({\n  id: z.string(),\n  ruleId: z.string(),\n  ruleName: z.string(),\n  severity: AlertSeveritySchema,\n  status: AlertStatusSchema,\n  message: z.string(),\n  value: z.number(),\n  threshold: z.number(),\n  startedAt: z.date(),\n  resolvedAt: z.date().optional(),\n  acknowledgedAt: z.date().optional(),\n  acknowledgedBy: z.string().optional(),\n  labels: z.record(z.string()).optional(),\n});\nexport type Alert = z.infer<typeof AlertSchema>;\n\n// ============================================================================\n// CONFIGURATION\n// ============================================================================\n\nexport const PerformanceConfigSchema = z.object({\n  // Collection\n  metricsEnabled: z.boolean().default(true),\n  tracingEnabled: z.boolean().default(true),\n  samplingRate: z.number().min(0).max(1).default(0.1), // 10% by default\n\n  // Retention\n  metricsRetentionDays: z.number().default(30),\n  tracesRetentionDays: z.number().default(7),\n  alertsRetentionDays: z.number().default(90),\n\n  // Aggregation\n  aggregationIntervalMs: z.number().default(60000), // 1 minute\n\n  // Alerting\n  alertingEnabled: z.boolean().default(true),\n  alertWebhookUrl: z.string().url().optional(),\n});\nexport type PerformanceConfig = z.infer<typeof PerformanceConfigSchema>;\n\n// ============================================================================\n// EVENTS\n// ============================================================================\n\nexport interface PerformanceEvents {\n  \"metric:recorded\": (metric: Metric) => void;\n  \"span:started\": (span: Span) => void;\n  \"span:ended\": (span: Span) => void;\n  \"trace:completed\": (trace: Trace) => void;\n  \"alert:fired\": (alert: Alert) => void;\n  \"alert:resolved\": (alert: Alert) => void;\n  \"health:changed\": (health: SystemHealth) => void;\n}\n\n// ============================================================================\n// CONSTANTS\n// ============================================================================\n\nexport const DEFAULT_ALERT_RULES: Omit<AlertRule, \"id\">[] = [\n  {\n    name: \"High Error Rate\",\n    description: \"Error rate exceeds 5%\",\n    metric: \"error_rate\",\n    condition: \"gt\",\n    threshold: 5,\n    duration: 300, // 5 minutes\n    severity: \"error\",\n    enabled: true,\n  },\n  {\n    name: \"High Latency\",\n    description: \"P95 latency exceeds 2 seconds\",\n    metric: \"latency_p95\",\n    condition: \"gt\",\n    threshold: 2000,\n    duration: 300,\n    severity: \"warning\",\n    enabled: true,\n  },\n  {\n    name: \"High Queue Depth\",\n    description: \"Queue depth exceeds 1000 jobs\",\n    metric: \"queue_depth\",\n    condition: \"gt\",\n    threshold: 1000,\n    duration: 600, // 10 minutes\n    severity: \"warning\",\n    enabled: true,\n  },\n  {\n    name: \"Low Cache Hit Rate\",\n    description: \"Cache hit rate below 50%\",\n    metric: \"cache_hit_rate\",\n    condition: \"lt\",\n    threshold: 50,\n    duration: 900, // 15 minutes\n    severity: \"info\",\n    enabled: true,\n  },\n  {\n    name: \"High Token Usage\",\n    description: \"Token usage exceeds daily budget\",\n    metric: \"daily_token_usage\",\n    condition: \"gt\",\n    threshold: 1000000, // 1M tokens\n    duration: 0, // Immediate\n    severity: \"warning\",\n    enabled: true,\n  },\n  {\n    name: \"Service Unhealthy\",\n    description: \"Service health check failing\",\n    metric: \"service_health\",\n    condition: \"eq\",\n    threshold: 0, // 0 = unhealthy\n    duration: 120, // 2 minutes\n    severity: \"critical\",\n    enabled: true,\n  },\n];\n","/**\n * Performance Manager\n * Phase 9F: Performance Dashboard\n */\n\nimport { EventEmitter } from \"eventemitter3\";\nimport { randomUUID } from \"crypto\";\nimport {\n  type PerformanceConfig,\n  type PerformanceEvents,\n  type Metric,\n  type MetricType,\n  type MetricUnit,\n  type Span,\n  type SpanStatus,\n  type Trace,\n  type Alert,\n  type AlertRule,\n  type AlertStatus,\n  type SystemHealth,\n  type PerformanceSummary,\n  type ServiceStats,\n  type EndpointStats,\n  type PipelineStats,\n  type LatencyPercentiles,\n  type TimeSeries,\n  type TimeSeriesPoint,\n  DEFAULT_ALERT_RULES,\n  PerformanceConfigSchema,\n} from \"./types.js\";\n\n// ============================================================================\n// PERFORMANCE MANAGER\n// ============================================================================\n\nexport class PerformanceManager extends EventEmitter<PerformanceEvents> {\n  private config: PerformanceConfig;\n  private metrics: Map<string, Metric[]> = new Map();\n  private activeSpans: Map<string, Span> = new Map();\n  private traces: Map<string, Trace> = new Map();\n  private alerts: Map<string, Alert> = new Map();\n  private alertRules: Map<string, AlertRule> = new Map();\n  private startTime: Date;\n  private aggregationTimer?: NodeJS.Timeout;\n  private alertCheckTimer?: NodeJS.Timeout;\n\n  constructor(config: Partial<PerformanceConfig> = {}) {\n    super();\n    this.config = PerformanceConfigSchema.parse(config);\n    this.startTime = new Date();\n\n    // Initialize default alert rules\n    for (const rule of DEFAULT_ALERT_RULES) {\n      const id = randomUUID();\n      this.alertRules.set(id, { ...rule, id });\n    }\n  }\n\n  // ==========================================================================\n  // LIFECYCLE\n  // ==========================================================================\n\n  start(): void {\n    // Start aggregation timer\n    if (this.config.metricsEnabled) {\n      this.aggregationTimer = setInterval(() => {\n        this.aggregate();\n      }, this.config.aggregationIntervalMs);\n    }\n\n    // Start alert check timer\n    if (this.config.alertingEnabled) {\n      this.alertCheckTimer = setInterval(() => {\n        this.checkAlerts();\n      }, 30000); // Check every 30 seconds\n    }\n  }\n\n  stop(): void {\n    if (this.aggregationTimer) {\n      clearInterval(this.aggregationTimer);\n    }\n    if (this.alertCheckTimer) {\n      clearInterval(this.alertCheckTimer);\n    }\n  }\n\n  // ==========================================================================\n  // METRICS\n  // ==========================================================================\n\n  recordMetric(\n    name: string,\n    value: number,\n    options: {\n      type?: MetricType;\n      unit?: MetricUnit;\n      labels?: Record<string, string>;\n    } = {}\n  ): void {\n    if (!this.config.metricsEnabled) return;\n\n    const metric: Metric = {\n      name,\n      value,\n      type: options.type || \"gauge\",\n      unit: options.unit || \"count\",\n      labels: options.labels,\n      timestamp: new Date(),\n    };\n\n    const key = this.getMetricKey(name, options.labels);\n    const existing = this.metrics.get(key) || [];\n    existing.push(metric);\n\n    // Keep only last hour of data points per metric\n    const cutoff = Date.now() - 3600000;\n    const filtered = existing.filter((m) => m.timestamp.getTime() > cutoff);\n    this.metrics.set(key, filtered);\n\n    this.emit(\"metric:recorded\", metric);\n  }\n\n  incrementCounter(\n    name: string,\n    value: number = 1,\n    labels?: Record<string, string>\n  ): void {\n    this.recordMetric(name, value, { type: \"counter\", unit: \"count\", labels });\n  }\n\n  recordLatency(\n    name: string,\n    durationMs: number,\n    labels?: Record<string, string>\n  ): void {\n    this.recordMetric(name, durationMs, { type: \"histogram\", unit: \"ms\", labels });\n  }\n\n  recordGauge(\n    name: string,\n    value: number,\n    unit: MetricUnit = \"count\",\n    labels?: Record<string, string>\n  ): void {\n    this.recordMetric(name, value, { type: \"gauge\", unit, labels });\n  }\n\n  private getMetricKey(name: string, labels?: Record<string, string>): string {\n    if (!labels) return name;\n    const labelStr = Object.entries(labels)\n      .sort(([a], [b]) => a.localeCompare(b))\n      .map(([k, v]) => `${k}=${v}`)\n      .join(\",\");\n    return `${name}{${labelStr}}`;\n  }\n\n  getMetricTimeSeries(\n    name: string,\n    labels?: Record<string, string>,\n    aggregation: \"sum\" | \"avg\" | \"min\" | \"max\" | \"count\" = \"avg\"\n  ): TimeSeries {\n    const key = this.getMetricKey(name, labels);\n    const metrics = this.metrics.get(key) || [];\n\n    // Group by minute\n    const buckets = new Map<number, number[]>();\n    for (const m of metrics) {\n      const bucket = Math.floor(m.timestamp.getTime() / 60000) * 60000;\n      const values = buckets.get(bucket) || [];\n      values.push(m.value);\n      buckets.set(bucket, values);\n    }\n\n    const points: TimeSeriesPoint[] = [];\n    for (const [timestamp, values] of buckets) {\n      let value: number;\n      switch (aggregation) {\n        case \"sum\":\n          value = values.reduce((a, b) => a + b, 0);\n          break;\n        case \"min\":\n          value = Math.min(...values);\n          break;\n        case \"max\":\n          value = Math.max(...values);\n          break;\n        case \"count\":\n          value = values.length;\n          break;\n        default:\n          value = values.reduce((a, b) => a + b, 0) / values.length;\n      }\n      points.push({ timestamp: new Date(timestamp), value });\n    }\n\n    points.sort((a, b) => a.timestamp.getTime() - b.timestamp.getTime());\n\n    return {\n      name,\n      unit: metrics[0]?.unit || \"count\",\n      points,\n      aggregation,\n    };\n  }\n\n  // ==========================================================================\n  // TRACING\n  // ==========================================================================\n\n  startSpan(\n    name: string,\n    options: {\n      traceId?: string;\n      parentSpanId?: string;\n      service?: string;\n      operation?: string;\n      attributes?: Record<string, unknown>;\n    } = {}\n  ): Span {\n    if (!this.config.tracingEnabled) {\n      // Return a no-op span\n      return {\n        spanId: \"\",\n        traceId: \"\",\n        name,\n        service: \"\",\n        operation: \"\",\n        startTime: new Date(),\n        status: \"ok\",\n      };\n    }\n\n    // Sampling\n    if (Math.random() > this.config.samplingRate) {\n      return {\n        spanId: \"\",\n        traceId: \"\",\n        name,\n        service: \"\",\n        operation: \"\",\n        startTime: new Date(),\n        status: \"ok\",\n      };\n    }\n\n    const span: Span = {\n      spanId: randomUUID(),\n      traceId: options.traceId || randomUUID(),\n      parentSpanId: options.parentSpanId,\n      name,\n      service: options.service || \"integration-hub\",\n      operation: options.operation || name,\n      startTime: new Date(),\n      status: \"ok\",\n      attributes: options.attributes,\n      events: [],\n    };\n\n    this.activeSpans.set(span.spanId, span);\n\n    // Create or update trace\n    if (!this.traces.has(span.traceId)) {\n      this.traces.set(span.traceId, {\n        traceId: span.traceId,\n        rootSpan: span,\n        spans: [span],\n        startTime: span.startTime,\n        services: [span.service],\n        status: \"ok\",\n      });\n    } else {\n      const trace = this.traces.get(span.traceId)!;\n      trace.spans.push(span);\n      if (!trace.services.includes(span.service)) {\n        trace.services.push(span.service);\n      }\n    }\n\n    this.emit(\"span:started\", span);\n    return span;\n  }\n\n  endSpan(\n    spanId: string,\n    options: {\n      status?: SpanStatus;\n      attributes?: Record<string, unknown>;\n    } = {}\n  ): Span | undefined {\n    const span = this.activeSpans.get(spanId);\n    if (!span || !span.spanId) return undefined;\n\n    span.endTime = new Date();\n    span.duration = span.endTime.getTime() - span.startTime.getTime();\n    span.status = options.status || \"ok\";\n    if (options.attributes) {\n      span.attributes = { ...span.attributes, ...options.attributes };\n    }\n\n    this.activeSpans.delete(spanId);\n    this.emit(\"span:ended\", span);\n\n    // Record latency metric\n    this.recordLatency(`${span.service}.${span.operation}.latency`, span.duration, {\n      service: span.service,\n      operation: span.operation,\n    });\n\n    // Check if trace is complete\n    const trace = this.traces.get(span.traceId);\n    if (trace) {\n      const allEnded = trace.spans.every((s) => s.endTime);\n      if (allEnded) {\n        trace.endTime = new Date();\n        trace.totalDuration = trace.endTime.getTime() - trace.startTime.getTime();\n        trace.status = trace.spans.some((s) => s.status === \"error\")\n          ? \"error\"\n          : trace.spans.some((s) => s.status === \"timeout\")\n          ? \"timeout\"\n          : \"ok\";\n        this.emit(\"trace:completed\", trace);\n      }\n    }\n\n    return span;\n  }\n\n  addSpanEvent(\n    spanId: string,\n    eventName: string,\n    attributes?: Record<string, unknown>\n  ): void {\n    const span = this.activeSpans.get(spanId);\n    if (!span) return;\n\n    span.events = span.events || [];\n    span.events.push({\n      name: eventName,\n      timestamp: new Date(),\n      attributes,\n    });\n  }\n\n  getTrace(traceId: string): Trace | undefined {\n    return this.traces.get(traceId);\n  }\n\n  getRecentTraces(limit: number = 100): Trace[] {\n    const traces = Array.from(this.traces.values());\n    traces.sort((a, b) => b.startTime.getTime() - a.startTime.getTime());\n    return traces.slice(0, limit);\n  }\n\n  // ==========================================================================\n  // ALERTS\n  // ==========================================================================\n\n  addAlertRule(rule: Omit<AlertRule, \"id\">): AlertRule {\n    const id = randomUUID();\n    const alertRule = { ...rule, id };\n    this.alertRules.set(id, alertRule);\n    return alertRule;\n  }\n\n  updateAlertRule(id: string, updates: Partial<AlertRule>): AlertRule | undefined {\n    const rule = this.alertRules.get(id);\n    if (!rule) return undefined;\n    const updated = { ...rule, ...updates, id };\n    this.alertRules.set(id, updated);\n    return updated;\n  }\n\n  deleteAlertRule(id: string): boolean {\n    return this.alertRules.delete(id);\n  }\n\n  getAlertRules(): AlertRule[] {\n    return Array.from(this.alertRules.values());\n  }\n\n  getAlerts(status?: AlertStatus): Alert[] {\n    const alerts = Array.from(this.alerts.values());\n    if (status) {\n      return alerts.filter((a) => a.status === status);\n    }\n    return alerts;\n  }\n\n  acknowledgeAlert(alertId: string, userId: string): Alert | undefined {\n    const alert = this.alerts.get(alertId);\n    if (!alert || alert.status !== \"firing\") return undefined;\n\n    alert.status = \"acknowledged\";\n    alert.acknowledgedAt = new Date();\n    alert.acknowledgedBy = userId;\n    return alert;\n  }\n\n  private checkAlerts(): void {\n    for (const rule of this.alertRules.values()) {\n      if (!rule.enabled) continue;\n\n      const value = this.getCurrentMetricValue(rule.metric);\n      if (value === undefined) continue;\n\n      const conditionMet = this.evaluateCondition(value, rule.condition, rule.threshold);\n      const existingAlert = this.findAlertByRule(rule.id);\n\n      if (conditionMet) {\n        if (!existingAlert) {\n          // Fire new alert\n          const alert: Alert = {\n            id: randomUUID(),\n            ruleId: rule.id,\n            ruleName: rule.name,\n            severity: rule.severity,\n            status: \"firing\",\n            message: rule.description || `${rule.name} triggered`,\n            value,\n            threshold: rule.threshold,\n            startedAt: new Date(),\n            labels: rule.labels,\n          };\n          this.alerts.set(alert.id, alert);\n          this.emit(\"alert:fired\", alert);\n        }\n      } else if (existingAlert && existingAlert.status === \"firing\") {\n        // Resolve alert\n        existingAlert.status = \"resolved\";\n        existingAlert.resolvedAt = new Date();\n        this.emit(\"alert:resolved\", existingAlert);\n      }\n    }\n  }\n\n  private getCurrentMetricValue(metricName: string): number | undefined {\n    const key = this.getMetricKey(metricName);\n    const metrics = this.metrics.get(key);\n    if (!metrics || metrics.length === 0) return undefined;\n\n    // Return the most recent value\n    return metrics[metrics.length - 1].value;\n  }\n\n  private evaluateCondition(\n    value: number,\n    condition: AlertRule[\"condition\"],\n    threshold: number\n  ): boolean {\n    switch (condition) {\n      case \"gt\":\n        return value > threshold;\n      case \"gte\":\n        return value >= threshold;\n      case \"lt\":\n        return value < threshold;\n      case \"lte\":\n        return value <= threshold;\n      case \"eq\":\n        return value === threshold;\n      case \"neq\":\n        return value !== threshold;\n      default:\n        return false;\n    }\n  }\n\n  private findAlertByRule(ruleId: string): Alert | undefined {\n    for (const alert of this.alerts.values()) {\n      if (alert.ruleId === ruleId && alert.status === \"firing\") {\n        return alert;\n      }\n    }\n    return undefined;\n  }\n\n  // ==========================================================================\n  // HEALTH & SUMMARY\n  // ==========================================================================\n\n  getSystemHealth(): SystemHealth {\n    const now = Date.now();\n    const uptime = Math.floor((now - this.startTime.getTime()) / 1000);\n\n    // Calculate error rate from metrics\n    const totalRequests = this.getAggregatedValue(\"http.requests.total\", \"sum\") || 0;\n    const totalErrors = this.getAggregatedValue(\"http.errors.total\", \"sum\") || 0;\n    const errorRate = totalRequests > 0 ? (totalErrors / totalRequests) * 100 : 0;\n\n    // Get queue depth\n    const queueDepth = this.getAggregatedValue(\"queue.depth\", \"avg\") || 0;\n\n    // Get cache hit rate\n    const cacheHits = this.getAggregatedValue(\"cache.hits\", \"sum\") || 0;\n    const cacheMisses = this.getAggregatedValue(\"cache.misses\", \"sum\") || 0;\n    const cacheTotal = cacheHits + cacheMisses;\n    const cacheHitRate = cacheTotal > 0 ? (cacheHits / cacheTotal) * 100 : 0;\n\n    // Determine status\n    let status: SystemHealth[\"status\"] = \"healthy\";\n    if (errorRate > 10 || queueDepth > 5000) {\n      status = \"unhealthy\";\n    } else if (errorRate > 5 || queueDepth > 1000 || cacheHitRate < 30) {\n      status = \"degraded\";\n    }\n\n    const health: SystemHealth = {\n      status,\n      uptime,\n      activeConnections: this.activeSpans.size,\n      queueDepth,\n      cacheHitRate,\n      errorRate,\n    };\n\n    this.emit(\"health:changed\", health);\n    return health;\n  }\n\n  getSummary(period: \"hour\" | \"day\" | \"week\" | \"month\" = \"day\"): PerformanceSummary {\n    const now = new Date();\n    const periodMs = {\n      hour: 3600000,\n      day: 86400000,\n      week: 604800000,\n      month: 2592000000,\n    }[period];\n    const startTime = new Date(now.getTime() - periodMs);\n\n    return {\n      period,\n      startTime,\n      endTime: now,\n      systemHealth: this.getSystemHealth(),\n      services: this.getServiceStats(startTime),\n      endpoints: this.getEndpointStats(startTime),\n      pipelines: this.getPipelineStats(startTime),\n      totalRequests: this.getAggregatedValue(\"http.requests.total\", \"sum\", startTime) || 0,\n      totalErrors: this.getAggregatedValue(\"http.errors.total\", \"sum\", startTime) || 0,\n      totalTokens: this.getAggregatedValue(\"llm.tokens.total\", \"sum\", startTime) || 0,\n      totalCost: this.getAggregatedValue(\"cost.total\", \"sum\", startTime) || 0,\n    };\n  }\n\n  private getAggregatedValue(\n    metricName: string,\n    aggregation: \"sum\" | \"avg\" | \"min\" | \"max\",\n    since?: Date\n  ): number | undefined {\n    const key = this.getMetricKey(metricName);\n    let metrics = this.metrics.get(key) || [];\n\n    if (since) {\n      metrics = metrics.filter((m) => m.timestamp >= since);\n    }\n\n    if (metrics.length === 0) return undefined;\n\n    const values = metrics.map((m) => m.value);\n    switch (aggregation) {\n      case \"sum\":\n        return values.reduce((a, b) => a + b, 0);\n      case \"avg\":\n        return values.reduce((a, b) => a + b, 0) / values.length;\n      case \"min\":\n        return Math.min(...values);\n      case \"max\":\n        return Math.max(...values);\n    }\n  }\n\n  private getServiceStats(since: Date): ServiceStats[] {\n    const services = new Map<string, { requests: number; errors: number; latencies: number[] }>();\n\n    // Aggregate from traces\n    for (const trace of this.traces.values()) {\n      if (trace.startTime < since) continue;\n\n      for (const span of trace.spans) {\n        const stats = services.get(span.service) || {\n          requests: 0,\n          errors: 0,\n          latencies: [],\n        };\n        stats.requests++;\n        if (span.status === \"error\") stats.errors++;\n        if (span.duration) stats.latencies.push(span.duration);\n        services.set(span.service, stats);\n      }\n    }\n\n    return Array.from(services.entries()).map(([service, stats]) => ({\n      service,\n      requestCount: stats.requests,\n      errorCount: stats.errors,\n      errorRate: stats.requests > 0 ? (stats.errors / stats.requests) * 100 : 0,\n      avgLatency:\n        stats.latencies.length > 0\n          ? stats.latencies.reduce((a, b) => a + b, 0) / stats.latencies.length\n          : 0,\n      latencyPercentiles: this.calculatePercentiles(stats.latencies),\n      throughput: stats.requests / ((Date.now() - since.getTime()) / 1000),\n    }));\n  }\n\n  private getEndpointStats(since: Date): EndpointStats[] {\n    const endpoints = new Map<string, { requests: number; errors: number; latencies: number[] }>();\n\n    // Aggregate from metrics with endpoint labels\n    for (const [key, metrics] of this.metrics) {\n      if (!key.includes(\"endpoint=\")) continue;\n\n      const filtered = metrics.filter((m) => m.timestamp >= since);\n      if (filtered.length === 0) continue;\n\n      const match = key.match(/endpoint=([^,}]+)/);\n      const endpoint = match?.[1] || \"unknown\";\n\n      const stats = endpoints.get(endpoint) || {\n        requests: 0,\n        errors: 0,\n        latencies: [],\n      };\n\n      for (const m of filtered) {\n        if (m.name.includes(\"request\")) stats.requests += m.value;\n        if (m.name.includes(\"error\")) stats.errors += m.value;\n        if (m.name.includes(\"latency\")) stats.latencies.push(m.value);\n      }\n\n      endpoints.set(endpoint, stats);\n    }\n\n    return Array.from(endpoints.entries()).map(([endpoint, stats]) => ({\n      endpoint,\n      method: \"ALL\",\n      requestCount: stats.requests,\n      errorCount: stats.errors,\n      errorRate: stats.requests > 0 ? (stats.errors / stats.requests) * 100 : 0,\n      avgLatency:\n        stats.latencies.length > 0\n          ? stats.latencies.reduce((a, b) => a + b, 0) / stats.latencies.length\n          : 0,\n      latencyPercentiles: this.calculatePercentiles(stats.latencies),\n    }));\n  }\n\n  private getPipelineStats(since: Date): PipelineStats[] {\n    // This would typically come from the analytics module\n    // For now, return aggregated from metrics\n    const pipelines = new Map<\n      string,\n      { executions: number; successes: number; failures: number; durations: number[]; tokens: number[]; costs: number[] }\n    >();\n\n    for (const [key, metrics] of this.metrics) {\n      if (!key.includes(\"pipeline_id=\")) continue;\n\n      const filtered = metrics.filter((m) => m.timestamp >= since);\n      if (filtered.length === 0) continue;\n\n      const match = key.match(/pipeline_id=([^,}]+)/);\n      const pipelineId = match?.[1] || \"unknown\";\n\n      const stats = pipelines.get(pipelineId) || {\n        executions: 0,\n        successes: 0,\n        failures: 0,\n        durations: [],\n        tokens: [],\n        costs: [],\n      };\n\n      for (const m of filtered) {\n        if (m.name.includes(\"execution\")) stats.executions++;\n        if (m.name.includes(\"success\")) stats.successes += m.value;\n        if (m.name.includes(\"failure\")) stats.failures += m.value;\n        if (m.name.includes(\"duration\")) stats.durations.push(m.value);\n        if (m.name.includes(\"tokens\")) stats.tokens.push(m.value);\n        if (m.name.includes(\"cost\")) stats.costs.push(m.value);\n      }\n\n      pipelines.set(pipelineId, stats);\n    }\n\n    return Array.from(pipelines.entries()).map(([pipelineId, stats]) => ({\n      pipelineId,\n      pipelineName: pipelineId, // Would need to look up actual name\n      executionCount: stats.executions,\n      successCount: stats.successes,\n      failureCount: stats.failures,\n      successRate:\n        stats.executions > 0 ? (stats.successes / stats.executions) * 100 : 0,\n      avgDuration:\n        stats.durations.length > 0\n          ? stats.durations.reduce((a, b) => a + b, 0) / stats.durations.length\n          : 0,\n      avgTokenUsage:\n        stats.tokens.length > 0\n          ? stats.tokens.reduce((a, b) => a + b, 0) / stats.tokens.length\n          : 0,\n      avgCost:\n        stats.costs.length > 0\n          ? stats.costs.reduce((a, b) => a + b, 0) / stats.costs.length\n          : 0,\n    }));\n  }\n\n  private calculatePercentiles(values: number[]): LatencyPercentiles {\n    if (values.length === 0) {\n      return { p50: 0, p75: 0, p90: 0, p95: 0, p99: 0 };\n    }\n\n    const sorted = [...values].sort((a, b) => a - b);\n    const percentile = (p: number) => {\n      const index = Math.ceil((p / 100) * sorted.length) - 1;\n      return sorted[Math.max(0, index)];\n    };\n\n    return {\n      p50: percentile(50),\n      p75: percentile(75),\n      p90: percentile(90),\n      p95: percentile(95),\n      p99: percentile(99),\n    };\n  }\n\n  // ==========================================================================\n  // AGGREGATION & CLEANUP\n  // ==========================================================================\n\n  private aggregate(): void {\n    const now = Date.now();\n    const metricsRetentionMs = this.config.metricsRetentionDays * 86400000;\n    const tracesRetentionMs = this.config.tracesRetentionDays * 86400000;\n\n    // Clean old metrics\n    for (const [key, metrics] of this.metrics) {\n      const cutoff = now - metricsRetentionMs;\n      const filtered = metrics.filter((m) => m.timestamp.getTime() > cutoff);\n      if (filtered.length === 0) {\n        this.metrics.delete(key);\n      } else {\n        this.metrics.set(key, filtered);\n      }\n    }\n\n    // Clean old traces\n    const traceCutoff = now - tracesRetentionMs;\n    for (const [traceId, trace] of this.traces) {\n      if (trace.startTime.getTime() < traceCutoff) {\n        this.traces.delete(traceId);\n      }\n    }\n\n    // Clean resolved alerts\n    const alertsCutoff = now - this.config.alertsRetentionDays * 86400000;\n    for (const [alertId, alert] of this.alerts) {\n      if (\n        alert.status === \"resolved\" &&\n        alert.resolvedAt &&\n        alert.resolvedAt.getTime() < alertsCutoff\n      ) {\n        this.alerts.delete(alertId);\n      }\n    }\n  }\n}\n\n// ============================================================================\n// SINGLETON & FACTORY\n// ============================================================================\n\nlet instance: PerformanceManager | null = null;\n\nexport function getPerformanceManager(): PerformanceManager {\n  if (!instance) {\n    instance = new PerformanceManager();\n  }\n  return instance;\n}\n\nexport function createPerformanceManager(\n  config: Partial<PerformanceConfig> = {}\n): PerformanceManager {\n  instance = new PerformanceManager(config);\n  return instance;\n}\n","/**\n * Intelligence Module Types\n * Phase 10: Intelligence & Automation\n */\n\nimport { z } from \"zod\";\n\n// ============================================================================\n// SUGGESTION TYPES\n// ============================================================================\n\nexport const SuggestionTypeSchema = z.enum([\n  \"optimization\",      // Performance improvements\n  \"cost_reduction\",    // Cost saving opportunities\n  \"error_fix\",         // Fix for common errors\n  \"best_practice\",     // Industry best practices\n  \"security\",          // Security improvements\n  \"reliability\",       // Reliability enhancements\n  \"similar_pipeline\",  // Similar existing pipelines\n]);\nexport type SuggestionType = z.infer<typeof SuggestionTypeSchema>;\n\nexport const SuggestionPrioritySchema = z.enum([\"low\", \"medium\", \"high\", \"critical\"]);\nexport type SuggestionPriority = z.infer<typeof SuggestionPrioritySchema>;\n\nexport const SuggestionStatusSchema = z.enum([\n  \"pending\",\n  \"applied\",\n  \"dismissed\",\n  \"expired\",\n]);\nexport type SuggestionStatus = z.infer<typeof SuggestionStatusSchema>;\n\nexport const SuggestionSchema = z.object({\n  id: z.string(),\n  type: SuggestionTypeSchema,\n  priority: SuggestionPrioritySchema,\n  status: SuggestionStatusSchema,\n  title: z.string(),\n  description: z.string(),\n  reasoning: z.string(),\n  pipelineId: z.string().optional(),\n  stepIndex: z.number().optional(),\n\n  // Impact estimates\n  estimatedImpact: z.object({\n    costReduction: z.number().optional(),      // percentage\n    speedImprovement: z.number().optional(),   // percentage\n    reliabilityGain: z.number().optional(),    // percentage\n    tokenSavings: z.number().optional(),       // absolute\n  }).optional(),\n\n  // Auto-fix capability\n  autoFixAvailable: z.boolean(),\n  autoFixConfig: z.record(z.unknown()).optional(),\n\n  // Metadata\n  confidence: z.number().min(0).max(1),\n  createdAt: z.date(),\n  expiresAt: z.date().optional(),\n  appliedAt: z.date().optional(),\n  dismissedAt: z.date().optional(),\n  dismissReason: z.string().optional(),\n});\nexport type Suggestion = z.infer<typeof SuggestionSchema>;\n\n// ============================================================================\n// SIMILAR PIPELINE\n// ============================================================================\n\nexport const SimilarPipelineSchema = z.object({\n  pipelineId: z.string(),\n  pipelineName: z.string(),\n  similarity: z.number().min(0).max(1),  // 0-1 score\n  matchedFeatures: z.array(z.string()),\n  differingFeatures: z.array(z.string()),\n  performanceComparison: z.object({\n    avgDuration: z.number(),\n    avgCost: z.number(),\n    successRate: z.number(),\n  }).optional(),\n});\nexport type SimilarPipeline = z.infer<typeof SimilarPipelineSchema>;\n\n// ============================================================================\n// OPTIMIZATION RECOMMENDATION\n// ============================================================================\n\nexport const OptimizationCategorySchema = z.enum([\n  \"prompt_efficiency\",    // Reduce token usage in prompts\n  \"step_consolidation\",   // Merge redundant steps\n  \"parallel_execution\",   // Run steps in parallel\n  \"caching\",              // Add caching for repeated calls\n  \"model_selection\",      // Use appropriate model for task\n  \"retry_strategy\",       // Optimize retry logic\n  \"batching\",             // Batch similar operations\n  \"early_termination\",    // Add early exit conditions\n]);\nexport type OptimizationCategory = z.infer<typeof OptimizationCategorySchema>;\n\nexport const OptimizationSchema = z.object({\n  id: z.string(),\n  category: OptimizationCategorySchema,\n  title: z.string(),\n  description: z.string(),\n  currentValue: z.string(),\n  suggestedValue: z.string(),\n  estimatedSavings: z.object({\n    tokens: z.number().optional(),\n    cost: z.number().optional(),\n    time: z.number().optional(),  // ms\n  }),\n  codeChange: z.object({\n    before: z.string(),\n    after: z.string(),\n    stepIndex: z.number().optional(),\n  }).optional(),\n  confidence: z.number().min(0).max(1),\n});\nexport type Optimization = z.infer<typeof OptimizationSchema>;\n\n// ============================================================================\n// ERROR PATTERNS & AUTO-FIX\n// ============================================================================\n\nexport const ErrorPatternSchema = z.object({\n  id: z.string(),\n  pattern: z.string(),           // Regex or string pattern\n  errorType: z.string(),\n  frequency: z.number(),         // How often this occurs\n  description: z.string(),\n  commonCauses: z.array(z.string()),\n  suggestedFixes: z.array(z.object({\n    title: z.string(),\n    description: z.string(),\n    autoFixable: z.boolean(),\n    fixConfig: z.record(z.unknown()).optional(),\n  })),\n});\nexport type ErrorPattern = z.infer<typeof ErrorPatternSchema>;\n\nexport const AutoFixSchema = z.object({\n  id: z.string(),\n  errorPatternId: z.string(),\n  pipelineId: z.string(),\n  stepIndex: z.number().optional(),\n  fixType: z.enum([\"config_change\", \"step_modification\", \"retry_config\", \"model_change\", \"prompt_edit\"]),\n  originalConfig: z.record(z.unknown()),\n  fixedConfig: z.record(z.unknown()),\n  applied: z.boolean(),\n  appliedAt: z.date().optional(),\n  rollbackAvailable: z.boolean(),\n});\nexport type AutoFix = z.infer<typeof AutoFixSchema>;\n\n// ============================================================================\n// PIPELINE ANALYSIS\n// ============================================================================\n\nexport const PipelineAnalysisSchema = z.object({\n  pipelineId: z.string(),\n  analyzedAt: z.date(),\n\n  // Health scores (0-100)\n  scores: z.object({\n    overall: z.number(),\n    efficiency: z.number(),\n    reliability: z.number(),\n    costEffectiveness: z.number(),\n    maintainability: z.number(),\n  }),\n\n  // Findings\n  suggestions: z.array(SuggestionSchema),\n  optimizations: z.array(OptimizationSchema),\n  similarPipelines: z.array(SimilarPipelineSchema),\n  errorPatterns: z.array(ErrorPatternSchema),\n\n  // Stats\n  executionStats: z.object({\n    totalExecutions: z.number(),\n    successRate: z.number(),\n    avgDuration: z.number(),\n    avgCost: z.number(),\n    avgTokens: z.number(),\n  }),\n});\nexport type PipelineAnalysis = z.infer<typeof PipelineAnalysisSchema>;\n\n// ============================================================================\n// CONFIGURATION\n// ============================================================================\n\nexport const IntelligenceConfigSchema = z.object({\n  // Analysis settings\n  analysisEnabled: z.boolean().default(true),\n  autoAnalyzeNewPipelines: z.boolean().default(true),\n  analysisIntervalHours: z.number().default(24),\n\n  // Suggestions\n  suggestionsEnabled: z.boolean().default(true),\n  minConfidenceThreshold: z.number().min(0).max(1).default(0.7),\n  maxSuggestionsPerPipeline: z.number().default(10),\n\n  // Auto-fix\n  autoFixEnabled: z.boolean().default(false),  // Opt-in\n  autoFixMinConfidence: z.number().min(0).max(1).default(0.9),\n  autoFixCategories: z.array(z.string()).default([]),\n\n  // Similar pipelines\n  similarityThreshold: z.number().min(0).max(1).default(0.7),\n  maxSimilarPipelines: z.number().default(5),\n\n  // LLM settings\n  llmModel: z.string().default(\"claude-3-haiku-20240307\"),\n  maxAnalysisTokens: z.number().default(4000),\n});\nexport type IntelligenceConfig = z.infer<typeof IntelligenceConfigSchema>;\n\n// ============================================================================\n// EVENTS\n// ============================================================================\n\nexport interface IntelligenceEvents {\n  \"analysis:started\": (pipelineId: string) => void;\n  \"analysis:completed\": (analysis: PipelineAnalysis) => void;\n  \"suggestion:created\": (suggestion: Suggestion) => void;\n  \"suggestion:applied\": (suggestion: Suggestion) => void;\n  \"suggestion:dismissed\": (suggestion: Suggestion) => void;\n  \"autofix:applied\": (fix: AutoFix) => void;\n  \"autofix:rolled_back\": (fix: AutoFix) => void;\n  \"similar:found\": (pipelineId: string, similar: SimilarPipeline[]) => void;\n}\n\n// ============================================================================\n// CONSTANTS\n// ============================================================================\n\nexport const OPTIMIZATION_TEMPLATES: Record<OptimizationCategory, {\n  title: string;\n  description: string;\n  checkFn: string;\n}> = {\n  prompt_efficiency: {\n    title: \"Optimize Prompt Length\",\n    description: \"Reduce token usage by streamlining prompts\",\n    checkFn: \"checkPromptEfficiency\",\n  },\n  step_consolidation: {\n    title: \"Consolidate Steps\",\n    description: \"Merge similar or redundant pipeline steps\",\n    checkFn: \"checkStepConsolidation\",\n  },\n  parallel_execution: {\n    title: \"Enable Parallel Execution\",\n    description: \"Run independent steps concurrently\",\n    checkFn: \"checkParallelOpportunities\",\n  },\n  caching: {\n    title: \"Add Result Caching\",\n    description: \"Cache repeated LLM calls with same inputs\",\n    checkFn: \"checkCachingOpportunities\",\n  },\n  model_selection: {\n    title: \"Optimize Model Selection\",\n    description: \"Use cost-effective models for simpler tasks\",\n    checkFn: \"checkModelSelection\",\n  },\n  retry_strategy: {\n    title: \"Improve Retry Strategy\",\n    description: \"Optimize retry logic to reduce failures\",\n    checkFn: \"checkRetryStrategy\",\n  },\n  batching: {\n    title: \"Batch Operations\",\n    description: \"Combine multiple similar operations\",\n    checkFn: \"checkBatchingOpportunities\",\n  },\n  early_termination: {\n    title: \"Add Early Exit\",\n    description: \"Skip unnecessary steps based on conditions\",\n    checkFn: \"checkEarlyTermination\",\n  },\n};\n\nexport const COMMON_ERROR_PATTERNS: Omit<ErrorPattern, \"id\" | \"frequency\">[] = [\n  {\n    pattern: \"rate_limit|429|too many requests\",\n    errorType: \"rate_limit\",\n    description: \"API rate limit exceeded\",\n    commonCauses: [\n      \"Too many concurrent requests\",\n      \"Burst of requests without backoff\",\n      \"Missing rate limiting on client side\",\n    ],\n    suggestedFixes: [\n      {\n        title: \"Add exponential backoff\",\n        description: \"Implement exponential backoff with jitter\",\n        autoFixable: true,\n        fixConfig: { retryDelay: \"exponential\", maxRetries: 3 },\n      },\n      {\n        title: \"Add request queuing\",\n        description: \"Queue requests to respect rate limits\",\n        autoFixable: true,\n        fixConfig: { enableQueue: true, maxConcurrent: 5 },\n      },\n    ],\n  },\n  {\n    pattern: \"timeout|ETIMEDOUT|deadline exceeded\",\n    errorType: \"timeout\",\n    description: \"Request timed out\",\n    commonCauses: [\n      \"Long-running LLM inference\",\n      \"Network latency\",\n      \"Timeout too short for task\",\n    ],\n    suggestedFixes: [\n      {\n        title: \"Increase timeout\",\n        description: \"Extend timeout for complex operations\",\n        autoFixable: true,\n        fixConfig: { timeout: 120000 },\n      },\n      {\n        title: \"Break into smaller steps\",\n        description: \"Split long operations into smaller chunks\",\n        autoFixable: false,\n      },\n    ],\n  },\n  {\n    pattern: \"context.length|max.tokens|token limit\",\n    errorType: \"token_limit\",\n    description: \"Token limit exceeded\",\n    commonCauses: [\n      \"Prompt too long\",\n      \"Input data too large\",\n      \"Accumulated context in conversation\",\n    ],\n    suggestedFixes: [\n      {\n        title: \"Truncate input\",\n        description: \"Limit input size to fit context window\",\n        autoFixable: true,\n        fixConfig: { maxInputTokens: 3000 },\n      },\n      {\n        title: \"Use larger context model\",\n        description: \"Switch to model with larger context window\",\n        autoFixable: true,\n        fixConfig: { model: \"claude-3-sonnet-20240229\" },\n      },\n    ],\n  },\n  {\n    pattern: \"invalid.json|JSON.parse|Unexpected token\",\n    errorType: \"json_parse\",\n    description: \"Failed to parse JSON response\",\n    commonCauses: [\n      \"LLM returned malformed JSON\",\n      \"Missing JSON mode instruction\",\n      \"Response truncated\",\n    ],\n    suggestedFixes: [\n      {\n        title: \"Add JSON mode\",\n        description: \"Force JSON output format\",\n        autoFixable: true,\n        fixConfig: { outputFormat: \"json\" },\n      },\n      {\n        title: \"Add JSON validation prompt\",\n        description: \"Include explicit JSON formatting instructions\",\n        autoFixable: true,\n      },\n    ],\n  },\n  {\n    pattern: \"authentication|unauthorized|401|invalid.key\",\n    errorType: \"auth_error\",\n    description: \"Authentication failed\",\n    commonCauses: [\n      \"Invalid or expired API key\",\n      \"Missing credentials\",\n      \"Wrong environment\",\n    ],\n    suggestedFixes: [\n      {\n        title: \"Check API key\",\n        description: \"Verify API key is valid and not expired\",\n        autoFixable: false,\n      },\n    ],\n  },\n];\n","/**\n * Suggestion Engine\n * Phase 10A: Smart Pipeline Suggestions\n */\n\nimport { EventEmitter } from \"eventemitter3\";\nimport { randomUUID } from \"crypto\";\nimport {\n  type IntelligenceConfig,\n  type IntelligenceEvents,\n  type Suggestion,\n  type SuggestionType,\n  type SuggestionPriority,\n  type Optimization,\n  type OptimizationCategory,\n  type SimilarPipeline,\n  type ErrorPattern,\n  type AutoFix,\n  type PipelineAnalysis,\n  IntelligenceConfigSchema,\n  OPTIMIZATION_TEMPLATES,\n  COMMON_ERROR_PATTERNS,\n} from \"./types.js\";\n\n// ============================================================================\n// TYPES\n// ============================================================================\n\ninterface PipelineData {\n  id: string;\n  name: string;\n  description?: string;\n  steps: Array<{\n    name: string;\n    type: string;\n    config: Record<string, unknown>;\n    prompt?: string;\n    model?: string;\n  }>;\n  config?: Record<string, unknown>;\n}\n\ninterface ExecutionHistory {\n  pipelineId: string;\n  executions: Array<{\n    id: string;\n    status: \"success\" | \"failure\" | \"cancelled\";\n    duration: number;\n    tokenUsage: number;\n    cost: number;\n    error?: string;\n    stepResults?: Array<{\n      stepIndex: number;\n      duration: number;\n      tokens: number;\n      error?: string;\n    }>;\n  }>;\n}\n\n// ============================================================================\n// SUGGESTION ENGINE\n// ============================================================================\n\nexport class SuggestionEngine extends EventEmitter<IntelligenceEvents> {\n  private config: IntelligenceConfig;\n  private suggestions: Map<string, Suggestion> = new Map();\n  private analyses: Map<string, PipelineAnalysis> = new Map();\n  private autoFixes: Map<string, AutoFix> = new Map();\n  private pipelineCache: Map<string, PipelineData> = new Map();\n  private executionCache: Map<string, ExecutionHistory> = new Map();\n\n  constructor(config: Partial<IntelligenceConfig> = {}) {\n    super();\n    this.config = IntelligenceConfigSchema.parse(config);\n  }\n\n  // ==========================================================================\n  // PIPELINE ANALYSIS\n  // ==========================================================================\n\n  async analyzePipeline(\n    pipeline: PipelineData,\n    history?: ExecutionHistory\n  ): Promise<PipelineAnalysis> {\n    if (!this.config.analysisEnabled) {\n      throw new Error(\"Analysis is disabled\");\n    }\n\n    this.emit(\"analysis:started\", pipeline.id);\n\n    // Cache pipeline data\n    this.pipelineCache.set(pipeline.id, pipeline);\n    if (history) {\n      this.executionCache.set(pipeline.id, history);\n    }\n\n    // Run all analysis components\n    const [suggestions, optimizations, similarPipelines, errorPatterns] =\n      await Promise.all([\n        this.generateSuggestions(pipeline, history),\n        this.findOptimizations(pipeline, history),\n        this.findSimilarPipelines(pipeline),\n        this.analyzeErrorPatterns(pipeline, history),\n      ]);\n\n    // Calculate scores\n    const scores = this.calculateScores(pipeline, history, optimizations);\n\n    // Compute execution stats\n    const executionStats = this.computeExecutionStats(history);\n\n    const analysis: PipelineAnalysis = {\n      pipelineId: pipeline.id,\n      analyzedAt: new Date(),\n      scores,\n      suggestions: suggestions.slice(0, this.config.maxSuggestionsPerPipeline),\n      optimizations,\n      similarPipelines: similarPipelines.slice(0, this.config.maxSimilarPipelines),\n      errorPatterns,\n      executionStats,\n    };\n\n    this.analyses.set(pipeline.id, analysis);\n    this.emit(\"analysis:completed\", analysis);\n\n    return analysis;\n  }\n\n  getAnalysis(pipelineId: string): PipelineAnalysis | undefined {\n    return this.analyses.get(pipelineId);\n  }\n\n  // ==========================================================================\n  // SUGGESTIONS\n  // ==========================================================================\n\n  private async generateSuggestions(\n    pipeline: PipelineData,\n    history?: ExecutionHistory\n  ): Promise<Suggestion[]> {\n    const suggestions: Suggestion[] = [];\n\n    // Check for optimization opportunities\n    if (pipeline.steps.length > 5) {\n      suggestions.push(this.createSuggestion({\n        type: \"optimization\",\n        priority: \"medium\",\n        title: \"Consider breaking down pipeline\",\n        description: `Pipeline has ${pipeline.steps.length} steps. Consider splitting into smaller, focused pipelines for better maintainability.`,\n        reasoning: \"Pipelines with many steps are harder to debug and maintain. Smaller pipelines are more reusable.\",\n        pipelineId: pipeline.id,\n        confidence: 0.75,\n        estimatedImpact: { reliabilityGain: 15 },\n      }));\n    }\n\n    // Check for missing error handling\n    const hasRetryConfig = pipeline.steps.some(s => s.config?.retry);\n    if (!hasRetryConfig && pipeline.steps.length > 2) {\n      suggestions.push(this.createSuggestion({\n        type: \"reliability\",\n        priority: \"high\",\n        title: \"Add retry logic\",\n        description: \"Pipeline lacks retry configuration. Add retry logic to handle transient failures.\",\n        reasoning: \"LLM APIs can have intermittent failures. Retry logic improves reliability.\",\n        pipelineId: pipeline.id,\n        confidence: 0.85,\n        autoFixAvailable: true,\n        autoFixConfig: { addRetry: true, maxRetries: 3, retryDelay: 1000 },\n        estimatedImpact: { reliabilityGain: 25 },\n      }));\n    }\n\n    // Check for expensive models on simple tasks\n    for (let i = 0; i < pipeline.steps.length; i++) {\n      const step = pipeline.steps[i];\n      if (this.isExpensiveModel(step.model) && this.isSimpleTask(step)) {\n        suggestions.push(this.createSuggestion({\n          type: \"cost_reduction\",\n          priority: \"medium\",\n          title: `Use smaller model for \"${step.name}\"`,\n          description: `Step \"${step.name}\" uses an expensive model but appears to be a simple task. Consider using a smaller model.`,\n          reasoning: \"Smaller models are faster and cheaper for classification, extraction, and simple generation tasks.\",\n          pipelineId: pipeline.id,\n          stepIndex: i,\n          confidence: 0.7,\n          autoFixAvailable: true,\n          autoFixConfig: { model: \"claude-3-haiku-20240307\" },\n          estimatedImpact: { costReduction: 50, speedImprovement: 30 },\n        }));\n      }\n    }\n\n    // Check for long prompts\n    for (let i = 0; i < pipeline.steps.length; i++) {\n      const step = pipeline.steps[i];\n      if (step.prompt && step.prompt.length > 2000) {\n        suggestions.push(this.createSuggestion({\n          type: \"optimization\",\n          priority: \"low\",\n          title: `Optimize prompt length in \"${step.name}\"`,\n          description: `Prompt in step \"${step.name}\" is ${step.prompt.length} characters. Consider condensing for efficiency.`,\n          reasoning: \"Shorter prompts reduce token usage and cost while often maintaining quality.\",\n          pipelineId: pipeline.id,\n          stepIndex: i,\n          confidence: 0.65,\n          estimatedImpact: { tokenSavings: Math.floor(step.prompt.length * 0.3) },\n        }));\n      }\n    }\n\n    // Check execution history for patterns\n    if (history && history.executions.length >= 5) {\n      const failureRate = history.executions.filter(e => e.status === \"failure\").length / history.executions.length;\n\n      if (failureRate > 0.2) {\n        suggestions.push(this.createSuggestion({\n          type: \"reliability\",\n          priority: \"critical\",\n          title: \"High failure rate detected\",\n          description: `Pipeline has a ${(failureRate * 100).toFixed(1)}% failure rate. Review error patterns and add error handling.`,\n          reasoning: \"High failure rates indicate systematic issues that should be addressed.\",\n          pipelineId: pipeline.id,\n          confidence: 0.95,\n        }));\n      }\n\n      // Check for cost outliers\n      const costs = history.executions.map(e => e.cost);\n      const avgCost = costs.reduce((a, b) => a + b, 0) / costs.length;\n      const maxCost = Math.max(...costs);\n\n      if (maxCost > avgCost * 3) {\n        suggestions.push(this.createSuggestion({\n          type: \"cost_reduction\",\n          priority: \"high\",\n          title: \"Cost variance detected\",\n          description: `Some executions cost ${(maxCost / avgCost).toFixed(1)}x more than average. Consider adding cost limits.`,\n          reasoning: \"High cost variance may indicate runaway loops or inefficient paths.\",\n          pipelineId: pipeline.id,\n          confidence: 0.8,\n          autoFixAvailable: true,\n          autoFixConfig: { maxCost: avgCost * 2 },\n        }));\n      }\n    }\n\n    // Check for security best practices\n    const hasSecrets = pipeline.steps.some(s =>\n      JSON.stringify(s.config).match(/password|secret|key|token|api_key/i)\n    );\n    if (hasSecrets) {\n      suggestions.push(this.createSuggestion({\n        type: \"security\",\n        priority: \"critical\",\n        title: \"Potential hardcoded secrets\",\n        description: \"Pipeline configuration may contain hardcoded secrets. Use environment variables instead.\",\n        reasoning: \"Hardcoded secrets are a security risk and make rotation difficult.\",\n        pipelineId: pipeline.id,\n        confidence: 0.9,\n      }));\n    }\n\n    // Store suggestions\n    for (const suggestion of suggestions) {\n      if (suggestion.confidence >= this.config.minConfidenceThreshold) {\n        this.suggestions.set(suggestion.id, suggestion);\n        this.emit(\"suggestion:created\", suggestion);\n      }\n    }\n\n    return suggestions.filter(s => s.confidence >= this.config.minConfidenceThreshold);\n  }\n\n  private createSuggestion(data: Omit<Suggestion, \"id\" | \"status\" | \"createdAt\" | \"autoFixAvailable\"> & { autoFixAvailable?: boolean }): Suggestion {\n    return {\n      ...data,\n      id: randomUUID(),\n      status: \"pending\",\n      autoFixAvailable: data.autoFixAvailable ?? false,\n      createdAt: new Date(),\n    };\n  }\n\n  getSuggestions(pipelineId?: string): Suggestion[] {\n    const all = Array.from(this.suggestions.values());\n    if (pipelineId) {\n      return all.filter(s => s.pipelineId === pipelineId);\n    }\n    return all;\n  }\n\n  async applySuggestion(suggestionId: string): Promise<boolean> {\n    const suggestion = this.suggestions.get(suggestionId);\n    if (!suggestion || suggestion.status !== \"pending\") {\n      return false;\n    }\n\n    if (!suggestion.autoFixAvailable) {\n      throw new Error(\"This suggestion does not support auto-fix\");\n    }\n\n    // Apply the fix (in real implementation, this would modify the pipeline)\n    suggestion.status = \"applied\";\n    suggestion.appliedAt = new Date();\n    this.emit(\"suggestion:applied\", suggestion);\n\n    return true;\n  }\n\n  dismissSuggestion(suggestionId: string, reason?: string): boolean {\n    const suggestion = this.suggestions.get(suggestionId);\n    if (!suggestion || suggestion.status !== \"pending\") {\n      return false;\n    }\n\n    suggestion.status = \"dismissed\";\n    suggestion.dismissedAt = new Date();\n    suggestion.dismissReason = reason;\n    this.emit(\"suggestion:dismissed\", suggestion);\n\n    return true;\n  }\n\n  // ==========================================================================\n  // OPTIMIZATIONS\n  // ==========================================================================\n\n  private async findOptimizations(\n    pipeline: PipelineData,\n    history?: ExecutionHistory\n  ): Promise<Optimization[]> {\n    const optimizations: Optimization[] = [];\n\n    // Check for parallel execution opportunities\n    const independentSteps = this.findIndependentSteps(pipeline);\n    if (independentSteps.length > 1) {\n      optimizations.push({\n        id: randomUUID(),\n        category: \"parallel_execution\",\n        title: OPTIMIZATION_TEMPLATES.parallel_execution.title,\n        description: `Steps ${independentSteps.join(\", \")} can run in parallel`,\n        currentValue: \"Sequential execution\",\n        suggestedValue: \"Parallel execution\",\n        estimatedSavings: {\n          time: this.estimateParallelSavings(pipeline, independentSteps, history),\n        },\n        confidence: 0.85,\n      });\n    }\n\n    // Check for caching opportunities\n    const repeatableSteps = this.findRepeatableSteps(pipeline, history);\n    if (repeatableSteps.length > 0) {\n      optimizations.push({\n        id: randomUUID(),\n        category: \"caching\",\n        title: OPTIMIZATION_TEMPLATES.caching.title,\n        description: `Steps ${repeatableSteps.join(\", \")} have repeated calls with same inputs`,\n        currentValue: \"No caching\",\n        suggestedValue: \"Enable result caching\",\n        estimatedSavings: {\n          tokens: this.estimateCachingSavings(history, repeatableSteps),\n          cost: this.estimateCachingCostSavings(history, repeatableSteps),\n        },\n        confidence: 0.8,\n      });\n    }\n\n    // Check model selection\n    for (let i = 0; i < pipeline.steps.length; i++) {\n      const step = pipeline.steps[i];\n      const recommendedModel = this.recommendModel(step, history);\n      if (recommendedModel && recommendedModel !== step.model) {\n        optimizations.push({\n          id: randomUUID(),\n          category: \"model_selection\",\n          title: `${OPTIMIZATION_TEMPLATES.model_selection.title} for \"${step.name}\"`,\n          description: OPTIMIZATION_TEMPLATES.model_selection.description,\n          currentValue: step.model || \"default\",\n          suggestedValue: recommendedModel,\n          estimatedSavings: {\n            cost: this.estimateModelSavings(step.model, recommendedModel),\n          },\n          codeChange: {\n            before: `model: \"${step.model || \"default\"}\"`,\n            after: `model: \"${recommendedModel}\"`,\n            stepIndex: i,\n          },\n          confidence: 0.75,\n        });\n      }\n    }\n\n    // Check for step consolidation\n    const consolidatableSteps = this.findConsolidatableSteps(pipeline);\n    if (consolidatableSteps.length > 0) {\n      for (const group of consolidatableSteps) {\n        optimizations.push({\n          id: randomUUID(),\n          category: \"step_consolidation\",\n          title: OPTIMIZATION_TEMPLATES.step_consolidation.title,\n          description: `Steps ${group.join(\", \")} can be merged into a single step`,\n          currentValue: `${group.length} separate steps`,\n          suggestedValue: \"1 consolidated step\",\n          estimatedSavings: {\n            time: 500 * (group.length - 1),  // Estimated overhead per step\n            tokens: 100 * (group.length - 1), // System prompt overhead\n          },\n          confidence: 0.7,\n        });\n      }\n    }\n\n    return optimizations;\n  }\n\n  // ==========================================================================\n  // SIMILAR PIPELINES\n  // ==========================================================================\n\n  private async findSimilarPipelines(pipeline: PipelineData): Promise<SimilarPipeline[]> {\n    const similar: SimilarPipeline[] = [];\n\n    for (const [id, cached] of this.pipelineCache) {\n      if (id === pipeline.id) continue;\n\n      const similarity = this.calculateSimilarity(pipeline, cached);\n      if (similarity >= this.config.similarityThreshold) {\n        const matchedFeatures = this.getMatchedFeatures(pipeline, cached);\n        const differingFeatures = this.getDifferingFeatures(pipeline, cached);\n\n        const history = this.executionCache.get(id);\n        const stats = history ? this.computeExecutionStats(history) : undefined;\n\n        similar.push({\n          pipelineId: id,\n          pipelineName: cached.name,\n          similarity,\n          matchedFeatures,\n          differingFeatures,\n          performanceComparison: stats ? {\n            avgDuration: stats.avgDuration,\n            avgCost: stats.avgCost,\n            successRate: stats.successRate,\n          } : undefined,\n        });\n      }\n    }\n\n    // Sort by similarity\n    similar.sort((a, b) => b.similarity - a.similarity);\n\n    if (similar.length > 0) {\n      this.emit(\"similar:found\", pipeline.id, similar);\n    }\n\n    return similar;\n  }\n\n  private calculateSimilarity(a: PipelineData, b: PipelineData): number {\n    let score = 0;\n    let factors = 0;\n\n    // Step count similarity\n    const stepDiff = Math.abs(a.steps.length - b.steps.length);\n    score += Math.max(0, 1 - stepDiff / 10);\n    factors++;\n\n    // Step type overlap\n    const aTypes = new Set(a.steps.map(s => s.type));\n    const bTypes = new Set(b.steps.map(s => s.type));\n    const typeOverlap = [...aTypes].filter(t => bTypes.has(t)).length;\n    score += typeOverlap / Math.max(aTypes.size, bTypes.size);\n    factors++;\n\n    // Name/description similarity (simple word overlap)\n    const aWords = new Set((a.name + \" \" + (a.description || \"\")).toLowerCase().split(/\\W+/));\n    const bWords = new Set((b.name + \" \" + (b.description || \"\")).toLowerCase().split(/\\W+/));\n    const wordOverlap = [...aWords].filter(w => bWords.has(w) && w.length > 3).length;\n    score += Math.min(1, wordOverlap / 5);\n    factors++;\n\n    return score / factors;\n  }\n\n  private getMatchedFeatures(a: PipelineData, b: PipelineData): string[] {\n    const matched: string[] = [];\n\n    const aTypes = new Set(a.steps.map(s => s.type));\n    const bTypes = new Set(b.steps.map(s => s.type));\n\n    for (const type of aTypes) {\n      if (bTypes.has(type)) {\n        matched.push(`Uses ${type} step`);\n      }\n    }\n\n    if (a.steps.length === b.steps.length) {\n      matched.push(\"Same number of steps\");\n    }\n\n    return matched;\n  }\n\n  private getDifferingFeatures(a: PipelineData, b: PipelineData): string[] {\n    const differing: string[] = [];\n\n    const aTypes = new Set(a.steps.map(s => s.type));\n    const bTypes = new Set(b.steps.map(s => s.type));\n\n    for (const type of aTypes) {\n      if (!bTypes.has(type)) {\n        differing.push(`Only A has ${type}`);\n      }\n    }\n    for (const type of bTypes) {\n      if (!aTypes.has(type)) {\n        differing.push(`Only B has ${type}`);\n      }\n    }\n\n    return differing;\n  }\n\n  // ==========================================================================\n  // ERROR PATTERNS\n  // ==========================================================================\n\n  private async analyzeErrorPatterns(\n    pipeline: PipelineData,\n    history?: ExecutionHistory\n  ): Promise<ErrorPattern[]> {\n    if (!history) return [];\n\n    const patterns: ErrorPattern[] = [];\n    const errorMessages = history.executions\n      .filter(e => e.error)\n      .map(e => e.error!);\n\n    for (const template of COMMON_ERROR_PATTERNS) {\n      const regex = new RegExp(template.pattern, \"i\");\n      const matches = errorMessages.filter(msg => regex.test(msg));\n\n      if (matches.length > 0) {\n        patterns.push({\n          ...template,\n          id: randomUUID(),\n          frequency: matches.length,\n        });\n      }\n    }\n\n    return patterns;\n  }\n\n  // ==========================================================================\n  // AUTO-FIX\n  // ==========================================================================\n\n  async applyAutoFix(\n    pipelineId: string,\n    errorPatternId: string,\n    fixIndex: number = 0\n  ): Promise<AutoFix | null> {\n    const analysis = this.analyses.get(pipelineId);\n    if (!analysis) return null;\n\n    const pattern = analysis.errorPatterns.find(p => p.id === errorPatternId);\n    if (!pattern || !pattern.suggestedFixes[fixIndex]?.autoFixable) {\n      return null;\n    }\n\n    const fix: AutoFix = {\n      id: randomUUID(),\n      errorPatternId,\n      pipelineId,\n      fixType: \"config_change\",\n      originalConfig: {},  // Would store original\n      fixedConfig: pattern.suggestedFixes[fixIndex].fixConfig || {},\n      applied: true,\n      appliedAt: new Date(),\n      rollbackAvailable: true,\n    };\n\n    this.autoFixes.set(fix.id, fix);\n    this.emit(\"autofix:applied\", fix);\n\n    return fix;\n  }\n\n  async rollbackAutoFix(fixId: string): Promise<boolean> {\n    const fix = this.autoFixes.get(fixId);\n    if (!fix || !fix.rollbackAvailable) {\n      return false;\n    }\n\n    fix.applied = false;\n    this.emit(\"autofix:rolled_back\", fix);\n\n    return true;\n  }\n\n  // ==========================================================================\n  // HELPER METHODS\n  // ==========================================================================\n\n  private isExpensiveModel(model?: string): boolean {\n    if (!model) return false;\n    return model.includes(\"opus\") || model.includes(\"gpt-4\") || model.includes(\"sonnet\");\n  }\n\n  private isSimpleTask(step: PipelineData[\"steps\"][0]): boolean {\n    const simpleTypes = [\"classify\", \"extract\", \"summarize\", \"translate\", \"format\"];\n    if (simpleTypes.some(t => step.type.toLowerCase().includes(t))) return true;\n    if (step.prompt && step.prompt.length < 500) return true;\n    return false;\n  }\n\n  private findIndependentSteps(pipeline: PipelineData): number[] {\n    // Simplified: assume steps with no {{variable}} references are independent\n    const independent: number[] = [];\n    for (let i = 0; i < pipeline.steps.length; i++) {\n      const step = pipeline.steps[i];\n      const configStr = JSON.stringify(step.config);\n      if (!configStr.includes(\"{{\") && !step.prompt?.includes(\"{{\")) {\n        independent.push(i);\n      }\n    }\n    return independent;\n  }\n\n  private findRepeatableSteps(pipeline: PipelineData, history?: ExecutionHistory): number[] {\n    // Would analyze execution history for repeated identical calls\n    return [];\n  }\n\n  private findConsolidatableSteps(pipeline: PipelineData): number[][] {\n    // Find consecutive steps of same type that could be merged\n    const groups: number[][] = [];\n    let currentGroup: number[] = [];\n    let lastType = \"\";\n\n    for (let i = 0; i < pipeline.steps.length; i++) {\n      if (pipeline.steps[i].type === lastType) {\n        currentGroup.push(i);\n      } else {\n        if (currentGroup.length > 1) {\n          groups.push([...currentGroup]);\n        }\n        currentGroup = [i];\n        lastType = pipeline.steps[i].type;\n      }\n    }\n\n    if (currentGroup.length > 1) {\n      groups.push(currentGroup);\n    }\n\n    return groups;\n  }\n\n  private recommendModel(step: PipelineData[\"steps\"][0], history?: ExecutionHistory): string | null {\n    if (this.isSimpleTask(step) && this.isExpensiveModel(step.model)) {\n      return \"claude-3-haiku-20240307\";\n    }\n    return null;\n  }\n\n  private estimateParallelSavings(\n    pipeline: PipelineData,\n    independentSteps: number[],\n    history?: ExecutionHistory\n  ): number {\n    if (!history || history.executions.length === 0) return 1000;\n\n    // Estimate based on average step duration\n    const avgDuration = history.executions.reduce((sum, e) => sum + e.duration, 0) / history.executions.length;\n    const avgStepDuration = avgDuration / pipeline.steps.length;\n\n    // Parallel execution could save (n-1) * avgStepDuration\n    return Math.floor(avgStepDuration * (independentSteps.length - 1));\n  }\n\n  private estimateCachingSavings(history: ExecutionHistory | undefined, steps: number[]): number {\n    if (!history) return 0;\n    return 500 * steps.length;  // Estimated token savings per cached step\n  }\n\n  private estimateCachingCostSavings(history: ExecutionHistory | undefined, steps: number[]): number {\n    if (!history) return 0;\n    const avgCost = history.executions.reduce((sum, e) => sum + e.cost, 0) / history.executions.length;\n    return avgCost * 0.1 * steps.length;  // ~10% savings per cached step\n  }\n\n  private estimateModelSavings(current?: string, recommended?: string): number {\n    if (!current || !recommended) return 0;\n    // Haiku is ~10x cheaper than Sonnet\n    if (current.includes(\"sonnet\") && recommended.includes(\"haiku\")) {\n      return 90;  // 90% cost reduction\n    }\n    return 0;\n  }\n\n  private calculateScores(\n    pipeline: PipelineData,\n    history: ExecutionHistory | undefined,\n    optimizations: Optimization[]\n  ): PipelineAnalysis[\"scores\"] {\n    let efficiency = 70;\n    let reliability = 70;\n    let costEffectiveness = 70;\n    let maintainability = 70;\n\n    // Adjust based on findings\n    if (optimizations.length > 0) {\n      efficiency -= optimizations.length * 5;\n    }\n    if (pipeline.steps.length > 10) {\n      maintainability -= 20;\n    }\n    if (history) {\n      const successRate = history.executions.filter(e => e.status === \"success\").length / history.executions.length;\n      reliability = Math.round(successRate * 100);\n    }\n\n    const overall = Math.round((efficiency + reliability + costEffectiveness + maintainability) / 4);\n\n    return {\n      overall: Math.max(0, Math.min(100, overall)),\n      efficiency: Math.max(0, Math.min(100, efficiency)),\n      reliability: Math.max(0, Math.min(100, reliability)),\n      costEffectiveness: Math.max(0, Math.min(100, costEffectiveness)),\n      maintainability: Math.max(0, Math.min(100, maintainability)),\n    };\n  }\n\n  private computeExecutionStats(history?: ExecutionHistory): PipelineAnalysis[\"executionStats\"] {\n    if (!history || history.executions.length === 0) {\n      return {\n        totalExecutions: 0,\n        successRate: 0,\n        avgDuration: 0,\n        avgCost: 0,\n        avgTokens: 0,\n      };\n    }\n\n    const executions = history.executions;\n    const successful = executions.filter(e => e.status === \"success\");\n\n    return {\n      totalExecutions: executions.length,\n      successRate: (successful.length / executions.length) * 100,\n      avgDuration: executions.reduce((sum, e) => sum + e.duration, 0) / executions.length,\n      avgCost: executions.reduce((sum, e) => sum + e.cost, 0) / executions.length,\n      avgTokens: executions.reduce((sum, e) => sum + e.tokenUsage, 0) / executions.length,\n    };\n  }\n}\n\n// ============================================================================\n// SINGLETON & FACTORY\n// ============================================================================\n\nlet instance: SuggestionEngine | null = null;\n\nexport function getSuggestionEngine(): SuggestionEngine {\n  if (!instance) {\n    instance = new SuggestionEngine();\n  }\n  return instance;\n}\n\nexport function createSuggestionEngine(\n  config: Partial<IntelligenceConfig> = {}\n): SuggestionEngine {\n  instance = new SuggestionEngine(config);\n  return instance;\n}\n","/**\n * Anomaly Detector\n * Phase 10B: Anomaly Detection\n */\n\nimport { EventEmitter } from \"eventemitter3\";\nimport { randomUUID } from \"crypto\";\nimport { z } from \"zod\";\n\n// ============================================================================\n// TYPES\n// ============================================================================\n\nexport const AnomalyTypeSchema = z.enum([\n  \"cost_spike\",           // Unusual cost increase\n  \"latency_spike\",        // Unusual latency increase\n  \"error_spike\",          // Unusual error rate increase\n  \"token_spike\",          // Unusual token usage\n  \"traffic_spike\",        // Unusual request volume\n  \"traffic_drop\",         // Unusual request drop\n  \"pattern_change\",       // Execution pattern changed\n  \"performance_regression\", // Gradual performance decline\n]);\nexport type AnomalyType = z.infer<typeof AnomalyTypeSchema>;\n\nexport const AnomalySeveritySchema = z.enum([\"low\", \"medium\", \"high\", \"critical\"]);\nexport type AnomalySeverity = z.infer<typeof AnomalySeveritySchema>;\n\nexport const AnomalyStatusSchema = z.enum([\n  \"active\",\n  \"investigating\",\n  \"resolved\",\n  \"false_positive\",\n]);\nexport type AnomalyStatus = z.infer<typeof AnomalyStatusSchema>;\n\nexport const AnomalySchema = z.object({\n  id: z.string(),\n  type: AnomalyTypeSchema,\n  severity: AnomalySeveritySchema,\n  status: AnomalyStatusSchema,\n  title: z.string(),\n  description: z.string(),\n\n  // Affected resources\n  pipelineId: z.string().optional(),\n  stepIndex: z.number().optional(),\n  service: z.string().optional(),\n\n  // Detection details\n  metric: z.string(),\n  expectedValue: z.number(),\n  actualValue: z.number(),\n  deviation: z.number(),  // Standard deviations from mean\n  confidence: z.number().min(0).max(1),\n\n  // Time range\n  detectedAt: z.date(),\n  startedAt: z.date(),\n  endedAt: z.date().optional(),\n  resolvedAt: z.date().optional(),\n\n  // Related data\n  relatedAnomalies: z.array(z.string()).optional(),\n  possibleCauses: z.array(z.string()).optional(),\n  suggestedActions: z.array(z.string()).optional(),\n\n  // Incident\n  incidentId: z.string().optional(),\n  acknowledgedBy: z.string().optional(),\n  acknowledgedAt: z.date().optional(),\n  notes: z.string().optional(),\n});\nexport type Anomaly = z.infer<typeof AnomalySchema>;\n\nexport const IncidentSchema = z.object({\n  id: z.string(),\n  title: z.string(),\n  description: z.string(),\n  severity: AnomalySeveritySchema,\n  status: z.enum([\"open\", \"investigating\", \"mitigating\", \"resolved\", \"closed\"]),\n  anomalyIds: z.array(z.string()),\n  createdAt: z.date(),\n  updatedAt: z.date(),\n  resolvedAt: z.date().optional(),\n  assignedTo: z.string().optional(),\n  timeline: z.array(z.object({\n    timestamp: z.date(),\n    event: z.string(),\n    actor: z.string().optional(),\n  })),\n  postmortem: z.string().optional(),\n});\nexport type Incident = z.infer<typeof IncidentSchema>;\n\nexport const AnomalyDetectorConfigSchema = z.object({\n  enabled: z.boolean().default(true),\n  checkIntervalMs: z.number().default(60000),  // 1 minute\n\n  // Thresholds (standard deviations)\n  costSpikeThreshold: z.number().default(3),\n  latencySpikeThreshold: z.number().default(2.5),\n  errorSpikeThreshold: z.number().default(2),\n  tokenSpikeThreshold: z.number().default(3),\n  trafficSpikeThreshold: z.number().default(3),\n  trafficDropThreshold: z.number().default(-2),\n\n  // Time windows\n  baselineWindowHours: z.number().default(168),  // 1 week\n  detectionWindowMinutes: z.number().default(15),\n\n  // Auto-incident creation\n  autoCreateIncident: z.boolean().default(true),\n  incidentThresholdSeverity: AnomalySeveritySchema.default(\"high\"),\n\n  // Alerting\n  alertWebhookUrl: z.string().url().optional(),\n  alertSlackChannel: z.string().optional(),\n});\nexport type AnomalyDetectorConfig = z.infer<typeof AnomalyDetectorConfigSchema>;\n\nexport interface AnomalyDetectorEvents {\n  \"anomaly:detected\": (anomaly: Anomaly) => void;\n  \"anomaly:resolved\": (anomaly: Anomaly) => void;\n  \"anomaly:escalated\": (anomaly: Anomaly) => void;\n  \"incident:created\": (incident: Incident) => void;\n  \"incident:updated\": (incident: Incident) => void;\n  \"incident:resolved\": (incident: Incident) => void;\n}\n\n// ============================================================================\n// METRIC DATA POINT\n// ============================================================================\n\ninterface DataPoint {\n  timestamp: Date;\n  value: number;\n  labels?: Record<string, string>;\n}\n\ninterface MetricSeries {\n  name: string;\n  points: DataPoint[];\n}\n\n// ============================================================================\n// ANOMALY DETECTOR\n// ============================================================================\n\nexport class AnomalyDetector extends EventEmitter<AnomalyDetectorEvents> {\n  private config: AnomalyDetectorConfig;\n  private anomalies: Map<string, Anomaly> = new Map();\n  private incidents: Map<string, Incident> = new Map();\n  private metrics: Map<string, MetricSeries> = new Map();\n  private checkTimer?: NodeJS.Timeout;\n  private baselines: Map<string, { mean: number; stdDev: number }> = new Map();\n\n  constructor(config: Partial<AnomalyDetectorConfig> = {}) {\n    super();\n    this.config = AnomalyDetectorConfigSchema.parse(config);\n  }\n\n  // ==========================================================================\n  // LIFECYCLE\n  // ==========================================================================\n\n  start(): void {\n    if (!this.config.enabled) return;\n\n    this.checkTimer = setInterval(() => {\n      this.runDetection();\n    }, this.config.checkIntervalMs);\n\n    // Run initial detection\n    this.runDetection();\n  }\n\n  stop(): void {\n    if (this.checkTimer) {\n      clearInterval(this.checkTimer);\n    }\n  }\n\n  // ==========================================================================\n  // METRIC INGESTION\n  // ==========================================================================\n\n  recordMetric(name: string, value: number, labels?: Record<string, string>): void {\n    const series = this.metrics.get(name) || { name, points: [] };\n\n    series.points.push({\n      timestamp: new Date(),\n      value,\n      labels,\n    });\n\n    // Keep only baseline window worth of data\n    const cutoff = Date.now() - this.config.baselineWindowHours * 3600000;\n    series.points = series.points.filter((p) => p.timestamp.getTime() > cutoff);\n\n    this.metrics.set(name, series);\n\n    // Update baseline\n    this.updateBaseline(name);\n  }\n\n  recordCost(pipelineId: string, cost: number): void {\n    this.recordMetric(\"cost\", cost, { pipeline_id: pipelineId });\n  }\n\n  recordLatency(pipelineId: string, latencyMs: number): void {\n    this.recordMetric(\"latency\", latencyMs, { pipeline_id: pipelineId });\n  }\n\n  recordError(pipelineId: string): void {\n    this.recordMetric(\"errors\", 1, { pipeline_id: pipelineId });\n  }\n\n  recordTokens(pipelineId: string, tokens: number): void {\n    this.recordMetric(\"tokens\", tokens, { pipeline_id: pipelineId });\n  }\n\n  recordRequest(service: string): void {\n    this.recordMetric(\"requests\", 1, { service });\n  }\n\n  // ==========================================================================\n  // DETECTION\n  // ==========================================================================\n\n  private runDetection(): void {\n    this.detectCostAnomalies();\n    this.detectLatencyAnomalies();\n    this.detectErrorAnomalies();\n    this.detectTokenAnomalies();\n    this.detectTrafficAnomalies();\n    this.checkResolvedAnomalies();\n  }\n\n  private detectCostAnomalies(): void {\n    this.detectAnomalyForMetric(\"cost\", \"cost_spike\", this.config.costSpikeThreshold);\n  }\n\n  private detectLatencyAnomalies(): void {\n    this.detectAnomalyForMetric(\"latency\", \"latency_spike\", this.config.latencySpikeThreshold);\n  }\n\n  private detectErrorAnomalies(): void {\n    this.detectAnomalyForMetric(\"errors\", \"error_spike\", this.config.errorSpikeThreshold);\n  }\n\n  private detectTokenAnomalies(): void {\n    this.detectAnomalyForMetric(\"tokens\", \"token_spike\", this.config.tokenSpikeThreshold);\n  }\n\n  private detectTrafficAnomalies(): void {\n    this.detectAnomalyForMetric(\"requests\", \"traffic_spike\", this.config.trafficSpikeThreshold);\n    this.detectAnomalyForMetric(\"requests\", \"traffic_drop\", this.config.trafficDropThreshold, true);\n  }\n\n  private detectAnomalyForMetric(\n    metricName: string,\n    anomalyType: AnomalyType,\n    threshold: number,\n    detectDrop: boolean = false\n  ): void {\n    const baseline = this.baselines.get(metricName);\n    if (!baseline || baseline.stdDev === 0) return;\n\n    const recentValue = this.getRecentValue(metricName);\n    if (recentValue === null) return;\n\n    const deviation = (recentValue - baseline.mean) / baseline.stdDev;\n\n    // Check if deviation exceeds threshold\n    const isAnomaly = detectDrop\n      ? deviation < threshold\n      : deviation > threshold;\n\n    if (isAnomaly) {\n      const existingAnomaly = this.findActiveAnomaly(metricName, anomalyType);\n\n      if (!existingAnomaly) {\n        const anomaly = this.createAnomaly({\n          type: anomalyType,\n          severity: this.calculateSeverity(Math.abs(deviation)),\n          title: this.generateTitle(anomalyType, metricName),\n          description: this.generateDescription(\n            anomalyType,\n            metricName,\n            baseline.mean,\n            recentValue,\n            deviation\n          ),\n          metric: metricName,\n          expectedValue: baseline.mean,\n          actualValue: recentValue,\n          deviation: Math.abs(deviation),\n          confidence: this.calculateConfidence(Math.abs(deviation), baseline),\n          possibleCauses: this.inferCauses(anomalyType, metricName),\n          suggestedActions: this.suggestActions(anomalyType),\n        });\n\n        this.anomalies.set(anomaly.id, anomaly);\n        this.emit(\"anomaly:detected\", anomaly);\n\n        // Auto-create incident for high severity\n        if (\n          this.config.autoCreateIncident &&\n          this.compareSeverity(anomaly.severity, this.config.incidentThresholdSeverity) >= 0\n        ) {\n          this.createIncidentFromAnomaly(anomaly);\n        }\n      }\n    }\n  }\n\n  private checkResolvedAnomalies(): void {\n    for (const anomaly of this.anomalies.values()) {\n      if (anomaly.status !== \"active\") continue;\n\n      const baseline = this.baselines.get(anomaly.metric);\n      if (!baseline) continue;\n\n      const recentValue = this.getRecentValue(anomaly.metric);\n      if (recentValue === null) continue;\n\n      const deviation = Math.abs((recentValue - baseline.mean) / baseline.stdDev);\n\n      // If deviation is back to normal (< 1.5 std devs), mark resolved\n      if (deviation < 1.5) {\n        anomaly.status = \"resolved\";\n        anomaly.endedAt = new Date();\n        anomaly.resolvedAt = new Date();\n        this.emit(\"anomaly:resolved\", anomaly);\n      }\n    }\n  }\n\n  // ==========================================================================\n  // ANOMALY MANAGEMENT\n  // ==========================================================================\n\n  private createAnomaly(\n    data: Omit<Anomaly, \"id\" | \"status\" | \"detectedAt\" | \"startedAt\">\n  ): Anomaly {\n    return {\n      ...data,\n      id: randomUUID(),\n      status: \"active\",\n      detectedAt: new Date(),\n      startedAt: new Date(),\n    };\n  }\n\n  getAnomalies(options?: {\n    status?: AnomalyStatus;\n    type?: AnomalyType;\n    severity?: AnomalySeverity;\n    pipelineId?: string;\n  }): Anomaly[] {\n    let anomalies = Array.from(this.anomalies.values());\n\n    if (options?.status) {\n      anomalies = anomalies.filter((a) => a.status === options.status);\n    }\n    if (options?.type) {\n      anomalies = anomalies.filter((a) => a.type === options.type);\n    }\n    if (options?.severity) {\n      anomalies = anomalies.filter((a) => a.severity === options.severity);\n    }\n    if (options?.pipelineId) {\n      anomalies = anomalies.filter((a) => a.pipelineId === options.pipelineId);\n    }\n\n    return anomalies.sort((a, b) => b.detectedAt.getTime() - a.detectedAt.getTime());\n  }\n\n  acknowledgeAnomaly(anomalyId: string, userId: string, notes?: string): boolean {\n    const anomaly = this.anomalies.get(anomalyId);\n    if (!anomaly) return false;\n\n    anomaly.status = \"investigating\";\n    anomaly.acknowledgedBy = userId;\n    anomaly.acknowledgedAt = new Date();\n    if (notes) anomaly.notes = notes;\n\n    return true;\n  }\n\n  markFalsePositive(anomalyId: string, reason?: string): boolean {\n    const anomaly = this.anomalies.get(anomalyId);\n    if (!anomaly) return false;\n\n    anomaly.status = \"false_positive\";\n    anomaly.resolvedAt = new Date();\n    if (reason) anomaly.notes = reason;\n\n    return true;\n  }\n\n  // ==========================================================================\n  // INCIDENTS\n  // ==========================================================================\n\n  private createIncidentFromAnomaly(anomaly: Anomaly): Incident {\n    const incident: Incident = {\n      id: randomUUID(),\n      title: `Incident: ${anomaly.title}`,\n      description: anomaly.description,\n      severity: anomaly.severity,\n      status: \"open\",\n      anomalyIds: [anomaly.id],\n      createdAt: new Date(),\n      updatedAt: new Date(),\n      timeline: [\n        {\n          timestamp: new Date(),\n          event: \"Incident created automatically from detected anomaly\",\n        },\n      ],\n    };\n\n    this.incidents.set(incident.id, incident);\n    anomaly.incidentId = incident.id;\n\n    this.emit(\"incident:created\", incident);\n    return incident;\n  }\n\n  getIncidents(status?: Incident[\"status\"]): Incident[] {\n    let incidents = Array.from(this.incidents.values());\n    if (status) {\n      incidents = incidents.filter((i) => i.status === status);\n    }\n    return incidents.sort((a, b) => b.createdAt.getTime() - a.createdAt.getTime());\n  }\n\n  updateIncident(\n    incidentId: string,\n    updates: {\n      status?: Incident[\"status\"];\n      assignedTo?: string;\n      notes?: string;\n    }\n  ): Incident | undefined {\n    const incident = this.incidents.get(incidentId);\n    if (!incident) return undefined;\n\n    if (updates.status) {\n      incident.status = updates.status;\n      incident.timeline.push({\n        timestamp: new Date(),\n        event: `Status changed to ${updates.status}`,\n      });\n\n      if (updates.status === \"resolved\" || updates.status === \"closed\") {\n        incident.resolvedAt = new Date();\n      }\n    }\n\n    if (updates.assignedTo) {\n      incident.assignedTo = updates.assignedTo;\n      incident.timeline.push({\n        timestamp: new Date(),\n        event: `Assigned to ${updates.assignedTo}`,\n      });\n    }\n\n    if (updates.notes) {\n      incident.timeline.push({\n        timestamp: new Date(),\n        event: updates.notes,\n      });\n    }\n\n    incident.updatedAt = new Date();\n    this.emit(\"incident:updated\", incident);\n\n    if (incident.status === \"resolved\") {\n      this.emit(\"incident:resolved\", incident);\n    }\n\n    return incident;\n  }\n\n  addPostmortem(incidentId: string, postmortem: string): boolean {\n    const incident = this.incidents.get(incidentId);\n    if (!incident) return false;\n\n    incident.postmortem = postmortem;\n    incident.timeline.push({\n      timestamp: new Date(),\n      event: \"Postmortem added\",\n    });\n    incident.updatedAt = new Date();\n\n    this.emit(\"incident:updated\", incident);\n    return true;\n  }\n\n  // ==========================================================================\n  // HELPER METHODS\n  // ==========================================================================\n\n  private updateBaseline(metricName: string): void {\n    const series = this.metrics.get(metricName);\n    if (!series || series.points.length < 10) return;\n\n    // Use data older than detection window for baseline\n    const baselineCutoff = Date.now() - this.config.detectionWindowMinutes * 60000;\n    const baselinePoints = series.points.filter(\n      (p) => p.timestamp.getTime() < baselineCutoff\n    );\n\n    if (baselinePoints.length < 10) return;\n\n    const values = baselinePoints.map((p) => p.value);\n    const mean = values.reduce((a, b) => a + b, 0) / values.length;\n    const variance =\n      values.reduce((sum, v) => sum + Math.pow(v - mean, 2), 0) / values.length;\n    const stdDev = Math.sqrt(variance);\n\n    this.baselines.set(metricName, { mean, stdDev: stdDev || 1 });\n  }\n\n  private getRecentValue(metricName: string): number | null {\n    const series = this.metrics.get(metricName);\n    if (!series || series.points.length === 0) return null;\n\n    // Get average of last detection window\n    const windowStart = Date.now() - this.config.detectionWindowMinutes * 60000;\n    const recentPoints = series.points.filter(\n      (p) => p.timestamp.getTime() >= windowStart\n    );\n\n    if (recentPoints.length === 0) return null;\n\n    return recentPoints.reduce((sum, p) => sum + p.value, 0) / recentPoints.length;\n  }\n\n  private findActiveAnomaly(metric: string, type: AnomalyType): Anomaly | undefined {\n    for (const anomaly of this.anomalies.values()) {\n      if (\n        anomaly.metric === metric &&\n        anomaly.type === type &&\n        anomaly.status === \"active\"\n      ) {\n        return anomaly;\n      }\n    }\n    return undefined;\n  }\n\n  private calculateSeverity(deviation: number): AnomalySeverity {\n    if (deviation >= 5) return \"critical\";\n    if (deviation >= 4) return \"high\";\n    if (deviation >= 3) return \"medium\";\n    return \"low\";\n  }\n\n  private calculateConfidence(\n    deviation: number,\n    baseline: { mean: number; stdDev: number }\n  ): number {\n    // Higher deviation = higher confidence\n    // More data points = higher confidence\n    const deviationFactor = Math.min(deviation / 5, 1);\n    const series = Array.from(this.metrics.values())[0];\n    const dataFactor = series ? Math.min(series.points.length / 100, 1) : 0.5;\n\n    return 0.5 + (deviationFactor * 0.3) + (dataFactor * 0.2);\n  }\n\n  private compareSeverity(a: AnomalySeverity, b: AnomalySeverity): number {\n    const order = { low: 0, medium: 1, high: 2, critical: 3 };\n    return order[a] - order[b];\n  }\n\n  private generateTitle(type: AnomalyType, metric: string): string {\n    const titles: Record<AnomalyType, string> = {\n      cost_spike: `Cost spike detected for ${metric}`,\n      latency_spike: `Latency spike detected`,\n      error_spike: `Error rate spike detected`,\n      token_spike: `Token usage spike detected`,\n      traffic_spike: `Traffic spike detected`,\n      traffic_drop: `Traffic drop detected`,\n      pattern_change: `Execution pattern change detected`,\n      performance_regression: `Performance regression detected`,\n    };\n    return titles[type];\n  }\n\n  private generateDescription(\n    type: AnomalyType,\n    metric: string,\n    expected: number,\n    actual: number,\n    deviation: number\n  ): string {\n    const change = ((actual - expected) / expected * 100).toFixed(1);\n    const direction = actual > expected ? \"above\" : \"below\";\n\n    return `${metric} is ${Math.abs(parseFloat(change))}% ${direction} normal. ` +\n      `Expected: ${expected.toFixed(2)}, Actual: ${actual.toFixed(2)} ` +\n      `(${deviation.toFixed(1)} standard deviations from mean)`;\n  }\n\n  private inferCauses(type: AnomalyType, metric: string): string[] {\n    const causes: Record<AnomalyType, string[]> = {\n      cost_spike: [\n        \"Increased execution volume\",\n        \"Using more expensive models\",\n        \"Longer prompts or responses\",\n        \"Retry loops causing duplicate calls\",\n      ],\n      latency_spike: [\n        \"API provider experiencing slowdown\",\n        \"Network latency issues\",\n        \"Complex prompts requiring more processing\",\n        \"Rate limiting causing delays\",\n      ],\n      error_spike: [\n        \"API provider outage\",\n        \"Invalid configuration\",\n        \"Rate limit exceeded\",\n        \"Authentication issues\",\n      ],\n      token_spike: [\n        \"Longer inputs than usual\",\n        \"More verbose outputs\",\n        \"Missing input truncation\",\n        \"Conversation context accumulation\",\n      ],\n      traffic_spike: [\n        \"Marketing campaign driving traffic\",\n        \"Bot or crawler activity\",\n        \"Batch job execution\",\n        \"User behavior change\",\n      ],\n      traffic_drop: [\n        \"Service disruption\",\n        \"DNS or networking issues\",\n        \"Deployment problems\",\n        \"External dependency failure\",\n      ],\n      pattern_change: [\n        \"Configuration change\",\n        \"Model update\",\n        \"Workflow modification\",\n      ],\n      performance_regression: [\n        \"Code changes affecting performance\",\n        \"Data growth\",\n        \"Resource contention\",\n      ],\n    };\n    return causes[type] || [];\n  }\n\n  private suggestActions(type: AnomalyType): string[] {\n    const actions: Record<AnomalyType, string[]> = {\n      cost_spike: [\n        \"Review recent execution logs\",\n        \"Check for retry loops\",\n        \"Consider adding cost limits\",\n        \"Evaluate model selection\",\n      ],\n      latency_spike: [\n        \"Check API provider status\",\n        \"Review network connectivity\",\n        \"Consider adding timeouts\",\n        \"Implement request queuing\",\n      ],\n      error_spike: [\n        \"Check API provider status page\",\n        \"Review error logs\",\n        \"Verify API keys and credentials\",\n        \"Check rate limit status\",\n      ],\n      token_spike: [\n        \"Review input data size\",\n        \"Check prompt templates\",\n        \"Implement input truncation\",\n        \"Add token budgets\",\n      ],\n      traffic_spike: [\n        \"Scale resources if needed\",\n        \"Enable rate limiting\",\n        \"Check for bot traffic\",\n        \"Review recent deployments\",\n      ],\n      traffic_drop: [\n        \"Check service health\",\n        \"Review recent deployments\",\n        \"Check DNS and networking\",\n        \"Contact API provider if needed\",\n      ],\n      pattern_change: [\n        \"Review recent configuration changes\",\n        \"Check for model updates\",\n        \"Verify workflow definitions\",\n      ],\n      performance_regression: [\n        \"Review recent code changes\",\n        \"Profile slow operations\",\n        \"Check resource utilization\",\n      ],\n    };\n    return actions[type] || [];\n  }\n}\n\n// ============================================================================\n// SINGLETON & FACTORY\n// ============================================================================\n\nlet instance: AnomalyDetector | null = null;\n\nexport function getAnomalyDetector(): AnomalyDetector {\n  if (!instance) {\n    instance = new AnomalyDetector();\n  }\n  return instance;\n}\n\nexport function createAnomalyDetector(\n  config: Partial<AnomalyDetectorConfig> = {}\n): AnomalyDetector {\n  instance = new AnomalyDetector(config);\n  return instance;\n}\n","/**\n * Natural Language Pipeline Builder\n * Phase 10C: Natural Language Pipeline Builder\n */\n\nimport { EventEmitter } from \"eventemitter3\";\nimport { randomUUID } from \"crypto\";\nimport { z } from \"zod\";\n\n// ============================================================================\n// TYPES\n// ============================================================================\n\nexport const NLRequestSchema = z.object({\n  description: z.string().min(10),\n  context: z.string().optional(),\n  constraints: z.object({\n    maxSteps: z.number().optional(),\n    maxCost: z.number().optional(),\n    preferredModels: z.array(z.string()).optional(),\n    requiredCapabilities: z.array(z.string()).optional(),\n  }).optional(),\n});\nexport type NLRequest = z.infer<typeof NLRequestSchema>;\n\nexport const GeneratedStepSchema = z.object({\n  name: z.string(),\n  type: z.enum([\n    \"llm_call\",\n    \"data_transform\",\n    \"api_call\",\n    \"condition\",\n    \"loop\",\n    \"parallel\",\n    \"human_review\",\n  ]),\n  description: z.string(),\n  config: z.record(z.unknown()),\n  prompt: z.string().optional(),\n  model: z.string().optional(),\n  dependencies: z.array(z.number()).optional(),  // indices of dependent steps\n  estimatedTokens: z.number().optional(),\n  estimatedCost: z.number().optional(),\n});\nexport type GeneratedStep = z.infer<typeof GeneratedStepSchema>;\n\nexport const GeneratedPipelineSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  description: z.string(),\n  steps: z.array(GeneratedStepSchema),\n  inputSchema: z.record(z.object({\n    type: z.string(),\n    description: z.string(),\n    required: z.boolean(),\n    default: z.unknown().optional(),\n  })),\n  outputSchema: z.record(z.object({\n    type: z.string(),\n    description: z.string(),\n  })),\n  estimatedTotalTokens: z.number(),\n  estimatedTotalCost: z.number(),\n  confidence: z.number().min(0).max(1),\n  reasoning: z.string(),\n  alternatives: z.array(z.object({\n    description: z.string(),\n    tradeoffs: z.string(),\n  })).optional(),\n});\nexport type GeneratedPipeline = z.infer<typeof GeneratedPipelineSchema>;\n\nexport const RefinementSchema = z.object({\n  type: z.enum([\"add_step\", \"remove_step\", \"modify_step\", \"reorder\", \"change_model\", \"add_validation\", \"other\"]),\n  instruction: z.string(),\n  stepIndex: z.number().optional(),\n});\nexport type Refinement = z.infer<typeof RefinementSchema>;\n\nexport const ConversationMessageSchema = z.object({\n  role: z.enum([\"user\", \"assistant\"]),\n  content: z.string(),\n  timestamp: z.date(),\n  pipelineSnapshot: GeneratedPipelineSchema.optional(),\n});\nexport type ConversationMessage = z.infer<typeof ConversationMessageSchema>;\n\nexport const BuilderSessionSchema = z.object({\n  id: z.string(),\n  status: z.enum([\"active\", \"completed\", \"abandoned\"]),\n  originalRequest: NLRequestSchema,\n  currentPipeline: GeneratedPipelineSchema.optional(),\n  conversation: z.array(ConversationMessageSchema),\n  refinements: z.array(RefinementSchema),\n  createdAt: z.date(),\n  updatedAt: z.date(),\n  completedAt: z.date().optional(),\n});\nexport type BuilderSession = z.infer<typeof BuilderSessionSchema>;\n\nexport const NLBuilderConfigSchema = z.object({\n  enabled: z.boolean().default(true),\n  model: z.string().default(\"claude-3-sonnet-20240229\"),\n  maxConversationTurns: z.number().default(10),\n  maxStepsPerPipeline: z.number().default(20),\n  defaultCostLimit: z.number().default(1.0),\n  templateMatching: z.boolean().default(true),\n  autoSuggestImprovements: z.boolean().default(true),\n});\nexport type NLBuilderConfig = z.infer<typeof NLBuilderConfigSchema>;\n\nexport interface NLBuilderEvents {\n  \"session:started\": (session: BuilderSession) => void;\n  \"session:updated\": (session: BuilderSession) => void;\n  \"session:completed\": (session: BuilderSession) => void;\n  \"pipeline:generated\": (pipeline: GeneratedPipeline) => void;\n  \"pipeline:refined\": (pipeline: GeneratedPipeline, refinement: Refinement) => void;\n}\n\n// ============================================================================\n// PIPELINE TEMPLATES\n// ============================================================================\n\ninterface PipelineTemplate {\n  id: string;\n  name: string;\n  description: string;\n  keywords: string[];\n  steps: GeneratedStep[];\n  inputSchema: GeneratedPipeline[\"inputSchema\"];\n  outputSchema: GeneratedPipeline[\"outputSchema\"];\n}\n\nconst PIPELINE_TEMPLATES: PipelineTemplate[] = [\n  {\n    id: \"content-generation\",\n    name: \"Content Generation\",\n    description: \"Generate content from a topic or brief\",\n    keywords: [\"write\", \"generate\", \"create\", \"content\", \"article\", \"blog\", \"post\"],\n    steps: [\n      {\n        name: \"Research Topic\",\n        type: \"llm_call\",\n        description: \"Research and gather information about the topic\",\n        config: {},\n        prompt: \"Research the following topic and provide key points: {{topic}}\",\n        model: \"claude-3-haiku-20240307\",\n        estimatedTokens: 500,\n        estimatedCost: 0.001,\n      },\n      {\n        name: \"Generate Outline\",\n        type: \"llm_call\",\n        description: \"Create a structured outline\",\n        config: {},\n        prompt: \"Create an outline for content about: {{topic}}\\n\\nResearch: {{step_0_output}}\",\n        model: \"claude-3-haiku-20240307\",\n        dependencies: [0],\n        estimatedTokens: 300,\n        estimatedCost: 0.0006,\n      },\n      {\n        name: \"Write Content\",\n        type: \"llm_call\",\n        description: \"Write the full content based on outline\",\n        config: {},\n        prompt: \"Write engaging content based on this outline: {{step_1_output}}\",\n        model: \"claude-3-sonnet-20240229\",\n        dependencies: [1],\n        estimatedTokens: 2000,\n        estimatedCost: 0.02,\n      },\n    ],\n    inputSchema: {\n      topic: { type: \"string\", description: \"The topic to write about\", required: true },\n    },\n    outputSchema: {\n      content: { type: \"string\", description: \"The generated content\" },\n    },\n  },\n  {\n    id: \"data-extraction\",\n    name: \"Data Extraction\",\n    description: \"Extract structured data from unstructured text\",\n    keywords: [\"extract\", \"parse\", \"data\", \"information\", \"structured\", \"json\"],\n    steps: [\n      {\n        name: \"Analyze Structure\",\n        type: \"llm_call\",\n        description: \"Analyze the input and identify extractable fields\",\n        config: {},\n        prompt: \"Analyze this text and identify the key data fields that can be extracted:\\n\\n{{input_text}}\",\n        model: \"claude-3-haiku-20240307\",\n        estimatedTokens: 400,\n        estimatedCost: 0.0008,\n      },\n      {\n        name: \"Extract Data\",\n        type: \"llm_call\",\n        description: \"Extract the identified data into JSON format\",\n        config: { outputFormat: \"json\" },\n        prompt: \"Extract the following fields from the text and return as JSON:\\nFields: {{step_0_output}}\\n\\nText: {{input_text}}\",\n        model: \"claude-3-sonnet-20240229\",\n        dependencies: [0],\n        estimatedTokens: 600,\n        estimatedCost: 0.006,\n      },\n      {\n        name: \"Validate Output\",\n        type: \"data_transform\",\n        description: \"Validate the extracted JSON\",\n        config: { validate: true },\n        dependencies: [1],\n      },\n    ],\n    inputSchema: {\n      input_text: { type: \"string\", description: \"The text to extract data from\", required: true },\n    },\n    outputSchema: {\n      extracted_data: { type: \"object\", description: \"The extracted structured data\" },\n    },\n  },\n  {\n    id: \"summarization\",\n    name: \"Summarization\",\n    description: \"Summarize long documents or text\",\n    keywords: [\"summarize\", \"summary\", \"condense\", \"brief\", \"tldr\", \"shorten\"],\n    steps: [\n      {\n        name: \"Chunk Document\",\n        type: \"data_transform\",\n        description: \"Split long document into manageable chunks\",\n        config: { chunkSize: 4000, overlap: 200 },\n      },\n      {\n        name: \"Summarize Chunks\",\n        type: \"loop\",\n        description: \"Summarize each chunk\",\n        config: { iterateOver: \"step_0_output\" },\n        prompt: \"Summarize the following text concisely:\\n\\n{{chunk}}\",\n        model: \"claude-3-haiku-20240307\",\n        dependencies: [0],\n        estimatedTokens: 1000,\n        estimatedCost: 0.002,\n      },\n      {\n        name: \"Combine Summaries\",\n        type: \"llm_call\",\n        description: \"Combine chunk summaries into final summary\",\n        config: {},\n        prompt: \"Combine these summaries into a cohesive final summary:\\n\\n{{step_1_output}}\",\n        model: \"claude-3-sonnet-20240229\",\n        dependencies: [1],\n        estimatedTokens: 800,\n        estimatedCost: 0.008,\n      },\n    ],\n    inputSchema: {\n      document: { type: \"string\", description: \"The document to summarize\", required: true },\n      max_length: { type: \"number\", description: \"Maximum summary length\", required: false, default: 500 },\n    },\n    outputSchema: {\n      summary: { type: \"string\", description: \"The generated summary\" },\n    },\n  },\n  {\n    id: \"classification\",\n    name: \"Classification\",\n    description: \"Classify text into categories\",\n    keywords: [\"classify\", \"categorize\", \"label\", \"tag\", \"category\", \"sentiment\"],\n    steps: [\n      {\n        name: \"Classify\",\n        type: \"llm_call\",\n        description: \"Classify the input into specified categories\",\n        config: { outputFormat: \"json\" },\n        prompt: \"Classify the following text into one of these categories: {{categories}}\\n\\nText: {{input_text}}\\n\\nRespond with JSON: {\\\"category\\\": \\\"...\\\", \\\"confidence\\\": 0.0-1.0, \\\"reasoning\\\": \\\"...\\\"}\",\n        model: \"claude-3-haiku-20240307\",\n        estimatedTokens: 200,\n        estimatedCost: 0.0004,\n      },\n    ],\n    inputSchema: {\n      input_text: { type: \"string\", description: \"The text to classify\", required: true },\n      categories: { type: \"array\", description: \"List of possible categories\", required: true },\n    },\n    outputSchema: {\n      category: { type: \"string\", description: \"The assigned category\" },\n      confidence: { type: \"number\", description: \"Classification confidence\" },\n    },\n  },\n  {\n    id: \"translation\",\n    name: \"Translation\",\n    description: \"Translate text between languages\",\n    keywords: [\"translate\", \"translation\", \"language\", \"convert\", \"localize\"],\n    steps: [\n      {\n        name: \"Translate\",\n        type: \"llm_call\",\n        description: \"Translate text to target language\",\n        config: {},\n        prompt: \"Translate the following text to {{target_language}}. Preserve the original meaning and tone:\\n\\n{{input_text}}\",\n        model: \"claude-3-sonnet-20240229\",\n        estimatedTokens: 500,\n        estimatedCost: 0.005,\n      },\n      {\n        name: \"Quality Check\",\n        type: \"llm_call\",\n        description: \"Verify translation quality\",\n        config: { outputFormat: \"json\" },\n        prompt: \"Review this translation for accuracy:\\nOriginal: {{input_text}}\\nTranslation: {{step_0_output}}\\n\\nRespond with JSON: {\\\"quality_score\\\": 0-100, \\\"issues\\\": [], \\\"suggestions\\\": []}\",\n        model: \"claude-3-haiku-20240307\",\n        dependencies: [0],\n        estimatedTokens: 300,\n        estimatedCost: 0.0006,\n      },\n    ],\n    inputSchema: {\n      input_text: { type: \"string\", description: \"Text to translate\", required: true },\n      target_language: { type: \"string\", description: \"Target language\", required: true },\n    },\n    outputSchema: {\n      translated_text: { type: \"string\", description: \"The translated text\" },\n      quality_score: { type: \"number\", description: \"Translation quality score\" },\n    },\n  },\n];\n\n// ============================================================================\n// NATURAL LANGUAGE BUILDER\n// ============================================================================\n\nexport class NLBuilder extends EventEmitter<NLBuilderEvents> {\n  private config: NLBuilderConfig;\n  private sessions: Map<string, BuilderSession> = new Map();\n  private templates: PipelineTemplate[] = PIPELINE_TEMPLATES;\n\n  constructor(config: Partial<NLBuilderConfig> = {}) {\n    super();\n    this.config = NLBuilderConfigSchema.parse(config);\n  }\n\n  // ==========================================================================\n  // SESSION MANAGEMENT\n  // ==========================================================================\n\n  async startSession(request: NLRequest): Promise<BuilderSession> {\n    const session: BuilderSession = {\n      id: randomUUID(),\n      status: \"active\",\n      originalRequest: request,\n      conversation: [\n        {\n          role: \"user\",\n          content: request.description,\n          timestamp: new Date(),\n        },\n      ],\n      refinements: [],\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    };\n\n    this.sessions.set(session.id, session);\n    this.emit(\"session:started\", session);\n\n    // Generate initial pipeline\n    const pipeline = await this.generatePipeline(request);\n    session.currentPipeline = pipeline;\n    session.conversation.push({\n      role: \"assistant\",\n      content: this.formatPipelineResponse(pipeline),\n      timestamp: new Date(),\n      pipelineSnapshot: pipeline,\n    });\n\n    this.emit(\"session:updated\", session);\n    this.emit(\"pipeline:generated\", pipeline);\n\n    return session;\n  }\n\n  getSession(sessionId: string): BuilderSession | undefined {\n    return this.sessions.get(sessionId);\n  }\n\n  async refineSession(sessionId: string, instruction: string): Promise<BuilderSession | undefined> {\n    const session = this.sessions.get(sessionId);\n    if (!session || session.status !== \"active\") return undefined;\n\n    if (session.conversation.length >= this.config.maxConversationTurns * 2) {\n      throw new Error(\"Maximum conversation turns reached\");\n    }\n\n    // Add user message\n    session.conversation.push({\n      role: \"user\",\n      content: instruction,\n      timestamp: new Date(),\n    });\n\n    // Parse refinement type\n    const refinement = this.parseRefinement(instruction, session.currentPipeline);\n    session.refinements.push(refinement);\n\n    // Apply refinement\n    if (session.currentPipeline) {\n      const refined = await this.applyRefinement(session.currentPipeline, refinement);\n      session.currentPipeline = refined;\n\n      session.conversation.push({\n        role: \"assistant\",\n        content: this.formatRefinementResponse(refinement, refined),\n        timestamp: new Date(),\n        pipelineSnapshot: refined,\n      });\n\n      this.emit(\"pipeline:refined\", refined, refinement);\n    }\n\n    session.updatedAt = new Date();\n    this.emit(\"session:updated\", session);\n\n    return session;\n  }\n\n  completeSession(sessionId: string): BuilderSession | undefined {\n    const session = this.sessions.get(sessionId);\n    if (!session) return undefined;\n\n    session.status = \"completed\";\n    session.completedAt = new Date();\n    session.updatedAt = new Date();\n\n    this.emit(\"session:completed\", session);\n    return session;\n  }\n\n  abandonSession(sessionId: string): boolean {\n    const session = this.sessions.get(sessionId);\n    if (!session) return false;\n\n    session.status = \"abandoned\";\n    session.updatedAt = new Date();\n    return true;\n  }\n\n  // ==========================================================================\n  // PIPELINE GENERATION\n  // ==========================================================================\n\n  async generatePipeline(request: NLRequest): Promise<GeneratedPipeline> {\n    // Try template matching first\n    if (this.config.templateMatching) {\n      const matchedTemplate = this.matchTemplate(request.description);\n      if (matchedTemplate) {\n        return this.templateToPipeline(matchedTemplate, request);\n      }\n    }\n\n    // Generate custom pipeline\n    return this.generateCustomPipeline(request);\n  }\n\n  private matchTemplate(description: string): PipelineTemplate | null {\n    const words = description.toLowerCase().split(/\\W+/);\n    let bestMatch: PipelineTemplate | null = null;\n    let bestScore = 0;\n\n    for (const template of this.templates) {\n      const score = template.keywords.filter((kw) =>\n        words.some((w) => w.includes(kw) || kw.includes(w))\n      ).length;\n\n      if (score > bestScore && score >= 2) {\n        bestScore = score;\n        bestMatch = template;\n      }\n    }\n\n    return bestMatch;\n  }\n\n  private templateToPipeline(\n    template: PipelineTemplate,\n    request: NLRequest\n  ): GeneratedPipeline {\n    const totalTokens = template.steps.reduce(\n      (sum, s) => sum + (s.estimatedTokens || 0),\n      0\n    );\n    const totalCost = template.steps.reduce(\n      (sum, s) => sum + (s.estimatedCost || 0),\n      0\n    );\n\n    return {\n      id: randomUUID(),\n      name: this.generatePipelineName(request.description),\n      description: request.description,\n      steps: template.steps,\n      inputSchema: template.inputSchema,\n      outputSchema: template.outputSchema,\n      estimatedTotalTokens: totalTokens,\n      estimatedTotalCost: totalCost,\n      confidence: 0.85,\n      reasoning: `Matched template \"${template.name}\" based on your description. ` +\n        `This is a proven pattern for ${template.description.toLowerCase()}.`,\n      alternatives: this.findAlternativeApproaches(template, request),\n    };\n  }\n\n  private async generateCustomPipeline(request: NLRequest): Promise<GeneratedPipeline> {\n    // This would call an LLM to generate a custom pipeline\n    // For now, return a simple generic pipeline\n    const steps: GeneratedStep[] = [\n      {\n        name: \"Process Input\",\n        type: \"llm_call\",\n        description: \"Process the input according to requirements\",\n        config: {},\n        prompt: `You are helping with: ${request.description}\\n\\nProcess this input: {{input}}`,\n        model: this.config.model,\n        estimatedTokens: 1000,\n        estimatedCost: 0.01,\n      },\n      {\n        name: \"Format Output\",\n        type: \"data_transform\",\n        description: \"Format the output as needed\",\n        config: {},\n        dependencies: [0],\n      },\n    ];\n\n    return {\n      id: randomUUID(),\n      name: this.generatePipelineName(request.description),\n      description: request.description,\n      steps,\n      inputSchema: {\n        input: { type: \"string\", description: \"The input to process\", required: true },\n      },\n      outputSchema: {\n        output: { type: \"string\", description: \"The processed output\" },\n      },\n      estimatedTotalTokens: 1000,\n      estimatedTotalCost: 0.01,\n      confidence: 0.6,\n      reasoning: \"Generated a basic custom pipeline. Consider refining the steps \" +\n        \"to better match your specific requirements.\",\n      alternatives: [\n        {\n          description: \"Add validation step\",\n          tradeoffs: \"Increases reliability but adds latency and cost\",\n        },\n        {\n          description: \"Split into multiple specialized steps\",\n          tradeoffs: \"Better modularity but higher total cost\",\n        },\n      ],\n    };\n  }\n\n  private generatePipelineName(description: string): string {\n    // Extract key words for name\n    const words = description\n      .split(/\\W+/)\n      .filter((w) => w.length > 3)\n      .slice(0, 3);\n    return words.map((w) => w.charAt(0).toUpperCase() + w.slice(1)).join(\" \") + \" Pipeline\";\n  }\n\n  private findAlternativeApproaches(\n    template: PipelineTemplate,\n    request: NLRequest\n  ): GeneratedPipeline[\"alternatives\"] {\n    const alternatives: GeneratedPipeline[\"alternatives\"] = [];\n\n    // Suggest adding validation\n    if (!template.steps.some((s) => s.type === \"data_transform\" && s.config.validate)) {\n      alternatives.push({\n        description: \"Add output validation step\",\n        tradeoffs: \"More reliable but slightly higher cost (+$0.001)\",\n      });\n    }\n\n    // Suggest different model choices\n    if (template.steps.some((s) => s.model?.includes(\"sonnet\"))) {\n      alternatives.push({\n        description: \"Use faster/cheaper Haiku model for all steps\",\n        tradeoffs: \"50% cheaper, faster, but may reduce quality for complex tasks\",\n      });\n    }\n\n    // Suggest parallel execution\n    const independentSteps = template.steps.filter(\n      (s) => !s.dependencies || s.dependencies.length === 0\n    );\n    if (independentSteps.length > 1) {\n      alternatives.push({\n        description: \"Run initial steps in parallel\",\n        tradeoffs: \"Faster execution but requires more concurrent API calls\",\n      });\n    }\n\n    return alternatives;\n  }\n\n  // ==========================================================================\n  // REFINEMENT\n  // ==========================================================================\n\n  private parseRefinement(instruction: string, pipeline?: GeneratedPipeline): Refinement {\n    const lower = instruction.toLowerCase();\n\n    if (lower.includes(\"add\") && (lower.includes(\"step\") || lower.includes(\"validation\"))) {\n      return { type: \"add_step\", instruction };\n    }\n    if (lower.includes(\"remove\") || lower.includes(\"delete\")) {\n      const stepMatch = instruction.match(/step\\s*(\\d+)/i);\n      return {\n        type: \"remove_step\",\n        instruction,\n        stepIndex: stepMatch ? parseInt(stepMatch[1]) - 1 : undefined,\n      };\n    }\n    if (lower.includes(\"change\") || lower.includes(\"modify\") || lower.includes(\"update\")) {\n      const stepMatch = instruction.match(/step\\s*(\\d+)/i);\n      return {\n        type: \"modify_step\",\n        instruction,\n        stepIndex: stepMatch ? parseInt(stepMatch[1]) - 1 : undefined,\n      };\n    }\n    if (lower.includes(\"reorder\") || lower.includes(\"move\")) {\n      return { type: \"reorder\", instruction };\n    }\n    if (lower.includes(\"model\") || lower.includes(\"haiku\") || lower.includes(\"sonnet\")) {\n      return { type: \"change_model\", instruction };\n    }\n\n    return { type: \"other\", instruction };\n  }\n\n  private async applyRefinement(\n    pipeline: GeneratedPipeline,\n    refinement: Refinement\n  ): Promise<GeneratedPipeline> {\n    const updated = { ...pipeline, id: randomUUID() };\n\n    switch (refinement.type) {\n      case \"add_step\":\n        updated.steps = [\n          ...updated.steps,\n          {\n            name: \"New Step\",\n            type: \"llm_call\",\n            description: \"Added step based on refinement\",\n            config: {},\n            model: \"claude-3-haiku-20240307\",\n            estimatedTokens: 200,\n            estimatedCost: 0.0004,\n          },\n        ];\n        break;\n\n      case \"remove_step\":\n        if (refinement.stepIndex !== undefined && refinement.stepIndex < updated.steps.length) {\n          updated.steps = updated.steps.filter((_, i) => i !== refinement.stepIndex);\n          // Update dependencies\n          updated.steps = updated.steps.map((s) => ({\n            ...s,\n            dependencies: s.dependencies\n              ?.filter((d) => d !== refinement.stepIndex)\n              .map((d) => (d > refinement.stepIndex! ? d - 1 : d)),\n          }));\n        }\n        break;\n\n      case \"change_model\":\n        const targetModel = refinement.instruction.toLowerCase().includes(\"haiku\")\n          ? \"claude-3-haiku-20240307\"\n          : \"claude-3-sonnet-20240229\";\n        updated.steps = updated.steps.map((s) =>\n          s.model ? { ...s, model: targetModel } : s\n        );\n        break;\n\n      case \"add_validation\":\n        updated.steps.push({\n          name: \"Validate Output\",\n          type: \"data_transform\",\n          description: \"Validate the output format and content\",\n          config: { validate: true },\n          dependencies: [updated.steps.length - 1],\n        });\n        break;\n    }\n\n    // Recalculate totals\n    updated.estimatedTotalTokens = updated.steps.reduce(\n      (sum, s) => sum + (s.estimatedTokens || 0),\n      0\n    );\n    updated.estimatedTotalCost = updated.steps.reduce(\n      (sum, s) => sum + (s.estimatedCost || 0),\n      0\n    );\n\n    return updated;\n  }\n\n  // ==========================================================================\n  // FORMATTING\n  // ==========================================================================\n\n  private formatPipelineResponse(pipeline: GeneratedPipeline): string {\n    let response = `I've generated a pipeline for you:\\n\\n`;\n    response += `**${pipeline.name}**\\n\\n`;\n    response += `${pipeline.reasoning}\\n\\n`;\n    response += `**Steps (${pipeline.steps.length}):**\\n`;\n\n    pipeline.steps.forEach((step, i) => {\n      response += `${i + 1}. **${step.name}** - ${step.description}`;\n      if (step.model) response += ` (${step.model.split(\"-\").pop()})`;\n      response += `\\n`;\n    });\n\n    response += `\\n**Estimated Cost:** $${pipeline.estimatedTotalCost.toFixed(4)}\\n`;\n    response += `**Confidence:** ${(pipeline.confidence * 100).toFixed(0)}%\\n\\n`;\n\n    if (pipeline.alternatives && pipeline.alternatives.length > 0) {\n      response += `**Alternative approaches:**\\n`;\n      pipeline.alternatives.forEach((alt) => {\n        response += `- ${alt.description}: ${alt.tradeoffs}\\n`;\n      });\n    }\n\n    response += `\\nYou can refine this by saying things like \"add a validation step\" or \"use haiku for all steps\".`;\n\n    return response;\n  }\n\n  private formatRefinementResponse(\n    refinement: Refinement,\n    pipeline: GeneratedPipeline\n  ): string {\n    let response = `I've updated the pipeline based on your request.\\n\\n`;\n    response += `**Updated Steps (${pipeline.steps.length}):**\\n`;\n\n    pipeline.steps.forEach((step, i) => {\n      response += `${i + 1}. **${step.name}** - ${step.description}\\n`;\n    });\n\n    response += `\\n**New Estimated Cost:** $${pipeline.estimatedTotalCost.toFixed(4)}\\n`;\n    response += `\\nAnything else you'd like to change?`;\n\n    return response;\n  }\n\n  // ==========================================================================\n  // TEMPLATE MANAGEMENT\n  // ==========================================================================\n\n  addTemplate(template: PipelineTemplate): void {\n    this.templates.push(template);\n  }\n\n  getTemplates(): PipelineTemplate[] {\n    return [...this.templates];\n  }\n}\n\n// ============================================================================\n// SINGLETON & FACTORY\n// ============================================================================\n\nlet instance: NLBuilder | null = null;\n\nexport function getNLBuilder(): NLBuilder {\n  if (!instance) {\n    instance = new NLBuilder();\n  }\n  return instance;\n}\n\nexport function createNLBuilder(config: Partial<NLBuilderConfig> = {}): NLBuilder {\n  instance = new NLBuilder(config);\n  return instance;\n}\n","/**\n * Predictive Analytics\n * Phase 10D: Predictive Analytics\n */\n\nimport { EventEmitter } from \"eventemitter3\";\nimport { randomUUID } from \"crypto\";\nimport { z } from \"zod\";\n\n// ============================================================================\n// TYPES\n// ============================================================================\n\nexport const PredictionTypeSchema = z.enum([\n  \"execution_time\",\n  \"cost\",\n  \"token_usage\",\n  \"success_rate\",\n  \"traffic\",\n  \"capacity\",\n]);\nexport type PredictionType = z.infer<typeof PredictionTypeSchema>;\n\nexport const PredictionConfidenceSchema = z.enum([\"low\", \"medium\", \"high\"]);\nexport type PredictionConfidence = z.infer<typeof PredictionConfidenceSchema>;\n\nexport const PredictionSchema = z.object({\n  id: z.string(),\n  type: PredictionTypeSchema,\n  target: z.string(),  // pipeline ID, service name, etc.\n  targetType: z.enum([\"pipeline\", \"service\", \"organization\", \"global\"]),\n\n  // Prediction details\n  predictedValue: z.number(),\n  unit: z.string(),\n  confidence: PredictionConfidenceSchema,\n  confidenceScore: z.number().min(0).max(1),\n\n  // Range\n  lowerBound: z.number(),\n  upperBound: z.number(),\n\n  // Time frame\n  horizon: z.enum([\"hour\", \"day\", \"week\", \"month\"]),\n  predictedFor: z.date(),\n  createdAt: z.date(),\n\n  // Factors\n  factors: z.array(z.object({\n    name: z.string(),\n    impact: z.number(),  // -1 to 1, negative = decreases, positive = increases\n    description: z.string(),\n  })).optional(),\n\n  // Model info\n  modelVersion: z.string(),\n  dataPointsUsed: z.number(),\n});\nexport type Prediction = z.infer<typeof PredictionSchema>;\n\nexport const ForecastSchema = z.object({\n  id: z.string(),\n  type: PredictionTypeSchema,\n  target: z.string(),\n  horizon: z.enum([\"day\", \"week\", \"month\", \"quarter\"]),\n  startDate: z.date(),\n  endDate: z.date(),\n  predictions: z.array(z.object({\n    date: z.date(),\n    value: z.number(),\n    lowerBound: z.number(),\n    upperBound: z.number(),\n  })),\n  trend: z.enum([\"increasing\", \"decreasing\", \"stable\", \"volatile\"]),\n  trendStrength: z.number().min(0).max(1),\n  seasonality: z.object({\n    detected: z.boolean(),\n    period: z.string().optional(),  // \"daily\", \"weekly\", \"monthly\"\n    amplitude: z.number().optional(),\n  }),\n  createdAt: z.date(),\n});\nexport type Forecast = z.infer<typeof ForecastSchema>;\n\nexport const CapacityPlanSchema = z.object({\n  id: z.string(),\n  target: z.string(),\n  currentCapacity: z.number(),\n  currentUsage: z.number(),\n  usagePercent: z.number(),\n  projectedUsage: z.array(z.object({\n    date: z.date(),\n    usage: z.number(),\n    percent: z.number(),\n  })),\n  recommendations: z.array(z.object({\n    action: z.enum([\"scale_up\", \"scale_down\", \"optimize\", \"no_action\"]),\n    description: z.string(),\n    timing: z.string(),\n    impact: z.string(),\n    priority: z.enum([\"low\", \"medium\", \"high\"]),\n  })),\n  alertThresholds: z.object({\n    warning: z.number(),  // percent\n    critical: z.number(),\n  }),\n  createdAt: z.date(),\n});\nexport type CapacityPlan = z.infer<typeof CapacityPlanSchema>;\n\nexport const UsageTrendSchema = z.object({\n  metric: z.string(),\n  period: z.enum([\"day\", \"week\", \"month\"]),\n  dataPoints: z.array(z.object({\n    date: z.date(),\n    value: z.number(),\n  })),\n  trend: z.object({\n    direction: z.enum([\"up\", \"down\", \"stable\"]),\n    percentChange: z.number(),\n    slope: z.number(),\n  }),\n  comparison: z.object({\n    previousPeriod: z.number(),\n    percentChange: z.number(),\n  }),\n});\nexport type UsageTrend = z.infer<typeof UsageTrendSchema>;\n\nexport const PredictiveAnalyticsConfigSchema = z.object({\n  enabled: z.boolean().default(true),\n  updateIntervalMs: z.number().default(3600000),  // 1 hour\n  minDataPoints: z.number().default(30),\n  forecastHorizons: z.array(z.enum([\"day\", \"week\", \"month\", \"quarter\"])).default([\"day\", \"week\"]),\n  confidenceLevel: z.number().default(0.95),\n  seasonalityDetection: z.boolean().default(true),\n  anomalyAdjustment: z.boolean().default(true),\n});\nexport type PredictiveAnalyticsConfig = z.infer<typeof PredictiveAnalyticsConfigSchema>;\n\nexport interface PredictiveAnalyticsEvents {\n  \"prediction:created\": (prediction: Prediction) => void;\n  \"forecast:updated\": (forecast: Forecast) => void;\n  \"capacity:warning\": (plan: CapacityPlan) => void;\n  \"trend:detected\": (trend: UsageTrend) => void;\n}\n\n// ============================================================================\n// DATA STRUCTURES\n// ============================================================================\n\ninterface HistoricalDataPoint {\n  timestamp: Date;\n  value: number;\n  metadata?: Record<string, unknown>;\n}\n\ninterface TimeSeriesData {\n  metric: string;\n  target: string;\n  points: HistoricalDataPoint[];\n}\n\n// ============================================================================\n// PREDICTIVE ANALYTICS ENGINE\n// ============================================================================\n\nexport class PredictiveAnalytics extends EventEmitter<PredictiveAnalyticsEvents> {\n  private config: PredictiveAnalyticsConfig;\n  private historicalData: Map<string, TimeSeriesData> = new Map();\n  private predictions: Map<string, Prediction> = new Map();\n  private forecasts: Map<string, Forecast> = new Map();\n  private capacityPlans: Map<string, CapacityPlan> = new Map();\n  private updateTimer?: NodeJS.Timeout;\n\n  constructor(config: Partial<PredictiveAnalyticsConfig> = {}) {\n    super();\n    this.config = PredictiveAnalyticsConfigSchema.parse(config);\n  }\n\n  // ==========================================================================\n  // LIFECYCLE\n  // ==========================================================================\n\n  start(): void {\n    if (!this.config.enabled) return;\n\n    this.updateTimer = setInterval(() => {\n      this.updatePredictions();\n    }, this.config.updateIntervalMs);\n  }\n\n  stop(): void {\n    if (this.updateTimer) {\n      clearInterval(this.updateTimer);\n    }\n  }\n\n  // ==========================================================================\n  // DATA INGESTION\n  // ==========================================================================\n\n  recordDataPoint(\n    metric: string,\n    target: string,\n    value: number,\n    metadata?: Record<string, unknown>\n  ): void {\n    const key = `${metric}:${target}`;\n    const series = this.historicalData.get(key) || {\n      metric,\n      target,\n      points: [],\n    };\n\n    series.points.push({\n      timestamp: new Date(),\n      value,\n      metadata,\n    });\n\n    // Keep 90 days of data\n    const cutoff = Date.now() - 90 * 24 * 3600000;\n    series.points = series.points.filter((p) => p.timestamp.getTime() > cutoff);\n\n    this.historicalData.set(key, series);\n  }\n\n  recordExecution(\n    pipelineId: string,\n    duration: number,\n    cost: number,\n    tokens: number,\n    success: boolean\n  ): void {\n    this.recordDataPoint(\"execution_time\", pipelineId, duration);\n    this.recordDataPoint(\"cost\", pipelineId, cost);\n    this.recordDataPoint(\"tokens\", pipelineId, tokens);\n    this.recordDataPoint(\"success\", pipelineId, success ? 1 : 0);\n  }\n\n  recordTraffic(service: string, requestCount: number): void {\n    this.recordDataPoint(\"traffic\", service, requestCount);\n  }\n\n  // ==========================================================================\n  // PREDICTIONS\n  // ==========================================================================\n\n  async predictExecutionTime(pipelineId: string): Promise<Prediction> {\n    const data = this.getHistoricalData(\"execution_time\", pipelineId);\n    const prediction = this.generatePrediction(\n      \"execution_time\",\n      pipelineId,\n      \"pipeline\",\n      data,\n      \"ms\"\n    );\n\n    this.predictions.set(prediction.id, prediction);\n    this.emit(\"prediction:created\", prediction);\n    return prediction;\n  }\n\n  async predictCost(\n    pipelineId: string,\n    horizon: \"hour\" | \"day\" | \"week\" | \"month\" = \"day\"\n  ): Promise<Prediction> {\n    const data = this.getHistoricalData(\"cost\", pipelineId);\n    const prediction = this.generatePrediction(\n      \"cost\",\n      pipelineId,\n      \"pipeline\",\n      data,\n      \"USD\",\n      horizon\n    );\n\n    this.predictions.set(prediction.id, prediction);\n    this.emit(\"prediction:created\", prediction);\n    return prediction;\n  }\n\n  async predictTokenUsage(\n    pipelineId: string,\n    horizon: \"hour\" | \"day\" | \"week\" | \"month\" = \"day\"\n  ): Promise<Prediction> {\n    const data = this.getHistoricalData(\"tokens\", pipelineId);\n    const prediction = this.generatePrediction(\n      \"token_usage\",\n      pipelineId,\n      \"pipeline\",\n      data,\n      \"tokens\",\n      horizon\n    );\n\n    this.predictions.set(prediction.id, prediction);\n    this.emit(\"prediction:created\", prediction);\n    return prediction;\n  }\n\n  async predictSuccessRate(pipelineId: string): Promise<Prediction> {\n    const data = this.getHistoricalData(\"success\", pipelineId);\n    const prediction = this.generatePrediction(\n      \"success_rate\",\n      pipelineId,\n      \"pipeline\",\n      data,\n      \"%\"\n    );\n\n    // Convert to percentage\n    prediction.predictedValue *= 100;\n    prediction.lowerBound *= 100;\n    prediction.upperBound *= 100;\n\n    this.predictions.set(prediction.id, prediction);\n    this.emit(\"prediction:created\", prediction);\n    return prediction;\n  }\n\n  async predictTraffic(\n    service: string,\n    horizon: \"hour\" | \"day\" | \"week\" | \"month\" = \"day\"\n  ): Promise<Prediction> {\n    const data = this.getHistoricalData(\"traffic\", service);\n    const prediction = this.generatePrediction(\n      \"traffic\",\n      service,\n      \"service\",\n      data,\n      \"requests\",\n      horizon\n    );\n\n    this.predictions.set(prediction.id, prediction);\n    this.emit(\"prediction:created\", prediction);\n    return prediction;\n  }\n\n  getPrediction(predictionId: string): Prediction | undefined {\n    return this.predictions.get(predictionId);\n  }\n\n  getLatestPredictions(target: string, type?: PredictionType): Prediction[] {\n    const predictions = Array.from(this.predictions.values())\n      .filter((p) => p.target === target && (!type || p.type === type))\n      .sort((a, b) => b.createdAt.getTime() - a.createdAt.getTime());\n    return predictions;\n  }\n\n  // ==========================================================================\n  // FORECASTING\n  // ==========================================================================\n\n  async generateForecast(\n    type: PredictionType,\n    target: string,\n    horizon: \"day\" | \"week\" | \"month\" | \"quarter\" = \"week\"\n  ): Promise<Forecast> {\n    const metricMap: Record<PredictionType, string> = {\n      execution_time: \"execution_time\",\n      cost: \"cost\",\n      token_usage: \"tokens\",\n      success_rate: \"success\",\n      traffic: \"traffic\",\n      capacity: \"traffic\",\n    };\n\n    const data = this.getHistoricalData(metricMap[type], target);\n    const forecast = this.buildForecast(type, target, data, horizon);\n\n    this.forecasts.set(forecast.id, forecast);\n    this.emit(\"forecast:updated\", forecast);\n    return forecast;\n  }\n\n  getForecast(forecastId: string): Forecast | undefined {\n    return this.forecasts.get(forecastId);\n  }\n\n  // ==========================================================================\n  // CAPACITY PLANNING\n  // ==========================================================================\n\n  async generateCapacityPlan(\n    target: string,\n    currentCapacity: number\n  ): Promise<CapacityPlan> {\n    const trafficData = this.getHistoricalData(\"traffic\", target);\n    const plan = this.buildCapacityPlan(target, currentCapacity, trafficData);\n\n    this.capacityPlans.set(plan.id, plan);\n\n    // Check if we need to alert\n    if (plan.usagePercent > plan.alertThresholds.warning) {\n      this.emit(\"capacity:warning\", plan);\n    }\n\n    return plan;\n  }\n\n  getCapacityPlan(target: string): CapacityPlan | undefined {\n    return this.capacityPlans.get(target);\n  }\n\n  // ==========================================================================\n  // TRENDS\n  // ==========================================================================\n\n  analyzeTrend(\n    metric: string,\n    target: string,\n    period: \"day\" | \"week\" | \"month\" = \"week\"\n  ): UsageTrend {\n    const data = this.getHistoricalData(metric, target);\n    const trend = this.calculateTrend(metric, data, period);\n\n    this.emit(\"trend:detected\", trend);\n    return trend;\n  }\n\n  // ==========================================================================\n  // PRIVATE METHODS\n  // ==========================================================================\n\n  private getHistoricalData(metric: string, target: string): HistoricalDataPoint[] {\n    const key = `${metric}:${target}`;\n    const series = this.historicalData.get(key);\n    return series?.points || [];\n  }\n\n  private generatePrediction(\n    type: PredictionType,\n    target: string,\n    targetType: Prediction[\"targetType\"],\n    data: HistoricalDataPoint[],\n    unit: string,\n    horizon: Prediction[\"horizon\"] = \"day\"\n  ): Prediction {\n    // Calculate statistics\n    const values = data.map((d) => d.value);\n    const stats = this.calculateStats(values);\n\n    // Simple prediction using exponential moving average\n    const ema = this.calculateEMA(values);\n    const predictedValue = ema;\n\n    // Calculate confidence based on data quality\n    const confidence = this.calculateConfidence(data.length, stats.cv);\n\n    // Calculate bounds using standard deviation\n    const margin = stats.stdDev * (confidence === \"high\" ? 1.5 : confidence === \"medium\" ? 2 : 2.5);\n\n    // Identify contributing factors\n    const factors = this.identifyFactors(data, stats);\n\n    // Calculate prediction date based on horizon\n    const horizonMs = {\n      hour: 3600000,\n      day: 86400000,\n      week: 604800000,\n      month: 2592000000,\n    }[horizon];\n\n    return {\n      id: randomUUID(),\n      type,\n      target,\n      targetType,\n      predictedValue: Math.max(0, predictedValue),\n      unit,\n      confidence,\n      confidenceScore: confidence === \"high\" ? 0.9 : confidence === \"medium\" ? 0.7 : 0.5,\n      lowerBound: Math.max(0, predictedValue - margin),\n      upperBound: predictedValue + margin,\n      horizon,\n      predictedFor: new Date(Date.now() + horizonMs),\n      createdAt: new Date(),\n      factors,\n      modelVersion: \"1.0.0\",\n      dataPointsUsed: data.length,\n    };\n  }\n\n  private buildForecast(\n    type: PredictionType,\n    target: string,\n    data: HistoricalDataPoint[],\n    horizon: Forecast[\"horizon\"]\n  ): Forecast {\n    const values = data.map((d) => d.value);\n    const stats = this.calculateStats(values);\n\n    // Generate forecast points\n    const horizonDays = { day: 1, week: 7, month: 30, quarter: 90 }[horizon];\n    const predictions: Forecast[\"predictions\"] = [];\n\n    const trend = this.detectTrend(values);\n    const seasonality = this.detectSeasonality(data);\n\n    for (let i = 1; i <= horizonDays; i++) {\n      const date = new Date(Date.now() + i * 86400000);\n      const baseValue = stats.mean;\n\n      // Apply trend\n      let value = baseValue + (trend.slope * i);\n\n      // Apply seasonality if detected\n      if (seasonality.detected && seasonality.amplitude) {\n        const dayOfWeek = date.getDay();\n        value += seasonality.amplitude * Math.sin((dayOfWeek / 7) * 2 * Math.PI);\n      }\n\n      const margin = stats.stdDev * 1.96; // 95% confidence\n\n      predictions.push({\n        date,\n        value: Math.max(0, value),\n        lowerBound: Math.max(0, value - margin),\n        upperBound: value + margin,\n      });\n    }\n\n    return {\n      id: randomUUID(),\n      type,\n      target,\n      horizon,\n      startDate: new Date(),\n      endDate: new Date(Date.now() + horizonDays * 86400000),\n      predictions,\n      trend: trend.direction === \"up\" ? \"increasing\"\n        : trend.direction === \"down\" ? \"decreasing\"\n        : Math.abs(trend.slope) < 0.01 ? \"stable\" : \"volatile\",\n      trendStrength: Math.min(1, Math.abs(trend.slope) / stats.mean),\n      seasonality,\n      createdAt: new Date(),\n    };\n  }\n\n  private buildCapacityPlan(\n    target: string,\n    currentCapacity: number,\n    data: HistoricalDataPoint[]\n  ): CapacityPlan {\n    const values = data.map((d) => d.value);\n    const stats = this.calculateStats(values);\n    const trend = this.detectTrend(values);\n\n    const currentUsage = values.length > 0 ? values[values.length - 1] : 0;\n    const usagePercent = (currentUsage / currentCapacity) * 100;\n\n    // Project usage for next 30 days\n    const projectedUsage: CapacityPlan[\"projectedUsage\"] = [];\n    for (let i = 1; i <= 30; i++) {\n      const date = new Date(Date.now() + i * 86400000);\n      const usage = currentUsage + (trend.slope * i);\n      projectedUsage.push({\n        date,\n        usage: Math.max(0, usage),\n        percent: (Math.max(0, usage) / currentCapacity) * 100,\n      });\n    }\n\n    // Generate recommendations\n    const recommendations: CapacityPlan[\"recommendations\"] = [];\n\n    const maxProjectedPercent = Math.max(...projectedUsage.map((p) => p.percent));\n\n    if (maxProjectedPercent > 90) {\n      recommendations.push({\n        action: \"scale_up\",\n        description: \"Projected usage will exceed 90% capacity\",\n        timing: \"Within 2 weeks\",\n        impact: \"Prevent service degradation\",\n        priority: \"high\",\n      });\n    } else if (maxProjectedPercent > 75) {\n      recommendations.push({\n        action: \"scale_up\",\n        description: \"Projected usage approaching capacity limits\",\n        timing: \"Within 4 weeks\",\n        impact: \"Maintain performance headroom\",\n        priority: \"medium\",\n      });\n    } else if (usagePercent < 30 && trend.direction !== \"up\") {\n      recommendations.push({\n        action: \"scale_down\",\n        description: \"Current usage is well below capacity\",\n        timing: \"Consider in next review\",\n        impact: \"Reduce costs by 20-40%\",\n        priority: \"low\",\n      });\n    }\n\n    if (stats.cv > 0.5) {\n      recommendations.push({\n        action: \"optimize\",\n        description: \"High usage variance detected\",\n        timing: \"As soon as possible\",\n        impact: \"More predictable capacity needs\",\n        priority: \"medium\",\n      });\n    }\n\n    if (recommendations.length === 0) {\n      recommendations.push({\n        action: \"no_action\",\n        description: \"Current capacity is appropriate\",\n        timing: \"Review in 30 days\",\n        impact: \"None needed\",\n        priority: \"low\",\n      });\n    }\n\n    return {\n      id: randomUUID(),\n      target,\n      currentCapacity,\n      currentUsage,\n      usagePercent,\n      projectedUsage,\n      recommendations,\n      alertThresholds: {\n        warning: 75,\n        critical: 90,\n      },\n      createdAt: new Date(),\n    };\n  }\n\n  private calculateStats(values: number[]): {\n    mean: number;\n    stdDev: number;\n    cv: number;  // coefficient of variation\n    min: number;\n    max: number;\n  } {\n    if (values.length === 0) {\n      return { mean: 0, stdDev: 0, cv: 0, min: 0, max: 0 };\n    }\n\n    const mean = values.reduce((a, b) => a + b, 0) / values.length;\n    const variance = values.reduce((sum, v) => sum + Math.pow(v - mean, 2), 0) / values.length;\n    const stdDev = Math.sqrt(variance);\n\n    return {\n      mean,\n      stdDev,\n      cv: mean > 0 ? stdDev / mean : 0,\n      min: Math.min(...values),\n      max: Math.max(...values),\n    };\n  }\n\n  private calculateEMA(values: number[], smoothing: number = 0.2): number {\n    if (values.length === 0) return 0;\n    if (values.length === 1) return values[0];\n\n    let ema = values[0];\n    for (let i = 1; i < values.length; i++) {\n      ema = values[i] * smoothing + ema * (1 - smoothing);\n    }\n    return ema;\n  }\n\n  private calculateConfidence(\n    dataPoints: number,\n    cv: number\n  ): PredictionConfidence {\n    if (dataPoints < this.config.minDataPoints) return \"low\";\n    if (cv > 0.5) return \"low\";\n    if (dataPoints >= 100 && cv < 0.2) return \"high\";\n    return \"medium\";\n  }\n\n  private identifyFactors(\n    data: HistoricalDataPoint[],\n    stats: { mean: number; stdDev: number }\n  ): Prediction[\"factors\"] {\n    const factors: Prediction[\"factors\"] = [];\n\n    // Check for recent trend\n    if (data.length >= 7) {\n      const recentValues = data.slice(-7).map((d) => d.value);\n      const recentMean = recentValues.reduce((a, b) => a + b, 0) / recentValues.length;\n      const trendImpact = (recentMean - stats.mean) / stats.mean;\n\n      if (Math.abs(trendImpact) > 0.1) {\n        factors.push({\n          name: \"Recent trend\",\n          impact: trendImpact > 0 ? 0.3 : -0.3,\n          description: trendImpact > 0\n            ? \"Recent values trending above historical average\"\n            : \"Recent values trending below historical average\",\n        });\n      }\n    }\n\n    // Check for day-of-week patterns\n    const dayPatterns = new Map<number, number[]>();\n    data.forEach((d) => {\n      const day = d.timestamp.getDay();\n      const values = dayPatterns.get(day) || [];\n      values.push(d.value);\n      dayPatterns.set(day, values);\n    });\n\n    const today = new Date().getDay();\n    const todayValues = dayPatterns.get(today);\n    if (todayValues && todayValues.length > 3) {\n      const todayMean = todayValues.reduce((a, b) => a + b, 0) / todayValues.length;\n      const dayImpact = (todayMean - stats.mean) / stats.mean;\n\n      if (Math.abs(dayImpact) > 0.15) {\n        factors.push({\n          name: \"Day-of-week pattern\",\n          impact: dayImpact > 0 ? 0.2 : -0.2,\n          description: dayImpact > 0\n            ? \"This day typically has higher than average values\"\n            : \"This day typically has lower than average values\",\n        });\n      }\n    }\n\n    return factors;\n  }\n\n  private detectTrend(values: number[]): { direction: \"up\" | \"down\" | \"stable\"; slope: number } {\n    if (values.length < 3) {\n      return { direction: \"stable\", slope: 0 };\n    }\n\n    // Simple linear regression\n    const n = values.length;\n    let sumX = 0, sumY = 0, sumXY = 0, sumX2 = 0;\n\n    for (let i = 0; i < n; i++) {\n      sumX += i;\n      sumY += values[i];\n      sumXY += i * values[i];\n      sumX2 += i * i;\n    }\n\n    const slope = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);\n    const mean = sumY / n;\n\n    // Determine direction based on slope relative to mean\n    const relativeSlope = slope / (mean || 1);\n\n    if (relativeSlope > 0.01) return { direction: \"up\", slope };\n    if (relativeSlope < -0.01) return { direction: \"down\", slope };\n    return { direction: \"stable\", slope };\n  }\n\n  private detectSeasonality(data: HistoricalDataPoint[]): Forecast[\"seasonality\"] {\n    if (!this.config.seasonalityDetection || data.length < 14) {\n      return { detected: false };\n    }\n\n    // Check for weekly seasonality\n    const dayAverages = new Map<number, number[]>();\n    data.forEach((d) => {\n      const day = d.timestamp.getDay();\n      const values = dayAverages.get(day) || [];\n      values.push(d.value);\n      dayAverages.set(day, values);\n    });\n\n    if (dayAverages.size < 7) {\n      return { detected: false };\n    }\n\n    const dailyMeans = Array.from(dayAverages.values()).map(\n      (vals) => vals.reduce((a, b) => a + b, 0) / vals.length\n    );\n\n    const overallMean = dailyMeans.reduce((a, b) => a + b, 0) / dailyMeans.length;\n    const variance = dailyMeans.reduce((sum, v) => sum + Math.pow(v - overallMean, 2), 0) / dailyMeans.length;\n    const amplitude = Math.sqrt(variance);\n\n    // If daily variation is significant, seasonality detected\n    if (amplitude / overallMean > 0.1) {\n      return {\n        detected: true,\n        period: \"weekly\",\n        amplitude,\n      };\n    }\n\n    return { detected: false };\n  }\n\n  private calculateTrend(\n    metric: string,\n    data: HistoricalDataPoint[],\n    period: \"day\" | \"week\" | \"month\"\n  ): UsageTrend {\n    const periodMs = { day: 86400000, week: 604800000, month: 2592000000 }[period];\n    const cutoff = Date.now() - periodMs;\n\n    const periodData = data.filter((d) => d.timestamp.getTime() > cutoff);\n    const previousCutoff = cutoff - periodMs;\n    const previousData = data.filter(\n      (d) => d.timestamp.getTime() > previousCutoff && d.timestamp.getTime() <= cutoff\n    );\n\n    const currentSum = periodData.reduce((sum, d) => sum + d.value, 0);\n    const previousSum = previousData.reduce((sum, d) => sum + d.value, 0);\n\n    const trend = this.detectTrend(periodData.map((d) => d.value));\n    const percentChange = previousSum > 0 ? ((currentSum - previousSum) / previousSum) * 100 : 0;\n\n    return {\n      metric,\n      period,\n      dataPoints: periodData.map((d) => ({ date: d.timestamp, value: d.value })),\n      trend: {\n        direction: trend.direction,\n        percentChange,\n        slope: trend.slope,\n      },\n      comparison: {\n        previousPeriod: previousSum,\n        percentChange,\n      },\n    };\n  }\n\n  private updatePredictions(): void {\n    // Refresh predictions for all tracked targets\n    for (const [key] of this.historicalData) {\n      const [metric, target] = key.split(\":\");\n\n      // Map metrics to prediction types\n      const typeMap: Record<string, PredictionType> = {\n        execution_time: \"execution_time\",\n        cost: \"cost\",\n        tokens: \"token_usage\",\n        success: \"success_rate\",\n        traffic: \"traffic\",\n      };\n\n      const type = typeMap[metric];\n      if (type) {\n        const data = this.getHistoricalData(metric, target);\n        if (data.length >= this.config.minDataPoints) {\n          const prediction = this.generatePrediction(\n            type,\n            target,\n            \"pipeline\",\n            data,\n            type === \"cost\" ? \"USD\" : type === \"execution_time\" ? \"ms\" : \"units\"\n          );\n          this.predictions.set(`${type}:${target}`, prediction);\n        }\n      }\n    }\n  }\n}\n\n// ============================================================================\n// SINGLETON & FACTORY\n// ============================================================================\n\nlet instance: PredictiveAnalytics | null = null;\n\nexport function getPredictiveAnalytics(): PredictiveAnalytics {\n  if (!instance) {\n    instance = new PredictiveAnalytics();\n  }\n  return instance;\n}\n\nexport function createPredictiveAnalytics(\n  config: Partial<PredictiveAnalyticsConfig> = {}\n): PredictiveAnalytics {\n  instance = new PredictiveAnalytics(config);\n  return instance;\n}\n","/**\n * Reliability Types\n * Phase 12: Reliability & Resilience\n */\n\nimport { z } from \"zod\";\n\n// ============================================================================\n// Circuit Breaker (12A)\n// ============================================================================\n\nexport const CircuitStateSchema = z.enum([\"closed\", \"open\", \"half_open\"]);\nexport type CircuitState = z.infer<typeof CircuitStateSchema>;\n\nexport const CircuitBreakerConfigSchema = z.object({\n  name: z.string(),\n  failureThreshold: z.number().min(1).default(5),\n  successThreshold: z.number().min(1).default(3),\n  timeout: z.number().min(1000).default(30000), // Time in OPEN before trying HALF_OPEN\n  volumeThreshold: z.number().min(1).default(10), // Min requests before tripping\n  errorPercentageThreshold: z.number().min(0).max(100).default(50),\n  rollingWindowMs: z.number().default(60000), // Window for calculating error rate\n  halfOpenMaxCalls: z.number().min(1).default(3), // Max calls in HALF_OPEN\n});\nexport type CircuitBreakerConfig = z.infer<typeof CircuitBreakerConfigSchema>;\n\nexport const CircuitStatsSchema = z.object({\n  totalRequests: z.number(),\n  successfulRequests: z.number(),\n  failedRequests: z.number(),\n  rejectedRequests: z.number(),\n  lastFailureTime: z.date().optional(),\n  lastSuccessTime: z.date().optional(),\n  stateChangedAt: z.date(),\n  consecutiveFailures: z.number(),\n  consecutiveSuccesses: z.number(),\n});\nexport type CircuitStats = z.infer<typeof CircuitStatsSchema>;\n\nexport const CircuitBreakerStateSchema = z.object({\n  name: z.string(),\n  state: CircuitStateSchema,\n  stats: CircuitStatsSchema,\n  config: CircuitBreakerConfigSchema,\n});\nexport type CircuitBreakerState = z.infer<typeof CircuitBreakerStateSchema>;\n\n// ============================================================================\n// Retry Strategy (12B)\n// ============================================================================\n\nexport const RetryStrategyTypeSchema = z.enum([\n  \"fixed\",\n  \"linear\",\n  \"exponential\",\n  \"exponential_jitter\",\n]);\nexport type RetryStrategyType = z.infer<typeof RetryStrategyTypeSchema>;\n\nexport const RetryConfigSchema = z.object({\n  maxRetries: z.number().min(0).default(3),\n  strategy: RetryStrategyTypeSchema.default(\"exponential_jitter\"),\n  baseDelayMs: z.number().min(0).default(1000),\n  maxDelayMs: z.number().min(0).default(30000),\n  jitterFactor: z.number().min(0).max(1).default(0.2),\n  retryableErrors: z.array(z.string()).optional(), // Error codes/names to retry\n  nonRetryableErrors: z.array(z.string()).optional(), // Error codes to never retry\n  retryBudgetPerMinute: z.number().optional(), // Max retries per minute\n  onRetry: z.function().args(z.number(), z.unknown()).optional(),\n});\nexport type RetryConfig = z.infer<typeof RetryConfigSchema>;\n\nexport const RetryAttemptSchema = z.object({\n  attempt: z.number(),\n  delay: z.number(),\n  error: z.unknown().optional(),\n  timestamp: z.date(),\n});\nexport type RetryAttempt = z.infer<typeof RetryAttemptSchema>;\n\nexport const RetryResultSchema = z.object({\n  success: z.boolean(),\n  result: z.unknown().optional(),\n  error: z.unknown().optional(),\n  attempts: z.array(RetryAttemptSchema),\n  totalTime: z.number(),\n});\nexport type RetryResult = z.infer<typeof RetryResultSchema>;\n\n// ============================================================================\n// Timeout Manager (12C)\n// ============================================================================\n\nexport const TimeoutConfigSchema = z.object({\n  defaultTimeout: z.number().min(0).default(30000),\n  operationTimeouts: z.record(z.number()).optional(), // Per-operation overrides\n  cascadingBudget: z.boolean().default(true), // Reduce timeout for child operations\n  budgetReservePercent: z.number().min(0).max(50).default(10), // Reserve for cleanup\n});\nexport type TimeoutConfig = z.infer<typeof TimeoutConfigSchema>;\n\nexport const TimeoutContextSchema = z.object({\n  operationId: z.string(),\n  parentId: z.string().optional(),\n  timeout: z.number(),\n  startTime: z.date(),\n  deadline: z.date(),\n  remainingMs: z.number(),\n  abortController: z.instanceof(AbortController).optional(),\n});\nexport type TimeoutContext = z.infer<typeof TimeoutContextSchema>;\n\nexport const TimeoutResultSchema = z.object({\n  operationId: z.string(),\n  timedOut: z.boolean(),\n  elapsedMs: z.number(),\n  remainingMs: z.number(),\n});\nexport type TimeoutResult = z.infer<typeof TimeoutResultSchema>;\n\n// ============================================================================\n// Health Aggregator (12D)\n// ============================================================================\n\nexport const HealthStatusSchema = z.enum([\n  \"healthy\",\n  \"degraded\",\n  \"unhealthy\",\n  \"unknown\",\n]);\nexport type HealthStatus = z.infer<typeof HealthStatusSchema>;\n\nexport const HealthCheckTypeSchema = z.enum([\n  \"liveness\",\n  \"readiness\",\n  \"startup\",\n  \"deep\",\n]);\nexport type HealthCheckType = z.infer<typeof HealthCheckTypeSchema>;\n\nexport const ServiceHealthSchema = z.object({\n  name: z.string(),\n  status: HealthStatusSchema,\n  latency: z.number().optional(),\n  lastCheck: z.date(),\n  message: z.string().optional(),\n  metadata: z.record(z.unknown()).optional(),\n});\nexport type ServiceHealth = z.infer<typeof ServiceHealthSchema>;\n\nexport const DependencySchema = z.object({\n  name: z.string(),\n  type: z.enum([\"required\", \"optional\"]),\n  checkFn: z.function().returns(z.promise(z.boolean())).optional(),\n  timeout: z.number().default(5000),\n  weight: z.number().min(0).max(1).default(1), // Impact on overall health\n});\nexport type Dependency = z.infer<typeof DependencySchema>;\n\nexport const HealthAggregatorConfigSchema = z.object({\n  checkInterval: z.number().default(30000),\n  unhealthyThreshold: z.number().default(3), // Consecutive failures\n  healthyThreshold: z.number().default(2), // Consecutive successes to recover\n  historySize: z.number().default(100),\n  dependencies: z.array(DependencySchema).optional(),\n});\nexport type HealthAggregatorConfig = z.infer<typeof HealthAggregatorConfigSchema>;\n\nexport const AggregatedHealthSchema = z.object({\n  status: HealthStatusSchema,\n  services: z.array(ServiceHealthSchema),\n  dependencies: z.array(ServiceHealthSchema),\n  uptime: z.number(),\n  lastUpdated: z.date(),\n  version: z.string().optional(),\n});\nexport type AggregatedHealth = z.infer<typeof AggregatedHealthSchema>;\n\nexport const HealthHistoryEntrySchema = z.object({\n  timestamp: z.date(),\n  status: HealthStatusSchema,\n  services: z.record(HealthStatusSchema),\n});\nexport type HealthHistoryEntry = z.infer<typeof HealthHistoryEntrySchema>;\n\n// ============================================================================\n// Reliability Manager Config\n// ============================================================================\n\nexport const ReliabilityManagerConfigSchema = z.object({\n  defaultCircuitBreaker: CircuitBreakerConfigSchema.optional(),\n  defaultRetry: RetryConfigSchema.optional(),\n  defaultTimeout: TimeoutConfigSchema.optional(),\n  healthAggregator: HealthAggregatorConfigSchema.optional(),\n});\nexport type ReliabilityManagerConfig = z.infer<typeof ReliabilityManagerConfigSchema>;\n\n// ============================================================================\n// Events\n// ============================================================================\n\nexport type CircuitBreakerEvents = {\n  stateChanged: (name: string, from: CircuitState, to: CircuitState) => void;\n  opened: (name: string, stats: CircuitStats) => void;\n  closed: (name: string, stats: CircuitStats) => void;\n  halfOpen: (name: string) => void;\n  requestRejected: (name: string) => void;\n  requestSuccess: (name: string, duration: number) => void;\n  requestFailure: (name: string, error: Error) => void;\n};\n\nexport type RetryEvents = {\n  retrying: (attempt: number, delay: number, error: unknown) => void;\n  exhausted: (attempts: RetryAttempt[]) => void;\n  success: (attempt: number) => void;\n  budgetExhausted: () => void;\n};\n\nexport type TimeoutEvents = {\n  started: (operationId: string, timeout: number) => void;\n  completed: (operationId: string, elapsed: number) => void;\n  timedOut: (operationId: string) => void;\n  cancelled: (operationId: string) => void;\n};\n\nexport type HealthEvents = {\n  statusChanged: (from: HealthStatus, to: HealthStatus) => void;\n  serviceHealthChanged: (service: string, status: HealthStatus) => void;\n  checkCompleted: (health: AggregatedHealth) => void;\n  checkFailed: (error: Error) => void;\n};\n\nexport type ReliabilityEvents = CircuitBreakerEvents &\n  RetryEvents &\n  TimeoutEvents &\n  HealthEvents & {\n    error: (error: Error) => void;\n  };\n","/**\n * Circuit Breaker\n * Phase 12A: Reliability & Resilience\n */\n\nimport { EventEmitter } from \"eventemitter3\";\nimport {\n  type CircuitState,\n  type CircuitBreakerConfig,\n  type CircuitStats,\n  type CircuitBreakerState,\n  type CircuitBreakerEvents,\n  CircuitBreakerConfigSchema,\n} from \"./types.js\";\n\n// ============================================================================\n// Circuit Breaker Error\n// ============================================================================\n\nexport class CircuitOpenError extends Error {\n  constructor(\n    public readonly circuitName: string,\n    public readonly state: CircuitState,\n    public readonly stats: CircuitStats\n  ) {\n    super(`Circuit breaker '${circuitName}' is ${state}`);\n    this.name = \"CircuitOpenError\";\n  }\n}\n\n// ============================================================================\n// Circuit Breaker Class\n// ============================================================================\n\nexport class CircuitBreaker extends EventEmitter<CircuitBreakerEvents> {\n  private config: Required<CircuitBreakerConfig>;\n  private state: CircuitState = \"closed\";\n  private stats: CircuitStats;\n  private halfOpenCalls: number = 0;\n  private requestTimestamps: number[] = [];\n  private failureTimestamps: number[] = [];\n  private stateTimer: NodeJS.Timeout | null = null;\n\n  constructor(config: CircuitBreakerConfig) {\n    super();\n    this.config = CircuitBreakerConfigSchema.parse(config) as Required<CircuitBreakerConfig>;\n\n    this.stats = {\n      totalRequests: 0,\n      successfulRequests: 0,\n      failedRequests: 0,\n      rejectedRequests: 0,\n      stateChangedAt: new Date(),\n      consecutiveFailures: 0,\n      consecutiveSuccesses: 0,\n    };\n  }\n\n  // ============================================================================\n  // Public API\n  // ============================================================================\n\n  /**\n   * Execute a function with circuit breaker protection\n   */\n  async execute<T>(fn: () => Promise<T>): Promise<T> {\n    // Check if request is allowed\n    if (!this.allowRequest()) {\n      this.stats.rejectedRequests++;\n      this.emit(\"requestRejected\", this.config.name);\n      throw new CircuitOpenError(this.config.name, this.state, this.stats);\n    }\n\n    const startTime = Date.now();\n\n    try {\n      const result = await fn();\n      this.recordSuccess(Date.now() - startTime);\n      return result;\n    } catch (error) {\n      this.recordFailure(error instanceof Error ? error : new Error(String(error)));\n      throw error;\n    }\n  }\n\n  /**\n   * Wrap a function with circuit breaker\n   */\n  wrap<T extends (...args: unknown[]) => Promise<unknown>>(\n    fn: T\n  ): (...args: Parameters<T>) => Promise<Awaited<ReturnType<T>>> {\n    return async (...args: Parameters<T>): Promise<Awaited<ReturnType<T>>> => {\n      return this.execute(() => fn(...args)) as Promise<Awaited<ReturnType<T>>>;\n    };\n  }\n\n  /**\n   * Get current state\n   */\n  getState(): CircuitBreakerState {\n    return {\n      name: this.config.name,\n      state: this.state,\n      stats: { ...this.stats },\n      config: { ...this.config },\n    };\n  }\n\n  /**\n   * Manually open the circuit\n   */\n  open(): void {\n    this.transitionTo(\"open\");\n  }\n\n  /**\n   * Manually close the circuit\n   */\n  close(): void {\n    this.transitionTo(\"closed\");\n  }\n\n  /**\n   * Reset statistics\n   */\n  resetStats(): void {\n    this.stats = {\n      totalRequests: 0,\n      successfulRequests: 0,\n      failedRequests: 0,\n      rejectedRequests: 0,\n      stateChangedAt: new Date(),\n      consecutiveFailures: 0,\n      consecutiveSuccesses: 0,\n    };\n    this.requestTimestamps = [];\n    this.failureTimestamps = [];\n  }\n\n  /**\n   * Get error rate in rolling window\n   */\n  getErrorRate(): number {\n    this.cleanupOldTimestamps();\n    if (this.requestTimestamps.length < this.config.volumeThreshold) {\n      return 0;\n    }\n    return (this.failureTimestamps.length / this.requestTimestamps.length) * 100;\n  }\n\n  /**\n   * Check if circuit is allowing requests\n   */\n  isAllowing(): boolean {\n    return this.allowRequest();\n  }\n\n  /**\n   * Dispose of the circuit breaker\n   */\n  dispose(): void {\n    if (this.stateTimer) {\n      clearTimeout(this.stateTimer);\n      this.stateTimer = null;\n    }\n    this.removeAllListeners();\n  }\n\n  // ============================================================================\n  // Private Methods\n  // ============================================================================\n\n  private allowRequest(): boolean {\n    switch (this.state) {\n      case \"closed\":\n        return true;\n\n      case \"open\":\n        return false;\n\n      case \"half_open\":\n        // Allow limited requests in half-open state\n        if (this.halfOpenCalls < this.config.halfOpenMaxCalls) {\n          this.halfOpenCalls++;\n          return true;\n        }\n        return false;\n\n      default:\n        return false;\n    }\n  }\n\n  private recordSuccess(duration: number): void {\n    const now = Date.now();\n    this.requestTimestamps.push(now);\n    this.stats.totalRequests++;\n    this.stats.successfulRequests++;\n    this.stats.lastSuccessTime = new Date();\n    this.stats.consecutiveSuccesses++;\n    this.stats.consecutiveFailures = 0;\n\n    this.emit(\"requestSuccess\", this.config.name, duration);\n\n    // State transitions on success\n    if (this.state === \"half_open\") {\n      if (this.stats.consecutiveSuccesses >= this.config.successThreshold) {\n        this.transitionTo(\"closed\");\n      }\n    }\n\n    this.cleanupOldTimestamps();\n  }\n\n  private recordFailure(error: Error): void {\n    const now = Date.now();\n    this.requestTimestamps.push(now);\n    this.failureTimestamps.push(now);\n    this.stats.totalRequests++;\n    this.stats.failedRequests++;\n    this.stats.lastFailureTime = new Date();\n    this.stats.consecutiveFailures++;\n    this.stats.consecutiveSuccesses = 0;\n\n    this.emit(\"requestFailure\", this.config.name, error);\n\n    // State transitions on failure\n    if (this.state === \"closed\") {\n      // Check if we should open the circuit\n      if (this.shouldTrip()) {\n        this.transitionTo(\"open\");\n      }\n    } else if (this.state === \"half_open\") {\n      // Any failure in half-open state opens the circuit\n      this.transitionTo(\"open\");\n    }\n\n    this.cleanupOldTimestamps();\n  }\n\n  private shouldTrip(): boolean {\n    // Need minimum volume before tripping\n    if (this.requestTimestamps.length < this.config.volumeThreshold) {\n      return false;\n    }\n\n    // Check consecutive failures\n    if (this.stats.consecutiveFailures >= this.config.failureThreshold) {\n      return true;\n    }\n\n    // Check error percentage\n    const errorRate = this.getErrorRate();\n    return errorRate >= this.config.errorPercentageThreshold;\n  }\n\n  private transitionTo(newState: CircuitState): void {\n    if (this.state === newState) {\n      return;\n    }\n\n    const oldState = this.state;\n    this.state = newState;\n    this.stats.stateChangedAt = new Date();\n\n    // Clear any existing timer\n    if (this.stateTimer) {\n      clearTimeout(this.stateTimer);\n      this.stateTimer = null;\n    }\n\n    this.emit(\"stateChanged\", this.config.name, oldState, newState);\n\n    switch (newState) {\n      case \"open\":\n        this.halfOpenCalls = 0;\n        this.emit(\"opened\", this.config.name, { ...this.stats });\n\n        // Schedule transition to half-open\n        this.stateTimer = setTimeout(() => {\n          this.transitionTo(\"half_open\");\n        }, this.config.timeout);\n        break;\n\n      case \"closed\":\n        this.stats.consecutiveFailures = 0;\n        this.stats.consecutiveSuccesses = 0;\n        this.emit(\"closed\", this.config.name, { ...this.stats });\n        break;\n\n      case \"half_open\":\n        this.halfOpenCalls = 0;\n        this.stats.consecutiveSuccesses = 0;\n        this.emit(\"halfOpen\", this.config.name);\n        break;\n    }\n  }\n\n  private cleanupOldTimestamps(): void {\n    const cutoff = Date.now() - this.config.rollingWindowMs;\n\n    this.requestTimestamps = this.requestTimestamps.filter((ts) => ts > cutoff);\n    this.failureTimestamps = this.failureTimestamps.filter((ts) => ts > cutoff);\n  }\n}\n\n// ============================================================================\n// Circuit Breaker Registry\n// ============================================================================\n\nexport class CircuitBreakerRegistry extends EventEmitter<CircuitBreakerEvents> {\n  private breakers: Map<string, CircuitBreaker> = new Map();\n  private defaultConfig: Partial<CircuitBreakerConfig>;\n\n  constructor(defaultConfig: Partial<CircuitBreakerConfig> = {}) {\n    super();\n    this.defaultConfig = defaultConfig;\n  }\n\n  /**\n   * Get or create a circuit breaker\n   */\n  get(name: string, config?: Partial<CircuitBreakerConfig>): CircuitBreaker {\n    let breaker = this.breakers.get(name);\n\n    if (!breaker) {\n      breaker = new CircuitBreaker({\n        name,\n        ...this.defaultConfig,\n        ...config,\n      } as CircuitBreakerConfig);\n\n      // Forward events\n      this.forwardEvents(breaker);\n\n      this.breakers.set(name, breaker);\n    }\n\n    return breaker;\n  }\n\n  /**\n   * Get all circuit breakers\n   */\n  getAll(): Map<string, CircuitBreaker> {\n    return new Map(this.breakers);\n  }\n\n  /**\n   * Get all circuit breaker states\n   */\n  getAllStates(): CircuitBreakerState[] {\n    return Array.from(this.breakers.values()).map((b) => b.getState());\n  }\n\n  /**\n   * Remove a circuit breaker\n   */\n  remove(name: string): boolean {\n    const breaker = this.breakers.get(name);\n    if (breaker) {\n      breaker.dispose();\n      this.breakers.delete(name);\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Reset all circuit breakers\n   */\n  resetAll(): void {\n    for (const breaker of this.breakers.values()) {\n      breaker.resetStats();\n      breaker.close();\n    }\n  }\n\n  /**\n   * Get summary of all circuit breakers\n   */\n  getSummary(): {\n    total: number;\n    closed: number;\n    open: number;\n    halfOpen: number;\n  } {\n    const states = this.getAllStates();\n    return {\n      total: states.length,\n      closed: states.filter((s) => s.state === \"closed\").length,\n      open: states.filter((s) => s.state === \"open\").length,\n      halfOpen: states.filter((s) => s.state === \"half_open\").length,\n    };\n  }\n\n  /**\n   * Dispose of all circuit breakers\n   */\n  dispose(): void {\n    for (const breaker of this.breakers.values()) {\n      breaker.dispose();\n    }\n    this.breakers.clear();\n    this.removeAllListeners();\n  }\n\n  private forwardEvents(breaker: CircuitBreaker): void {\n    breaker.on(\"stateChanged\", (...args) => this.emit(\"stateChanged\", ...args));\n    breaker.on(\"opened\", (...args) => this.emit(\"opened\", ...args));\n    breaker.on(\"closed\", (...args) => this.emit(\"closed\", ...args));\n    breaker.on(\"halfOpen\", (...args) => this.emit(\"halfOpen\", ...args));\n    breaker.on(\"requestRejected\", (...args) => this.emit(\"requestRejected\", ...args));\n    breaker.on(\"requestSuccess\", (...args) => this.emit(\"requestSuccess\", ...args));\n    breaker.on(\"requestFailure\", (...args) => this.emit(\"requestFailure\", ...args));\n  }\n}\n\n// ============================================================================\n// Singleton & Factory\n// ============================================================================\n\nlet registryInstance: CircuitBreakerRegistry | null = null;\n\nexport function getCircuitBreakerRegistry(\n  config?: Partial<CircuitBreakerConfig>\n): CircuitBreakerRegistry {\n  if (!registryInstance) {\n    registryInstance = new CircuitBreakerRegistry(config);\n  }\n  return registryInstance;\n}\n\nexport function createCircuitBreakerRegistry(\n  config?: Partial<CircuitBreakerConfig>\n): CircuitBreakerRegistry {\n  return new CircuitBreakerRegistry(config);\n}\n\nexport function createCircuitBreaker(config: CircuitBreakerConfig): CircuitBreaker {\n  return new CircuitBreaker(config);\n}\n","/**\n * Retry Strategy\n * Phase 12B: Reliability & Resilience\n */\n\nimport { EventEmitter } from \"eventemitter3\";\nimport {\n  type RetryConfig,\n  type RetryStrategyType,\n  type RetryAttempt,\n  type RetryResult,\n  type RetryEvents,\n  RetryConfigSchema,\n} from \"./types.js\";\n\n// ============================================================================\n// Retry Exhausted Error\n// ============================================================================\n\nexport class RetryExhaustedError extends Error {\n  constructor(\n    public readonly attempts: RetryAttempt[],\n    public readonly lastError: unknown\n  ) {\n    super(`Retry exhausted after ${attempts.length} attempts`);\n    this.name = \"RetryExhaustedError\";\n  }\n}\n\n// ============================================================================\n// Retry Strategy Class\n// ============================================================================\n\nexport class RetryStrategy extends EventEmitter<RetryEvents> {\n  private config: Required<RetryConfig>;\n  private retryBudgetUsed: number = 0;\n  private budgetResetTime: number = Date.now();\n\n  constructor(config: Partial<RetryConfig> = {}) {\n    super();\n    this.config = RetryConfigSchema.parse(config) as Required<RetryConfig>;\n  }\n\n  // ============================================================================\n  // Public API\n  // ============================================================================\n\n  /**\n   * Execute a function with retry logic\n   */\n  async execute<T>(fn: () => Promise<T>): Promise<RetryResult> {\n    const attempts: RetryAttempt[] = [];\n    const startTime = Date.now();\n    let lastError: unknown;\n\n    for (let attempt = 0; attempt <= this.config.maxRetries; attempt++) {\n      // Check retry budget\n      if (attempt > 0 && !this.checkBudget()) {\n        this.emit(\"budgetExhausted\");\n        return {\n          success: false,\n          error: new RetryExhaustedError(attempts, lastError),\n          attempts,\n          totalTime: Date.now() - startTime,\n        };\n      }\n\n      // Calculate delay for retry\n      const delay = attempt > 0 ? this.calculateDelay(attempt) : 0;\n\n      // Wait before retry\n      if (delay > 0) {\n        this.emit(\"retrying\", attempt, delay, lastError);\n        if (this.config.onRetry) {\n          this.config.onRetry(attempt, lastError);\n        }\n        await this.sleep(delay);\n      }\n\n      try {\n        const result = await fn();\n\n        const attemptRecord: RetryAttempt = {\n          attempt,\n          delay,\n          timestamp: new Date(),\n        };\n        attempts.push(attemptRecord);\n\n        this.emit(\"success\", attempt);\n\n        return {\n          success: true,\n          result,\n          attempts,\n          totalTime: Date.now() - startTime,\n        };\n      } catch (error) {\n        lastError = error;\n\n        const attemptRecord: RetryAttempt = {\n          attempt,\n          delay,\n          error,\n          timestamp: new Date(),\n        };\n        attempts.push(attemptRecord);\n\n        // Check if error is retryable\n        if (!this.isRetryable(error)) {\n          return {\n            success: false,\n            error,\n            attempts,\n            totalTime: Date.now() - startTime,\n          };\n        }\n\n        // Consume retry budget\n        if (attempt > 0) {\n          this.consumeBudget();\n        }\n      }\n    }\n\n    this.emit(\"exhausted\", attempts);\n\n    return {\n      success: false,\n      error: new RetryExhaustedError(attempts, lastError),\n      attempts,\n      totalTime: Date.now() - startTime,\n    };\n  }\n\n  /**\n   * Wrap a function with retry logic\n   */\n  wrap<T extends (...args: unknown[]) => Promise<unknown>>(\n    fn: T\n  ): (...args: Parameters<T>) => Promise<RetryResult> {\n    return async (...args: Parameters<T>): Promise<RetryResult> => {\n      return this.execute(() => fn(...args));\n    };\n  }\n\n  /**\n   * Execute with automatic unwrap (throws on failure)\n   */\n  async executeOrThrow<T>(fn: () => Promise<T>): Promise<T> {\n    const result = await this.execute(fn);\n\n    if (!result.success) {\n      throw result.error;\n    }\n\n    return result.result as T;\n  }\n\n  /**\n   * Calculate delay for a given attempt\n   */\n  calculateDelay(attempt: number): number {\n    let delay: number;\n\n    switch (this.config.strategy) {\n      case \"fixed\":\n        delay = this.config.baseDelayMs;\n        break;\n\n      case \"linear\":\n        delay = this.config.baseDelayMs * attempt;\n        break;\n\n      case \"exponential\":\n        delay = this.config.baseDelayMs * Math.pow(2, attempt - 1);\n        break;\n\n      case \"exponential_jitter\":\n        delay = this.config.baseDelayMs * Math.pow(2, attempt - 1);\n        const jitter = delay * this.config.jitterFactor * (Math.random() * 2 - 1);\n        delay = delay + jitter;\n        break;\n\n      default:\n        delay = this.config.baseDelayMs;\n    }\n\n    return Math.min(delay, this.config.maxDelayMs);\n  }\n\n  /**\n   * Get remaining retry budget\n   */\n  getRemainingBudget(): number | undefined {\n    if (!this.config.retryBudgetPerMinute) {\n      return undefined;\n    }\n\n    this.refreshBudget();\n    return Math.max(0, this.config.retryBudgetPerMinute - this.retryBudgetUsed);\n  }\n\n  /**\n   * Reset retry budget\n   */\n  resetBudget(): void {\n    this.retryBudgetUsed = 0;\n    this.budgetResetTime = Date.now();\n  }\n\n  // ============================================================================\n  // Private Methods\n  // ============================================================================\n\n  private isRetryable(error: unknown): boolean {\n    const errorName = error instanceof Error ? error.name : String(error);\n    const errorMessage = error instanceof Error ? error.message : String(error);\n\n    // Check non-retryable errors first\n    if (this.config.nonRetryableErrors?.length) {\n      for (const pattern of this.config.nonRetryableErrors) {\n        if (errorName.includes(pattern) || errorMessage.includes(pattern)) {\n          return false;\n        }\n      }\n    }\n\n    // If retryable errors are specified, check against them\n    if (this.config.retryableErrors?.length) {\n      for (const pattern of this.config.retryableErrors) {\n        if (errorName.includes(pattern) || errorMessage.includes(pattern)) {\n          return true;\n        }\n      }\n      return false; // Not in retryable list\n    }\n\n    // Default: retry all errors\n    return true;\n  }\n\n  private checkBudget(): boolean {\n    if (!this.config.retryBudgetPerMinute) {\n      return true;\n    }\n\n    this.refreshBudget();\n    return this.retryBudgetUsed < this.config.retryBudgetPerMinute;\n  }\n\n  private consumeBudget(): void {\n    if (this.config.retryBudgetPerMinute) {\n      this.retryBudgetUsed++;\n    }\n  }\n\n  private refreshBudget(): void {\n    const now = Date.now();\n    if (now - this.budgetResetTime >= 60000) {\n      this.retryBudgetUsed = 0;\n      this.budgetResetTime = now;\n    }\n  }\n\n  private sleep(ms: number): Promise<void> {\n    return new Promise((resolve) => setTimeout(resolve, ms));\n  }\n}\n\n// ============================================================================\n// Retry Decorators / Helpers\n// ============================================================================\n\n/**\n * Create a retry wrapper for a function\n */\nexport function withRetry<T extends (...args: unknown[]) => Promise<unknown>>(\n  fn: T,\n  config?: Partial<RetryConfig>\n): (...args: Parameters<T>) => Promise<Awaited<ReturnType<T>>> {\n  const strategy = new RetryStrategy(config);\n\n  return async (...args: Parameters<T>): Promise<Awaited<ReturnType<T>>> => {\n    const result = await strategy.execute(() => fn(...args));\n\n    if (!result.success) {\n      throw result.error;\n    }\n\n    return result.result as Awaited<ReturnType<T>>;\n  };\n}\n\n/**\n * Retry with exponential backoff (convenience function)\n */\nexport async function retryWithBackoff<T>(\n  fn: () => Promise<T>,\n  options?: {\n    maxRetries?: number;\n    baseDelay?: number;\n    maxDelay?: number;\n  }\n): Promise<T> {\n  const strategy = new RetryStrategy({\n    maxRetries: options?.maxRetries ?? 3,\n    baseDelayMs: options?.baseDelay ?? 1000,\n    maxDelayMs: options?.maxDelay ?? 30000,\n    strategy: \"exponential_jitter\",\n  });\n\n  return strategy.executeOrThrow(fn);\n}\n\n// ============================================================================\n// Singleton & Factory\n// ============================================================================\n\nexport function createRetryStrategy(config?: Partial<RetryConfig>): RetryStrategy {\n  return new RetryStrategy(config);\n}\n\n// Default strategies\nexport const DEFAULT_RETRY_STRATEGIES: Record<string, Partial<RetryConfig>> = {\n  // Aggressive retry for transient failures\n  aggressive: {\n    maxRetries: 5,\n    strategy: \"exponential_jitter\",\n    baseDelayMs: 100,\n    maxDelayMs: 5000,\n    jitterFactor: 0.3,\n  },\n\n  // Conservative retry for external APIs\n  conservative: {\n    maxRetries: 3,\n    strategy: \"exponential\",\n    baseDelayMs: 1000,\n    maxDelayMs: 30000,\n    jitterFactor: 0.2,\n  },\n\n  // Quick retry for cache operations\n  quick: {\n    maxRetries: 2,\n    strategy: \"fixed\",\n    baseDelayMs: 100,\n    maxDelayMs: 500,\n  },\n\n  // No retry\n  none: {\n    maxRetries: 0,\n  },\n};\n","/**\n * Timeout Manager\n * Phase 12C: Reliability & Resilience\n */\n\nimport { EventEmitter } from \"eventemitter3\";\nimport { randomUUID } from \"crypto\";\nimport {\n  type TimeoutConfig,\n  type TimeoutContext,\n  type TimeoutResult,\n  type TimeoutEvents,\n  TimeoutConfigSchema,\n} from \"./types.js\";\n\n// ============================================================================\n// Timeout Error\n// ============================================================================\n\nexport class TimeoutError extends Error {\n  constructor(\n    public readonly operationId: string,\n    public readonly timeout: number,\n    public readonly elapsed: number\n  ) {\n    super(`Operation '${operationId}' timed out after ${elapsed}ms (limit: ${timeout}ms)`);\n    this.name = \"TimeoutError\";\n  }\n}\n\n// ============================================================================\n// Timeout Manager Class\n// ============================================================================\n\nexport class TimeoutManager extends EventEmitter<TimeoutEvents> {\n  private config: Required<TimeoutConfig>;\n  private activeContexts: Map<string, TimeoutContext> = new Map();\n\n  constructor(config: Partial<TimeoutConfig> = {}) {\n    super();\n    this.config = TimeoutConfigSchema.parse(config) as Required<TimeoutConfig>;\n  }\n\n  // ============================================================================\n  // Public API\n  // ============================================================================\n\n  /**\n   * Execute a function with timeout\n   */\n  async execute<T>(\n    fn: (signal: AbortSignal) => Promise<T>,\n    options?: {\n      operationId?: string;\n      timeout?: number;\n      parentContext?: TimeoutContext;\n    }\n  ): Promise<T> {\n    const operationId = options?.operationId ?? randomUUID();\n    const context = this.createContext(operationId, options?.timeout, options?.parentContext);\n\n    this.activeContexts.set(operationId, context);\n    this.emit(\"started\", operationId, context.timeout);\n\n    const abortController = new AbortController();\n    context.abortController = abortController;\n\n    // Set up timeout\n    const timeoutPromise = new Promise<never>((_, reject) => {\n      const timer = setTimeout(() => {\n        abortController.abort();\n        const elapsed = Date.now() - context.startTime.getTime();\n        this.emit(\"timedOut\", operationId);\n        reject(new TimeoutError(operationId, context.timeout, elapsed));\n      }, context.timeout);\n\n      // Clean up timer on abort\n      abortController.signal.addEventListener(\"abort\", () => {\n        clearTimeout(timer);\n      });\n    });\n\n    try {\n      const result = await Promise.race([fn(abortController.signal), timeoutPromise]);\n\n      const elapsed = Date.now() - context.startTime.getTime();\n      this.emit(\"completed\", operationId, elapsed);\n\n      return result;\n    } finally {\n      this.activeContexts.delete(operationId);\n    }\n  }\n\n  /**\n   * Execute with child context (inherits parent timeout budget)\n   */\n  async executeChild<T>(\n    parentContext: TimeoutContext,\n    fn: (signal: AbortSignal) => Promise<T>,\n    options?: {\n      operationId?: string;\n      maxTimeout?: number;\n    }\n  ): Promise<T> {\n    const remaining = this.getRemainingTime(parentContext);\n\n    if (remaining <= 0) {\n      throw new TimeoutError(\n        options?.operationId ?? \"child\",\n        0,\n        parentContext.timeout\n      );\n    }\n\n    // Calculate child timeout (respect budget)\n    let childTimeout = remaining;\n    if (this.config.cascadingBudget) {\n      // Reserve some time for parent cleanup\n      const reserve = remaining * (this.config.budgetReservePercent / 100);\n      childTimeout = remaining - reserve;\n    }\n\n    // Apply max timeout if specified\n    if (options?.maxTimeout) {\n      childTimeout = Math.min(childTimeout, options.maxTimeout);\n    }\n\n    return this.execute(fn, {\n      operationId: options?.operationId,\n      timeout: childTimeout,\n      parentContext,\n    });\n  }\n\n  /**\n   * Create a timeout context without executing\n   */\n  createContext(\n    operationId: string,\n    timeout?: number,\n    parent?: TimeoutContext\n  ): TimeoutContext {\n    const now = new Date();\n    let effectiveTimeout = timeout ?? this.getTimeout(operationId);\n\n    // If parent exists, limit to remaining parent time\n    if (parent) {\n      const remaining = this.getRemainingTime(parent);\n      effectiveTimeout = Math.min(effectiveTimeout, remaining);\n    }\n\n    return {\n      operationId,\n      parentId: parent?.operationId,\n      timeout: effectiveTimeout,\n      startTime: now,\n      deadline: new Date(now.getTime() + effectiveTimeout),\n      remainingMs: effectiveTimeout,\n    };\n  }\n\n  /**\n   * Get remaining time for a context\n   */\n  getRemainingTime(context: TimeoutContext): number {\n    const elapsed = Date.now() - context.startTime.getTime();\n    return Math.max(0, context.timeout - elapsed);\n  }\n\n  /**\n   * Check if context has timed out\n   */\n  hasTimedOut(context: TimeoutContext): boolean {\n    return this.getRemainingTime(context) <= 0;\n  }\n\n  /**\n   * Cancel an active operation\n   */\n  cancel(operationId: string): boolean {\n    const context = this.activeContexts.get(operationId);\n    if (context?.abortController) {\n      context.abortController.abort();\n      this.activeContexts.delete(operationId);\n      this.emit(\"cancelled\", operationId);\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Get timeout for an operation\n   */\n  getTimeout(operationId: string): number {\n    if (this.config.operationTimeouts?.[operationId]) {\n      return this.config.operationTimeouts[operationId];\n    }\n    return this.config.defaultTimeout;\n  }\n\n  /**\n   * Set timeout for an operation\n   */\n  setTimeout(operationId: string, timeout: number): void {\n    if (!this.config.operationTimeouts) {\n      this.config.operationTimeouts = {};\n    }\n    this.config.operationTimeouts[operationId] = timeout;\n  }\n\n  /**\n   * Get all active contexts\n   */\n  getActiveContexts(): TimeoutContext[] {\n    return Array.from(this.activeContexts.values());\n  }\n\n  /**\n   * Get results for completed/timed out operations\n   */\n  getResult(context: TimeoutContext): TimeoutResult {\n    const elapsed = Date.now() - context.startTime.getTime();\n    return {\n      operationId: context.operationId,\n      timedOut: elapsed >= context.timeout,\n      elapsedMs: elapsed,\n      remainingMs: Math.max(0, context.timeout - elapsed),\n    };\n  }\n\n  /**\n   * Wrap a function with timeout\n   */\n  wrap<T extends (signal: AbortSignal, ...args: unknown[]) => Promise<unknown>>(\n    fn: T,\n    options?: { operationId?: string; timeout?: number }\n  ): (...args: Parameters<T> extends [AbortSignal, ...infer R] ? R : never) => Promise<\n    Awaited<ReturnType<T>>\n  > {\n    return async (\n      ...args: Parameters<T> extends [AbortSignal, ...infer R] ? R : never\n    ): Promise<Awaited<ReturnType<T>>> => {\n      return this.execute(\n        (signal) => fn(signal, ...args) as Promise<Awaited<ReturnType<T>>>,\n        options\n      );\n    };\n  }\n\n  /**\n   * Create a deadline from duration\n   */\n  createDeadline(ms: number): Date {\n    return new Date(Date.now() + ms);\n  }\n\n  /**\n   * Check if deadline has passed\n   */\n  isDeadlinePassed(deadline: Date): boolean {\n    return Date.now() >= deadline.getTime();\n  }\n\n  /**\n   * Get summary of timeout manager\n   */\n  getSummary(): {\n    activeOperations: number;\n    defaultTimeout: number;\n    customTimeouts: number;\n  } {\n    return {\n      activeOperations: this.activeContexts.size,\n      defaultTimeout: this.config.defaultTimeout,\n      customTimeouts: Object.keys(this.config.operationTimeouts || {}).length,\n    };\n  }\n}\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\n/**\n * Execute with timeout (standalone function)\n */\nexport async function withTimeout<T>(\n  fn: (signal: AbortSignal) => Promise<T>,\n  timeout: number,\n  operationId?: string\n): Promise<T> {\n  const manager = new TimeoutManager({ defaultTimeout: timeout });\n  return manager.execute(fn, { operationId });\n}\n\n/**\n * Race multiple promises with overall timeout\n */\nexport async function raceWithTimeout<T>(\n  promises: Promise<T>[],\n  timeout: number\n): Promise<T> {\n  const abortController = new AbortController();\n\n  const timeoutPromise = new Promise<never>((_, reject) => {\n    const timer = setTimeout(() => {\n      abortController.abort();\n      reject(new TimeoutError(\"race\", timeout, timeout));\n    }, timeout);\n\n    abortController.signal.addEventListener(\"abort\", () => {\n      clearTimeout(timer);\n    });\n  });\n\n  try {\n    return await Promise.race([...promises, timeoutPromise]);\n  } finally {\n    abortController.abort();\n  }\n}\n\n// ============================================================================\n// Singleton & Factory\n// ============================================================================\n\nlet timeoutManagerInstance: TimeoutManager | null = null;\n\nexport function getTimeoutManager(config?: Partial<TimeoutConfig>): TimeoutManager {\n  if (!timeoutManagerInstance) {\n    timeoutManagerInstance = new TimeoutManager(config);\n  }\n  return timeoutManagerInstance;\n}\n\nexport function createTimeoutManager(config?: Partial<TimeoutConfig>): TimeoutManager {\n  return new TimeoutManager(config);\n}\n\n// Common timeout presets\nexport const TIMEOUT_PRESETS = {\n  fast: 5000, // 5s - cache, local ops\n  normal: 30000, // 30s - most API calls\n  slow: 120000, // 2min - file operations, AI calls\n  veryLong: 600000, // 10min - batch processing\n} as const;\n","/**\n * Health Aggregator\n * Phase 12D: Reliability & Resilience\n */\n\nimport { EventEmitter } from \"eventemitter3\";\nimport {\n  type HealthStatus,\n  type HealthCheckType,\n  type ServiceHealth,\n  type Dependency,\n  type HealthAggregatorConfig,\n  type AggregatedHealth,\n  type HealthHistoryEntry,\n  type HealthEvents,\n  HealthAggregatorConfigSchema,\n} from \"./types.js\";\n\n// ============================================================================\n// Health Check Error\n// ============================================================================\n\nexport class HealthCheckError extends Error {\n  constructor(\n    public readonly service: string,\n    public readonly checkType: HealthCheckType,\n    message: string\n  ) {\n    super(`Health check failed for ${service} (${checkType}): ${message}`);\n    this.name = \"HealthCheckError\";\n  }\n}\n\n// ============================================================================\n// Health Aggregator Class\n// ============================================================================\n\nexport class HealthAggregator extends EventEmitter<HealthEvents> {\n  private config: Required<HealthAggregatorConfig>;\n  private services: Map<string, ServiceHealth> = new Map();\n  private dependencies: Map<string, ServiceHealth> = new Map();\n  private history: HealthHistoryEntry[] = [];\n  private consecutiveFailures: Map<string, number> = new Map();\n  private consecutiveSuccesses: Map<string, number> = new Map();\n  private checkInterval: NodeJS.Timeout | null = null;\n  private startTime: Date;\n  private currentStatus: HealthStatus = \"unknown\";\n\n  constructor(config: Partial<HealthAggregatorConfig> = {}) {\n    super();\n    this.config = HealthAggregatorConfigSchema.parse(config) as Required<HealthAggregatorConfig>;\n    this.startTime = new Date();\n\n    // Register dependencies from config\n    if (this.config.dependencies) {\n      for (const dep of this.config.dependencies) {\n        this.registerDependency(dep);\n      }\n    }\n  }\n\n  // ============================================================================\n  // Public API\n  // ============================================================================\n\n  /**\n   * Start periodic health checks\n   */\n  start(): void {\n    if (this.checkInterval) {\n      return;\n    }\n\n    // Initial check\n    this.runChecks();\n\n    // Schedule periodic checks\n    this.checkInterval = setInterval(() => {\n      this.runChecks();\n    }, this.config.checkInterval);\n  }\n\n  /**\n   * Stop periodic health checks\n   */\n  stop(): void {\n    if (this.checkInterval) {\n      clearInterval(this.checkInterval);\n      this.checkInterval = null;\n    }\n  }\n\n  /**\n   * Register a service health check\n   */\n  registerService(\n    name: string,\n    checkFn?: () => Promise<boolean>,\n    options?: { timeout?: number }\n  ): void {\n    this.services.set(name, {\n      name,\n      status: \"unknown\",\n      lastCheck: new Date(),\n    });\n\n    if (checkFn) {\n      // Store check function for later use\n      (this.services.get(name) as ServiceHealth & { checkFn: () => Promise<boolean> }).checkFn =\n        checkFn;\n      (this.services.get(name) as ServiceHealth & { timeout: number }).timeout =\n        options?.timeout ?? 5000;\n    }\n  }\n\n  /**\n   * Register a dependency\n   */\n  registerDependency(dependency: Dependency): void {\n    this.dependencies.set(dependency.name, {\n      name: dependency.name,\n      status: \"unknown\",\n      lastCheck: new Date(),\n      metadata: {\n        type: dependency.type,\n        weight: dependency.weight,\n        timeout: dependency.timeout,\n      },\n    });\n\n    if (dependency.checkFn) {\n      (this.dependencies.get(dependency.name) as ServiceHealth & { checkFn: () => Promise<boolean> }).checkFn =\n        dependency.checkFn;\n    }\n  }\n\n  /**\n   * Update service health manually\n   */\n  updateServiceHealth(\n    name: string,\n    status: HealthStatus,\n    options?: { latency?: number; message?: string; metadata?: Record<string, unknown> }\n  ): void {\n    const service = this.services.get(name);\n    const oldStatus = service?.status;\n\n    const newHealth: ServiceHealth = {\n      name,\n      status,\n      latency: options?.latency,\n      lastCheck: new Date(),\n      message: options?.message,\n      metadata: options?.metadata,\n    };\n\n    this.services.set(name, newHealth);\n\n    if (oldStatus !== status) {\n      this.emit(\"serviceHealthChanged\", name, status);\n    }\n\n    // Recalculate overall health\n    this.calculateOverallHealth();\n  }\n\n  /**\n   * Get aggregated health\n   */\n  getHealth(): AggregatedHealth {\n    return {\n      status: this.currentStatus,\n      services: Array.from(this.services.values()),\n      dependencies: Array.from(this.dependencies.values()),\n      uptime: Date.now() - this.startTime.getTime(),\n      lastUpdated: new Date(),\n    };\n  }\n\n  /**\n   * Get health for a specific type\n   */\n  async checkHealth(type: HealthCheckType = \"liveness\"): Promise<AggregatedHealth> {\n    switch (type) {\n      case \"liveness\":\n        // Quick check - is the process alive?\n        return {\n          status: \"healthy\",\n          services: [],\n          dependencies: [],\n          uptime: Date.now() - this.startTime.getTime(),\n          lastUpdated: new Date(),\n        };\n\n      case \"readiness\":\n        // Check required dependencies\n        await this.checkRequiredDependencies();\n        return this.getHealth();\n\n      case \"startup\":\n        // Check all services are initialized\n        await this.runChecks();\n        return this.getHealth();\n\n      case \"deep\":\n        // Full health check\n        await this.runChecks();\n        return this.getHealth();\n\n      default:\n        return this.getHealth();\n    }\n  }\n\n  /**\n   * Get health history\n   */\n  getHistory(limit?: number): HealthHistoryEntry[] {\n    const entries = [...this.history];\n    if (limit) {\n      return entries.slice(-limit);\n    }\n    return entries;\n  }\n\n  /**\n   * Check if system is healthy\n   */\n  isHealthy(): boolean {\n    return this.currentStatus === \"healthy\";\n  }\n\n  /**\n   * Check if system is at least degraded (not unhealthy)\n   */\n  isOperational(): boolean {\n    return this.currentStatus === \"healthy\" || this.currentStatus === \"degraded\";\n  }\n\n  /**\n   * Get uptime in milliseconds\n   */\n  getUptime(): number {\n    return Date.now() - this.startTime.getTime();\n  }\n\n  /**\n   * Get summary\n   */\n  getSummary(): {\n    status: HealthStatus;\n    services: { total: number; healthy: number; unhealthy: number };\n    dependencies: { total: number; healthy: number; unhealthy: number };\n    uptime: number;\n  } {\n    const serviceStatuses = Array.from(this.services.values());\n    const depStatuses = Array.from(this.dependencies.values());\n\n    return {\n      status: this.currentStatus,\n      services: {\n        total: serviceStatuses.length,\n        healthy: serviceStatuses.filter((s) => s.status === \"healthy\").length,\n        unhealthy: serviceStatuses.filter((s) => s.status === \"unhealthy\").length,\n      },\n      dependencies: {\n        total: depStatuses.length,\n        healthy: depStatuses.filter((s) => s.status === \"healthy\").length,\n        unhealthy: depStatuses.filter((s) => s.status === \"unhealthy\").length,\n      },\n      uptime: this.getUptime(),\n    };\n  }\n\n  /**\n   * Dispose\n   */\n  dispose(): void {\n    this.stop();\n    this.services.clear();\n    this.dependencies.clear();\n    this.history = [];\n    this.removeAllListeners();\n  }\n\n  // ============================================================================\n  // Private Methods\n  // ============================================================================\n\n  private async runChecks(): Promise<void> {\n    try {\n      // Check all services\n      await Promise.all(\n        Array.from(this.services.entries()).map(async ([name, service]) => {\n          await this.checkService(name, service);\n        })\n      );\n\n      // Check all dependencies\n      await Promise.all(\n        Array.from(this.dependencies.entries()).map(async ([name, dep]) => {\n          await this.checkDependency(name, dep);\n        })\n      );\n\n      // Calculate overall health\n      this.calculateOverallHealth();\n\n      // Record history\n      this.recordHistory();\n\n      // Emit event\n      this.emit(\"checkCompleted\", this.getHealth());\n    } catch (error) {\n      this.emit(\"checkFailed\", error instanceof Error ? error : new Error(String(error)));\n    }\n  }\n\n  private async checkService(name: string, service: ServiceHealth): Promise<void> {\n    const checkFn = (service as ServiceHealth & { checkFn?: () => Promise<boolean> }).checkFn;\n    const timeout = (service as ServiceHealth & { timeout?: number }).timeout ?? 5000;\n\n    if (!checkFn) {\n      return; // No check function, status is managed externally\n    }\n\n    const startTime = Date.now();\n\n    try {\n      const result = await this.withTimeout(checkFn(), timeout);\n      const latency = Date.now() - startTime;\n\n      if (result) {\n        this.recordSuccess(name, \"service\", latency);\n      } else {\n        this.recordFailure(name, \"service\", \"Check returned false\");\n      }\n    } catch (error) {\n      const latency = Date.now() - startTime;\n      this.recordFailure(\n        name,\n        \"service\",\n        error instanceof Error ? error.message : \"Unknown error\",\n        latency\n      );\n    }\n  }\n\n  private async checkDependency(name: string, dep: ServiceHealth): Promise<void> {\n    const checkFn = (dep as ServiceHealth & { checkFn?: () => Promise<boolean> }).checkFn;\n    const timeout = (dep.metadata?.timeout as number) ?? 5000;\n\n    if (!checkFn) {\n      return; // No check function, status is managed externally\n    }\n\n    const startTime = Date.now();\n\n    try {\n      const result = await this.withTimeout(checkFn(), timeout);\n      const latency = Date.now() - startTime;\n\n      if (result) {\n        this.recordSuccess(name, \"dependency\", latency);\n      } else {\n        this.recordFailure(name, \"dependency\", \"Check returned false\");\n      }\n    } catch (error) {\n      const latency = Date.now() - startTime;\n      this.recordFailure(\n        name,\n        \"dependency\",\n        error instanceof Error ? error.message : \"Unknown error\",\n        latency\n      );\n    }\n  }\n\n  private async checkRequiredDependencies(): Promise<void> {\n    const required = Array.from(this.dependencies.entries()).filter(\n      ([, dep]) => dep.metadata?.type === \"required\"\n    );\n\n    await Promise.all(\n      required.map(async ([name, dep]) => {\n        await this.checkDependency(name, dep);\n      })\n    );\n  }\n\n  private recordSuccess(name: string, type: \"service\" | \"dependency\", latency: number): void {\n    const map = type === \"service\" ? this.services : this.dependencies;\n    const existing = map.get(name);\n\n    const failures = this.consecutiveFailures.get(name) ?? 0;\n    const successes = (this.consecutiveSuccesses.get(name) ?? 0) + 1;\n\n    this.consecutiveSuccesses.set(name, successes);\n    this.consecutiveFailures.set(name, 0);\n\n    // Determine new status\n    let newStatus: HealthStatus = existing?.status ?? \"unknown\";\n\n    if (successes >= this.config.healthyThreshold) {\n      newStatus = \"healthy\";\n    } else if (failures > 0) {\n      newStatus = \"degraded\";\n    }\n\n    const oldStatus = existing?.status;\n    const newHealth: ServiceHealth = {\n      ...existing,\n      name,\n      status: newStatus,\n      latency,\n      lastCheck: new Date(),\n      message: undefined,\n    };\n\n    map.set(name, newHealth);\n\n    if (oldStatus !== newStatus) {\n      this.emit(\"serviceHealthChanged\", name, newStatus);\n    }\n  }\n\n  private recordFailure(\n    name: string,\n    type: \"service\" | \"dependency\",\n    message: string,\n    latency?: number\n  ): void {\n    const map = type === \"service\" ? this.services : this.dependencies;\n    const existing = map.get(name);\n\n    const failures = (this.consecutiveFailures.get(name) ?? 0) + 1;\n\n    this.consecutiveFailures.set(name, failures);\n    this.consecutiveSuccesses.set(name, 0);\n\n    // Determine new status\n    let newStatus: HealthStatus = existing?.status ?? \"unknown\";\n\n    if (failures >= this.config.unhealthyThreshold) {\n      newStatus = \"unhealthy\";\n    } else {\n      newStatus = \"degraded\";\n    }\n\n    const oldStatus = existing?.status;\n    const newHealth: ServiceHealth = {\n      ...existing,\n      name,\n      status: newStatus,\n      latency,\n      lastCheck: new Date(),\n      message,\n    };\n\n    map.set(name, newHealth);\n\n    if (oldStatus !== newStatus) {\n      this.emit(\"serviceHealthChanged\", name, newStatus);\n    }\n  }\n\n  private calculateOverallHealth(): void {\n    const oldStatus = this.currentStatus;\n\n    // Get all statuses with weights\n    const allHealth: { status: HealthStatus; weight: number; required: boolean }[] = [];\n\n    for (const service of this.services.values()) {\n      allHealth.push({\n        status: service.status,\n        weight: 1,\n        required: false,\n      });\n    }\n\n    for (const dep of this.dependencies.values()) {\n      allHealth.push({\n        status: dep.status,\n        weight: (dep.metadata?.weight as number) ?? 1,\n        required: dep.metadata?.type === \"required\",\n      });\n    }\n\n    if (allHealth.length === 0) {\n      this.currentStatus = \"healthy\";\n      return;\n    }\n\n    // Check required dependencies first\n    const requiredUnhealthy = allHealth.filter(\n      (h) => h.required && h.status === \"unhealthy\"\n    );\n\n    if (requiredUnhealthy.length > 0) {\n      this.currentStatus = \"unhealthy\";\n    } else {\n      // Calculate weighted health score\n      let totalWeight = 0;\n      let healthyWeight = 0;\n      let degradedWeight = 0;\n\n      for (const h of allHealth) {\n        totalWeight += h.weight;\n        if (h.status === \"healthy\") {\n          healthyWeight += h.weight;\n        } else if (h.status === \"degraded\") {\n          degradedWeight += h.weight;\n        }\n      }\n\n      const healthScore = (healthyWeight + degradedWeight * 0.5) / totalWeight;\n\n      if (healthScore >= 0.9) {\n        this.currentStatus = \"healthy\";\n      } else if (healthScore >= 0.5) {\n        this.currentStatus = \"degraded\";\n      } else {\n        this.currentStatus = \"unhealthy\";\n      }\n    }\n\n    if (oldStatus !== this.currentStatus) {\n      this.emit(\"statusChanged\", oldStatus, this.currentStatus);\n    }\n  }\n\n  private recordHistory(): void {\n    const entry: HealthHistoryEntry = {\n      timestamp: new Date(),\n      status: this.currentStatus,\n      services: {},\n    };\n\n    for (const [name, service] of this.services) {\n      entry.services[name] = service.status;\n    }\n\n    for (const [name, dep] of this.dependencies) {\n      entry.services[`dep:${name}`] = dep.status;\n    }\n\n    this.history.push(entry);\n\n    // Trim history\n    if (this.history.length > this.config.historySize) {\n      this.history = this.history.slice(-this.config.historySize);\n    }\n  }\n\n  private async withTimeout<T>(promise: Promise<T>, timeout: number): Promise<T> {\n    return Promise.race([\n      promise,\n      new Promise<never>((_, reject) => {\n        setTimeout(() => reject(new Error(\"Timeout\")), timeout);\n      }),\n    ]);\n  }\n}\n\n// ============================================================================\n// Singleton & Factory\n// ============================================================================\n\nlet healthAggregatorInstance: HealthAggregator | null = null;\n\nexport function getHealthAggregator(\n  config?: Partial<HealthAggregatorConfig>\n): HealthAggregator {\n  if (!healthAggregatorInstance) {\n    healthAggregatorInstance = new HealthAggregator(config);\n  }\n  return healthAggregatorInstance;\n}\n\nexport function createHealthAggregator(\n  config?: Partial<HealthAggregatorConfig>\n): HealthAggregator {\n  return new HealthAggregator(config);\n}\n","/**\n * Secrets Management Types\n * Phase 13A: Security & Secrets\n */\n\nimport { z } from \"zod\";\n\n// ============================================================================\n// Secret Provider Types\n// ============================================================================\n\nexport const SecretProviderSchema = z.enum([\n  \"env\",\n  \"vault\",\n  \"aws\",\n  \"azure\",\n  \"gcp\",\n  \"memory\",\n]);\nexport type SecretProvider = z.infer<typeof SecretProviderSchema>;\n\n// ============================================================================\n// Secret Types\n// ============================================================================\n\nexport const SecretTypeSchema = z.enum([\n  \"string\",\n  \"json\",\n  \"certificate\",\n  \"key_pair\",\n  \"api_key\",\n  \"connection_string\",\n]);\nexport type SecretType = z.infer<typeof SecretTypeSchema>;\n\nexport const SecretMetadataSchema = z.object({\n  type: SecretTypeSchema.default(\"string\"),\n  version: z.number().default(1),\n  createdAt: z.date(),\n  updatedAt: z.date(),\n  expiresAt: z.date().optional(),\n  rotatedAt: z.date().optional(),\n  provider: SecretProviderSchema,\n  path: z.string(),\n  tags: z.record(z.string()).optional(),\n});\nexport type SecretMetadata = z.infer<typeof SecretMetadataSchema>;\n\nexport const SecretValueSchema = z.object({\n  name: z.string(),\n  value: z.string(),\n  metadata: SecretMetadataSchema,\n});\nexport type SecretValue = z.infer<typeof SecretValueSchema>;\n\n// ============================================================================\n// Provider Configurations\n// ============================================================================\n\nexport const EnvProviderConfigSchema = z.object({\n  provider: z.literal(\"env\"),\n  prefix: z.string().optional(),\n  transform: z.enum([\"none\", \"uppercase\", \"lowercase\"]).default(\"uppercase\"),\n});\nexport type EnvProviderConfig = z.infer<typeof EnvProviderConfigSchema>;\n\nexport const VaultProviderConfigSchema = z.object({\n  provider: z.literal(\"vault\"),\n  address: z.string().url(),\n  token: z.string().optional(),\n  roleId: z.string().optional(),\n  secretId: z.string().optional(),\n  namespace: z.string().optional(),\n  mountPath: z.string().default(\"secret\"),\n  engineVersion: z.enum([\"v1\", \"v2\"]).default(\"v2\"),\n  tlsSkipVerify: z.boolean().default(false),\n  renewLease: z.boolean().default(true),\n});\nexport type VaultProviderConfig = z.infer<typeof VaultProviderConfigSchema>;\n\nexport const AWSProviderConfigSchema = z.object({\n  provider: z.literal(\"aws\"),\n  region: z.string(),\n  accessKeyId: z.string().optional(),\n  secretAccessKey: z.string().optional(),\n  sessionToken: z.string().optional(),\n  profile: z.string().optional(),\n  roleArn: z.string().optional(),\n});\nexport type AWSProviderConfig = z.infer<typeof AWSProviderConfigSchema>;\n\nexport const AzureProviderConfigSchema = z.object({\n  provider: z.literal(\"azure\"),\n  vaultUrl: z.string().url(),\n  clientId: z.string().optional(),\n  clientSecret: z.string().optional(),\n  tenantId: z.string().optional(),\n  useManagedIdentity: z.boolean().default(false),\n});\nexport type AzureProviderConfig = z.infer<typeof AzureProviderConfigSchema>;\n\nexport const GCPProviderConfigSchema = z.object({\n  provider: z.literal(\"gcp\"),\n  projectId: z.string(),\n  credentials: z.string().optional(), // JSON credentials\n  useDefaultCredentials: z.boolean().default(true),\n});\nexport type GCPProviderConfig = z.infer<typeof GCPProviderConfigSchema>;\n\nexport const MemoryProviderConfigSchema = z.object({\n  provider: z.literal(\"memory\"),\n  encrypted: z.boolean().default(false),\n  encryptionKey: z.string().optional(),\n});\nexport type MemoryProviderConfig = z.infer<typeof MemoryProviderConfigSchema>;\n\nexport const ProviderConfigSchema = z.discriminatedUnion(\"provider\", [\n  EnvProviderConfigSchema,\n  VaultProviderConfigSchema,\n  AWSProviderConfigSchema,\n  AzureProviderConfigSchema,\n  GCPProviderConfigSchema,\n  MemoryProviderConfigSchema,\n]);\nexport type ProviderConfig = z.infer<typeof ProviderConfigSchema>;\n\n// ============================================================================\n// Rotation Configuration\n// ============================================================================\n\nexport const RotationStrategySchema = z.enum([\n  \"manual\",\n  \"scheduled\",\n  \"on_expiry\",\n  \"on_access_count\",\n]);\nexport type RotationStrategy = z.infer<typeof RotationStrategySchema>;\n\nexport const RotationConfigSchema = z.object({\n  enabled: z.boolean().default(false),\n  strategy: RotationStrategySchema.default(\"manual\"),\n  intervalDays: z.number().optional(),\n  maxAccessCount: z.number().optional(),\n  notifyBeforeDays: z.number().default(7),\n  autoRotate: z.boolean().default(false),\n  rotationFunction: z.string().optional(), // Function name to call for rotation\n});\nexport type RotationConfig = z.infer<typeof RotationConfigSchema>;\n\n// ============================================================================\n// Access Control\n// ============================================================================\n\nexport const SecretAccessSchema = z.object({\n  secretName: z.string(),\n  accessor: z.string(), // User/service identifier\n  action: z.enum([\"read\", \"write\", \"delete\", \"rotate\"]),\n  timestamp: z.date(),\n  allowed: z.boolean(),\n  reason: z.string().optional(),\n});\nexport type SecretAccess = z.infer<typeof SecretAccessSchema>;\n\nexport const SecretPolicySchema = z.object({\n  name: z.string(),\n  pattern: z.string(), // Glob pattern for secret names\n  allowedAccessors: z.array(z.string()).optional(),\n  deniedAccessors: z.array(z.string()).optional(),\n  permissions: z.array(z.enum([\"read\", \"write\", \"delete\", \"rotate\"])),\n  conditions: z.object({\n    timeWindow: z.object({\n      start: z.string(), // HH:mm\n      end: z.string(),\n      timezone: z.string(),\n    }).optional(),\n    ipWhitelist: z.array(z.string()).optional(),\n    requireMfa: z.boolean().optional(),\n  }).optional(),\n});\nexport type SecretPolicy = z.infer<typeof SecretPolicySchema>;\n\n// ============================================================================\n// Lease Management\n// ============================================================================\n\nexport const SecretLeaseSchema = z.object({\n  id: z.string(),\n  secretName: z.string(),\n  duration: z.number(), // Seconds\n  renewable: z.boolean(),\n  createdAt: z.date(),\n  expiresAt: z.date(),\n  renewedAt: z.date().optional(),\n  renewCount: z.number().default(0),\n  maxRenewals: z.number().optional(),\n});\nexport type SecretLease = z.infer<typeof SecretLeaseSchema>;\n\n// ============================================================================\n// Secrets Manager Configuration\n// ============================================================================\n\nexport const SecretsManagerConfigSchema = z.object({\n  providers: z.array(ProviderConfigSchema).min(1),\n  defaultProvider: SecretProviderSchema.default(\"env\"),\n  cacheEnabled: z.boolean().default(true),\n  cacheTTL: z.number().default(300000), // 5 minutes\n  auditEnabled: z.boolean().default(true),\n  encryptionAtRest: z.boolean().default(false),\n  encryptionKey: z.string().optional(),\n  rotationConfig: RotationConfigSchema.optional(),\n  policies: z.array(SecretPolicySchema).optional(),\n});\nexport type SecretsManagerConfig = z.infer<typeof SecretsManagerConfigSchema>;\n\n// ============================================================================\n// Events\n// ============================================================================\n\nexport type SecretsEvents = {\n  // Secret lifecycle\n  secretAccessed: (name: string, accessor: string) => void;\n  secretCreated: (name: string) => void;\n  secretUpdated: (name: string, version: number) => void;\n  secretDeleted: (name: string) => void;\n  secretRotated: (name: string, newVersion: number) => void;\n\n  // Expiration\n  secretExpiring: (name: string, daysUntilExpiry: number) => void;\n  secretExpired: (name: string) => void;\n\n  // Lease\n  leaseCreated: (lease: SecretLease) => void;\n  leaseRenewed: (lease: SecretLease) => void;\n  leaseExpired: (lease: SecretLease) => void;\n\n  // Access control\n  accessDenied: (access: SecretAccess) => void;\n  policyViolation: (policy: string, accessor: string, action: string) => void;\n\n  // Provider\n  providerConnected: (provider: SecretProvider) => void;\n  providerDisconnected: (provider: SecretProvider, reason: string) => void;\n  providerError: (provider: SecretProvider, error: Error) => void;\n\n  // General\n  error: (error: Error) => void;\n};\n\n// ============================================================================\n// Reference Schemas\n// ============================================================================\n\nexport const SecretReferenceSchema = z.object({\n  name: z.string(),\n  provider: SecretProviderSchema.optional(),\n  version: z.number().optional(),\n  key: z.string().optional(), // For JSON secrets, specific key to extract\n});\nexport type SecretReference = z.infer<typeof SecretReferenceSchema>;\n\n// Format: ${secret:name} or ${secret:provider/name} or ${secret:name#key}\nexport const SECRET_REFERENCE_PATTERN = /\\$\\{secret:([a-zA-Z0-9_\\-\\/]+)(#[a-zA-Z0-9_\\-\\.]+)?\\}/g;\n\n// ============================================================================\n// Encrypted Secret\n// ============================================================================\n\nexport const EncryptedSecretSchema = z.object({\n  algorithm: z.string().default(\"aes-256-gcm\"),\n  iv: z.string(), // Base64 encoded\n  ciphertext: z.string(), // Base64 encoded\n  authTag: z.string().optional(), // For GCM mode\n  keyId: z.string().optional(), // Key identifier for rotation\n});\nexport type EncryptedSecret = z.infer<typeof EncryptedSecretSchema>;\n","/**\n * Secrets Manager\n * Phase 13A: Security & Secrets\n */\n\nimport { EventEmitter } from \"eventemitter3\";\nimport { randomUUID, createCipheriv, createDecipheriv, randomBytes } from \"crypto\";\nimport {\n  type SecretProvider,\n  type SecretValue,\n  type SecretMetadata,\n  type ProviderConfig,\n  type SecretLease,\n  type SecretAccess,\n  type SecretsManagerConfig,\n  type SecretsEvents,\n  type SecretReference,\n  type EncryptedSecret,\n  SecretsManagerConfigSchema,\n  SECRET_REFERENCE_PATTERN,\n} from \"./types.js\";\n\n// ============================================================================\n// Secret Provider Interface\n// ============================================================================\n\nexport interface ISecretProvider {\n  readonly name: SecretProvider;\n  connect(): Promise<void>;\n  disconnect(): Promise<void>;\n  get(name: string, version?: number): Promise<string | undefined>;\n  set(name: string, value: string): Promise<void>;\n  delete(name: string): Promise<void>;\n  list(prefix?: string): Promise<string[]>;\n  exists(name: string): Promise<boolean>;\n}\n\n// ============================================================================\n// Secrets Manager Error\n// ============================================================================\n\nexport class SecretsError extends Error {\n  constructor(\n    message: string,\n    public readonly code: string,\n    public readonly secretName?: string,\n    public readonly provider?: SecretProvider\n  ) {\n    super(message);\n    this.name = \"SecretsError\";\n  }\n}\n\n// ============================================================================\n// Built-in Providers\n// ============================================================================\n\n// Environment Variable Provider\nclass EnvProvider implements ISecretProvider {\n  readonly name: SecretProvider = \"env\";\n  private prefix: string;\n  private transform: \"none\" | \"uppercase\" | \"lowercase\";\n\n  constructor(config: { prefix?: string; transform?: \"none\" | \"uppercase\" | \"lowercase\" }) {\n    this.prefix = config.prefix ?? \"\";\n    this.transform = config.transform ?? \"uppercase\";\n  }\n\n  async connect(): Promise<void> {\n    // No connection needed for env vars\n  }\n\n  async disconnect(): Promise<void> {\n    // No disconnection needed\n  }\n\n  async get(name: string): Promise<string | undefined> {\n    const key = this.transformKey(name);\n    return process.env[key];\n  }\n\n  async set(name: string, value: string): Promise<void> {\n    const key = this.transformKey(name);\n    process.env[key] = value;\n  }\n\n  async delete(name: string): Promise<void> {\n    const key = this.transformKey(name);\n    delete process.env[key];\n  }\n\n  async list(prefix?: string): Promise<string[]> {\n    const fullPrefix = this.prefix + (prefix ?? \"\");\n    return Object.keys(process.env)\n      .filter((key) => key.startsWith(fullPrefix))\n      .map((key) => key.slice(this.prefix.length));\n  }\n\n  async exists(name: string): Promise<boolean> {\n    const key = this.transformKey(name);\n    return key in process.env;\n  }\n\n  private transformKey(name: string): string {\n    let key = this.prefix + name.replace(/[.\\-\\/]/g, \"_\");\n    switch (this.transform) {\n      case \"uppercase\":\n        return key.toUpperCase();\n      case \"lowercase\":\n        return key.toLowerCase();\n      default:\n        return key;\n    }\n  }\n}\n\n// In-Memory Provider (for testing/development)\nclass MemoryProvider implements ISecretProvider {\n  readonly name: SecretProvider = \"memory\";\n  private secrets: Map<string, string> = new Map();\n  private encrypted: boolean;\n  private encryptionKey?: Buffer;\n\n  constructor(config: { encrypted?: boolean; encryptionKey?: string }) {\n    this.encrypted = config.encrypted ?? false;\n    if (config.encryptionKey) {\n      this.encryptionKey = Buffer.from(config.encryptionKey, \"base64\");\n    }\n  }\n\n  async connect(): Promise<void> {}\n  async disconnect(): Promise<void> {\n    this.secrets.clear();\n  }\n\n  async get(name: string): Promise<string | undefined> {\n    const value = this.secrets.get(name);\n    if (!value) return undefined;\n\n    if (this.encrypted && this.encryptionKey) {\n      return this.decrypt(value);\n    }\n    return value;\n  }\n\n  async set(name: string, value: string): Promise<void> {\n    if (this.encrypted && this.encryptionKey) {\n      this.secrets.set(name, this.encrypt(value));\n    } else {\n      this.secrets.set(name, value);\n    }\n  }\n\n  async delete(name: string): Promise<void> {\n    this.secrets.delete(name);\n  }\n\n  async list(prefix?: string): Promise<string[]> {\n    const keys = Array.from(this.secrets.keys());\n    if (prefix) {\n      return keys.filter((k) => k.startsWith(prefix));\n    }\n    return keys;\n  }\n\n  async exists(name: string): Promise<boolean> {\n    return this.secrets.has(name);\n  }\n\n  private encrypt(value: string): string {\n    if (!this.encryptionKey) throw new Error(\"No encryption key\");\n    const iv = randomBytes(16);\n    const cipher = createCipheriv(\"aes-256-gcm\", this.encryptionKey, iv);\n    const encrypted = Buffer.concat([cipher.update(value, \"utf8\"), cipher.final()]);\n    const authTag = cipher.getAuthTag();\n    return JSON.stringify({\n      iv: iv.toString(\"base64\"),\n      ciphertext: encrypted.toString(\"base64\"),\n      authTag: authTag.toString(\"base64\"),\n    });\n  }\n\n  private decrypt(encryptedData: string): string {\n    if (!this.encryptionKey) throw new Error(\"No encryption key\");\n    const { iv, ciphertext, authTag } = JSON.parse(encryptedData);\n    const decipher = createDecipheriv(\n      \"aes-256-gcm\",\n      this.encryptionKey,\n      Buffer.from(iv, \"base64\")\n    );\n    decipher.setAuthTag(Buffer.from(authTag, \"base64\"));\n    const decrypted = Buffer.concat([\n      decipher.update(Buffer.from(ciphertext, \"base64\")),\n      decipher.final(),\n    ]);\n    return decrypted.toString(\"utf8\");\n  }\n}\n\n// ============================================================================\n// Secrets Manager Class\n// ============================================================================\n\nexport class SecretsManager extends EventEmitter<SecretsEvents> {\n  private config: Required<SecretsManagerConfig>;\n  private providers: Map<SecretProvider, ISecretProvider> = new Map();\n  private cache: Map<string, { value: string; expiresAt: number }> = new Map();\n  private leases: Map<string, SecretLease> = new Map();\n  private accessLog: SecretAccess[] = [];\n  private versions: Map<string, number> = new Map();\n\n  constructor(config: Partial<SecretsManagerConfig>) {\n    super();\n    this.config = SecretsManagerConfigSchema.parse(config) as Required<SecretsManagerConfig>;\n\n    // Initialize providers\n    this.initializeProviders();\n  }\n\n  // ============================================================================\n  // Public API\n  // ============================================================================\n\n  /**\n   * Get a secret value\n   */\n  async get(name: string, options?: { provider?: SecretProvider; version?: number }): Promise<string> {\n    const provider = options?.provider ?? this.config.defaultProvider;\n\n    // Check cache first\n    if (this.config.cacheEnabled) {\n      const cached = this.cache.get(`${provider}:${name}`);\n      if (cached && cached.expiresAt > Date.now()) {\n        this.logAccess(name, \"system\", \"read\", true);\n        this.emit(\"secretAccessed\", name, \"system\");\n        return cached.value;\n      }\n    }\n\n    // Get from provider\n    const providerInstance = this.providers.get(provider);\n    if (!providerInstance) {\n      throw new SecretsError(\n        `Provider not configured: ${provider}`,\n        \"PROVIDER_NOT_FOUND\",\n        name,\n        provider\n      );\n    }\n\n    const value = await providerInstance.get(name, options?.version);\n    if (value === undefined) {\n      throw new SecretsError(\n        `Secret not found: ${name}`,\n        \"SECRET_NOT_FOUND\",\n        name,\n        provider\n      );\n    }\n\n    // Cache the value\n    if (this.config.cacheEnabled) {\n      this.cache.set(`${provider}:${name}`, {\n        value,\n        expiresAt: Date.now() + this.config.cacheTTL,\n      });\n    }\n\n    this.logAccess(name, \"system\", \"read\", true);\n    this.emit(\"secretAccessed\", name, \"system\");\n\n    return value;\n  }\n\n  /**\n   * Get a secret with type coercion\n   */\n  async getTyped<T>(\n    name: string,\n    parser: (value: string) => T,\n    options?: { provider?: SecretProvider }\n  ): Promise<T> {\n    const value = await this.get(name, options);\n    return parser(value);\n  }\n\n  /**\n   * Get a JSON secret\n   */\n  async getJSON<T = unknown>(\n    name: string,\n    options?: { provider?: SecretProvider; key?: string }\n  ): Promise<T> {\n    const value = await this.get(name, options);\n    const parsed = JSON.parse(value);\n\n    if (options?.key) {\n      const keys = options.key.split(\".\");\n      let result = parsed;\n      for (const k of keys) {\n        result = result?.[k];\n      }\n      return result as T;\n    }\n\n    return parsed as T;\n  }\n\n  /**\n   * Set a secret value\n   */\n  async set(\n    name: string,\n    value: string,\n    options?: { provider?: SecretProvider }\n  ): Promise<void> {\n    const provider = options?.provider ?? this.config.defaultProvider;\n\n    const providerInstance = this.providers.get(provider);\n    if (!providerInstance) {\n      throw new SecretsError(\n        `Provider not configured: ${provider}`,\n        \"PROVIDER_NOT_FOUND\",\n        name,\n        provider\n      );\n    }\n\n    const exists = await providerInstance.exists(name);\n    await providerInstance.set(name, value);\n\n    // Update version\n    const currentVersion = this.versions.get(name) ?? 0;\n    this.versions.set(name, currentVersion + 1);\n\n    // Invalidate cache\n    this.cache.delete(`${provider}:${name}`);\n\n    this.logAccess(name, \"system\", \"write\", true);\n\n    if (exists) {\n      this.emit(\"secretUpdated\", name, currentVersion + 1);\n    } else {\n      this.emit(\"secretCreated\", name);\n    }\n  }\n\n  /**\n   * Delete a secret\n   */\n  async delete(name: string, options?: { provider?: SecretProvider }): Promise<void> {\n    const provider = options?.provider ?? this.config.defaultProvider;\n\n    const providerInstance = this.providers.get(provider);\n    if (!providerInstance) {\n      throw new SecretsError(\n        `Provider not configured: ${provider}`,\n        \"PROVIDER_NOT_FOUND\",\n        name,\n        provider\n      );\n    }\n\n    await providerInstance.delete(name);\n\n    // Invalidate cache\n    this.cache.delete(`${provider}:${name}`);\n\n    this.logAccess(name, \"system\", \"delete\", true);\n    this.emit(\"secretDeleted\", name);\n  }\n\n  /**\n   * Check if a secret exists\n   */\n  async exists(name: string, options?: { provider?: SecretProvider }): Promise<boolean> {\n    const provider = options?.provider ?? this.config.defaultProvider;\n\n    const providerInstance = this.providers.get(provider);\n    if (!providerInstance) {\n      return false;\n    }\n\n    return providerInstance.exists(name);\n  }\n\n  /**\n   * List secrets\n   */\n  async list(options?: { provider?: SecretProvider; prefix?: string }): Promise<string[]> {\n    const provider = options?.provider ?? this.config.defaultProvider;\n\n    const providerInstance = this.providers.get(provider);\n    if (!providerInstance) {\n      return [];\n    }\n\n    return providerInstance.list(options?.prefix);\n  }\n\n  /**\n   * Resolve secret references in a string\n   * Format: ${secret:name} or ${secret:provider/name} or ${secret:name#key}\n   */\n  async resolveReferences(template: string): Promise<string> {\n    let result = template;\n    let match;\n\n    // Reset regex\n    SECRET_REFERENCE_PATTERN.lastIndex = 0;\n\n    while ((match = SECRET_REFERENCE_PATTERN.exec(template)) !== null) {\n      const [fullMatch, path, keyPart] = match;\n      const key = keyPart?.slice(1); // Remove # prefix\n\n      let provider: SecretProvider | undefined;\n      let name: string;\n\n      if (path.includes(\"/\")) {\n        [provider, name] = path.split(\"/\") as [SecretProvider, string];\n      } else {\n        name = path;\n      }\n\n      try {\n        let value: string;\n        if (key) {\n          value = await this.getJSON(name, { provider, key });\n        } else {\n          value = await this.get(name, { provider });\n        }\n        result = result.replace(fullMatch, value);\n      } catch {\n        // Leave reference as-is if secret not found\n      }\n    }\n\n    return result;\n  }\n\n  /**\n   * Rotate a secret\n   */\n  async rotate(\n    name: string,\n    newValue: string,\n    options?: { provider?: SecretProvider }\n  ): Promise<number> {\n    const provider = options?.provider ?? this.config.defaultProvider;\n\n    // Set new value\n    await this.set(name, newValue, { provider });\n\n    const newVersion = this.versions.get(name) ?? 1;\n\n    this.emit(\"secretRotated\", name, newVersion);\n\n    return newVersion;\n  }\n\n  /**\n   * Create a lease for a secret\n   */\n  createLease(\n    secretName: string,\n    options?: { duration?: number; renewable?: boolean; maxRenewals?: number }\n  ): SecretLease {\n    const now = new Date();\n    const duration = options?.duration ?? 3600; // 1 hour default\n\n    const lease: SecretLease = {\n      id: randomUUID(),\n      secretName,\n      duration,\n      renewable: options?.renewable ?? true,\n      createdAt: now,\n      expiresAt: new Date(now.getTime() + duration * 1000),\n      renewCount: 0,\n      maxRenewals: options?.maxRenewals,\n    };\n\n    this.leases.set(lease.id, lease);\n    this.emit(\"leaseCreated\", lease);\n\n    return lease;\n  }\n\n  /**\n   * Renew a lease\n   */\n  renewLease(leaseId: string): SecretLease {\n    const lease = this.leases.get(leaseId);\n    if (!lease) {\n      throw new SecretsError(\"Lease not found\", \"LEASE_NOT_FOUND\");\n    }\n\n    if (!lease.renewable) {\n      throw new SecretsError(\"Lease is not renewable\", \"LEASE_NOT_RENEWABLE\");\n    }\n\n    if (lease.maxRenewals && lease.renewCount >= lease.maxRenewals) {\n      throw new SecretsError(\"Max renewals reached\", \"MAX_RENEWALS_REACHED\");\n    }\n\n    const now = new Date();\n    lease.renewedAt = now;\n    lease.expiresAt = new Date(now.getTime() + lease.duration * 1000);\n    lease.renewCount++;\n\n    this.leases.set(leaseId, lease);\n    this.emit(\"leaseRenewed\", lease);\n\n    return lease;\n  }\n\n  /**\n   * Revoke a lease\n   */\n  revokeLease(leaseId: string): boolean {\n    const lease = this.leases.get(leaseId);\n    if (!lease) {\n      return false;\n    }\n\n    this.leases.delete(leaseId);\n    this.emit(\"leaseExpired\", lease);\n\n    return true;\n  }\n\n  /**\n   * Get active leases\n   */\n  getActiveLeases(): SecretLease[] {\n    const now = Date.now();\n    return Array.from(this.leases.values()).filter(\n      (lease) => lease.expiresAt.getTime() > now\n    );\n  }\n\n  /**\n   * Clear cache\n   */\n  clearCache(): void {\n    this.cache.clear();\n  }\n\n  /**\n   * Get access log\n   */\n  getAccessLog(options?: { limit?: number; secretName?: string }): SecretAccess[] {\n    let log = [...this.accessLog];\n\n    if (options?.secretName) {\n      log = log.filter((a) => a.secretName === options.secretName);\n    }\n\n    if (options?.limit) {\n      log = log.slice(-options.limit);\n    }\n\n    return log;\n  }\n\n  /**\n   * Register a custom provider\n   */\n  registerProvider(provider: ISecretProvider): void {\n    this.providers.set(provider.name, provider);\n    this.emit(\"providerConnected\", provider.name);\n  }\n\n  /**\n   * Get summary\n   */\n  getSummary(): {\n    providers: SecretProvider[];\n    cacheSize: number;\n    activeLeases: number;\n    accessLogSize: number;\n  } {\n    return {\n      providers: Array.from(this.providers.keys()),\n      cacheSize: this.cache.size,\n      activeLeases: this.getActiveLeases().length,\n      accessLogSize: this.accessLog.length,\n    };\n  }\n\n  /**\n   * Dispose\n   */\n  async dispose(): Promise<void> {\n    for (const provider of this.providers.values()) {\n      try {\n        await provider.disconnect();\n      } catch {\n        // Ignore disconnect errors\n      }\n    }\n    this.providers.clear();\n    this.cache.clear();\n    this.leases.clear();\n    this.removeAllListeners();\n  }\n\n  // ============================================================================\n  // Private Methods\n  // ============================================================================\n\n  private initializeProviders(): void {\n    for (const providerConfig of this.config.providers) {\n      const provider = this.createProvider(providerConfig);\n      this.providers.set(provider.name, provider);\n    }\n  }\n\n  private createProvider(config: ProviderConfig): ISecretProvider {\n    switch (config.provider) {\n      case \"env\":\n        return new EnvProvider({\n          prefix: config.prefix,\n          transform: config.transform,\n        });\n\n      case \"memory\":\n        return new MemoryProvider({\n          encrypted: config.encrypted,\n          encryptionKey: config.encryptionKey,\n        });\n\n      case \"vault\":\n      case \"aws\":\n      case \"azure\":\n      case \"gcp\":\n        // These would require actual SDK implementations\n        // For now, return a mock that throws\n        return {\n          name: config.provider,\n          connect: async () => {},\n          disconnect: async () => {},\n          get: async () => {\n            throw new SecretsError(\n              `Provider ${config.provider} not implemented`,\n              \"PROVIDER_NOT_IMPLEMENTED\"\n            );\n          },\n          set: async () => {\n            throw new SecretsError(\n              `Provider ${config.provider} not implemented`,\n              \"PROVIDER_NOT_IMPLEMENTED\"\n            );\n          },\n          delete: async () => {\n            throw new SecretsError(\n              `Provider ${config.provider} not implemented`,\n              \"PROVIDER_NOT_IMPLEMENTED\"\n            );\n          },\n          list: async () => [],\n          exists: async () => false,\n        };\n\n      default:\n        throw new SecretsError(`Unknown provider: ${config.provider}`, \"UNKNOWN_PROVIDER\");\n    }\n  }\n\n  private logAccess(\n    secretName: string,\n    accessor: string,\n    action: \"read\" | \"write\" | \"delete\" | \"rotate\",\n    allowed: boolean,\n    reason?: string\n  ): void {\n    if (!this.config.auditEnabled) {\n      return;\n    }\n\n    const access: SecretAccess = {\n      secretName,\n      accessor,\n      action,\n      timestamp: new Date(),\n      allowed,\n      reason,\n    };\n\n    this.accessLog.push(access);\n\n    // Trim log if too large\n    if (this.accessLog.length > 10000) {\n      this.accessLog = this.accessLog.slice(-5000);\n    }\n\n    if (!allowed) {\n      this.emit(\"accessDenied\", access);\n    }\n  }\n}\n\n// ============================================================================\n// Singleton & Factory\n// ============================================================================\n\nlet secretsManagerInstance: SecretsManager | null = null;\n\nexport function getSecretsManager(config?: Partial<SecretsManagerConfig>): SecretsManager {\n  if (!secretsManagerInstance) {\n    secretsManagerInstance = new SecretsManager(\n      config ?? { providers: [{ provider: \"env\" }] }\n    );\n  }\n  return secretsManagerInstance;\n}\n\nexport function createSecretsManager(config: Partial<SecretsManagerConfig>): SecretsManager {\n  return new SecretsManager(config);\n}\n","/**\n * Rate Limiter Types\n * Phase 13B: Rate Limiting\n */\n\nimport { z } from \"zod\";\n\n// =============================================================================\n// Rate Limit Algorithms\n// =============================================================================\n\nexport const RateLimitAlgorithmSchema = z.enum([\n  \"token_bucket\",\n  \"sliding_window\",\n  \"fixed_window\",\n  \"leaky_bucket\",\n]);\nexport type RateLimitAlgorithm = z.infer<typeof RateLimitAlgorithmSchema>;\n\n// =============================================================================\n// Token Bucket Config\n// =============================================================================\n\nexport const TokenBucketConfigSchema = z.object({\n  algorithm: z.literal(\"token_bucket\"),\n  capacity: z.number().min(1).describe(\"Maximum tokens in bucket\"),\n  refillRate: z.number().min(0).describe(\"Tokens added per interval\"),\n  refillIntervalMs: z.number().min(1).default(1000).describe(\"Refill interval\"),\n});\nexport type TokenBucketConfig = z.infer<typeof TokenBucketConfigSchema>;\n\n// =============================================================================\n// Sliding Window Config\n// =============================================================================\n\nexport const SlidingWindowConfigSchema = z.object({\n  algorithm: z.literal(\"sliding_window\"),\n  windowMs: z.number().min(1).describe(\"Window duration in ms\"),\n  maxRequests: z.number().min(1).describe(\"Max requests per window\"),\n  precision: z.number().min(1).default(10).describe(\"Number of sub-windows\"),\n});\nexport type SlidingWindowConfig = z.infer<typeof SlidingWindowConfigSchema>;\n\n// =============================================================================\n// Fixed Window Config\n// =============================================================================\n\nexport const FixedWindowConfigSchema = z.object({\n  algorithm: z.literal(\"fixed_window\"),\n  windowMs: z.number().min(1).describe(\"Window duration in ms\"),\n  maxRequests: z.number().min(1).describe(\"Max requests per window\"),\n});\nexport type FixedWindowConfig = z.infer<typeof FixedWindowConfigSchema>;\n\n// =============================================================================\n// Leaky Bucket Config\n// =============================================================================\n\nexport const LeakyBucketConfigSchema = z.object({\n  algorithm: z.literal(\"leaky_bucket\"),\n  capacity: z.number().min(1).describe(\"Bucket capacity\"),\n  leakRate: z.number().min(0).describe(\"Requests leaked per interval\"),\n  leakIntervalMs: z.number().min(1).default(1000).describe(\"Leak interval\"),\n});\nexport type LeakyBucketConfig = z.infer<typeof LeakyBucketConfigSchema>;\n\n// =============================================================================\n// Combined Algorithm Config\n// =============================================================================\n\nexport const AlgorithmConfigSchema = z.discriminatedUnion(\"algorithm\", [\n  TokenBucketConfigSchema,\n  SlidingWindowConfigSchema,\n  FixedWindowConfigSchema,\n  LeakyBucketConfigSchema,\n]);\nexport type AlgorithmConfig = z.infer<typeof AlgorithmConfigSchema>;\n\n// =============================================================================\n// Rate Limit Rule\n// =============================================================================\n\nexport const RateLimitRuleSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  description: z.string().optional(),\n  enabled: z.boolean().default(true),\n  priority: z.number().default(0).describe(\"Higher = evaluated first\"),\n  match: z.object({\n    path: z.string().optional().describe(\"Path pattern (glob)\"),\n    method: z.array(z.string()).optional(),\n    headers: z.record(z.string()).optional(),\n    clientId: z.string().optional(),\n    tags: z.array(z.string()).optional(),\n  }),\n  config: AlgorithmConfigSchema,\n  actions: z.object({\n    onLimit: z.enum([\"reject\", \"queue\", \"throttle\"]).default(\"reject\"),\n    retryAfterMs: z.number().optional(),\n    queueTimeoutMs: z.number().optional(),\n    customResponse: z.object({\n      statusCode: z.number().default(429),\n      message: z.string().default(\"Too many requests\"),\n      headers: z.record(z.string()).optional(),\n    }).optional(),\n  }),\n});\nexport type RateLimitRule = z.infer<typeof RateLimitRuleSchema>;\n\n// =============================================================================\n// Rate Limit Result\n// =============================================================================\n\nexport const RateLimitResultSchema = z.object({\n  allowed: z.boolean(),\n  remaining: z.number(),\n  limit: z.number(),\n  resetMs: z.number().describe(\"Ms until limit resets\"),\n  retryAfterMs: z.number().optional(),\n  rule: z.string().optional().describe(\"Matched rule ID\"),\n  queuePosition: z.number().optional(),\n});\nexport type RateLimitResult = z.infer<typeof RateLimitResultSchema>;\n\n// =============================================================================\n// Rate Limit Request\n// =============================================================================\n\nexport const RateLimitRequestSchema = z.object({\n  key: z.string().describe(\"Unique identifier for rate limiting\"),\n  path: z.string().optional(),\n  method: z.string().optional(),\n  headers: z.record(z.string()).optional(),\n  clientId: z.string().optional(),\n  tags: z.array(z.string()).optional(),\n  cost: z.number().default(1).describe(\"Request cost (tokens consumed)\"),\n  timestamp: z.number().optional(),\n});\nexport type RateLimitRequest = z.infer<typeof RateLimitRequestSchema>;\n\n// =============================================================================\n// Rate Limiter State\n// =============================================================================\n\nexport const TokenBucketStateSchema = z.object({\n  algorithm: z.literal(\"token_bucket\"),\n  tokens: z.number(),\n  lastRefill: z.number(),\n});\nexport type TokenBucketState = z.infer<typeof TokenBucketStateSchema>;\n\nexport const SlidingWindowStateSchema = z.object({\n  algorithm: z.literal(\"sliding_window\"),\n  windows: z.array(z.object({\n    start: z.number(),\n    count: z.number(),\n  })),\n});\nexport type SlidingWindowState = z.infer<typeof SlidingWindowStateSchema>;\n\nexport const FixedWindowStateSchema = z.object({\n  algorithm: z.literal(\"fixed_window\"),\n  windowStart: z.number(),\n  count: z.number(),\n});\nexport type FixedWindowState = z.infer<typeof FixedWindowStateSchema>;\n\nexport const LeakyBucketStateSchema = z.object({\n  algorithm: z.literal(\"leaky_bucket\"),\n  level: z.number(),\n  lastLeak: z.number(),\n});\nexport type LeakyBucketState = z.infer<typeof LeakyBucketStateSchema>;\n\nexport const LimiterStateSchema = z.discriminatedUnion(\"algorithm\", [\n  TokenBucketStateSchema,\n  SlidingWindowStateSchema,\n  FixedWindowStateSchema,\n  LeakyBucketStateSchema,\n]);\nexport type LimiterState = z.infer<typeof LimiterStateSchema>;\n\n// =============================================================================\n// Rate Limit Stats\n// =============================================================================\n\nexport const RateLimitStatsSchema = z.object({\n  key: z.string(),\n  rule: z.string(),\n  totalRequests: z.number(),\n  allowedRequests: z.number(),\n  rejectedRequests: z.number(),\n  queuedRequests: z.number(),\n  averageWaitMs: z.number(),\n  peakUsage: z.number(),\n  lastRequest: z.number(),\n});\nexport type RateLimitStats = z.infer<typeof RateLimitStatsSchema>;\n\n// =============================================================================\n// Rate Limiter Config\n// =============================================================================\n\nexport const RateLimiterConfigSchema = z.object({\n  defaultRule: AlgorithmConfigSchema.optional(),\n  rules: z.array(RateLimitRuleSchema).default([]),\n  enableStats: z.boolean().default(true),\n  statsRetentionMs: z.number().default(24 * 60 * 60 * 1000), // 24 hours\n  enableDistributed: z.boolean().default(false),\n  redis: z.object({\n    host: z.string().default(\"localhost\"),\n    port: z.number().default(6379),\n    keyPrefix: z.string().default(\"ratelimit:\"),\n    password: z.string().optional(),\n  }).optional(),\n  queueConfig: z.object({\n    maxSize: z.number().default(1000),\n    defaultTimeoutMs: z.number().default(30000),\n  }).optional(),\n});\nexport type RateLimiterConfig = z.infer<typeof RateLimiterConfigSchema>;\n\n// =============================================================================\n// Distributed Sync\n// =============================================================================\n\nexport const DistributedSyncSchema = z.object({\n  nodeId: z.string(),\n  timestamp: z.number(),\n  states: z.record(LimiterStateSchema),\n});\nexport type DistributedSync = z.infer<typeof DistributedSyncSchema>;\n\n// =============================================================================\n// Events\n// =============================================================================\n\nexport type RateLimitEvents = {\n  // Request Events\n  allowed: (key: string, result: RateLimitResult) => void;\n  rejected: (key: string, result: RateLimitResult) => void;\n  queued: (key: string, position: number) => void;\n  dequeued: (key: string, waitMs: number) => void;\n\n  // Rule Events\n  ruleMatched: (key: string, ruleId: string) => void;\n  ruleAdded: (rule: RateLimitRule) => void;\n  ruleRemoved: (ruleId: string) => void;\n  ruleUpdated: (rule: RateLimitRule) => void;\n\n  // State Events\n  limitReached: (key: string, rule: string) => void;\n  limitReset: (key: string, rule: string) => void;\n\n  // Distributed Events\n  syncStarted: (nodeId: string) => void;\n  syncCompleted: (nodeId: string, keysSync: number) => void;\n  syncError: (nodeId: string, error: Error) => void;\n\n  // Errors\n  error: (error: Error) => void;\n};\n\n// =============================================================================\n// Storage Interface\n// =============================================================================\n\nexport interface RateLimitStorage {\n  get(key: string): Promise<LimiterState | null>;\n  set(key: string, state: LimiterState, ttlMs?: number): Promise<void>;\n  delete(key: string): Promise<void>;\n  increment(key: string, field: string, amount: number): Promise<number>;\n  getMulti(keys: string[]): Promise<Map<string, LimiterState>>;\n  setMulti(entries: Map<string, LimiterState>, ttlMs?: number): Promise<void>;\n}\n\n// =============================================================================\n// Queue Interface\n// =============================================================================\n\nexport interface RateLimitQueue {\n  enqueue(key: string, request: RateLimitRequest): Promise<number>;\n  dequeue(key: string): Promise<RateLimitRequest | null>;\n  peek(key: string): Promise<RateLimitRequest | null>;\n  size(key: string): Promise<number>;\n  clear(key: string): Promise<void>;\n}\n","/**\n * Rate Limiter Implementation\n * Phase 13B: Rate Limiting\n */\n\nimport { EventEmitter } from \"eventemitter3\";\nimport {\n  type RateLimiterConfig,\n  RateLimiterConfigSchema,\n  type RateLimitRule,\n  type RateLimitRequest,\n  type RateLimitResult,\n  type RateLimitStats,\n  type LimiterState,\n  type TokenBucketState,\n  type SlidingWindowState,\n  type FixedWindowState,\n  type LeakyBucketState,\n  type AlgorithmConfig,\n  type RateLimitEvents,\n  type RateLimitStorage,\n  type RateLimitQueue,\n} from \"./types.js\";\n\n// =============================================================================\n// Errors\n// =============================================================================\n\nexport class RateLimitExceededError extends Error {\n  constructor(\n    public readonly key: string,\n    public readonly result: RateLimitResult\n  ) {\n    super(`Rate limit exceeded for ${key}`);\n    this.name = \"RateLimitExceededError\";\n  }\n}\n\n// =============================================================================\n// In-Memory Storage\n// =============================================================================\n\nclass MemoryStorage implements RateLimitStorage {\n  private store = new Map<string, { state: LimiterState; expiresAt?: number }>();\n\n  async get(key: string): Promise<LimiterState | null> {\n    const entry = this.store.get(key);\n    if (!entry) return null;\n    if (entry.expiresAt && Date.now() > entry.expiresAt) {\n      this.store.delete(key);\n      return null;\n    }\n    return entry.state;\n  }\n\n  async set(key: string, state: LimiterState, ttlMs?: number): Promise<void> {\n    this.store.set(key, {\n      state,\n      expiresAt: ttlMs ? Date.now() + ttlMs : undefined,\n    });\n  }\n\n  async delete(key: string): Promise<void> {\n    this.store.delete(key);\n  }\n\n  async increment(_key: string, _field: string, _amount: number): Promise<number> {\n    // Not used for in-memory storage\n    return 0;\n  }\n\n  async getMulti(keys: string[]): Promise<Map<string, LimiterState>> {\n    const result = new Map<string, LimiterState>();\n    for (const key of keys) {\n      const state = await this.get(key);\n      if (state) result.set(key, state);\n    }\n    return result;\n  }\n\n  async setMulti(entries: Map<string, LimiterState>, ttlMs?: number): Promise<void> {\n    for (const [key, state] of entries) {\n      await this.set(key, state, ttlMs);\n    }\n  }\n\n  cleanup(): void {\n    const now = Date.now();\n    for (const [key, entry] of this.store) {\n      if (entry.expiresAt && now > entry.expiresAt) {\n        this.store.delete(key);\n      }\n    }\n  }\n}\n\n// =============================================================================\n// In-Memory Queue\n// =============================================================================\n\nclass MemoryQueue implements RateLimitQueue {\n  private queues = new Map<string, RateLimitRequest[]>();\n\n  async enqueue(key: string, request: RateLimitRequest): Promise<number> {\n    if (!this.queues.has(key)) {\n      this.queues.set(key, []);\n    }\n    const queue = this.queues.get(key)!;\n    queue.push(request);\n    return queue.length;\n  }\n\n  async dequeue(key: string): Promise<RateLimitRequest | null> {\n    const queue = this.queues.get(key);\n    if (!queue || queue.length === 0) return null;\n    return queue.shift()!;\n  }\n\n  async peek(key: string): Promise<RateLimitRequest | null> {\n    const queue = this.queues.get(key);\n    if (!queue || queue.length === 0) return null;\n    return queue[0];\n  }\n\n  async size(key: string): Promise<number> {\n    return this.queues.get(key)?.length ?? 0;\n  }\n\n  async clear(key: string): Promise<void> {\n    this.queues.delete(key);\n  }\n}\n\n// =============================================================================\n// Algorithm Implementations\n// =============================================================================\n\nfunction processTokenBucket(\n  state: TokenBucketState | null,\n  config: AlgorithmConfig & { algorithm: \"token_bucket\" },\n  cost: number,\n  now: number\n): { newState: TokenBucketState; result: RateLimitResult } {\n  // Initialize state if needed\n  if (!state) {\n    state = {\n      algorithm: \"token_bucket\",\n      tokens: config.capacity,\n      lastRefill: now,\n    };\n  }\n\n  // Calculate tokens to add based on time elapsed\n  const elapsed = now - state.lastRefill;\n  const tokensToAdd = Math.floor(elapsed / config.refillIntervalMs) * config.refillRate;\n  const newTokens = Math.min(config.capacity, state.tokens + tokensToAdd);\n  const lastRefill = tokensToAdd > 0 ? now : state.lastRefill;\n\n  // Check if we can consume\n  const allowed = newTokens >= cost;\n  const remaining = allowed ? newTokens - cost : newTokens;\n\n  // Calculate reset time (when bucket will be full again)\n  const tokensNeeded = config.capacity - remaining;\n  const intervalsNeeded = Math.ceil(tokensNeeded / config.refillRate);\n  const resetMs = intervalsNeeded * config.refillIntervalMs;\n\n  return {\n    newState: {\n      algorithm: \"token_bucket\",\n      tokens: allowed ? remaining : newTokens,\n      lastRefill,\n    },\n    result: {\n      allowed,\n      remaining: Math.floor(remaining),\n      limit: config.capacity,\n      resetMs,\n      retryAfterMs: allowed ? undefined : Math.ceil((cost - newTokens) / config.refillRate * config.refillIntervalMs),\n    },\n  };\n}\n\nfunction processSlidingWindow(\n  state: SlidingWindowState | null,\n  config: AlgorithmConfig & { algorithm: \"sliding_window\" },\n  cost: number,\n  now: number\n): { newState: SlidingWindowState; result: RateLimitResult } {\n  const subWindowMs = config.windowMs / config.precision;\n\n  // Initialize state if needed\n  if (!state) {\n    state = {\n      algorithm: \"sliding_window\",\n      windows: [],\n    };\n  }\n\n  // Clean up old windows\n  const windowStart = now - config.windowMs;\n  const windows = state.windows.filter(w => w.start >= windowStart);\n\n  // Calculate current count with weighted average\n  let currentCount = 0;\n  for (const window of windows) {\n    const age = now - window.start;\n    const weight = 1 - (age / config.windowMs);\n    currentCount += window.count * weight;\n  }\n\n  // Check if we can add\n  const allowed = currentCount + cost <= config.maxRequests;\n  const remaining = Math.max(0, config.maxRequests - currentCount - (allowed ? cost : 0));\n\n  // Add to current sub-window if allowed\n  if (allowed) {\n    const currentSubWindow = Math.floor(now / subWindowMs) * subWindowMs;\n    const existingWindow = windows.find(w => w.start === currentSubWindow);\n    if (existingWindow) {\n      existingWindow.count += cost;\n    } else {\n      windows.push({ start: currentSubWindow, count: cost });\n    }\n  }\n\n  // Calculate reset time (when oldest relevant request will expire)\n  const oldestWindow = windows.length > 0 ? Math.min(...windows.map(w => w.start)) : now;\n  const resetMs = Math.max(0, (oldestWindow + config.windowMs) - now);\n\n  return {\n    newState: {\n      algorithm: \"sliding_window\",\n      windows,\n    },\n    result: {\n      allowed,\n      remaining: Math.floor(remaining),\n      limit: config.maxRequests,\n      resetMs,\n      retryAfterMs: allowed ? undefined : resetMs,\n    },\n  };\n}\n\nfunction processFixedWindow(\n  state: FixedWindowState | null,\n  config: AlgorithmConfig & { algorithm: \"fixed_window\" },\n  cost: number,\n  now: number\n): { newState: FixedWindowState; result: RateLimitResult } {\n  const currentWindow = Math.floor(now / config.windowMs) * config.windowMs;\n\n  // Initialize or reset state if needed\n  if (!state || state.windowStart !== currentWindow) {\n    state = {\n      algorithm: \"fixed_window\",\n      windowStart: currentWindow,\n      count: 0,\n    };\n  }\n\n  // Check if we can add\n  const allowed = state.count + cost <= config.maxRequests;\n  const remaining = Math.max(0, config.maxRequests - state.count - (allowed ? cost : 0));\n  const resetMs = (currentWindow + config.windowMs) - now;\n\n  return {\n    newState: {\n      algorithm: \"fixed_window\",\n      windowStart: currentWindow,\n      count: allowed ? state.count + cost : state.count,\n    },\n    result: {\n      allowed,\n      remaining: Math.floor(remaining),\n      limit: config.maxRequests,\n      resetMs,\n      retryAfterMs: allowed ? undefined : resetMs,\n    },\n  };\n}\n\nfunction processLeakyBucket(\n  state: LeakyBucketState | null,\n  config: AlgorithmConfig & { algorithm: \"leaky_bucket\" },\n  cost: number,\n  now: number\n): { newState: LeakyBucketState; result: RateLimitResult } {\n  // Initialize state if needed\n  if (!state) {\n    state = {\n      algorithm: \"leaky_bucket\",\n      level: 0,\n      lastLeak: now,\n    };\n  }\n\n  // Calculate leaked amount based on time elapsed\n  const elapsed = now - state.lastLeak;\n  const leaked = Math.floor(elapsed / config.leakIntervalMs) * config.leakRate;\n  const newLevel = Math.max(0, state.level - leaked);\n  const lastLeak = leaked > 0 ? now : state.lastLeak;\n\n  // Check if we can add\n  const allowed = newLevel + cost <= config.capacity;\n  const remaining = Math.max(0, config.capacity - newLevel - (allowed ? cost : 0));\n\n  // Calculate reset time (when bucket will be empty)\n  const intervalsToEmpty = Math.ceil(newLevel / config.leakRate);\n  const resetMs = intervalsToEmpty * config.leakIntervalMs;\n\n  return {\n    newState: {\n      algorithm: \"leaky_bucket\",\n      level: allowed ? newLevel + cost : newLevel,\n      lastLeak,\n    },\n    result: {\n      allowed,\n      remaining: Math.floor(remaining),\n      limit: config.capacity,\n      resetMs,\n      retryAfterMs: allowed ? undefined : Math.ceil((newLevel + cost - config.capacity) / config.leakRate * config.leakIntervalMs),\n    },\n  };\n}\n\n// =============================================================================\n// Rate Limiter\n// =============================================================================\n\nexport class RateLimiter extends EventEmitter<RateLimitEvents> {\n  private config: RateLimiterConfig;\n  private storage: RateLimitStorage;\n  private queue: RateLimitQueue;\n  private stats = new Map<string, RateLimitStats>();\n  private cleanupInterval?: ReturnType<typeof setInterval>;\n\n  constructor(config: Partial<RateLimiterConfig> = {}) {\n    super();\n    this.config = RateLimiterConfigSchema.parse(config);\n    this.storage = new MemoryStorage();\n    this.queue = new MemoryQueue();\n\n    // Start cleanup interval\n    this.cleanupInterval = setInterval(() => {\n      if (this.storage instanceof MemoryStorage) {\n        this.storage.cleanup();\n      }\n      this.cleanupStats();\n    }, 60000); // Every minute\n  }\n\n  // ---------------------------------------------------------------------------\n  // Core Methods\n  // ---------------------------------------------------------------------------\n\n  async check(request: RateLimitRequest): Promise<RateLimitResult> {\n    const now = request.timestamp ?? Date.now();\n    const rule = this.findMatchingRule(request);\n    const config = rule?.config ?? this.config.defaultRule;\n\n    if (!config) {\n      // No rate limiting configured\n      return {\n        allowed: true,\n        remaining: Infinity,\n        limit: Infinity,\n        resetMs: 0,\n      };\n    }\n\n    const stateKey = this.getStateKey(request.key, rule?.id);\n    const currentState = await this.storage.get(stateKey);\n\n    const { newState, result } = this.processRequest(currentState, config, request.cost, now);\n\n    // Update state\n    await this.storage.set(stateKey, newState, this.getStateTTL(config));\n\n    // Add rule info to result\n    result.rule = rule?.id;\n\n    // Update stats\n    if (this.config.enableStats) {\n      this.updateStats(request.key, rule?.id ?? \"default\", result);\n    }\n\n    // Emit events\n    if (result.allowed) {\n      this.emit(\"allowed\", request.key, result);\n    } else {\n      this.emit(\"rejected\", request.key, result);\n      this.emit(\"limitReached\", request.key, rule?.id ?? \"default\");\n    }\n\n    if (rule) {\n      this.emit(\"ruleMatched\", request.key, rule.id);\n    }\n\n    return result;\n  }\n\n  async consume(request: RateLimitRequest): Promise<RateLimitResult> {\n    const result = await this.check(request);\n\n    if (!result.allowed) {\n      const rule = this.findMatchingRule(request);\n\n      if (rule?.actions.onLimit === \"queue\" && this.config.queueConfig) {\n        const queueKey = `queue:${request.key}`;\n        const position = await this.queue.enqueue(queueKey, request);\n\n        if (position <= this.config.queueConfig.maxSize) {\n          this.emit(\"queued\", request.key, position);\n          return {\n            ...result,\n            queuePosition: position,\n          };\n        }\n      }\n\n      throw new RateLimitExceededError(request.key, result);\n    }\n\n    return result;\n  }\n\n  async acquire(request: RateLimitRequest): Promise<RateLimitResult> {\n    return this.consume(request);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Rule Management\n  // ---------------------------------------------------------------------------\n\n  addRule(rule: RateLimitRule): void {\n    const existing = this.config.rules.findIndex(r => r.id === rule.id);\n    if (existing >= 0) {\n      this.config.rules[existing] = rule;\n      this.emit(\"ruleUpdated\", rule);\n    } else {\n      this.config.rules.push(rule);\n      this.config.rules.sort((a, b) => b.priority - a.priority);\n      this.emit(\"ruleAdded\", rule);\n    }\n  }\n\n  removeRule(ruleId: string): boolean {\n    const index = this.config.rules.findIndex(r => r.id === ruleId);\n    if (index >= 0) {\n      this.config.rules.splice(index, 1);\n      this.emit(\"ruleRemoved\", ruleId);\n      return true;\n    }\n    return false;\n  }\n\n  getRule(ruleId: string): RateLimitRule | undefined {\n    return this.config.rules.find(r => r.id === ruleId);\n  }\n\n  getRules(): RateLimitRule[] {\n    return [...this.config.rules];\n  }\n\n  // ---------------------------------------------------------------------------\n  // Stats\n  // ---------------------------------------------------------------------------\n\n  getStats(key?: string): RateLimitStats[] {\n    if (key) {\n      const stat = this.stats.get(key);\n      return stat ? [stat] : [];\n    }\n    return Array.from(this.stats.values());\n  }\n\n  resetStats(key?: string): void {\n    if (key) {\n      this.stats.delete(key);\n    } else {\n      this.stats.clear();\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // State Management\n  // ---------------------------------------------------------------------------\n\n  async reset(key: string, ruleId?: string): Promise<void> {\n    const stateKey = this.getStateKey(key, ruleId);\n    await this.storage.delete(stateKey);\n    this.emit(\"limitReset\", key, ruleId ?? \"default\");\n  }\n\n  async getState(key: string, ruleId?: string): Promise<LimiterState | null> {\n    const stateKey = this.getStateKey(key, ruleId);\n    return this.storage.get(stateKey);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Cleanup\n  // ---------------------------------------------------------------------------\n\n  destroy(): void {\n    if (this.cleanupInterval) {\n      clearInterval(this.cleanupInterval);\n    }\n    this.removeAllListeners();\n  }\n\n  // ---------------------------------------------------------------------------\n  // Private Helpers\n  // ---------------------------------------------------------------------------\n\n  private findMatchingRule(request: RateLimitRequest): RateLimitRule | undefined {\n    for (const rule of this.config.rules) {\n      if (!rule.enabled) continue;\n\n      // Check path match\n      if (rule.match.path && request.path) {\n        if (!this.matchPath(request.path, rule.match.path)) continue;\n      }\n\n      // Check method match\n      if (rule.match.method && request.method) {\n        if (!rule.match.method.includes(request.method.toUpperCase())) continue;\n      }\n\n      // Check client ID match\n      if (rule.match.clientId && request.clientId) {\n        if (rule.match.clientId !== request.clientId) continue;\n      }\n\n      // Check tags match\n      if (rule.match.tags && request.tags) {\n        const hasAllTags = rule.match.tags.every(t => request.tags!.includes(t));\n        if (!hasAllTags) continue;\n      }\n\n      // Check headers match\n      if (rule.match.headers && request.headers) {\n        const headersMatch = Object.entries(rule.match.headers).every(\n          ([key, value]) => request.headers![key] === value\n        );\n        if (!headersMatch) continue;\n      }\n\n      return rule;\n    }\n    return undefined;\n  }\n\n  private matchPath(path: string, pattern: string): boolean {\n    // Simple glob matching\n    const regex = pattern\n      .replace(/\\*/g, \".*\")\n      .replace(/\\?/g, \".\");\n    return new RegExp(`^${regex}$`).test(path);\n  }\n\n  private getStateKey(key: string, ruleId?: string): string {\n    return ruleId ? `${key}:${ruleId}` : key;\n  }\n\n  private getStateTTL(config: AlgorithmConfig): number {\n    switch (config.algorithm) {\n      case \"token_bucket\":\n        return config.refillIntervalMs * Math.ceil(config.capacity / config.refillRate) * 2;\n      case \"sliding_window\":\n        return config.windowMs * 2;\n      case \"fixed_window\":\n        return config.windowMs * 2;\n      case \"leaky_bucket\":\n        return config.leakIntervalMs * Math.ceil(config.capacity / config.leakRate) * 2;\n    }\n  }\n\n  private processRequest(\n    state: LimiterState | null,\n    config: AlgorithmConfig,\n    cost: number,\n    now: number\n  ): { newState: LimiterState; result: RateLimitResult } {\n    switch (config.algorithm) {\n      case \"token_bucket\":\n        return processTokenBucket(\n          state as TokenBucketState | null,\n          config,\n          cost,\n          now\n        );\n      case \"sliding_window\":\n        return processSlidingWindow(\n          state as SlidingWindowState | null,\n          config,\n          cost,\n          now\n        );\n      case \"fixed_window\":\n        return processFixedWindow(\n          state as FixedWindowState | null,\n          config,\n          cost,\n          now\n        );\n      case \"leaky_bucket\":\n        return processLeakyBucket(\n          state as LeakyBucketState | null,\n          config,\n          cost,\n          now\n        );\n    }\n  }\n\n  private updateStats(key: string, ruleId: string, result: RateLimitResult): void {\n    const statsKey = `${key}:${ruleId}`;\n    let stat = this.stats.get(statsKey);\n\n    if (!stat) {\n      stat = {\n        key,\n        rule: ruleId,\n        totalRequests: 0,\n        allowedRequests: 0,\n        rejectedRequests: 0,\n        queuedRequests: 0,\n        averageWaitMs: 0,\n        peakUsage: 0,\n        lastRequest: Date.now(),\n      };\n      this.stats.set(statsKey, stat);\n    }\n\n    stat.totalRequests++;\n    if (result.allowed) {\n      stat.allowedRequests++;\n    } else {\n      stat.rejectedRequests++;\n    }\n    if (result.queuePosition) {\n      stat.queuedRequests++;\n    }\n    stat.lastRequest = Date.now();\n\n    // Calculate peak usage\n    const usage = 1 - (result.remaining / result.limit);\n    if (usage > stat.peakUsage) {\n      stat.peakUsage = usage;\n    }\n  }\n\n  private cleanupStats(): void {\n    const cutoff = Date.now() - this.config.statsRetentionMs;\n    for (const [key, stat] of this.stats) {\n      if (stat.lastRequest < cutoff) {\n        this.stats.delete(key);\n      }\n    }\n  }\n}\n\n// =============================================================================\n// Rate Limiter Registry\n// =============================================================================\n\nexport class RateLimiterRegistry {\n  private limiters = new Map<string, RateLimiter>();\n\n  create(name: string, config: Partial<RateLimiterConfig> = {}): RateLimiter {\n    if (this.limiters.has(name)) {\n      throw new Error(`Rate limiter '${name}' already exists`);\n    }\n\n    const limiter = new RateLimiter(config);\n    this.limiters.set(name, limiter);\n    return limiter;\n  }\n\n  get(name: string): RateLimiter | undefined {\n    return this.limiters.get(name);\n  }\n\n  getOrCreate(name: string, config: Partial<RateLimiterConfig> = {}): RateLimiter {\n    const existing = this.limiters.get(name);\n    if (existing) return existing;\n    return this.create(name, config);\n  }\n\n  remove(name: string): boolean {\n    const limiter = this.limiters.get(name);\n    if (limiter) {\n      limiter.destroy();\n      this.limiters.delete(name);\n      return true;\n    }\n    return false;\n  }\n\n  list(): string[] {\n    return Array.from(this.limiters.keys());\n  }\n\n  destroy(): void {\n    for (const limiter of this.limiters.values()) {\n      limiter.destroy();\n    }\n    this.limiters.clear();\n  }\n}\n\n// =============================================================================\n// Factory Functions\n// =============================================================================\n\nlet defaultRegistry: RateLimiterRegistry | null = null;\n\nexport function getRateLimiterRegistry(): RateLimiterRegistry {\n  if (!defaultRegistry) {\n    defaultRegistry = new RateLimiterRegistry();\n  }\n  return defaultRegistry;\n}\n\nexport function createRateLimiterRegistry(): RateLimiterRegistry {\n  return new RateLimiterRegistry();\n}\n\nexport function createRateLimiter(config: Partial<RateLimiterConfig> = {}): RateLimiter {\n  return new RateLimiter(config);\n}\n\n// =============================================================================\n// Decorator / Wrapper\n// =============================================================================\n\nexport function withRateLimit<T extends (...args: unknown[]) => Promise<unknown>>(\n  limiter: RateLimiter,\n  keyFn: (...args: Parameters<T>) => string,\n  fn: T\n): T {\n  return (async (...args: Parameters<T>) => {\n    const key = keyFn(...args);\n    await limiter.acquire({ key });\n    return fn(...args);\n  }) as T;\n}\n\n// =============================================================================\n// Presets\n// =============================================================================\n\nexport const RATE_LIMIT_PRESETS = {\n  api: {\n    algorithm: \"token_bucket\" as const,\n    capacity: 100,\n    refillRate: 10,\n    refillIntervalMs: 1000,\n  },\n  burst: {\n    algorithm: \"token_bucket\" as const,\n    capacity: 50,\n    refillRate: 1,\n    refillIntervalMs: 1000,\n  },\n  strict: {\n    algorithm: \"fixed_window\" as const,\n    windowMs: 60000,\n    maxRequests: 60,\n  },\n  smooth: {\n    algorithm: \"leaky_bucket\" as const,\n    capacity: 100,\n    leakRate: 10,\n    leakIntervalMs: 1000,\n  },\n} as const;\n","/**\n * API Authentication Types\n * Phase 13C: API Authentication\n */\n\nimport { z } from \"zod\";\n\n// =============================================================================\n// Authentication Methods\n// =============================================================================\n\nexport const AuthMethodSchema = z.enum([\n  \"api_key\",\n  \"jwt\",\n  \"oauth2\",\n  \"basic\",\n  \"bearer\",\n  \"custom\",\n]);\nexport type AuthMethod = z.infer<typeof AuthMethodSchema>;\n\n// =============================================================================\n// API Key Authentication\n// =============================================================================\n\nexport const ApiKeyLocationSchema = z.enum([\"header\", \"query\", \"cookie\"]);\nexport type ApiKeyLocation = z.infer<typeof ApiKeyLocationSchema>;\n\nexport const ApiKeyConfigSchema = z.object({\n  method: z.literal(\"api_key\"),\n  location: ApiKeyLocationSchema.default(\"header\"),\n  name: z.string().default(\"X-API-Key\"),\n  prefix: z.string().optional(),\n  hashAlgorithm: z.enum([\"sha256\", \"sha512\", \"none\"]).default(\"sha256\"),\n});\nexport type ApiKeyConfig = z.infer<typeof ApiKeyConfigSchema>;\n\nexport const ApiKeySchema = z.object({\n  id: z.string(),\n  key: z.string().describe(\"The hashed key (or plain if hash is none)\"),\n  name: z.string(),\n  description: z.string().optional(),\n  clientId: z.string().optional(),\n  scopes: z.array(z.string()).default([]),\n  rateLimit: z.number().optional().describe(\"Requests per hour\"),\n  expiresAt: z.number().optional(),\n  createdAt: z.number(),\n  lastUsedAt: z.number().optional(),\n  enabled: z.boolean().default(true),\n  metadata: z.record(z.unknown()).optional(),\n});\nexport type ApiKey = z.infer<typeof ApiKeySchema>;\n\n// =============================================================================\n// JWT Authentication\n// =============================================================================\n\nexport const JwtAlgorithmSchema = z.enum([\n  \"HS256\",\n  \"HS384\",\n  \"HS512\",\n  \"RS256\",\n  \"RS384\",\n  \"RS512\",\n  \"ES256\",\n  \"ES384\",\n  \"ES512\",\n  \"PS256\",\n  \"PS384\",\n  \"PS512\",\n]);\nexport type JwtAlgorithm = z.infer<typeof JwtAlgorithmSchema>;\n\nexport const JwtConfigSchema = z.object({\n  method: z.literal(\"jwt\"),\n  algorithm: JwtAlgorithmSchema.default(\"RS256\"),\n  secret: z.string().optional().describe(\"For HS* algorithms\"),\n  publicKey: z.string().optional().describe(\"For RS*/ES*/PS* algorithms\"),\n  privateKey: z.string().optional().describe(\"For signing\"),\n  issuer: z.string().optional(),\n  audience: z.union([z.string(), z.array(z.string())]).optional(),\n  clockTolerance: z.number().default(60).describe(\"Seconds\"),\n  maxAge: z.number().optional().describe(\"Max token age in seconds\"),\n  jwksUri: z.string().optional().describe(\"JWKS endpoint for key rotation\"),\n  jwksCacheTtl: z.number().default(3600).describe(\"Cache TTL in seconds\"),\n});\nexport type JwtConfig = z.infer<typeof JwtConfigSchema>;\n\nexport const JwtPayloadSchema = z.object({\n  sub: z.string().optional(),\n  iss: z.string().optional(),\n  aud: z.union([z.string(), z.array(z.string())]).optional(),\n  exp: z.number().optional(),\n  nbf: z.number().optional(),\n  iat: z.number().optional(),\n  jti: z.string().optional(),\n  // Custom claims\n  scopes: z.array(z.string()).optional(),\n  roles: z.array(z.string()).optional(),\n  clientId: z.string().optional(),\n}).passthrough();\nexport type JwtPayload = z.infer<typeof JwtPayloadSchema>;\n\n// =============================================================================\n// OAuth2 Authentication\n// =============================================================================\n\nexport const OAuth2GrantTypeSchema = z.enum([\n  \"authorization_code\",\n  \"client_credentials\",\n  \"refresh_token\",\n  \"password\",\n  \"device_code\",\n]);\nexport type OAuth2GrantType = z.infer<typeof OAuth2GrantTypeSchema>;\n\nexport const OAuth2ConfigSchema = z.object({\n  method: z.literal(\"oauth2\"),\n  clientId: z.string(),\n  clientSecret: z.string().optional(),\n  authorizationUrl: z.string().optional(),\n  tokenUrl: z.string(),\n  userInfoUrl: z.string().optional(),\n  jwksUri: z.string().optional(),\n  scopes: z.array(z.string()).default([]),\n  redirectUri: z.string().optional(),\n  grantTypes: z.array(OAuth2GrantTypeSchema).default([\"authorization_code\"]),\n  pkce: z.boolean().default(true),\n  state: z.boolean().default(true),\n});\nexport type OAuth2Config = z.infer<typeof OAuth2ConfigSchema>;\n\nexport const OAuth2TokenSchema = z.object({\n  accessToken: z.string(),\n  tokenType: z.string().default(\"Bearer\"),\n  expiresIn: z.number().optional(),\n  refreshToken: z.string().optional(),\n  scope: z.string().optional(),\n  idToken: z.string().optional(),\n});\nexport type OAuth2Token = z.infer<typeof OAuth2TokenSchema>;\n\n// =============================================================================\n// Basic Authentication\n// =============================================================================\n\nexport const BasicAuthConfigSchema = z.object({\n  method: z.literal(\"basic\"),\n  realm: z.string().default(\"API\"),\n  hashAlgorithm: z.enum([\"bcrypt\", \"argon2\", \"scrypt\", \"none\"]).default(\"bcrypt\"),\n});\nexport type BasicAuthConfig = z.infer<typeof BasicAuthConfigSchema>;\n\nexport const BasicCredentialsSchema = z.object({\n  id: z.string(),\n  username: z.string(),\n  passwordHash: z.string(),\n  scopes: z.array(z.string()).default([]),\n  enabled: z.boolean().default(true),\n  createdAt: z.number(),\n  lastLoginAt: z.number().optional(),\n});\nexport type BasicCredentials = z.infer<typeof BasicCredentialsSchema>;\n\n// =============================================================================\n// Bearer Token\n// =============================================================================\n\nexport const BearerConfigSchema = z.object({\n  method: z.literal(\"bearer\"),\n  validateFn: z.string().optional().describe(\"Custom validation function name\"),\n  tokenFormat: z.enum([\"opaque\", \"jwt\"]).default(\"opaque\"),\n});\nexport type BearerConfig = z.infer<typeof BearerConfigSchema>;\n\n// =============================================================================\n// Custom Authentication\n// =============================================================================\n\nexport const CustomAuthConfigSchema = z.object({\n  method: z.literal(\"custom\"),\n  handler: z.string().describe(\"Handler function name\"),\n  config: z.record(z.unknown()).optional(),\n});\nexport type CustomAuthConfig = z.infer<typeof CustomAuthConfigSchema>;\n\n// =============================================================================\n// Combined Auth Config\n// =============================================================================\n\nexport const ApiAuthConfigSchema = z.discriminatedUnion(\"method\", [\n  ApiKeyConfigSchema,\n  JwtConfigSchema,\n  OAuth2ConfigSchema,\n  BasicAuthConfigSchema,\n  BearerConfigSchema,\n  CustomAuthConfigSchema,\n]);\nexport type ApiAuthConfig = z.infer<typeof ApiAuthConfigSchema>;\n\n// =============================================================================\n// Authentication Result\n// =============================================================================\n\nexport const ApiAuthResultSchema = z.object({\n  authenticated: z.boolean(),\n  method: AuthMethodSchema.optional(),\n  principal: z.object({\n    id: z.string(),\n    type: z.enum([\"user\", \"service\", \"api_key\", \"anonymous\"]),\n    name: z.string().optional(),\n    email: z.string().optional(),\n    scopes: z.array(z.string()).default([]),\n    roles: z.array(z.string()).default([]),\n    metadata: z.record(z.unknown()).optional(),\n  }).optional(),\n  token: z.object({\n    raw: z.string(),\n    type: z.string(),\n    expiresAt: z.number().optional(),\n  }).optional(),\n  error: z.object({\n    code: z.string(),\n    message: z.string(),\n  }).optional(),\n});\nexport type ApiAuthResult = z.infer<typeof ApiAuthResultSchema>;\n\n// =============================================================================\n// Authentication Request\n// =============================================================================\n\nexport const ApiAuthRequestSchema = z.object({\n  headers: z.record(z.string()).optional(),\n  query: z.record(z.string()).optional(),\n  cookies: z.record(z.string()).optional(),\n  body: z.record(z.unknown()).optional(),\n  method: z.string().optional(),\n  path: z.string().optional(),\n  ip: z.string().optional(),\n  userAgent: z.string().optional(),\n});\nexport type ApiAuthRequest = z.infer<typeof ApiAuthRequestSchema>;\n\n// =============================================================================\n// Token Storage\n// =============================================================================\n\nexport const StoredTokenSchema = z.object({\n  id: z.string(),\n  token: z.string(),\n  tokenType: z.enum([\"access\", \"refresh\", \"id\"]),\n  principalId: z.string(),\n  clientId: z.string().optional(),\n  scopes: z.array(z.string()).default([]),\n  issuedAt: z.number(),\n  expiresAt: z.number().optional(),\n  revokedAt: z.number().optional(),\n  metadata: z.record(z.unknown()).optional(),\n});\nexport type StoredToken = z.infer<typeof StoredTokenSchema>;\n\n// =============================================================================\n// Session\n// =============================================================================\n\nexport const ApiSessionSchema = z.object({\n  id: z.string(),\n  principalId: z.string(),\n  createdAt: z.number(),\n  expiresAt: z.number(),\n  lastActivityAt: z.number(),\n  ip: z.string().optional(),\n  userAgent: z.string().optional(),\n  data: z.record(z.unknown()).default({}),\n});\nexport type ApiSession = z.infer<typeof ApiSessionSchema>;\n\n// =============================================================================\n// Auth Manager Config\n// =============================================================================\n\nexport const ApiAuthManagerConfigSchema = z.object({\n  methods: z.array(ApiAuthConfigSchema).min(1),\n  defaultMethod: AuthMethodSchema.optional(),\n  fallbackToAnonymous: z.boolean().default(false),\n  sessionConfig: z.object({\n    enabled: z.boolean().default(false),\n    ttlSeconds: z.number().default(3600),\n    renewOnActivity: z.boolean().default(true),\n    cookieName: z.string().default(\"session_id\"),\n    secure: z.boolean().default(true),\n    sameSite: z.enum([\"strict\", \"lax\", \"none\"]).default(\"lax\"),\n  }).optional(),\n  tokenRefresh: z.object({\n    enabled: z.boolean().default(true),\n    refreshThresholdSeconds: z.number().default(300),\n  }).optional(),\n  audit: z.object({\n    enabled: z.boolean().default(true),\n    logSuccessful: z.boolean().default(true),\n    logFailed: z.boolean().default(true),\n  }).optional(),\n});\nexport type ApiAuthManagerConfig = z.infer<typeof ApiAuthManagerConfigSchema>;\n\n// =============================================================================\n// Audit Entry\n// =============================================================================\n\nexport const ApiAuthAuditEntrySchema = z.object({\n  id: z.string(),\n  timestamp: z.number(),\n  method: AuthMethodSchema,\n  success: z.boolean(),\n  principalId: z.string().optional(),\n  clientId: z.string().optional(),\n  ip: z.string().optional(),\n  userAgent: z.string().optional(),\n  path: z.string().optional(),\n  errorCode: z.string().optional(),\n  errorMessage: z.string().optional(),\n  metadata: z.record(z.unknown()).optional(),\n});\nexport type ApiAuthAuditEntry = z.infer<typeof ApiAuthAuditEntrySchema>;\n\n// =============================================================================\n// Events\n// =============================================================================\n\nexport type ApiAuthEvents = {\n  // Authentication Events\n  authenticated: (result: ApiAuthResult) => void;\n  authFailed: (result: ApiAuthResult, request: ApiAuthRequest) => void;\n  tokenIssued: (token: StoredToken) => void;\n  tokenRefreshed: (oldToken: string, newToken: StoredToken) => void;\n  tokenRevoked: (tokenId: string, reason?: string) => void;\n\n  // Session Events\n  sessionCreated: (session: ApiSession) => void;\n  sessionDestroyed: (sessionId: string) => void;\n  sessionExpired: (sessionId: string) => void;\n\n  // API Key Events\n  apiKeyCreated: (apiKey: ApiKey) => void;\n  apiKeyRevoked: (apiKeyId: string) => void;\n  apiKeyUsed: (apiKeyId: string) => void;\n\n  // Audit Events\n  auditLogged: (entry: ApiAuthAuditEntry) => void;\n\n  // Errors\n  error: (error: Error) => void;\n};\n\n// =============================================================================\n// Provider Interface\n// =============================================================================\n\nexport interface ApiAuthProvider {\n  readonly method: AuthMethod;\n  authenticate(request: ApiAuthRequest): Promise<ApiAuthResult>;\n  validate?(token: string): Promise<ApiAuthResult>;\n  refresh?(refreshToken: string): Promise<OAuth2Token | null>;\n  revoke?(token: string): Promise<boolean>;\n}\n\n// =============================================================================\n// Storage Interface\n// =============================================================================\n\nexport interface ApiAuthStorage {\n  // API Keys\n  getApiKey(id: string): Promise<ApiKey | null>;\n  getApiKeyByHash(hash: string): Promise<ApiKey | null>;\n  saveApiKey(apiKey: ApiKey): Promise<void>;\n  deleteApiKey(id: string): Promise<void>;\n  listApiKeys(clientId?: string): Promise<ApiKey[]>;\n\n  // Tokens\n  getToken(id: string): Promise<StoredToken | null>;\n  saveToken(token: StoredToken): Promise<void>;\n  deleteToken(id: string): Promise<void>;\n  deleteTokensByPrincipal(principalId: string): Promise<void>;\n\n  // Sessions\n  getSession(id: string): Promise<ApiSession | null>;\n  saveSession(session: ApiSession): Promise<void>;\n  deleteSession(id: string): Promise<void>;\n  deleteSessionsByPrincipal(principalId: string): Promise<void>;\n\n  // Basic Credentials\n  getCredentials(username: string): Promise<BasicCredentials | null>;\n  saveCredentials(credentials: BasicCredentials): Promise<void>;\n  deleteCredentials(username: string): Promise<void>;\n}\n","/**\n * API Authentication Manager\n * Phase 13C: API Authentication\n */\n\nimport { EventEmitter } from \"eventemitter3\";\nimport { createHash, randomBytes, timingSafeEqual } from \"crypto\";\nimport {\n  type ApiAuthManagerConfig,\n  ApiAuthManagerConfigSchema,\n  type ApiAuthConfig,\n  type ApiAuthRequest,\n  type ApiAuthResult,\n  type ApiAuthProvider,\n  type ApiAuthStorage,\n  type ApiKey,\n  type StoredToken,\n  type ApiSession,\n  type ApiAuthAuditEntry,\n  type ApiAuthEvents,\n  type AuthMethod,\n  type OAuth2Token,\n} from \"./types.js\";\n\n// =============================================================================\n// Errors\n// =============================================================================\n\nexport class AuthenticationError extends Error {\n  constructor(\n    public readonly code: string,\n    message: string\n  ) {\n    super(message);\n    this.name = \"AuthenticationError\";\n  }\n}\n\nexport class TokenExpiredError extends AuthenticationError {\n  constructor(message = \"Token has expired\") {\n    super(\"TOKEN_EXPIRED\", message);\n    this.name = \"TokenExpiredError\";\n  }\n}\n\nexport class TokenRevokedError extends AuthenticationError {\n  constructor(message = \"Token has been revoked\") {\n    super(\"TOKEN_REVOKED\", message);\n    this.name = \"TokenRevokedError\";\n  }\n}\n\nexport class InvalidCredentialsError extends AuthenticationError {\n  constructor(message = \"Invalid credentials\") {\n    super(\"INVALID_CREDENTIALS\", message);\n    this.name = \"InvalidCredentialsError\";\n  }\n}\n\n// =============================================================================\n// In-Memory Storage\n// =============================================================================\n\nclass MemoryAuthStorage implements ApiAuthStorage {\n  private apiKeys = new Map<string, ApiKey>();\n  private apiKeysByHash = new Map<string, ApiKey>();\n  private tokens = new Map<string, StoredToken>();\n  private sessions = new Map<string, ApiSession>();\n  private credentials = new Map<string, { id: string; username: string; passwordHash: string; scopes: string[]; enabled: boolean; createdAt: number; lastLoginAt?: number }>();\n\n  async getApiKey(id: string): Promise<ApiKey | null> {\n    return this.apiKeys.get(id) ?? null;\n  }\n\n  async getApiKeyByHash(hash: string): Promise<ApiKey | null> {\n    return this.apiKeysByHash.get(hash) ?? null;\n  }\n\n  async saveApiKey(apiKey: ApiKey): Promise<void> {\n    this.apiKeys.set(apiKey.id, apiKey);\n    this.apiKeysByHash.set(apiKey.key, apiKey);\n  }\n\n  async deleteApiKey(id: string): Promise<void> {\n    const apiKey = this.apiKeys.get(id);\n    if (apiKey) {\n      this.apiKeysByHash.delete(apiKey.key);\n      this.apiKeys.delete(id);\n    }\n  }\n\n  async listApiKeys(clientId?: string): Promise<ApiKey[]> {\n    const keys = Array.from(this.apiKeys.values());\n    return clientId ? keys.filter(k => k.clientId === clientId) : keys;\n  }\n\n  async getToken(id: string): Promise<StoredToken | null> {\n    return this.tokens.get(id) ?? null;\n  }\n\n  async saveToken(token: StoredToken): Promise<void> {\n    this.tokens.set(token.id, token);\n  }\n\n  async deleteToken(id: string): Promise<void> {\n    this.tokens.delete(id);\n  }\n\n  async deleteTokensByPrincipal(principalId: string): Promise<void> {\n    for (const [id, token] of this.tokens) {\n      if (token.principalId === principalId) {\n        this.tokens.delete(id);\n      }\n    }\n  }\n\n  async getSession(id: string): Promise<ApiSession | null> {\n    const session = this.sessions.get(id);\n    if (session && session.expiresAt < Date.now()) {\n      this.sessions.delete(id);\n      return null;\n    }\n    return session ?? null;\n  }\n\n  async saveSession(session: ApiSession): Promise<void> {\n    this.sessions.set(session.id, session);\n  }\n\n  async deleteSession(id: string): Promise<void> {\n    this.sessions.delete(id);\n  }\n\n  async deleteSessionsByPrincipal(principalId: string): Promise<void> {\n    for (const [id, session] of this.sessions) {\n      if (session.principalId === principalId) {\n        this.sessions.delete(id);\n      }\n    }\n  }\n\n  async getCredentials(username: string): Promise<{ id: string; username: string; passwordHash: string; scopes: string[]; enabled: boolean; createdAt: number; lastLoginAt?: number } | null> {\n    return this.credentials.get(username) ?? null;\n  }\n\n  async saveCredentials(credentials: { id: string; username: string; passwordHash: string; scopes: string[]; enabled: boolean; createdAt: number; lastLoginAt?: number }): Promise<void> {\n    this.credentials.set(credentials.username, credentials);\n  }\n\n  async deleteCredentials(username: string): Promise<void> {\n    this.credentials.delete(username);\n  }\n}\n\n// =============================================================================\n// API Key Provider\n// =============================================================================\n\nclass ApiKeyProvider implements ApiAuthProvider {\n  readonly method: AuthMethod = \"api_key\";\n\n  constructor(\n    private config: ApiAuthConfig & { method: \"api_key\" },\n    private storage: ApiAuthStorage\n  ) {}\n\n  async authenticate(request: ApiAuthRequest): Promise<ApiAuthResult> {\n    // Extract API key from request\n    let rawKey: string | undefined;\n\n    switch (this.config.location) {\n      case \"header\":\n        rawKey = request.headers?.[this.config.name.toLowerCase()];\n        break;\n      case \"query\":\n        rawKey = request.query?.[this.config.name];\n        break;\n      case \"cookie\":\n        rawKey = request.cookies?.[this.config.name];\n        break;\n    }\n\n    if (!rawKey) {\n      return {\n        authenticated: false,\n        method: this.method,\n        error: { code: \"NO_API_KEY\", message: \"API key not provided\" },\n      };\n    }\n\n    // Remove prefix if configured\n    if (this.config.prefix && rawKey.startsWith(this.config.prefix)) {\n      rawKey = rawKey.slice(this.config.prefix.length);\n    }\n\n    // Hash the key\n    const keyHash = this.config.hashAlgorithm === \"none\"\n      ? rawKey\n      : createHash(this.config.hashAlgorithm).update(rawKey).digest(\"hex\");\n\n    // Look up API key\n    const apiKey = await this.storage.getApiKeyByHash(keyHash);\n\n    if (!apiKey) {\n      return {\n        authenticated: false,\n        method: this.method,\n        error: { code: \"INVALID_API_KEY\", message: \"Invalid API key\" },\n      };\n    }\n\n    if (!apiKey.enabled) {\n      return {\n        authenticated: false,\n        method: this.method,\n        error: { code: \"API_KEY_DISABLED\", message: \"API key is disabled\" },\n      };\n    }\n\n    if (apiKey.expiresAt && apiKey.expiresAt < Date.now()) {\n      return {\n        authenticated: false,\n        method: this.method,\n        error: { code: \"API_KEY_EXPIRED\", message: \"API key has expired\" },\n      };\n    }\n\n    // Update last used\n    apiKey.lastUsedAt = Date.now();\n    await this.storage.saveApiKey(apiKey);\n\n    return {\n      authenticated: true,\n      method: this.method,\n      principal: {\n        id: apiKey.clientId ?? apiKey.id,\n        type: \"api_key\",\n        name: apiKey.name,\n        scopes: apiKey.scopes,\n        roles: [],\n        metadata: apiKey.metadata,\n      },\n    };\n  }\n}\n\n// =============================================================================\n// Basic Auth Provider\n// =============================================================================\n\nclass BasicAuthProvider implements ApiAuthProvider {\n  readonly method: AuthMethod = \"basic\";\n\n  constructor(\n    private config: ApiAuthConfig & { method: \"basic\" },\n    private storage: ApiAuthStorage\n  ) {}\n\n  async authenticate(request: ApiAuthRequest): Promise<ApiAuthResult> {\n    const authHeader = request.headers?.[\"authorization\"];\n    if (!authHeader?.startsWith(\"Basic \")) {\n      return {\n        authenticated: false,\n        method: this.method,\n        error: { code: \"NO_CREDENTIALS\", message: \"Basic auth credentials not provided\" },\n      };\n    }\n\n    const encoded = authHeader.slice(6);\n    let decoded: string;\n    try {\n      decoded = Buffer.from(encoded, \"base64\").toString(\"utf8\");\n    } catch {\n      return {\n        authenticated: false,\n        method: this.method,\n        error: { code: \"INVALID_ENCODING\", message: \"Invalid base64 encoding\" },\n      };\n    }\n\n    const colonIndex = decoded.indexOf(\":\");\n    if (colonIndex === -1) {\n      return {\n        authenticated: false,\n        method: this.method,\n        error: { code: \"INVALID_FORMAT\", message: \"Invalid credentials format\" },\n      };\n    }\n\n    const username = decoded.slice(0, colonIndex);\n    const password = decoded.slice(colonIndex + 1);\n\n    const credentials = await this.storage.getCredentials(username);\n    if (!credentials) {\n      return {\n        authenticated: false,\n        method: this.method,\n        error: { code: \"INVALID_CREDENTIALS\", message: \"Invalid username or password\" },\n      };\n    }\n\n    if (!credentials.enabled) {\n      return {\n        authenticated: false,\n        method: this.method,\n        error: { code: \"ACCOUNT_DISABLED\", message: \"Account is disabled\" },\n      };\n    }\n\n    // Verify password (simple hash comparison for now)\n    const passwordHash = this.config.hashAlgorithm === \"none\"\n      ? password\n      : createHash(\"sha256\").update(password).digest(\"hex\");\n\n    // Use timing-safe comparison\n    const expected = Buffer.from(credentials.passwordHash);\n    const actual = Buffer.from(passwordHash);\n\n    if (expected.length !== actual.length || !timingSafeEqual(expected, actual)) {\n      return {\n        authenticated: false,\n        method: this.method,\n        error: { code: \"INVALID_CREDENTIALS\", message: \"Invalid username or password\" },\n      };\n    }\n\n    // Update last login\n    credentials.lastLoginAt = Date.now();\n    await this.storage.saveCredentials(credentials);\n\n    return {\n      authenticated: true,\n      method: this.method,\n      principal: {\n        id: credentials.id,\n        type: \"user\",\n        name: credentials.username,\n        scopes: credentials.scopes,\n        roles: [],\n      },\n    };\n  }\n}\n\n// =============================================================================\n// Bearer Token Provider\n// =============================================================================\n\nclass BearerTokenProvider implements ApiAuthProvider {\n  readonly method: AuthMethod = \"bearer\";\n\n  constructor(\n    private _config: ApiAuthConfig & { method: \"bearer\" },\n    private storage: ApiAuthStorage\n  ) {}\n\n  async authenticate(request: ApiAuthRequest): Promise<ApiAuthResult> {\n    const authHeader = request.headers?.[\"authorization\"];\n    if (!authHeader?.startsWith(\"Bearer \")) {\n      return {\n        authenticated: false,\n        method: this.method,\n        error: { code: \"NO_TOKEN\", message: \"Bearer token not provided\" },\n      };\n    }\n\n    const token = authHeader.slice(7);\n    return this.validate(token);\n  }\n\n  async validate(token: string): Promise<ApiAuthResult> {\n    // Hash the token to look it up\n    const tokenHash = createHash(\"sha256\").update(token).digest(\"hex\");\n\n    // Look up all tokens and find match (in real impl, you'd have a proper index)\n    // For now, just demonstrate the pattern\n    const storedToken = await this.findToken(tokenHash);\n\n    if (!storedToken) {\n      return {\n        authenticated: false,\n        method: this.method,\n        error: { code: \"INVALID_TOKEN\", message: \"Invalid token\" },\n      };\n    }\n\n    if (storedToken.revokedAt) {\n      return {\n        authenticated: false,\n        method: this.method,\n        error: { code: \"TOKEN_REVOKED\", message: \"Token has been revoked\" },\n      };\n    }\n\n    if (storedToken.expiresAt && storedToken.expiresAt < Date.now()) {\n      return {\n        authenticated: false,\n        method: this.method,\n        error: { code: \"TOKEN_EXPIRED\", message: \"Token has expired\" },\n      };\n    }\n\n    return {\n      authenticated: true,\n      method: this.method,\n      principal: {\n        id: storedToken.principalId,\n        type: \"service\",\n        scopes: storedToken.scopes,\n        roles: [],\n        metadata: storedToken.metadata,\n      },\n      token: {\n        raw: token,\n        type: storedToken.tokenType,\n        expiresAt: storedToken.expiresAt,\n      },\n    };\n  }\n\n  private async findToken(hash: string): Promise<StoredToken | null> {\n    // In a real implementation, you'd have an index by hash\n    // This is a simplified version\n    const token = await this.storage.getToken(hash);\n    return token;\n  }\n}\n\n// =============================================================================\n// API Authentication Manager\n// =============================================================================\n\nexport class ApiAuthManager extends EventEmitter<ApiAuthEvents> {\n  private config: ApiAuthManagerConfig;\n  private storage: ApiAuthStorage;\n  private providers = new Map<AuthMethod, ApiAuthProvider>();\n  private auditLog: ApiAuthAuditEntry[] = [];\n\n  constructor(\n    config: Partial<ApiAuthManagerConfig> & { methods: ApiAuthConfig[] },\n    storage?: ApiAuthStorage\n  ) {\n    super();\n    this.config = ApiAuthManagerConfigSchema.parse(config);\n    this.storage = storage ?? new MemoryAuthStorage();\n\n    // Initialize providers\n    this.initializeProviders();\n  }\n\n  private initializeProviders(): void {\n    for (const methodConfig of this.config.methods) {\n      switch (methodConfig.method) {\n        case \"api_key\":\n          this.providers.set(\"api_key\", new ApiKeyProvider(methodConfig, this.storage));\n          break;\n        case \"basic\":\n          this.providers.set(\"basic\", new BasicAuthProvider(methodConfig, this.storage));\n          break;\n        case \"bearer\":\n          this.providers.set(\"bearer\", new BearerTokenProvider(methodConfig, this.storage));\n          break;\n        // JWT and OAuth2 would need additional dependencies\n        // Adding stubs here for completeness\n        case \"jwt\":\n        case \"oauth2\":\n        case \"custom\":\n          // These would need more complex implementations\n          break;\n      }\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Authentication\n  // ---------------------------------------------------------------------------\n\n  async authenticate(request: ApiAuthRequest): Promise<ApiAuthResult> {\n    // Try each configured method in order\n    for (const methodConfig of this.config.methods) {\n      const provider = this.providers.get(methodConfig.method);\n      if (!provider) continue;\n\n      const result = await provider.authenticate(request);\n\n      if (result.authenticated) {\n        await this.logAudit(methodConfig.method, true, result, request);\n        this.emit(\"authenticated\", result);\n        return result;\n      }\n\n      // If there's an error other than \"not provided\", log it\n      if (result.error && !result.error.code.includes(\"NO_\")) {\n        await this.logAudit(methodConfig.method, false, result, request);\n        this.emit(\"authFailed\", result, request);\n        return result;\n      }\n    }\n\n    // No authentication method succeeded\n    if (this.config.fallbackToAnonymous) {\n      const result: ApiAuthResult = {\n        authenticated: true,\n        principal: {\n          id: \"anonymous\",\n          type: \"anonymous\",\n          scopes: [],\n          roles: [],\n        },\n      };\n      return result;\n    }\n\n    const result: ApiAuthResult = {\n      authenticated: false,\n      error: { code: \"NO_AUTH\", message: \"No valid authentication provided\" },\n    };\n\n    await this.logAudit(\"custom\", false, result, request);\n    this.emit(\"authFailed\", result, request);\n    return result;\n  }\n\n  // ---------------------------------------------------------------------------\n  // API Key Management\n  // ---------------------------------------------------------------------------\n\n  async createApiKey(options: {\n    name: string;\n    description?: string;\n    clientId?: string;\n    scopes?: string[];\n    rateLimit?: number;\n    expiresAt?: number;\n    metadata?: Record<string, unknown>;\n  }): Promise<{ apiKey: ApiKey; rawKey: string }> {\n    const rawKey = randomBytes(32).toString(\"hex\");\n\n    // Get API key config\n    const apiKeyConfig = this.config.methods.find(m => m.method === \"api_key\") as\n      | (ApiAuthConfig & { method: \"api_key\" })\n      | undefined;\n\n    const hashAlgorithm = apiKeyConfig?.hashAlgorithm ?? \"sha256\";\n    const keyHash = hashAlgorithm === \"none\"\n      ? rawKey\n      : createHash(hashAlgorithm).update(rawKey).digest(\"hex\");\n\n    const apiKey: ApiKey = {\n      id: randomBytes(16).toString(\"hex\"),\n      key: keyHash,\n      name: options.name,\n      description: options.description,\n      clientId: options.clientId,\n      scopes: options.scopes ?? [],\n      rateLimit: options.rateLimit,\n      expiresAt: options.expiresAt,\n      createdAt: Date.now(),\n      enabled: true,\n      metadata: options.metadata,\n    };\n\n    await this.storage.saveApiKey(apiKey);\n    this.emit(\"apiKeyCreated\", apiKey);\n\n    return { apiKey, rawKey };\n  }\n\n  async revokeApiKey(id: string): Promise<boolean> {\n    const apiKey = await this.storage.getApiKey(id);\n    if (!apiKey) return false;\n\n    apiKey.enabled = false;\n    await this.storage.saveApiKey(apiKey);\n    this.emit(\"apiKeyRevoked\", id);\n    return true;\n  }\n\n  async deleteApiKey(id: string): Promise<boolean> {\n    const apiKey = await this.storage.getApiKey(id);\n    if (!apiKey) return false;\n\n    await this.storage.deleteApiKey(id);\n    return true;\n  }\n\n  async listApiKeys(clientId?: string): Promise<ApiKey[]> {\n    return this.storage.listApiKeys(clientId);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Token Management\n  // ---------------------------------------------------------------------------\n\n  async issueToken(options: {\n    principalId: string;\n    clientId?: string;\n    scopes?: string[];\n    tokenType?: \"access\" | \"refresh\" | \"id\";\n    expiresIn?: number;\n    metadata?: Record<string, unknown>;\n  }): Promise<{ token: StoredToken; rawToken: string }> {\n    const rawToken = randomBytes(32).toString(\"hex\");\n    const tokenHash = createHash(\"sha256\").update(rawToken).digest(\"hex\");\n\n    const token: StoredToken = {\n      id: tokenHash, // Use hash as ID for lookup\n      token: tokenHash,\n      tokenType: options.tokenType ?? \"access\",\n      principalId: options.principalId,\n      clientId: options.clientId,\n      scopes: options.scopes ?? [],\n      issuedAt: Date.now(),\n      expiresAt: options.expiresIn ? Date.now() + options.expiresIn * 1000 : undefined,\n      metadata: options.metadata,\n    };\n\n    await this.storage.saveToken(token);\n    this.emit(\"tokenIssued\", token);\n\n    return { token, rawToken };\n  }\n\n  async revokeToken(tokenId: string, reason?: string): Promise<boolean> {\n    const token = await this.storage.getToken(tokenId);\n    if (!token) return false;\n\n    token.revokedAt = Date.now();\n    await this.storage.saveToken(token);\n    this.emit(\"tokenRevoked\", tokenId, reason);\n    return true;\n  }\n\n  async refreshToken(refreshToken: string): Promise<OAuth2Token | null> {\n    const tokenHash = createHash(\"sha256\").update(refreshToken).digest(\"hex\");\n    const storedToken = await this.storage.getToken(tokenHash);\n\n    if (!storedToken || storedToken.tokenType !== \"refresh\") {\n      return null;\n    }\n\n    if (storedToken.revokedAt || (storedToken.expiresAt && storedToken.expiresAt < Date.now())) {\n      return null;\n    }\n\n    // Issue new access token\n    const { rawToken } = await this.issueToken({\n      principalId: storedToken.principalId,\n      clientId: storedToken.clientId,\n      scopes: storedToken.scopes,\n      tokenType: \"access\",\n      expiresIn: 3600, // 1 hour\n      metadata: storedToken.metadata,\n    });\n\n    const oldToken = refreshToken;\n    const newStoredToken = await this.storage.getToken(\n      createHash(\"sha256\").update(rawToken).digest(\"hex\")\n    );\n\n    if (newStoredToken) {\n      this.emit(\"tokenRefreshed\", oldToken, newStoredToken);\n    }\n\n    return {\n      accessToken: rawToken,\n      tokenType: \"Bearer\",\n      expiresIn: 3600,\n      refreshToken,\n    };\n  }\n\n  // ---------------------------------------------------------------------------\n  // Session Management\n  // ---------------------------------------------------------------------------\n\n  async createSession(options: {\n    principalId: string;\n    ip?: string;\n    userAgent?: string;\n    data?: Record<string, unknown>;\n  }): Promise<ApiSession> {\n    const session: ApiSession = {\n      id: randomBytes(32).toString(\"hex\"),\n      principalId: options.principalId,\n      createdAt: Date.now(),\n      expiresAt: Date.now() + (this.config.sessionConfig?.ttlSeconds ?? 3600) * 1000,\n      lastActivityAt: Date.now(),\n      ip: options.ip,\n      userAgent: options.userAgent,\n      data: options.data ?? {},\n    };\n\n    await this.storage.saveSession(session);\n    this.emit(\"sessionCreated\", session);\n    return session;\n  }\n\n  async getSession(sessionId: string): Promise<ApiSession | null> {\n    const session = await this.storage.getSession(sessionId);\n    if (!session) return null;\n\n    if (session.expiresAt < Date.now()) {\n      this.emit(\"sessionExpired\", sessionId);\n      await this.storage.deleteSession(sessionId);\n      return null;\n    }\n\n    // Renew session if configured\n    if (this.config.sessionConfig?.renewOnActivity) {\n      session.lastActivityAt = Date.now();\n      session.expiresAt = Date.now() + (this.config.sessionConfig.ttlSeconds ?? 3600) * 1000;\n      await this.storage.saveSession(session);\n    }\n\n    return session;\n  }\n\n  async destroySession(sessionId: string): Promise<boolean> {\n    const session = await this.storage.getSession(sessionId);\n    if (!session) return false;\n\n    await this.storage.deleteSession(sessionId);\n    this.emit(\"sessionDestroyed\", sessionId);\n    return true;\n  }\n\n  async destroyAllSessions(principalId: string): Promise<void> {\n    await this.storage.deleteSessionsByPrincipal(principalId);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Audit\n  // ---------------------------------------------------------------------------\n\n  private async logAudit(\n    method: AuthMethod,\n    success: boolean,\n    result: ApiAuthResult,\n    request: ApiAuthRequest\n  ): Promise<void> {\n    if (!this.config.audit?.enabled) return;\n    if (success && !this.config.audit.logSuccessful) return;\n    if (!success && !this.config.audit.logFailed) return;\n\n    const entry: ApiAuthAuditEntry = {\n      id: randomBytes(16).toString(\"hex\"),\n      timestamp: Date.now(),\n      method,\n      success,\n      principalId: result.principal?.id,\n      ip: request.ip,\n      userAgent: request.userAgent,\n      path: request.path,\n      errorCode: result.error?.code,\n      errorMessage: result.error?.message,\n    };\n\n    this.auditLog.push(entry);\n    this.emit(\"auditLogged\", entry);\n\n    // Keep audit log bounded\n    if (this.auditLog.length > 10000) {\n      this.auditLog = this.auditLog.slice(-5000);\n    }\n  }\n\n  getAuditLog(options?: {\n    limit?: number;\n    offset?: number;\n    method?: AuthMethod;\n    success?: boolean;\n    principalId?: string;\n    since?: number;\n  }): ApiAuthAuditEntry[] {\n    let entries = [...this.auditLog];\n\n    if (options?.method) {\n      entries = entries.filter(e => e.method === options.method);\n    }\n    if (options?.success !== undefined) {\n      entries = entries.filter(e => e.success === options.success);\n    }\n    if (options?.principalId) {\n      entries = entries.filter(e => e.principalId === options.principalId);\n    }\n    if (options?.since) {\n      entries = entries.filter(e => e.timestamp >= options.since!);\n    }\n\n    // Sort by timestamp descending\n    entries.sort((a, b) => b.timestamp - a.timestamp);\n\n    // Apply pagination\n    const offset = options?.offset ?? 0;\n    const limit = options?.limit ?? 100;\n    return entries.slice(offset, offset + limit);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Credential Management\n  // ---------------------------------------------------------------------------\n\n  async createCredentials(options: {\n    username: string;\n    password: string;\n    scopes?: string[];\n  }): Promise<void> {\n    const basicConfig = this.config.methods.find(m => m.method === \"basic\") as\n      | (ApiAuthConfig & { method: \"basic\" })\n      | undefined;\n\n    const hashAlgorithm = basicConfig?.hashAlgorithm ?? \"bcrypt\";\n    const passwordHash = hashAlgorithm === \"none\"\n      ? options.password\n      : createHash(\"sha256\").update(options.password).digest(\"hex\");\n\n    await this.storage.saveCredentials({\n      id: randomBytes(16).toString(\"hex\"),\n      username: options.username,\n      passwordHash,\n      scopes: options.scopes ?? [],\n      enabled: true,\n      createdAt: Date.now(),\n    });\n  }\n\n  async deleteCredentials(username: string): Promise<void> {\n    await this.storage.deleteCredentials(username);\n  }\n}\n\n// =============================================================================\n// Factory Functions\n// =============================================================================\n\nlet defaultManager: ApiAuthManager | null = null;\n\nexport function getApiAuthManager(): ApiAuthManager {\n  if (!defaultManager) {\n    throw new Error(\"API Auth Manager not initialized. Call createApiAuthManager first.\");\n  }\n  return defaultManager;\n}\n\nexport function createApiAuthManager(\n  config: Partial<ApiAuthManagerConfig> & { methods: ApiAuthConfig[] },\n  storage?: ApiAuthStorage\n): ApiAuthManager {\n  const manager = new ApiAuthManager(config, storage);\n  if (!defaultManager) {\n    defaultManager = manager;\n  }\n  return manager;\n}\n","/**\n * Security Headers Types\n * Phase 13D: Security Headers\n */\n\nimport { z } from \"zod\";\n\n// =============================================================================\n// Content Security Policy (CSP)\n// =============================================================================\n\nexport const CSPDirectiveSchema = z.enum([\n  \"default-src\",\n  \"script-src\",\n  \"style-src\",\n  \"img-src\",\n  \"font-src\",\n  \"connect-src\",\n  \"media-src\",\n  \"object-src\",\n  \"frame-src\",\n  \"child-src\",\n  \"worker-src\",\n  \"manifest-src\",\n  \"base-uri\",\n  \"form-action\",\n  \"frame-ancestors\",\n  \"navigate-to\",\n  \"report-uri\",\n  \"report-to\",\n  \"upgrade-insecure-requests\",\n  \"block-all-mixed-content\",\n]);\nexport type CSPDirective = z.infer<typeof CSPDirectiveSchema>;\n\nexport const CSPSourceSchema = z.enum([\n  \"'self'\",\n  \"'unsafe-inline'\",\n  \"'unsafe-eval'\",\n  \"'unsafe-hashes'\",\n  \"'strict-dynamic'\",\n  \"'none'\",\n  \"data:\",\n  \"blob:\",\n  \"https:\",\n  \"http:\",\n  \"wss:\",\n  \"ws:\",\n]);\nexport type CSPSource = z.infer<typeof CSPSourceSchema>;\n\nexport const CSPConfigSchema = z.object({\n  directives: z.record(\n    CSPDirectiveSchema,\n    z.array(z.string())\n  ),\n  reportOnly: z.boolean().default(false),\n  reportUri: z.string().optional(),\n  reportTo: z.string().optional(),\n  nonce: z.boolean().default(false).describe(\"Generate nonces for scripts/styles\"),\n});\nexport type CSPConfig = z.infer<typeof CSPConfigSchema>;\n\n// =============================================================================\n// Cross-Origin Resource Sharing (CORS)\n// =============================================================================\n\nexport const CORSConfigSchema = z.object({\n  enabled: z.boolean().default(true),\n  origins: z.union([\n    z.literal(\"*\"),\n    z.array(z.string()),\n  ]).default(\"*\"),\n  methods: z.array(z.enum([\n    \"GET\", \"POST\", \"PUT\", \"PATCH\", \"DELETE\", \"OPTIONS\", \"HEAD\",\n  ])).default([\"GET\", \"POST\", \"PUT\", \"PATCH\", \"DELETE\"]),\n  allowedHeaders: z.array(z.string()).default([\n    \"Content-Type\", \"Authorization\", \"X-Requested-With\",\n  ]),\n  exposedHeaders: z.array(z.string()).default([]),\n  credentials: z.boolean().default(false),\n  maxAge: z.number().default(86400).describe(\"Preflight cache in seconds\"),\n  preflightContinue: z.boolean().default(false),\n  optionsSuccessStatus: z.number().default(204),\n});\nexport type CORSConfig = z.infer<typeof CORSConfigSchema>;\n\n// =============================================================================\n// HTTP Strict Transport Security (HSTS)\n// =============================================================================\n\nexport const HSTSConfigSchema = z.object({\n  enabled: z.boolean().default(true),\n  maxAge: z.number().default(31536000).describe(\"Max age in seconds (1 year default)\"),\n  includeSubDomains: z.boolean().default(true),\n  preload: z.boolean().default(false).describe(\"Submit to HSTS preload list\"),\n});\nexport type HSTSConfig = z.infer<typeof HSTSConfigSchema>;\n\n// =============================================================================\n// X-Frame-Options\n// =============================================================================\n\nexport const FrameOptionsSchema = z.enum([\"DENY\", \"SAMEORIGIN\"]);\nexport type FrameOptions = z.infer<typeof FrameOptionsSchema>;\n\nexport const FrameOptionsConfigSchema = z.object({\n  enabled: z.boolean().default(true),\n  value: FrameOptionsSchema.default(\"DENY\"),\n});\nexport type FrameOptionsConfig = z.infer<typeof FrameOptionsConfigSchema>;\n\n// =============================================================================\n// X-Content-Type-Options\n// =============================================================================\n\nexport const ContentTypeOptionsConfigSchema = z.object({\n  enabled: z.boolean().default(true),\n  nosniff: z.boolean().default(true),\n});\nexport type ContentTypeOptionsConfig = z.infer<typeof ContentTypeOptionsConfigSchema>;\n\n// =============================================================================\n// Referrer Policy\n// =============================================================================\n\nexport const ReferrerPolicySchema = z.enum([\n  \"no-referrer\",\n  \"no-referrer-when-downgrade\",\n  \"origin\",\n  \"origin-when-cross-origin\",\n  \"same-origin\",\n  \"strict-origin\",\n  \"strict-origin-when-cross-origin\",\n  \"unsafe-url\",\n]);\nexport type ReferrerPolicy = z.infer<typeof ReferrerPolicySchema>;\n\nexport const ReferrerPolicyConfigSchema = z.object({\n  enabled: z.boolean().default(true),\n  policy: ReferrerPolicySchema.default(\"strict-origin-when-cross-origin\"),\n});\nexport type ReferrerPolicyConfig = z.infer<typeof ReferrerPolicyConfigSchema>;\n\n// =============================================================================\n// Permissions Policy (Feature Policy)\n// =============================================================================\n\nexport const PermissionsPolicyFeatureSchema = z.enum([\n  \"accelerometer\",\n  \"ambient-light-sensor\",\n  \"autoplay\",\n  \"battery\",\n  \"camera\",\n  \"display-capture\",\n  \"document-domain\",\n  \"encrypted-media\",\n  \"fullscreen\",\n  \"geolocation\",\n  \"gyroscope\",\n  \"magnetometer\",\n  \"microphone\",\n  \"midi\",\n  \"payment\",\n  \"picture-in-picture\",\n  \"publickey-credentials-get\",\n  \"screen-wake-lock\",\n  \"usb\",\n  \"web-share\",\n  \"xr-spatial-tracking\",\n]);\nexport type PermissionsPolicyFeature = z.infer<typeof PermissionsPolicyFeatureSchema>;\n\nexport const PermissionsPolicyConfigSchema = z.object({\n  enabled: z.boolean().default(true),\n  features: z.record(\n    PermissionsPolicyFeatureSchema,\n    z.union([\n      z.literal(\"*\"),\n      z.literal(\"self\"),\n      z.literal(\"none\"),\n      z.array(z.string()),\n    ])\n  ).default({}),\n});\nexport type PermissionsPolicyConfig = z.infer<typeof PermissionsPolicyConfigSchema>;\n\n// =============================================================================\n// Cross-Origin Policies\n// =============================================================================\n\nexport const CrossOriginOpenerPolicySchema = z.enum([\n  \"unsafe-none\",\n  \"same-origin-allow-popups\",\n  \"same-origin\",\n]);\nexport type CrossOriginOpenerPolicy = z.infer<typeof CrossOriginOpenerPolicySchema>;\n\nexport const CrossOriginEmbedderPolicySchema = z.enum([\n  \"unsafe-none\",\n  \"require-corp\",\n  \"credentialless\",\n]);\nexport type CrossOriginEmbedderPolicy = z.infer<typeof CrossOriginEmbedderPolicySchema>;\n\nexport const CrossOriginResourcePolicySchema = z.enum([\n  \"same-site\",\n  \"same-origin\",\n  \"cross-origin\",\n]);\nexport type CrossOriginResourcePolicy = z.infer<typeof CrossOriginResourcePolicySchema>;\n\nexport const CrossOriginPoliciesConfigSchema = z.object({\n  opener: z.object({\n    enabled: z.boolean().default(false),\n    policy: CrossOriginOpenerPolicySchema.default(\"same-origin\"),\n  }).optional(),\n  embedder: z.object({\n    enabled: z.boolean().default(false),\n    policy: CrossOriginEmbedderPolicySchema.default(\"require-corp\"),\n  }).optional(),\n  resource: z.object({\n    enabled: z.boolean().default(false),\n    policy: CrossOriginResourcePolicySchema.default(\"same-origin\"),\n  }).optional(),\n});\nexport type CrossOriginPoliciesConfig = z.infer<typeof CrossOriginPoliciesConfigSchema>;\n\n// =============================================================================\n// Cache Control\n// =============================================================================\n\nexport const CacheControlConfigSchema = z.object({\n  enabled: z.boolean().default(true),\n  directives: z.object({\n    public: z.boolean().optional(),\n    private: z.boolean().optional(),\n    noCache: z.boolean().optional(),\n    noStore: z.boolean().optional(),\n    noTransform: z.boolean().optional(),\n    mustRevalidate: z.boolean().optional(),\n    proxyRevalidate: z.boolean().optional(),\n    maxAge: z.number().optional(),\n    sMaxAge: z.number().optional(),\n    immutable: z.boolean().optional(),\n    staleWhileRevalidate: z.number().optional(),\n    staleIfError: z.number().optional(),\n  }).default({}),\n});\nexport type CacheControlConfig = z.infer<typeof CacheControlConfigSchema>;\n\n// =============================================================================\n// Custom Headers\n// =============================================================================\n\nexport const CustomHeaderSchema = z.object({\n  name: z.string(),\n  value: z.string(),\n  override: z.boolean().default(false).describe(\"Override if exists\"),\n});\nexport type CustomHeader = z.infer<typeof CustomHeaderSchema>;\n\n// =============================================================================\n// Remove Headers\n// =============================================================================\n\nexport const RemoveHeadersConfigSchema = z.object({\n  enabled: z.boolean().default(true),\n  headers: z.array(z.string()).default([\n    \"X-Powered-By\",\n    \"Server\",\n    \"X-AspNet-Version\",\n    \"X-AspNetMvc-Version\",\n  ]),\n});\nexport type RemoveHeadersConfig = z.infer<typeof RemoveHeadersConfigSchema>;\n\n// =============================================================================\n// Security Headers Manager Config\n// =============================================================================\n\nexport const SecurityHeadersConfigSchema = z.object({\n  csp: CSPConfigSchema.optional(),\n  cors: CORSConfigSchema.optional(),\n  hsts: HSTSConfigSchema.optional(),\n  frameOptions: FrameOptionsConfigSchema.optional(),\n  contentTypeOptions: ContentTypeOptionsConfigSchema.optional(),\n  referrerPolicy: ReferrerPolicyConfigSchema.optional(),\n  permissionsPolicy: PermissionsPolicyConfigSchema.optional(),\n  crossOriginPolicies: CrossOriginPoliciesConfigSchema.optional(),\n  cacheControl: CacheControlConfigSchema.optional(),\n  customHeaders: z.array(CustomHeaderSchema).default([]),\n  removeHeaders: RemoveHeadersConfigSchema.optional(),\n});\nexport type SecurityHeadersConfig = z.infer<typeof SecurityHeadersConfigSchema>;\n\n// =============================================================================\n// Request/Response Types\n// =============================================================================\n\nexport const SecurityRequestSchema = z.object({\n  method: z.string(),\n  path: z.string(),\n  origin: z.string().optional(),\n  headers: z.record(z.string()),\n});\nexport type SecurityRequest = z.infer<typeof SecurityRequestSchema>;\n\nexport const SecurityResponseSchema = z.object({\n  statusCode: z.number().optional(),\n  headers: z.record(z.string()),\n});\nexport type SecurityResponse = z.infer<typeof SecurityResponseSchema>;\n\n// =============================================================================\n// Events\n// =============================================================================\n\nexport type SecurityHeadersEvents = {\n  // Headers Applied\n  headersApplied: (request: SecurityRequest, headers: Record<string, string>) => void;\n  headerRemoved: (name: string) => void;\n\n  // CORS\n  corsAllowed: (origin: string) => void;\n  corsBlocked: (origin: string) => void;\n  preflightHandled: (origin: string) => void;\n\n  // CSP\n  cspViolation: (report: unknown) => void;\n  nonceGenerated: (nonce: string) => void;\n\n  // Errors\n  error: (error: Error) => void;\n};\n\n// =============================================================================\n// Path Matching\n// =============================================================================\n\nexport const PathConfigSchema = z.object({\n  pattern: z.string().describe(\"Glob pattern or regex\"),\n  config: SecurityHeadersConfigSchema,\n});\nexport type PathConfig = z.infer<typeof PathConfigSchema>;\n\nexport const SecurityManagerConfigSchema = z.object({\n  global: SecurityHeadersConfigSchema.optional(),\n  paths: z.array(PathConfigSchema).default([]),\n  excludePaths: z.array(z.string()).default([]),\n});\nexport type SecurityManagerConfig = z.infer<typeof SecurityManagerConfigSchema>;\n","/**\n * Security Headers Manager\n * Phase 13D: Security Headers\n */\n\nimport { EventEmitter } from \"eventemitter3\";\nimport { randomBytes } from \"crypto\";\nimport {\n  type SecurityManagerConfig,\n  SecurityManagerConfigSchema,\n  type SecurityHeadersConfig,\n  type SecurityRequest,\n  type SecurityResponse,\n  type SecurityHeadersEvents,\n  type CSPConfig,\n  type CORSConfig,\n} from \"./types.js\";\n\n// =============================================================================\n// Security Headers Manager\n// =============================================================================\n\nexport class SecurityHeadersManager extends EventEmitter<SecurityHeadersEvents> {\n  private config: SecurityManagerConfig;\n  private currentNonce: string | null = null;\n\n  constructor(config: Partial<SecurityManagerConfig> = {}) {\n    super();\n    this.config = SecurityManagerConfigSchema.parse(config);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Main Methods\n  // ---------------------------------------------------------------------------\n\n  apply(request: SecurityRequest, response: SecurityResponse = { headers: {} }): SecurityResponse {\n    // Check if path is excluded\n    if (this.isExcluded(request.path)) {\n      return response;\n    }\n\n    // Get effective config (merge global with path-specific)\n    const effectiveConfig = this.getEffectiveConfig(request.path);\n    if (!effectiveConfig) {\n      return response;\n    }\n\n    const headers: Record<string, string> = { ...response.headers };\n\n    // Apply each security header type\n    this.applyCSP(effectiveConfig, headers);\n    this.applyCORS(effectiveConfig, request, headers);\n    this.applyHSTS(effectiveConfig, headers);\n    this.applyFrameOptions(effectiveConfig, headers);\n    this.applyContentTypeOptions(effectiveConfig, headers);\n    this.applyReferrerPolicy(effectiveConfig, headers);\n    this.applyPermissionsPolicy(effectiveConfig, headers);\n    this.applyCrossOriginPolicies(effectiveConfig, headers);\n    this.applyCacheControl(effectiveConfig, headers);\n    this.applyCustomHeaders(effectiveConfig, headers);\n    this.removeHeaders(effectiveConfig, headers);\n\n    this.emit(\"headersApplied\", request, headers);\n\n    return {\n      ...response,\n      headers,\n    };\n  }\n\n  handlePreflight(request: SecurityRequest): SecurityResponse | null {\n    if (request.method !== \"OPTIONS\") {\n      return null;\n    }\n\n    const effectiveConfig = this.getEffectiveConfig(request.path);\n    const corsConfig = effectiveConfig?.cors;\n\n    if (!corsConfig?.enabled) {\n      return null;\n    }\n\n    const headers: Record<string, string> = {};\n    const origin = request.origin ?? request.headers[\"origin\"];\n\n    if (!this.isOriginAllowed(origin, corsConfig)) {\n      this.emit(\"corsBlocked\", origin ?? \"unknown\");\n      return { statusCode: 403, headers: {} };\n    }\n\n    // Set CORS headers\n    if (corsConfig.origins === \"*\") {\n      headers[\"Access-Control-Allow-Origin\"] = \"*\";\n    } else if (origin) {\n      headers[\"Access-Control-Allow-Origin\"] = origin;\n    }\n\n    headers[\"Access-Control-Allow-Methods\"] = corsConfig.methods.join(\", \");\n    headers[\"Access-Control-Allow-Headers\"] = corsConfig.allowedHeaders.join(\", \");\n\n    if (corsConfig.credentials) {\n      headers[\"Access-Control-Allow-Credentials\"] = \"true\";\n    }\n\n    if (corsConfig.maxAge) {\n      headers[\"Access-Control-Max-Age\"] = String(corsConfig.maxAge);\n    }\n\n    this.emit(\"preflightHandled\", origin ?? \"unknown\");\n\n    return {\n      statusCode: corsConfig.optionsSuccessStatus,\n      headers,\n    };\n  }\n\n  // ---------------------------------------------------------------------------\n  // Nonce Management\n  // ---------------------------------------------------------------------------\n\n  generateNonce(): string {\n    this.currentNonce = randomBytes(16).toString(\"base64\");\n    this.emit(\"nonceGenerated\", this.currentNonce);\n    return this.currentNonce;\n  }\n\n  getNonce(): string | null {\n    return this.currentNonce;\n  }\n\n  // ---------------------------------------------------------------------------\n  // CSP Report Handler\n  // ---------------------------------------------------------------------------\n\n  handleCSPReport(report: unknown): void {\n    this.emit(\"cspViolation\", report);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Config Methods\n  // ---------------------------------------------------------------------------\n\n  getConfig(): SecurityManagerConfig {\n    return { ...this.config };\n  }\n\n  updateConfig(config: Partial<SecurityManagerConfig>): void {\n    this.config = SecurityManagerConfigSchema.parse({\n      ...this.config,\n      ...config,\n    });\n  }\n\n  // ---------------------------------------------------------------------------\n  // Private Helpers\n  // ---------------------------------------------------------------------------\n\n  private isExcluded(path: string): boolean {\n    return this.config.excludePaths.some(pattern => {\n      const regex = this.patternToRegex(pattern);\n      return regex.test(path);\n    });\n  }\n\n  private getEffectiveConfig(path: string): SecurityHeadersConfig | null {\n    // Start with global config\n    let effective: SecurityHeadersConfig = { ...(this.config.global ?? {}) };\n\n    // Apply path-specific configs (later ones override earlier)\n    for (const pathConfig of this.config.paths) {\n      const regex = this.patternToRegex(pathConfig.pattern);\n      if (regex.test(path)) {\n        effective = this.mergeConfigs(effective, pathConfig.config);\n      }\n    }\n\n    return effective;\n  }\n\n  private mergeConfigs(\n    base: SecurityHeadersConfig,\n    override: SecurityHeadersConfig\n  ): SecurityHeadersConfig {\n    return {\n      ...base,\n      ...override,\n      customHeaders: [\n        ...(base.customHeaders ?? []),\n        ...(override.customHeaders ?? []),\n      ],\n    };\n  }\n\n  private patternToRegex(pattern: string): RegExp {\n    // Simple glob to regex conversion\n    const regex = pattern\n      .replace(/\\*/g, \".*\")\n      .replace(/\\?/g, \".\");\n    return new RegExp(`^${regex}$`);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Header Application\n  // ---------------------------------------------------------------------------\n\n  private applyCSP(config: SecurityHeadersConfig, headers: Record<string, string>): void {\n    if (!config.csp) return;\n\n    const csp = config.csp;\n    const directives: string[] = [];\n\n    for (const [directive, sources] of Object.entries(csp.directives)) {\n      let sourceList = [...sources];\n\n      // Add nonce if enabled\n      if (csp.nonce && this.currentNonce) {\n        if (directive === \"script-src\" || directive === \"style-src\") {\n          sourceList.push(`'nonce-${this.currentNonce}'`);\n        }\n      }\n\n      directives.push(`${directive} ${sourceList.join(\" \")}`);\n    }\n\n    if (csp.reportUri) {\n      directives.push(`report-uri ${csp.reportUri}`);\n    }\n\n    if (csp.reportTo) {\n      directives.push(`report-to ${csp.reportTo}`);\n    }\n\n    const headerName = csp.reportOnly\n      ? \"Content-Security-Policy-Report-Only\"\n      : \"Content-Security-Policy\";\n\n    headers[headerName] = directives.join(\"; \");\n  }\n\n  private applyCORS(\n    config: SecurityHeadersConfig,\n    request: SecurityRequest,\n    headers: Record<string, string>\n  ): void {\n    if (!config.cors?.enabled) return;\n\n    const cors = config.cors;\n    const origin = request.origin ?? request.headers[\"origin\"];\n\n    if (!this.isOriginAllowed(origin, cors)) {\n      if (origin) {\n        this.emit(\"corsBlocked\", origin);\n      }\n      return;\n    }\n\n    // Set origin header\n    if (cors.origins === \"*\") {\n      headers[\"Access-Control-Allow-Origin\"] = \"*\";\n    } else if (origin) {\n      headers[\"Access-Control-Allow-Origin\"] = origin;\n      headers[\"Vary\"] = \"Origin\";\n    }\n\n    // Expose headers\n    if (cors.exposedHeaders.length > 0) {\n      headers[\"Access-Control-Expose-Headers\"] = cors.exposedHeaders.join(\", \");\n    }\n\n    // Credentials\n    if (cors.credentials) {\n      headers[\"Access-Control-Allow-Credentials\"] = \"true\";\n    }\n\n    if (origin) {\n      this.emit(\"corsAllowed\", origin);\n    }\n  }\n\n  private isOriginAllowed(origin: string | undefined, cors: CORSConfig): boolean {\n    if (!origin) return true; // Same-origin request\n    if (cors.origins === \"*\") return true;\n\n    return (cors.origins as string[]).some(allowed => {\n      if (allowed === origin) return true;\n      // Support wildcards in origin patterns\n      const regex = new RegExp(`^${allowed.replace(/\\*/g, \".*\")}$`);\n      return regex.test(origin);\n    });\n  }\n\n  private applyHSTS(config: SecurityHeadersConfig, headers: Record<string, string>): void {\n    if (!config.hsts?.enabled) return;\n\n    const hsts = config.hsts;\n    let value = `max-age=${hsts.maxAge}`;\n\n    if (hsts.includeSubDomains) {\n      value += \"; includeSubDomains\";\n    }\n\n    if (hsts.preload) {\n      value += \"; preload\";\n    }\n\n    headers[\"Strict-Transport-Security\"] = value;\n  }\n\n  private applyFrameOptions(config: SecurityHeadersConfig, headers: Record<string, string>): void {\n    if (!config.frameOptions?.enabled) return;\n    headers[\"X-Frame-Options\"] = config.frameOptions.value;\n  }\n\n  private applyContentTypeOptions(config: SecurityHeadersConfig, headers: Record<string, string>): void {\n    if (!config.contentTypeOptions?.enabled) return;\n    if (config.contentTypeOptions.nosniff) {\n      headers[\"X-Content-Type-Options\"] = \"nosniff\";\n    }\n  }\n\n  private applyReferrerPolicy(config: SecurityHeadersConfig, headers: Record<string, string>): void {\n    if (!config.referrerPolicy?.enabled) return;\n    headers[\"Referrer-Policy\"] = config.referrerPolicy.policy;\n  }\n\n  private applyPermissionsPolicy(config: SecurityHeadersConfig, headers: Record<string, string>): void {\n    if (!config.permissionsPolicy?.enabled) return;\n\n    const features = config.permissionsPolicy.features;\n    const policies: string[] = [];\n\n    for (const [feature, value] of Object.entries(features)) {\n      if (value === \"none\") {\n        policies.push(`${feature}=()`);\n      } else if (value === \"self\") {\n        policies.push(`${feature}=(self)`);\n      } else if (value === \"*\") {\n        policies.push(`${feature}=*`);\n      } else if (Array.isArray(value)) {\n        policies.push(`${feature}=(${value.join(\" \")})`);\n      }\n    }\n\n    if (policies.length > 0) {\n      headers[\"Permissions-Policy\"] = policies.join(\", \");\n    }\n  }\n\n  private applyCrossOriginPolicies(config: SecurityHeadersConfig, headers: Record<string, string>): void {\n    const policies = config.crossOriginPolicies;\n    if (!policies) return;\n\n    if (policies.opener?.enabled) {\n      headers[\"Cross-Origin-Opener-Policy\"] = policies.opener.policy;\n    }\n\n    if (policies.embedder?.enabled) {\n      headers[\"Cross-Origin-Embedder-Policy\"] = policies.embedder.policy;\n    }\n\n    if (policies.resource?.enabled) {\n      headers[\"Cross-Origin-Resource-Policy\"] = policies.resource.policy;\n    }\n  }\n\n  private applyCacheControl(config: SecurityHeadersConfig, headers: Record<string, string>): void {\n    if (!config.cacheControl?.enabled) return;\n\n    const directives = config.cacheControl.directives;\n    const parts: string[] = [];\n\n    if (directives.public) parts.push(\"public\");\n    if (directives.private) parts.push(\"private\");\n    if (directives.noCache) parts.push(\"no-cache\");\n    if (directives.noStore) parts.push(\"no-store\");\n    if (directives.noTransform) parts.push(\"no-transform\");\n    if (directives.mustRevalidate) parts.push(\"must-revalidate\");\n    if (directives.proxyRevalidate) parts.push(\"proxy-revalidate\");\n    if (directives.maxAge !== undefined) parts.push(`max-age=${directives.maxAge}`);\n    if (directives.sMaxAge !== undefined) parts.push(`s-maxage=${directives.sMaxAge}`);\n    if (directives.immutable) parts.push(\"immutable\");\n    if (directives.staleWhileRevalidate !== undefined) {\n      parts.push(`stale-while-revalidate=${directives.staleWhileRevalidate}`);\n    }\n    if (directives.staleIfError !== undefined) {\n      parts.push(`stale-if-error=${directives.staleIfError}`);\n    }\n\n    if (parts.length > 0) {\n      headers[\"Cache-Control\"] = parts.join(\", \");\n    }\n  }\n\n  private applyCustomHeaders(config: SecurityHeadersConfig, headers: Record<string, string>): void {\n    for (const custom of config.customHeaders ?? []) {\n      if (custom.override || !(custom.name in headers)) {\n        headers[custom.name] = custom.value;\n      }\n    }\n  }\n\n  private removeHeaders(config: SecurityHeadersConfig, headers: Record<string, string>): void {\n    if (!config.removeHeaders?.enabled) return;\n\n    for (const name of config.removeHeaders.headers) {\n      if (name in headers) {\n        delete headers[name];\n        this.emit(\"headerRemoved\", name);\n      }\n      // Also check lowercase\n      const lower = name.toLowerCase();\n      for (const key of Object.keys(headers)) {\n        if (key.toLowerCase() === lower) {\n          delete headers[key];\n          this.emit(\"headerRemoved\", key);\n        }\n      }\n    }\n  }\n}\n\n// =============================================================================\n// Factory Functions\n// =============================================================================\n\nlet defaultManager: SecurityHeadersManager | null = null;\n\nexport function getSecurityHeadersManager(): SecurityHeadersManager {\n  if (!defaultManager) {\n    defaultManager = new SecurityHeadersManager();\n  }\n  return defaultManager;\n}\n\nexport function createSecurityHeadersManager(\n  config: Partial<SecurityManagerConfig> = {}\n): SecurityHeadersManager {\n  const manager = new SecurityHeadersManager(config);\n  if (!defaultManager) {\n    defaultManager = manager;\n  }\n  return manager;\n}\n\n// =============================================================================\n// Presets\n// =============================================================================\n\nexport const SECURITY_PRESETS = {\n  // Strict preset for APIs\n  strict: {\n    global: {\n      hsts: {\n        enabled: true,\n        maxAge: 31536000,\n        includeSubDomains: true,\n        preload: true,\n      },\n      frameOptions: {\n        enabled: true,\n        value: \"DENY\" as const,\n      },\n      contentTypeOptions: {\n        enabled: true,\n        nosniff: true,\n      },\n      referrerPolicy: {\n        enabled: true,\n        policy: \"no-referrer\" as const,\n      },\n      cors: {\n        enabled: true,\n        origins: [] as string[],\n        methods: [\"GET\" as const, \"POST\" as const, \"PUT\" as const, \"DELETE\" as const],\n        allowedHeaders: [\"Content-Type\", \"Authorization\"],\n        credentials: false,\n        maxAge: 86400,\n        preflightContinue: false,\n        optionsSuccessStatus: 204,\n        exposedHeaders: [],\n      },\n      removeHeaders: {\n        enabled: true,\n        headers: [\"X-Powered-By\", \"Server\"],\n      },\n      cacheControl: {\n        enabled: true,\n        directives: {\n          noStore: true,\n          noCache: true,\n          mustRevalidate: true,\n          private: true,\n        },\n      },\n    },\n  },\n\n  // Relaxed preset for development\n  development: {\n    global: {\n      cors: {\n        enabled: true,\n        origins: \"*\" as const,\n        methods: [\"GET\" as const, \"POST\" as const, \"PUT\" as const, \"PATCH\" as const, \"DELETE\" as const, \"OPTIONS\" as const, \"HEAD\" as const],\n        allowedHeaders: [\"*\"],\n        credentials: true,\n        maxAge: 0,\n        preflightContinue: false,\n        optionsSuccessStatus: 204,\n        exposedHeaders: [],\n      },\n      hsts: {\n        enabled: false,\n        maxAge: 0,\n        includeSubDomains: false,\n        preload: false,\n      },\n    },\n  },\n\n  // Standard preset for production web apps\n  standard: {\n    global: {\n      hsts: {\n        enabled: true,\n        maxAge: 31536000,\n        includeSubDomains: true,\n        preload: false,\n      },\n      frameOptions: {\n        enabled: true,\n        value: \"SAMEORIGIN\" as const,\n      },\n      contentTypeOptions: {\n        enabled: true,\n        nosniff: true,\n      },\n      referrerPolicy: {\n        enabled: true,\n        policy: \"strict-origin-when-cross-origin\" as const,\n      },\n      permissionsPolicy: {\n        enabled: true,\n        features: {\n          geolocation: \"none\" as const,\n          microphone: \"none\" as const,\n          camera: \"none\" as const,\n        },\n      },\n      removeHeaders: {\n        enabled: true,\n        headers: [\"X-Powered-By\", \"Server\"],\n      },\n    },\n  },\n} as const;\n\n// =============================================================================\n// CSP Builder\n// =============================================================================\n\nexport class CSPBuilder {\n  private directives: Record<string, string[]> = {};\n  private reportOnly = false;\n  private reportUri?: string;\n  private reportTo?: string;\n  private useNonce = false;\n\n  defaultSrc(...sources: string[]): this {\n    this.directives[\"default-src\"] = sources;\n    return this;\n  }\n\n  scriptSrc(...sources: string[]): this {\n    this.directives[\"script-src\"] = sources;\n    return this;\n  }\n\n  styleSrc(...sources: string[]): this {\n    this.directives[\"style-src\"] = sources;\n    return this;\n  }\n\n  imgSrc(...sources: string[]): this {\n    this.directives[\"img-src\"] = sources;\n    return this;\n  }\n\n  fontSrc(...sources: string[]): this {\n    this.directives[\"font-src\"] = sources;\n    return this;\n  }\n\n  connectSrc(...sources: string[]): this {\n    this.directives[\"connect-src\"] = sources;\n    return this;\n  }\n\n  frameSrc(...sources: string[]): this {\n    this.directives[\"frame-src\"] = sources;\n    return this;\n  }\n\n  frameAncestors(...sources: string[]): this {\n    this.directives[\"frame-ancestors\"] = sources;\n    return this;\n  }\n\n  formAction(...sources: string[]): this {\n    this.directives[\"form-action\"] = sources;\n    return this;\n  }\n\n  baseUri(...sources: string[]): this {\n    this.directives[\"base-uri\"] = sources;\n    return this;\n  }\n\n  objectSrc(...sources: string[]): this {\n    this.directives[\"object-src\"] = sources;\n    return this;\n  }\n\n  workerSrc(...sources: string[]): this {\n    this.directives[\"worker-src\"] = sources;\n    return this;\n  }\n\n  upgradeInsecureRequests(): this {\n    this.directives[\"upgrade-insecure-requests\"] = [];\n    return this;\n  }\n\n  blockAllMixedContent(): this {\n    this.directives[\"block-all-mixed-content\"] = [];\n    return this;\n  }\n\n  withNonce(): this {\n    this.useNonce = true;\n    return this;\n  }\n\n  withReportUri(uri: string): this {\n    this.reportUri = uri;\n    return this;\n  }\n\n  withReportTo(endpoint: string): this {\n    this.reportTo = endpoint;\n    return this;\n  }\n\n  reportOnlyMode(): this {\n    this.reportOnly = true;\n    return this;\n  }\n\n  build(): CSPConfig {\n    return {\n      directives: this.directives as CSPConfig[\"directives\"],\n      reportOnly: this.reportOnly,\n      reportUri: this.reportUri,\n      reportTo: this.reportTo,\n      nonce: this.useNonce,\n    };\n  }\n}\n\nexport function csp(): CSPBuilder {\n  return new CSPBuilder();\n}\n","/**\n * OpenTelemetry Types\n * Phase 14A: OpenTelemetry Integration\n */\n\nimport { z } from \"zod\";\n\n// =============================================================================\n// Trace Context\n// =============================================================================\n\nexport const TraceIdSchema = z.string().regex(/^[a-f0-9]{32}$/);\nexport type TraceId = z.infer<typeof TraceIdSchema>;\n\nexport const SpanIdSchema = z.string().regex(/^[a-f0-9]{16}$/);\nexport type SpanId = z.infer<typeof SpanIdSchema>;\n\nexport const TraceFlagsSchema = z.number().int().min(0).max(255);\nexport type TraceFlags = z.infer<typeof TraceFlagsSchema>;\n\nexport const TraceContextSchema = z.object({\n  traceId: TraceIdSchema,\n  spanId: SpanIdSchema,\n  traceFlags: TraceFlagsSchema.default(1), // 0 = not sampled, 1 = sampled\n  traceState: z.string().optional(),\n});\nexport type TraceContext = z.infer<typeof TraceContextSchema>;\n\n// =============================================================================\n// Span Status\n// =============================================================================\n\nexport const SpanStatusCodeSchema = z.enum([\"UNSET\", \"OK\", \"ERROR\"]);\nexport type SpanStatusCode = z.infer<typeof SpanStatusCodeSchema>;\n\nexport const SpanStatusSchema = z.object({\n  code: SpanStatusCodeSchema,\n  message: z.string().optional(),\n});\nexport type SpanStatus = z.infer<typeof SpanStatusSchema>;\n\n// =============================================================================\n// Span Kind\n// =============================================================================\n\nexport const SpanKindSchema = z.enum([\n  \"INTERNAL\",\n  \"SERVER\",\n  \"CLIENT\",\n  \"PRODUCER\",\n  \"CONSUMER\",\n]);\nexport type SpanKind = z.infer<typeof SpanKindSchema>;\n\n// =============================================================================\n// Attributes\n// =============================================================================\n\nexport const AttributeValueSchema = z.union([\n  z.string(),\n  z.number(),\n  z.boolean(),\n  z.array(z.string()),\n  z.array(z.number()),\n  z.array(z.boolean()),\n]);\nexport type AttributeValue = z.infer<typeof AttributeValueSchema>;\n\nexport const AttributesSchema = z.record(AttributeValueSchema);\nexport type Attributes = z.infer<typeof AttributesSchema>;\n\n// =============================================================================\n// Span Event\n// =============================================================================\n\nexport const SpanEventSchema = z.object({\n  name: z.string(),\n  timestamp: z.number(),\n  attributes: AttributesSchema.optional(),\n});\nexport type SpanEvent = z.infer<typeof SpanEventSchema>;\n\n// =============================================================================\n// Span Link\n// =============================================================================\n\nexport const SpanLinkSchema = z.object({\n  context: TraceContextSchema,\n  attributes: AttributesSchema.optional(),\n});\nexport type SpanLink = z.infer<typeof SpanLinkSchema>;\n\n// =============================================================================\n// Span\n// =============================================================================\n\nexport const SpanSchema = z.object({\n  traceId: TraceIdSchema,\n  spanId: SpanIdSchema,\n  parentSpanId: SpanIdSchema.optional(),\n  name: z.string(),\n  kind: SpanKindSchema.default(\"INTERNAL\"),\n  startTime: z.number(),\n  endTime: z.number().optional(),\n  status: SpanStatusSchema.optional(),\n  attributes: AttributesSchema.default({}),\n  events: z.array(SpanEventSchema).default([]),\n  links: z.array(SpanLinkSchema).default([]),\n  droppedAttributesCount: z.number().default(0),\n  droppedEventsCount: z.number().default(0),\n  droppedLinksCount: z.number().default(0),\n});\nexport type Span = z.infer<typeof SpanSchema>;\n\n// =============================================================================\n// Resource\n// =============================================================================\n\nexport const ResourceSchema = z.object({\n  attributes: AttributesSchema.default({}),\n  schemaUrl: z.string().optional(),\n});\nexport type Resource = z.infer<typeof ResourceSchema>;\n\n// =============================================================================\n// Instrumentation Scope\n// =============================================================================\n\nexport const InstrumentationScopeSchema = z.object({\n  name: z.string(),\n  version: z.string().optional(),\n  schemaUrl: z.string().optional(),\n  attributes: AttributesSchema.optional(),\n});\nexport type InstrumentationScope = z.infer<typeof InstrumentationScopeSchema>;\n\n// =============================================================================\n// Sampler\n// =============================================================================\n\nexport const SamplerTypeSchema = z.enum([\n  \"always_on\",\n  \"always_off\",\n  \"trace_id_ratio\",\n  \"parent_based\",\n]);\nexport type SamplerType = z.infer<typeof SamplerTypeSchema>;\n\nexport const SamplerConfigSchema = z.object({\n  type: SamplerTypeSchema,\n  ratio: z.number().min(0).max(1).optional(),\n  root: SamplerTypeSchema.optional(),\n  remoteParentSampled: SamplerTypeSchema.optional(),\n  remoteParentNotSampled: SamplerTypeSchema.optional(),\n  localParentSampled: SamplerTypeSchema.optional(),\n  localParentNotSampled: SamplerTypeSchema.optional(),\n});\nexport type SamplerConfig = z.infer<typeof SamplerConfigSchema>;\n\n// =============================================================================\n// Exporter\n// =============================================================================\n\nexport const ExporterTypeSchema = z.enum([\n  \"console\",\n  \"otlp_http\",\n  \"otlp_grpc\",\n  \"zipkin\",\n  \"jaeger\",\n  \"memory\",\n]);\nexport type ExporterType = z.infer<typeof ExporterTypeSchema>;\n\nexport const ExporterConfigSchema = z.object({\n  type: ExporterTypeSchema,\n  endpoint: z.string().optional(),\n  headers: z.record(z.string()).optional(),\n  compression: z.enum([\"none\", \"gzip\"]).optional(),\n  timeout: z.number().optional(),\n  concurrencyLimit: z.number().optional(),\n});\nexport type ExporterConfig = z.infer<typeof ExporterConfigSchema>;\n\n// =============================================================================\n// Processor\n// =============================================================================\n\nexport const ProcessorTypeSchema = z.enum([\n  \"simple\",\n  \"batch\",\n]);\nexport type ProcessorType = z.infer<typeof ProcessorTypeSchema>;\n\nexport const BatchProcessorConfigSchema = z.object({\n  maxQueueSize: z.number().default(2048),\n  maxExportBatchSize: z.number().default(512),\n  scheduledDelayMs: z.number().default(5000),\n  exportTimeoutMs: z.number().default(30000),\n});\nexport type BatchProcessorConfig = z.infer<typeof BatchProcessorConfigSchema>;\n\n// =============================================================================\n// Propagator\n// =============================================================================\n\nexport const PropagatorTypeSchema = z.enum([\n  \"w3c_trace_context\",\n  \"w3c_baggage\",\n  \"b3\",\n  \"b3_multi\",\n  \"jaeger\",\n  \"xray\",\n]);\nexport type PropagatorType = z.infer<typeof PropagatorTypeSchema>;\n\n// =============================================================================\n// Tracer Config\n// =============================================================================\n\nexport const TracerConfigSchema = z.object({\n  serviceName: z.string(),\n  serviceVersion: z.string().optional(),\n  environment: z.string().optional(),\n  resource: ResourceSchema.optional(),\n  sampler: SamplerConfigSchema.optional(),\n  exporter: ExporterConfigSchema.optional(),\n  processor: z.object({\n    type: ProcessorTypeSchema.default(\"batch\"),\n    batch: BatchProcessorConfigSchema.optional(),\n  }).optional(),\n  propagators: z.array(PropagatorTypeSchema).default([\"w3c_trace_context\", \"w3c_baggage\"]),\n  spanLimits: z.object({\n    maxAttributeCount: z.number().default(128),\n    maxEventCount: z.number().default(128),\n    maxLinkCount: z.number().default(128),\n    maxAttributeValueLength: z.number().default(12000),\n  }).optional(),\n  instrumentations: z.object({\n    http: z.boolean().default(true),\n    grpc: z.boolean().default(true),\n    database: z.boolean().default(true),\n  }).optional(),\n});\nexport type TracerConfig = z.infer<typeof TracerConfigSchema>;\n\n// =============================================================================\n// Baggage\n// =============================================================================\n\nexport const BaggageEntrySchema = z.object({\n  value: z.string(),\n  metadata: z.string().optional(),\n});\nexport type BaggageEntry = z.infer<typeof BaggageEntrySchema>;\n\nexport const BaggageSchema = z.record(BaggageEntrySchema);\nexport type Baggage = z.infer<typeof BaggageSchema>;\n\n// =============================================================================\n// Context Carrier\n// =============================================================================\n\nexport const ContextCarrierSchema = z.record(z.string());\nexport type ContextCarrier = z.infer<typeof ContextCarrierSchema>;\n\n// =============================================================================\n// Span Options\n// =============================================================================\n\nexport const SpanOptionsSchema = z.object({\n  kind: SpanKindSchema.optional(),\n  attributes: AttributesSchema.optional(),\n  links: z.array(SpanLinkSchema).optional(),\n  startTime: z.number().optional(),\n  root: z.boolean().optional().describe(\"Force a new trace\"),\n});\nexport type SpanOptions = z.infer<typeof SpanOptionsSchema>;\n\n// =============================================================================\n// Events\n// =============================================================================\n\nexport type TelemetryEvents = {\n  // Span Lifecycle\n  spanStarted: (span: Span) => void;\n  spanEnded: (span: Span) => void;\n  spanError: (span: Span, error: Error) => void;\n\n  // Export Events\n  exportStarted: (spans: Span[]) => void;\n  exportCompleted: (spans: Span[], success: boolean) => void;\n  exportFailed: (error: Error) => void;\n\n  // Context Events\n  contextInjected: (carrier: ContextCarrier) => void;\n  contextExtracted: (context: TraceContext | null) => void;\n\n  // Errors\n  error: (error: Error) => void;\n};\n\n// =============================================================================\n// Semantic Conventions\n// =============================================================================\n\nexport const HTTP_ATTRIBUTES = {\n  METHOD: \"http.method\",\n  URL: \"http.url\",\n  TARGET: \"http.target\",\n  HOST: \"http.host\",\n  SCHEME: \"http.scheme\",\n  STATUS_CODE: \"http.status_code\",\n  FLAVOR: \"http.flavor\",\n  USER_AGENT: \"http.user_agent\",\n  REQUEST_CONTENT_LENGTH: \"http.request_content_length\",\n  RESPONSE_CONTENT_LENGTH: \"http.response_content_length\",\n  ROUTE: \"http.route\",\n  CLIENT_IP: \"http.client_ip\",\n} as const;\n\nexport const DB_ATTRIBUTES = {\n  SYSTEM: \"db.system\",\n  CONNECTION_STRING: \"db.connection_string\",\n  USER: \"db.user\",\n  NAME: \"db.name\",\n  STATEMENT: \"db.statement\",\n  OPERATION: \"db.operation\",\n} as const;\n\nexport const RPC_ATTRIBUTES = {\n  SYSTEM: \"rpc.system\",\n  SERVICE: \"rpc.service\",\n  METHOD: \"rpc.method\",\n  GRPC_STATUS_CODE: \"rpc.grpc.status_code\",\n} as const;\n\nexport const MESSAGING_ATTRIBUTES = {\n  SYSTEM: \"messaging.system\",\n  DESTINATION: \"messaging.destination\",\n  DESTINATION_KIND: \"messaging.destination_kind\",\n  MESSAGE_ID: \"messaging.message_id\",\n  OPERATION: \"messaging.operation\",\n} as const;\n\nexport const ERROR_ATTRIBUTES = {\n  TYPE: \"error.type\",\n  MESSAGE: \"error.message\",\n  STACK_TRACE: \"error.stack_trace\",\n} as const;\n\nexport const SERVICE_ATTRIBUTES = {\n  NAME: \"service.name\",\n  VERSION: \"service.version\",\n  INSTANCE_ID: \"service.instance.id\",\n  NAMESPACE: \"service.namespace\",\n} as const;\n","/**\n * OpenTelemetry Tracer Implementation\n * Phase 14A: OpenTelemetry Integration\n */\n\nimport { EventEmitter } from \"eventemitter3\";\nimport { randomBytes } from \"crypto\";\nimport {\n  type TracerConfig,\n  TracerConfigSchema,\n  type Span,\n  type SpanOptions,\n  type TraceContext,\n  type SpanStatus,\n  type SpanEvent,\n  type SpanLink,\n  type Attributes,\n  type Baggage,\n  type ContextCarrier,\n  type TelemetryEvents,\n  type Resource,\n  SERVICE_ATTRIBUTES,\n} from \"./types.js\";\n\n// =============================================================================\n// ID Generation\n// =============================================================================\n\nfunction generateTraceId(): string {\n  return randomBytes(16).toString(\"hex\");\n}\n\nfunction generateSpanId(): string {\n  return randomBytes(8).toString(\"hex\");\n}\n\n// =============================================================================\n// Context Management\n// =============================================================================\n\ninterface ContextData {\n  traceContext?: TraceContext;\n  baggage?: Baggage;\n  span?: ActiveSpan;\n}\n\nclass ContextManager {\n  private stack: ContextData[] = [{}];\n\n  current(): ContextData {\n    return this.stack[this.stack.length - 1];\n  }\n\n  with<T>(context: ContextData, fn: () => T): T {\n    this.stack.push({ ...this.current(), ...context });\n    try {\n      return fn();\n    } finally {\n      this.stack.pop();\n    }\n  }\n\n  async withAsync<T>(context: ContextData, fn: () => Promise<T>): Promise<T> {\n    this.stack.push({ ...this.current(), ...context });\n    try {\n      return await fn();\n    } finally {\n      this.stack.pop();\n    }\n  }\n\n  setCurrentSpan(span: ActiveSpan): void {\n    this.stack[this.stack.length - 1].span = span;\n    this.stack[this.stack.length - 1].traceContext = {\n      traceId: span.traceId,\n      spanId: span.spanId,\n      traceFlags: 1,\n    };\n  }\n\n  getCurrentSpan(): ActiveSpan | undefined {\n    return this.current().span;\n  }\n\n  getTraceContext(): TraceContext | undefined {\n    return this.current().traceContext;\n  }\n\n  getBaggage(): Baggage | undefined {\n    return this.current().baggage;\n  }\n\n  setBaggage(baggage: Baggage): void {\n    this.stack[this.stack.length - 1].baggage = baggage;\n  }\n}\n\n// =============================================================================\n// Active Span\n// =============================================================================\n\nclass ActiveSpan implements Span {\n  traceId: string;\n  spanId: string;\n  parentSpanId?: string;\n  name: string;\n  kind: Span[\"kind\"];\n  startTime: number;\n  endTime?: number;\n  status?: SpanStatus;\n  attributes: Attributes;\n  events: SpanEvent[];\n  links: SpanLink[];\n  droppedAttributesCount: number;\n  droppedEventsCount: number;\n  droppedLinksCount: number;\n\n  private ended = false;\n  private tracer: Tracer;\n\n  constructor(\n    tracer: Tracer,\n    name: string,\n    options: SpanOptions & { traceId: string; spanId: string; parentSpanId?: string }\n  ) {\n    this.tracer = tracer;\n    this.traceId = options.traceId;\n    this.spanId = options.spanId;\n    this.parentSpanId = options.parentSpanId;\n    this.name = name;\n    this.kind = options.kind ?? \"INTERNAL\";\n    this.startTime = options.startTime ?? Date.now();\n    this.attributes = options.attributes ?? {};\n    this.events = [];\n    this.links = options.links ?? [];\n    this.droppedAttributesCount = 0;\n    this.droppedEventsCount = 0;\n    this.droppedLinksCount = 0;\n  }\n\n  setAttribute(key: string, value: Attributes[string]): this {\n    if (!this.ended) {\n      this.attributes[key] = value;\n    }\n    return this;\n  }\n\n  setAttributes(attributes: Attributes): this {\n    if (!this.ended) {\n      Object.assign(this.attributes, attributes);\n    }\n    return this;\n  }\n\n  addEvent(name: string, attributes?: Attributes, timestamp?: number): this {\n    if (!this.ended) {\n      this.events.push({\n        name,\n        timestamp: timestamp ?? Date.now(),\n        attributes,\n      });\n    }\n    return this;\n  }\n\n  setStatus(status: SpanStatus): this {\n    if (!this.ended) {\n      this.status = status;\n    }\n    return this;\n  }\n\n  recordException(error: Error, timestamp?: number): this {\n    if (!this.ended) {\n      this.addEvent(\"exception\", {\n        \"exception.type\": error.name,\n        \"exception.message\": error.message,\n        \"exception.stacktrace\": error.stack ?? \"\",\n      }, timestamp);\n      this.setStatus({ code: \"ERROR\", message: error.message });\n      this.tracer[\"emit\"](\"spanError\", this.toSpan(), error);\n    }\n    return this;\n  }\n\n  updateName(name: string): this {\n    if (!this.ended) {\n      this.name = name;\n    }\n    return this;\n  }\n\n  isRecording(): boolean {\n    return !this.ended;\n  }\n\n  end(endTime?: number): void {\n    if (this.ended) return;\n    this.ended = true;\n    this.endTime = endTime ?? Date.now();\n    this.tracer[\"onSpanEnd\"](this);\n  }\n\n  toSpan(): Span {\n    return {\n      traceId: this.traceId,\n      spanId: this.spanId,\n      parentSpanId: this.parentSpanId,\n      name: this.name,\n      kind: this.kind,\n      startTime: this.startTime,\n      endTime: this.endTime,\n      status: this.status,\n      attributes: { ...this.attributes },\n      events: [...this.events],\n      links: [...this.links],\n      droppedAttributesCount: this.droppedAttributesCount,\n      droppedEventsCount: this.droppedEventsCount,\n      droppedLinksCount: this.droppedLinksCount,\n    };\n  }\n}\n\n// =============================================================================\n// Tracer\n// =============================================================================\n\nexport class Tracer extends EventEmitter<TelemetryEvents> {\n  private config: TracerConfig;\n  private context: ContextManager;\n  private resource: Resource;\n  private spans: Span[] = [];\n  private exportInterval?: ReturnType<typeof setInterval>;\n\n  constructor(config: Partial<TracerConfig> & { serviceName: string }) {\n    super();\n    this.config = TracerConfigSchema.parse(config);\n    this.context = new ContextManager();\n\n    // Build resource\n    this.resource = {\n      attributes: {\n        [SERVICE_ATTRIBUTES.NAME]: this.config.serviceName,\n        ...(this.config.serviceVersion && { [SERVICE_ATTRIBUTES.VERSION]: this.config.serviceVersion }),\n        ...(this.config.environment && { \"deployment.environment\": this.config.environment }),\n        ...this.config.resource?.attributes,\n      },\n      schemaUrl: this.config.resource?.schemaUrl,\n    };\n\n    // Start export interval for batch processing\n    if (this.config.processor?.type === \"batch\") {\n      const delay = this.config.processor.batch?.scheduledDelayMs ?? 5000;\n      this.exportInterval = setInterval(() => this.flush(), delay);\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Span Creation\n  // ---------------------------------------------------------------------------\n\n  startSpan(name: string, options: SpanOptions = {}): ActiveSpan {\n    let traceId: string;\n    let parentSpanId: string | undefined;\n\n    if (options.root) {\n      traceId = generateTraceId();\n    } else {\n      const currentContext = this.context.getTraceContext();\n      if (currentContext) {\n        traceId = currentContext.traceId;\n        parentSpanId = currentContext.spanId;\n      } else {\n        traceId = generateTraceId();\n      }\n    }\n\n    const spanId = generateSpanId();\n\n    const span = new ActiveSpan(this, name, {\n      ...options,\n      traceId,\n      spanId,\n      parentSpanId,\n    });\n\n    this.context.setCurrentSpan(span);\n    this.emit(\"spanStarted\", span.toSpan());\n\n    return span;\n  }\n\n  startActiveSpan<T>(\n    name: string,\n    fn: (span: ActiveSpan) => T\n  ): T;\n  startActiveSpan<T>(\n    name: string,\n    options: SpanOptions,\n    fn: (span: ActiveSpan) => T\n  ): T;\n  startActiveSpan<T>(\n    name: string,\n    optionsOrFn: SpanOptions | ((span: ActiveSpan) => T),\n    maybeFn?: (span: ActiveSpan) => T\n  ): T {\n    const options = typeof optionsOrFn === \"function\" ? {} : optionsOrFn;\n    const fn = typeof optionsOrFn === \"function\" ? optionsOrFn : maybeFn!;\n\n    const span = this.startSpan(name, options);\n    const context: ContextData = {\n      span,\n      traceContext: {\n        traceId: span.traceId,\n        spanId: span.spanId,\n        traceFlags: 1,\n      },\n    };\n\n    return this.context.with(context, () => {\n      try {\n        const result = fn(span);\n        if (result instanceof Promise) {\n          return result.finally(() => span.end()) as T;\n        }\n        span.end();\n        return result;\n      } catch (error) {\n        span.recordException(error as Error);\n        span.end();\n        throw error;\n      }\n    });\n  }\n\n  async startActiveSpanAsync<T>(\n    name: string,\n    fn: (span: ActiveSpan) => Promise<T>\n  ): Promise<T>;\n  async startActiveSpanAsync<T>(\n    name: string,\n    options: SpanOptions,\n    fn: (span: ActiveSpan) => Promise<T>\n  ): Promise<T>;\n  async startActiveSpanAsync<T>(\n    name: string,\n    optionsOrFn: SpanOptions | ((span: ActiveSpan) => Promise<T>),\n    maybeFn?: (span: ActiveSpan) => Promise<T>\n  ): Promise<T> {\n    const options = typeof optionsOrFn === \"function\" ? {} : optionsOrFn;\n    const fn = typeof optionsOrFn === \"function\" ? optionsOrFn : maybeFn!;\n\n    const span = this.startSpan(name, options);\n    const context: ContextData = {\n      span,\n      traceContext: {\n        traceId: span.traceId,\n        spanId: span.spanId,\n        traceFlags: 1,\n      },\n    };\n\n    return this.context.withAsync(context, async () => {\n      try {\n        const result = await fn(span);\n        span.end();\n        return result;\n      } catch (error) {\n        span.recordException(error as Error);\n        span.end();\n        throw error;\n      }\n    });\n  }\n\n  // ---------------------------------------------------------------------------\n  // Context Access\n  // ---------------------------------------------------------------------------\n\n  getCurrentSpan(): ActiveSpan | undefined {\n    return this.context.getCurrentSpan();\n  }\n\n  getTraceContext(): TraceContext | undefined {\n    return this.context.getTraceContext();\n  }\n\n  // ---------------------------------------------------------------------------\n  // Context Propagation\n  // ---------------------------------------------------------------------------\n\n  inject(carrier: ContextCarrier = {}): ContextCarrier {\n    const context = this.context.getTraceContext();\n    if (!context) return carrier;\n\n    // W3C Trace Context format\n    const traceparent = `00-${context.traceId}-${context.spanId}-${context.traceFlags.toString(16).padStart(2, \"0\")}`;\n    carrier[\"traceparent\"] = traceparent;\n\n    if (context.traceState) {\n      carrier[\"tracestate\"] = context.traceState;\n    }\n\n    // Inject baggage if present\n    const baggage = this.context.getBaggage();\n    if (baggage && Object.keys(baggage).length > 0) {\n      const baggageStr = Object.entries(baggage)\n        .map(([key, entry]) => `${encodeURIComponent(key)}=${encodeURIComponent(entry.value)}`)\n        .join(\",\");\n      carrier[\"baggage\"] = baggageStr;\n    }\n\n    this.emit(\"contextInjected\", carrier);\n    return carrier;\n  }\n\n  extract(carrier: ContextCarrier): TraceContext | null {\n    const traceparent = carrier[\"traceparent\"];\n    if (!traceparent) {\n      this.emit(\"contextExtracted\", null);\n      return null;\n    }\n\n    // Parse W3C Trace Context format\n    const match = traceparent.match(/^00-([a-f0-9]{32})-([a-f0-9]{16})-([a-f0-9]{2})$/);\n    if (!match) {\n      this.emit(\"contextExtracted\", null);\n      return null;\n    }\n\n    const context: TraceContext = {\n      traceId: match[1],\n      spanId: match[2],\n      traceFlags: parseInt(match[3], 16),\n      traceState: carrier[\"tracestate\"],\n    };\n\n    // Extract baggage\n    const baggageStr = carrier[\"baggage\"];\n    if (baggageStr) {\n      const baggage: Baggage = {};\n      for (const entry of baggageStr.split(\",\")) {\n        const [key, value] = entry.split(\"=\").map(s => decodeURIComponent(s.trim()));\n        if (key && value) {\n          baggage[key] = { value };\n        }\n      }\n      this.context.setBaggage(baggage);\n    }\n\n    this.emit(\"contextExtracted\", context);\n    return context;\n  }\n\n  withExtractedContext<T>(carrier: ContextCarrier, fn: () => T): T {\n    const context = this.extract(carrier);\n    if (!context) {\n      return fn();\n    }\n\n    return this.context.with({ traceContext: context }, fn);\n  }\n\n  async withExtractedContextAsync<T>(carrier: ContextCarrier, fn: () => Promise<T>): Promise<T> {\n    const context = this.extract(carrier);\n    if (!context) {\n      return fn();\n    }\n\n    return this.context.withAsync({ traceContext: context }, fn);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Baggage\n  // ---------------------------------------------------------------------------\n\n  getBaggage(): Baggage | undefined {\n    return this.context.getBaggage();\n  }\n\n  setBaggageEntry(key: string, value: string, metadata?: string): void {\n    const current = this.context.getBaggage() ?? {};\n    current[key] = { value, metadata };\n    this.context.setBaggage(current);\n  }\n\n  removeBaggageEntry(key: string): void {\n    const current = this.context.getBaggage();\n    if (current) {\n      delete current[key];\n      this.context.setBaggage(current);\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Resource\n  // ---------------------------------------------------------------------------\n\n  getResource(): Resource {\n    return { ...this.resource };\n  }\n\n  // ---------------------------------------------------------------------------\n  // Export\n  // ---------------------------------------------------------------------------\n\n  private onSpanEnd(span: ActiveSpan): void {\n    const spanData = span.toSpan();\n    this.emit(\"spanEnded\", spanData);\n\n    // Add to batch\n    this.spans.push(spanData);\n\n    // Export immediately if simple processor\n    if (this.config.processor?.type === \"simple\" || !this.config.processor) {\n      this.exportSpans([spanData]);\n    }\n  }\n\n  async flush(): Promise<void> {\n    if (this.spans.length === 0) return;\n\n    const toExport = [...this.spans];\n    this.spans = [];\n\n    await this.exportSpans(toExport);\n  }\n\n  private async exportSpans(spans: Span[]): Promise<void> {\n    if (spans.length === 0) return;\n\n    this.emit(\"exportStarted\", spans);\n\n    try {\n      const exporter = this.config.exporter;\n\n      switch (exporter?.type) {\n        case \"console\":\n          for (const span of spans) {\n            console.log(JSON.stringify({\n              resource: this.resource,\n              span,\n            }, null, 2));\n          }\n          break;\n\n        case \"otlp_http\":\n          if (exporter.endpoint) {\n            // In a real implementation, this would use fetch\n            // For now, just simulate the export\n            console.log(`[OTLP] Exporting ${spans.length} spans to ${exporter.endpoint}`);\n          }\n          break;\n\n        case \"memory\":\n          // Spans are already stored in memory\n          break;\n\n        default:\n          // Default to console\n          for (const span of spans) {\n            console.log(JSON.stringify(span));\n          }\n      }\n\n      this.emit(\"exportCompleted\", spans, true);\n    } catch (error) {\n      this.emit(\"exportFailed\", error as Error);\n      this.emit(\"exportCompleted\", spans, false);\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Lifecycle\n  // ---------------------------------------------------------------------------\n\n  async shutdown(): Promise<void> {\n    if (this.exportInterval) {\n      clearInterval(this.exportInterval);\n    }\n    await this.flush();\n    this.removeAllListeners();\n  }\n\n  // ---------------------------------------------------------------------------\n  // Stored Spans (for memory exporter)\n  // ---------------------------------------------------------------------------\n\n  getStoredSpans(): Span[] {\n    return [...this.spans];\n  }\n\n  clearStoredSpans(): void {\n    this.spans = [];\n  }\n}\n\n// =============================================================================\n// Factory Functions\n// =============================================================================\n\nlet defaultTracer: Tracer | null = null;\n\nexport function getTracer(): Tracer {\n  if (!defaultTracer) {\n    throw new Error(\"Tracer not initialized. Call createTracer first.\");\n  }\n  return defaultTracer;\n}\n\nexport function createTracer(config: Partial<TracerConfig> & { serviceName: string }): Tracer {\n  const tracer = new Tracer(config);\n  if (!defaultTracer) {\n    defaultTracer = tracer;\n  }\n  return tracer;\n}\n\n// =============================================================================\n// Decorators / Helpers\n// =============================================================================\n\nexport function traced(name?: string, options?: SpanOptions) {\n  return function <T extends (...args: unknown[]) => unknown>(\n    _target: object,\n    propertyKey: string,\n    descriptor: TypedPropertyDescriptor<T>\n  ) {\n    const originalMethod = descriptor.value!;\n    const spanName = name ?? propertyKey;\n\n    descriptor.value = function (this: unknown, ...args: unknown[]) {\n      const tracer = getTracer();\n      return tracer.startActiveSpan(spanName, options ?? {}, (span) => {\n        return originalMethod.apply(this, args) as ReturnType<T>;\n      });\n    } as T;\n\n    return descriptor;\n  };\n}\n\nexport function withSpan<T>(\n  name: string,\n  fn: (span: ActiveSpan) => T,\n  options?: SpanOptions\n): T {\n  const tracer = getTracer();\n  return tracer.startActiveSpan(name, options ?? {}, fn);\n}\n\nexport async function withSpanAsync<T>(\n  name: string,\n  fn: (span: ActiveSpan) => Promise<T>,\n  options?: SpanOptions\n): Promise<T> {\n  const tracer = getTracer();\n  return tracer.startActiveSpanAsync(name, options ?? {}, fn);\n}\n","/**\n * Log Aggregator Types\n * Phase 14B: Log Aggregation\n */\n\nimport { z } from \"zod\";\n\n// =============================================================================\n// Log Levels\n// =============================================================================\n\nexport const LogLevelSchema = z.enum([\n  \"trace\",\n  \"debug\",\n  \"info\",\n  \"warn\",\n  \"error\",\n  \"fatal\",\n]);\nexport type LogLevel = z.infer<typeof LogLevelSchema>;\n\nexport const LOG_LEVEL_VALUES: Record<LogLevel, number> = {\n  trace: 10,\n  debug: 20,\n  info: 30,\n  warn: 40,\n  error: 50,\n  fatal: 60,\n};\n\n// =============================================================================\n// Log Entry\n// =============================================================================\n\nexport const LogEntrySchema = z.object({\n  timestamp: z.number(),\n  level: LogLevelSchema,\n  message: z.string(),\n  logger: z.string().optional(),\n\n  // Context\n  traceId: z.string().optional(),\n  spanId: z.string().optional(),\n  requestId: z.string().optional(),\n\n  // Service info\n  service: z.string().optional(),\n  version: z.string().optional(),\n  environment: z.string().optional(),\n  hostname: z.string().optional(),\n  pid: z.number().optional(),\n\n  // Additional data\n  data: z.record(z.unknown()).optional(),\n  error: z.object({\n    name: z.string(),\n    message: z.string(),\n    stack: z.string().optional(),\n    code: z.string().optional(),\n  }).optional(),\n\n  // Tags for filtering\n  tags: z.array(z.string()).optional(),\n});\nexport type LogEntry = z.infer<typeof LogEntrySchema>;\n\n// =============================================================================\n// Transport Types\n// =============================================================================\n\nexport const TransportTypeSchema = z.enum([\n  \"console\",\n  \"file\",\n  \"http\",\n  \"stream\",\n  \"memory\",\n  \"elasticsearch\",\n  \"loki\",\n  \"datadog\",\n  \"cloudwatch\",\n]);\nexport type TransportType = z.infer<typeof TransportTypeSchema>;\n\n// =============================================================================\n// Console Transport Config\n// =============================================================================\n\nexport const ConsoleTransportConfigSchema = z.object({\n  type: z.literal(\"console\"),\n  level: LogLevelSchema.default(\"info\"),\n  colorize: z.boolean().default(true),\n  timestamp: z.boolean().default(true),\n  prettyPrint: z.boolean().default(false),\n});\nexport type ConsoleTransportConfig = z.infer<typeof ConsoleTransportConfigSchema>;\n\n// =============================================================================\n// File Transport Config\n// =============================================================================\n\nexport const FileTransportConfigSchema = z.object({\n  type: z.literal(\"file\"),\n  level: LogLevelSchema.default(\"info\"),\n  path: z.string(),\n  maxSize: z.number().default(10 * 1024 * 1024), // 10MB\n  maxFiles: z.number().default(5),\n  compress: z.boolean().default(true),\n  json: z.boolean().default(true),\n});\nexport type FileTransportConfig = z.infer<typeof FileTransportConfigSchema>;\n\n// =============================================================================\n// HTTP Transport Config\n// =============================================================================\n\nexport const HttpTransportConfigSchema = z.object({\n  type: z.literal(\"http\"),\n  level: LogLevelSchema.default(\"info\"),\n  url: z.string().url(),\n  method: z.enum([\"POST\", \"PUT\"]).default(\"POST\"),\n  headers: z.record(z.string()).optional(),\n  auth: z.object({\n    type: z.enum([\"basic\", \"bearer\", \"api_key\"]),\n    username: z.string().optional(),\n    password: z.string().optional(),\n    token: z.string().optional(),\n    apiKey: z.string().optional(),\n    apiKeyHeader: z.string().optional(),\n  }).optional(),\n  batch: z.object({\n    size: z.number().default(100),\n    interval: z.number().default(5000),\n  }).optional(),\n  retry: z.object({\n    attempts: z.number().default(3),\n    delay: z.number().default(1000),\n  }).optional(),\n  timeout: z.number().default(30000),\n});\nexport type HttpTransportConfig = z.infer<typeof HttpTransportConfigSchema>;\n\n// =============================================================================\n// Memory Transport Config\n// =============================================================================\n\nexport const MemoryTransportConfigSchema = z.object({\n  type: z.literal(\"memory\"),\n  level: LogLevelSchema.default(\"debug\"),\n  maxEntries: z.number().default(1000),\n  circular: z.boolean().default(true),\n});\nexport type MemoryTransportConfig = z.infer<typeof MemoryTransportConfigSchema>;\n\n// =============================================================================\n// Elasticsearch Transport Config\n// =============================================================================\n\nexport const ElasticsearchTransportConfigSchema = z.object({\n  type: z.literal(\"elasticsearch\"),\n  level: LogLevelSchema.default(\"info\"),\n  nodes: z.array(z.string().url()),\n  index: z.string().default(\"logs\"),\n  indexPattern: z.string().default(\"logs-%Y.%m.%d\"),\n  auth: z.object({\n    username: z.string(),\n    password: z.string(),\n  }).optional(),\n  ssl: z.object({\n    rejectUnauthorized: z.boolean().default(true),\n    ca: z.string().optional(),\n  }).optional(),\n  batch: z.object({\n    size: z.number().default(500),\n    interval: z.number().default(5000),\n  }).optional(),\n});\nexport type ElasticsearchTransportConfig = z.infer<typeof ElasticsearchTransportConfigSchema>;\n\n// =============================================================================\n// Loki Transport Config\n// =============================================================================\n\nexport const LokiTransportConfigSchema = z.object({\n  type: z.literal(\"loki\"),\n  level: LogLevelSchema.default(\"info\"),\n  url: z.string().url(),\n  labels: z.record(z.string()).default({}),\n  auth: z.object({\n    username: z.string(),\n    password: z.string(),\n  }).optional(),\n  batch: z.object({\n    size: z.number().default(100),\n    interval: z.number().default(5000),\n  }).optional(),\n});\nexport type LokiTransportConfig = z.infer<typeof LokiTransportConfigSchema>;\n\n// =============================================================================\n// Combined Transport Config\n// =============================================================================\n\nexport const TransportConfigSchema = z.discriminatedUnion(\"type\", [\n  ConsoleTransportConfigSchema,\n  FileTransportConfigSchema,\n  HttpTransportConfigSchema,\n  MemoryTransportConfigSchema,\n  ElasticsearchTransportConfigSchema,\n  LokiTransportConfigSchema,\n]);\nexport type TransportConfig = z.infer<typeof TransportConfigSchema>;\n\n// =============================================================================\n// Formatter\n// =============================================================================\n\nexport const FormatterTypeSchema = z.enum([\n  \"json\",\n  \"text\",\n  \"pretty\",\n  \"logfmt\",\n  \"ecs\", // Elastic Common Schema\n]);\nexport type FormatterType = z.infer<typeof FormatterTypeSchema>;\n\nexport const FormatterConfigSchema = z.object({\n  type: FormatterTypeSchema.default(\"json\"),\n  timestamp: z.enum([\"iso\", \"epoch\", \"unix\", \"none\"]).default(\"iso\"),\n  includeLevel: z.boolean().default(true),\n  includeMeta: z.boolean().default(true),\n  fields: z.object({\n    timestamp: z.string().default(\"timestamp\"),\n    level: z.string().default(\"level\"),\n    message: z.string().default(\"message\"),\n    error: z.string().default(\"error\"),\n  }).optional(),\n});\nexport type FormatterConfig = z.infer<typeof FormatterConfigSchema>;\n\n// =============================================================================\n// Filter\n// =============================================================================\n\nexport const LogFilterSchema = z.object({\n  levels: z.array(LogLevelSchema).optional(),\n  loggers: z.array(z.string()).optional(),\n  tags: z.array(z.string()).optional(),\n  pattern: z.string().optional().describe(\"Regex pattern for message\"),\n  exclude: z.object({\n    levels: z.array(LogLevelSchema).optional(),\n    loggers: z.array(z.string()).optional(),\n    tags: z.array(z.string()).optional(),\n    pattern: z.string().optional(),\n  }).optional(),\n});\nexport type LogFilter = z.infer<typeof LogFilterSchema>;\n\n// =============================================================================\n// Sampling\n// =============================================================================\n\nexport const SamplingConfigSchema = z.object({\n  enabled: z.boolean().default(false),\n  rate: z.number().min(0).max(1).default(1),\n  rules: z.array(z.object({\n    match: LogFilterSchema,\n    rate: z.number().min(0).max(1),\n  })).optional(),\n});\nexport type SamplingConfig = z.infer<typeof SamplingConfigSchema>;\n\n// =============================================================================\n// Redaction\n// =============================================================================\n\nexport const RedactionConfigSchema = z.object({\n  enabled: z.boolean().default(true),\n  fields: z.array(z.string()).default([\n    \"password\",\n    \"secret\",\n    \"token\",\n    \"apiKey\",\n    \"api_key\",\n    \"authorization\",\n    \"cookie\",\n    \"creditCard\",\n    \"credit_card\",\n    \"ssn\",\n  ]),\n  patterns: z.array(z.string()).optional().describe(\"Regex patterns\"),\n  replacement: z.string().default(\"[REDACTED]\"),\n  hash: z.boolean().default(false).describe(\"Hash instead of replace\"),\n});\nexport type RedactionConfig = z.infer<typeof RedactionConfigSchema>;\n\n// =============================================================================\n// Log Aggregator Config\n// =============================================================================\n\nexport const LogAggregatorConfigSchema = z.object({\n  service: z.string(),\n  version: z.string().optional(),\n  environment: z.string().optional(),\n\n  level: LogLevelSchema.default(\"info\"),\n  transports: z.array(TransportConfigSchema).default([\n    { type: \"console\", level: \"info\", colorize: true, timestamp: true, prettyPrint: false },\n  ]),\n\n  formatter: FormatterConfigSchema.optional(),\n  filter: LogFilterSchema.optional(),\n  sampling: SamplingConfigSchema.optional(),\n  redaction: RedactionConfigSchema.optional(),\n\n  context: z.object({\n    includeHostname: z.boolean().default(true),\n    includePid: z.boolean().default(true),\n    includeTraceContext: z.boolean().default(true),\n  }).optional(),\n\n  buffer: z.object({\n    enabled: z.boolean().default(false),\n    size: z.number().default(1000),\n    flushInterval: z.number().default(5000),\n  }).optional(),\n});\nexport type LogAggregatorConfig = z.infer<typeof LogAggregatorConfigSchema>;\n\n// =============================================================================\n// Log Query\n// =============================================================================\n\nexport const LogQuerySchema = z.object({\n  startTime: z.number().optional(),\n  endTime: z.number().optional(),\n  levels: z.array(LogLevelSchema).optional(),\n  loggers: z.array(z.string()).optional(),\n  traceId: z.string().optional(),\n  spanId: z.string().optional(),\n  requestId: z.string().optional(),\n  tags: z.array(z.string()).optional(),\n  search: z.string().optional(),\n  limit: z.number().default(100),\n  offset: z.number().default(0),\n  sort: z.enum([\"asc\", \"desc\"]).default(\"desc\"),\n});\nexport type LogQuery = z.infer<typeof LogQuerySchema>;\n\n// =============================================================================\n// Log Stats\n// =============================================================================\n\nexport const LogStatsSchema = z.object({\n  total: z.number(),\n  byLevel: z.record(LogLevelSchema, z.number()),\n  byLogger: z.record(z.string(), z.number()),\n  byHour: z.array(z.object({\n    hour: z.string(),\n    count: z.number(),\n  })),\n  errorRate: z.number(),\n  avgEntriesPerMinute: z.number(),\n});\nexport type LogStats = z.infer<typeof LogStatsSchema>;\n\n// =============================================================================\n// Events\n// =============================================================================\n\nexport type LoggingEvents = {\n  // Log Events\n  logged: (entry: LogEntry) => void;\n  filtered: (entry: LogEntry, reason: string) => void;\n  sampled: (entry: LogEntry, rate: number) => void;\n  redacted: (entry: LogEntry, fields: string[]) => void;\n\n  // Transport Events\n  transportError: (transport: TransportType, error: Error) => void;\n  transported: (transport: TransportType, count: number) => void;\n  bufferFlushed: (count: number) => void;\n\n  // Lifecycle\n  initialized: () => void;\n  shutdown: () => void;\n\n  // Errors\n  error: (error: Error) => void;\n};\n\n// =============================================================================\n// Transport Interface\n// =============================================================================\n\nexport interface LogTransport {\n  readonly type: TransportType;\n  readonly level: LogLevel;\n  log(entry: LogEntry): Promise<void>;\n  flush?(): Promise<void>;\n  close?(): Promise<void>;\n}\n","/**\n * Log Aggregator Implementation\n * Phase 14B: Log Aggregation\n */\n\nimport { EventEmitter } from \"eventemitter3\";\nimport { hostname } from \"os\";\nimport { createHash } from \"crypto\";\nimport {\n  type LogAggregatorConfig,\n  LogAggregatorConfigSchema,\n  type LogEntry,\n  type LogLevel,\n  type LogTransport,\n  type TransportConfig,\n  type LogQuery,\n  type LogStats,\n  type LoggingEvents,\n  type RedactionConfig,\n  LOG_LEVEL_VALUES,\n} from \"./types.js\";\n\n// =============================================================================\n// Console Transport\n// =============================================================================\n\nclass ConsoleTransport implements LogTransport {\n  readonly type = \"console\" as const;\n  readonly level: LogLevel;\n  private colorize: boolean;\n  private timestamp: boolean;\n  private prettyPrint: boolean;\n\n  private colors: Record<LogLevel, string> = {\n    trace: \"\\x1b[90m\", // gray\n    debug: \"\\x1b[36m\", // cyan\n    info: \"\\x1b[32m\",  // green\n    warn: \"\\x1b[33m\",  // yellow\n    error: \"\\x1b[31m\", // red\n    fatal: \"\\x1b[35m\", // magenta\n  };\n  private reset = \"\\x1b[0m\";\n\n  constructor(config: TransportConfig & { type: \"console\" }) {\n    this.level = config.level;\n    this.colorize = config.colorize;\n    this.timestamp = config.timestamp;\n    this.prettyPrint = config.prettyPrint;\n  }\n\n  async log(entry: LogEntry): Promise<void> {\n    let output: string;\n\n    if (this.prettyPrint) {\n      output = this.formatPretty(entry);\n    } else {\n      output = this.formatSimple(entry);\n    }\n\n    if (entry.level === \"error\" || entry.level === \"fatal\") {\n      console.error(output);\n    } else if (entry.level === \"warn\") {\n      console.warn(output);\n    } else if (entry.level === \"debug\" || entry.level === \"trace\") {\n      console.debug(output);\n    } else {\n      console.log(output);\n    }\n  }\n\n  private formatSimple(entry: LogEntry): string {\n    const parts: string[] = [];\n\n    if (this.timestamp) {\n      parts.push(new Date(entry.timestamp).toISOString());\n    }\n\n    const levelStr = entry.level.toUpperCase().padEnd(5);\n    if (this.colorize) {\n      parts.push(`${this.colors[entry.level]}${levelStr}${this.reset}`);\n    } else {\n      parts.push(levelStr);\n    }\n\n    if (entry.logger) {\n      parts.push(`[${entry.logger}]`);\n    }\n\n    parts.push(entry.message);\n\n    if (entry.traceId) {\n      parts.push(`trace=${entry.traceId.slice(0, 8)}`);\n    }\n\n    if (entry.error) {\n      parts.push(`error=${entry.error.name}: ${entry.error.message}`);\n    }\n\n    return parts.join(\" \");\n  }\n\n  private formatPretty(entry: LogEntry): string {\n    const lines: string[] = [];\n\n    const ts = new Date(entry.timestamp).toISOString();\n    const level = this.colorize\n      ? `${this.colors[entry.level]}${entry.level.toUpperCase()}${this.reset}`\n      : entry.level.toUpperCase();\n\n    lines.push(`${ts} ${level} ${entry.message}`);\n\n    if (entry.logger) {\n      lines.push(`  logger: ${entry.logger}`);\n    }\n\n    if (entry.traceId) {\n      lines.push(`  traceId: ${entry.traceId}`);\n    }\n\n    if (entry.spanId) {\n      lines.push(`  spanId: ${entry.spanId}`);\n    }\n\n    if (entry.data && Object.keys(entry.data).length > 0) {\n      lines.push(`  data: ${JSON.stringify(entry.data, null, 2).replace(/\\n/g, \"\\n  \")}`);\n    }\n\n    if (entry.error) {\n      lines.push(`  error: ${entry.error.name}: ${entry.error.message}`);\n      if (entry.error.stack) {\n        lines.push(`  ${entry.error.stack.replace(/\\n/g, \"\\n  \")}`);\n      }\n    }\n\n    return lines.join(\"\\n\");\n  }\n}\n\n// =============================================================================\n// Memory Transport\n// =============================================================================\n\nclass MemoryTransport implements LogTransport {\n  readonly type = \"memory\" as const;\n  readonly level: LogLevel;\n  private entries: LogEntry[] = [];\n  private maxEntries: number;\n  private circular: boolean;\n\n  constructor(config: TransportConfig & { type: \"memory\" }) {\n    this.level = config.level;\n    this.maxEntries = config.maxEntries;\n    this.circular = config.circular;\n  }\n\n  async log(entry: LogEntry): Promise<void> {\n    this.entries.push(entry);\n\n    if (this.entries.length > this.maxEntries) {\n      if (this.circular) {\n        this.entries.shift();\n      } else {\n        this.entries = this.entries.slice(-this.maxEntries);\n      }\n    }\n  }\n\n  getEntries(): LogEntry[] {\n    return [...this.entries];\n  }\n\n  clear(): void {\n    this.entries = [];\n  }\n\n  query(query: LogQuery): LogEntry[] {\n    let results = [...this.entries];\n\n    // Filter by time\n    if (query.startTime) {\n      results = results.filter(e => e.timestamp >= query.startTime!);\n    }\n    if (query.endTime) {\n      results = results.filter(e => e.timestamp <= query.endTime!);\n    }\n\n    // Filter by level\n    if (query.levels && query.levels.length > 0) {\n      results = results.filter(e => query.levels!.includes(e.level));\n    }\n\n    // Filter by logger\n    if (query.loggers && query.loggers.length > 0) {\n      results = results.filter(e => e.logger && query.loggers!.includes(e.logger));\n    }\n\n    // Filter by trace\n    if (query.traceId) {\n      results = results.filter(e => e.traceId === query.traceId);\n    }\n    if (query.spanId) {\n      results = results.filter(e => e.spanId === query.spanId);\n    }\n    if (query.requestId) {\n      results = results.filter(e => e.requestId === query.requestId);\n    }\n\n    // Filter by tags\n    if (query.tags && query.tags.length > 0) {\n      results = results.filter(e =>\n        e.tags && query.tags!.some(t => e.tags!.includes(t))\n      );\n    }\n\n    // Search\n    if (query.search) {\n      const searchLower = query.search.toLowerCase();\n      results = results.filter(e =>\n        e.message.toLowerCase().includes(searchLower) ||\n        JSON.stringify(e.data).toLowerCase().includes(searchLower)\n      );\n    }\n\n    // Sort\n    results.sort((a, b) =>\n      query.sort === \"asc\" ? a.timestamp - b.timestamp : b.timestamp - a.timestamp\n    );\n\n    // Paginate\n    return results.slice(query.offset, query.offset + query.limit);\n  }\n}\n\n// =============================================================================\n// HTTP Transport (Stub)\n// =============================================================================\n\nclass HttpTransport implements LogTransport {\n  readonly type = \"http\" as const;\n  readonly level: LogLevel;\n  private url: string;\n  private headers: Record<string, string>;\n  private batch: LogEntry[] = [];\n  private batchSize: number;\n  private batchInterval: number;\n  private intervalId?: ReturnType<typeof setInterval>;\n\n  constructor(config: TransportConfig & { type: \"http\" }) {\n    this.level = config.level;\n    this.url = config.url;\n    this.headers = config.headers ?? {};\n    this.batchSize = config.batch?.size ?? 100;\n    this.batchInterval = config.batch?.interval ?? 5000;\n\n    // Start batch flush interval\n    this.intervalId = setInterval(() => this.flush(), this.batchInterval);\n  }\n\n  async log(entry: LogEntry): Promise<void> {\n    this.batch.push(entry);\n\n    if (this.batch.length >= this.batchSize) {\n      await this.flush();\n    }\n  }\n\n  async flush(): Promise<void> {\n    if (this.batch.length === 0) return;\n\n    const toSend = [...this.batch];\n    this.batch = [];\n\n    try {\n      // In a real implementation, this would use fetch\n      console.log(`[HTTP Transport] Would send ${toSend.length} logs to ${this.url}`);\n    } catch (error) {\n      // Re-add failed logs to batch\n      this.batch = [...toSend, ...this.batch];\n      throw error;\n    }\n  }\n\n  async close(): Promise<void> {\n    if (this.intervalId) {\n      clearInterval(this.intervalId);\n    }\n    await this.flush();\n  }\n}\n\n// =============================================================================\n// Logger\n// =============================================================================\n\nexport class Logger {\n  private name: string;\n  private aggregator: LogAggregator;\n  private context: Record<string, unknown>;\n\n  constructor(aggregator: LogAggregator, name: string, context: Record<string, unknown> = {}) {\n    this.aggregator = aggregator;\n    this.name = name;\n    this.context = context;\n  }\n\n  child(name: string, context: Record<string, unknown> = {}): Logger {\n    return new Logger(\n      this.aggregator,\n      `${this.name}.${name}`,\n      { ...this.context, ...context }\n    );\n  }\n\n  with(context: Record<string, unknown>): Logger {\n    return new Logger(this.aggregator, this.name, { ...this.context, ...context });\n  }\n\n  trace(message: string, data?: Record<string, unknown>): void {\n    this.log(\"trace\", message, data);\n  }\n\n  debug(message: string, data?: Record<string, unknown>): void {\n    this.log(\"debug\", message, data);\n  }\n\n  info(message: string, data?: Record<string, unknown>): void {\n    this.log(\"info\", message, data);\n  }\n\n  warn(message: string, data?: Record<string, unknown>): void {\n    this.log(\"warn\", message, data);\n  }\n\n  error(message: string, error?: Error | Record<string, unknown>, data?: Record<string, unknown>): void {\n    if (error instanceof Error) {\n      this.log(\"error\", message, data, error);\n    } else {\n      this.log(\"error\", message, error);\n    }\n  }\n\n  fatal(message: string, error?: Error | Record<string, unknown>, data?: Record<string, unknown>): void {\n    if (error instanceof Error) {\n      this.log(\"fatal\", message, data, error);\n    } else {\n      this.log(\"fatal\", message, error);\n    }\n  }\n\n  private log(level: LogLevel, message: string, data?: Record<string, unknown>, error?: Error): void {\n    this.aggregator.log({\n      level,\n      message,\n      logger: this.name,\n      data: { ...this.context, ...data },\n      error: error ? {\n        name: error.name,\n        message: error.message,\n        stack: error.stack,\n      } : undefined,\n    });\n  }\n}\n\n// =============================================================================\n// Log Aggregator\n// =============================================================================\n\nexport class LogAggregator extends EventEmitter<LoggingEvents> {\n  private config: LogAggregatorConfig;\n  private transports: LogTransport[] = [];\n  private memoryTransport?: MemoryTransport;\n  private buffer: LogEntry[] = [];\n  private bufferInterval?: ReturnType<typeof setInterval>;\n  private contextData: {\n    hostname?: string;\n    pid?: number;\n    traceId?: string;\n    spanId?: string;\n    requestId?: string;\n  } = {};\n\n  constructor(config: Partial<LogAggregatorConfig> & { service: string }) {\n    super();\n    this.config = LogAggregatorConfigSchema.parse(config);\n\n    // Initialize transports\n    this.initializeTransports();\n\n    // Set up context\n    if (this.config.context?.includeHostname) {\n      this.contextData.hostname = hostname();\n    }\n    if (this.config.context?.includePid) {\n      this.contextData.pid = process.pid;\n    }\n\n    // Set up buffer\n    if (this.config.buffer?.enabled) {\n      this.bufferInterval = setInterval(\n        () => this.flushBuffer(),\n        this.config.buffer.flushInterval\n      );\n    }\n\n    this.emit(\"initialized\");\n  }\n\n  private initializeTransports(): void {\n    for (const config of this.config.transports) {\n      switch (config.type) {\n        case \"console\":\n          this.transports.push(new ConsoleTransport(config));\n          break;\n        case \"memory\":\n          this.memoryTransport = new MemoryTransport(config);\n          this.transports.push(this.memoryTransport);\n          break;\n        case \"http\":\n          this.transports.push(new HttpTransport(config));\n          break;\n        // Other transports would be added here\n      }\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Logging\n  // ---------------------------------------------------------------------------\n\n  log(entry: Partial<LogEntry> & { level: LogLevel; message: string }): void {\n    // Build full entry\n    const fullEntry: LogEntry = {\n      timestamp: entry.timestamp ?? Date.now(),\n      level: entry.level,\n      message: entry.message,\n      logger: entry.logger,\n      service: this.config.service,\n      version: this.config.version,\n      environment: this.config.environment,\n      hostname: this.contextData.hostname,\n      pid: this.contextData.pid,\n      traceId: entry.traceId ?? this.contextData.traceId,\n      spanId: entry.spanId ?? this.contextData.spanId,\n      requestId: entry.requestId ?? this.contextData.requestId,\n      data: entry.data,\n      error: entry.error,\n      tags: entry.tags,\n    };\n\n    // Check level\n    if (LOG_LEVEL_VALUES[fullEntry.level] < LOG_LEVEL_VALUES[this.config.level]) {\n      return;\n    }\n\n    // Apply filter\n    if (this.config.filter && !this.passesFilter(fullEntry)) {\n      this.emit(\"filtered\", fullEntry, \"filter\");\n      return;\n    }\n\n    // Apply sampling\n    if (this.config.sampling?.enabled) {\n      if (!this.passesSampling(fullEntry)) {\n        this.emit(\"sampled\", fullEntry, this.config.sampling.rate);\n        return;\n      }\n    }\n\n    // Apply redaction\n    if (this.config.redaction?.enabled) {\n      this.applyRedaction(fullEntry);\n    }\n\n    // Buffer or send immediately\n    if (this.config.buffer?.enabled) {\n      this.buffer.push(fullEntry);\n      if (this.buffer.length >= this.config.buffer.size) {\n        this.flushBuffer();\n      }\n    } else {\n      this.sendToTransports(fullEntry);\n    }\n\n    this.emit(\"logged\", fullEntry);\n  }\n\n  // Convenience methods\n  trace(message: string, data?: Record<string, unknown>): void {\n    this.log({ level: \"trace\", message, data });\n  }\n\n  debug(message: string, data?: Record<string, unknown>): void {\n    this.log({ level: \"debug\", message, data });\n  }\n\n  info(message: string, data?: Record<string, unknown>): void {\n    this.log({ level: \"info\", message, data });\n  }\n\n  warn(message: string, data?: Record<string, unknown>): void {\n    this.log({ level: \"warn\", message, data });\n  }\n\n  error(message: string, error?: Error, data?: Record<string, unknown>): void {\n    this.log({\n      level: \"error\",\n      message,\n      data,\n      error: error ? {\n        name: error.name,\n        message: error.message,\n        stack: error.stack,\n      } : undefined,\n    });\n  }\n\n  fatal(message: string, error?: Error, data?: Record<string, unknown>): void {\n    this.log({\n      level: \"fatal\",\n      message,\n      data,\n      error: error ? {\n        name: error.name,\n        message: error.message,\n        stack: error.stack,\n      } : undefined,\n    });\n  }\n\n  // ---------------------------------------------------------------------------\n  // Logger Factory\n  // ---------------------------------------------------------------------------\n\n  getLogger(name: string, context: Record<string, unknown> = {}): Logger {\n    return new Logger(this, name, context);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Context\n  // ---------------------------------------------------------------------------\n\n  setTraceContext(traceId?: string, spanId?: string): void {\n    this.contextData.traceId = traceId;\n    this.contextData.spanId = spanId;\n  }\n\n  setRequestId(requestId?: string): void {\n    this.contextData.requestId = requestId;\n  }\n\n  clearContext(): void {\n    delete this.contextData.traceId;\n    delete this.contextData.spanId;\n    delete this.contextData.requestId;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Query\n  // ---------------------------------------------------------------------------\n\n  query(query: LogQuery): LogEntry[] {\n    if (!this.memoryTransport) {\n      throw new Error(\"Memory transport not configured for querying\");\n    }\n    return this.memoryTransport.query(query);\n  }\n\n  getStats(): LogStats {\n    if (!this.memoryTransport) {\n      throw new Error(\"Memory transport not configured for stats\");\n    }\n\n    const entries = this.memoryTransport.getEntries();\n    const byLevel: Record<LogLevel, number> = {\n      trace: 0,\n      debug: 0,\n      info: 0,\n      warn: 0,\n      error: 0,\n      fatal: 0,\n    };\n    const byLogger: Record<string, number> = {};\n    const byHour: Map<string, number> = new Map();\n\n    for (const entry of entries) {\n      byLevel[entry.level]++;\n\n      if (entry.logger) {\n        byLogger[entry.logger] = (byLogger[entry.logger] ?? 0) + 1;\n      }\n\n      const hour = new Date(entry.timestamp).toISOString().slice(0, 13);\n      byHour.set(hour, (byHour.get(hour) ?? 0) + 1);\n    }\n\n    const errorCount = byLevel.error + byLevel.fatal;\n    const errorRate = entries.length > 0 ? errorCount / entries.length : 0;\n\n    // Calculate average entries per minute\n    const timeRange = entries.length > 1\n      ? (entries[entries.length - 1].timestamp - entries[0].timestamp) / 60000\n      : 1;\n    const avgEntriesPerMinute = entries.length / Math.max(timeRange, 1);\n\n    return {\n      total: entries.length,\n      byLevel,\n      byLogger,\n      byHour: Array.from(byHour.entries())\n        .map(([hour, count]) => ({ hour, count }))\n        .sort((a, b) => a.hour.localeCompare(b.hour)),\n      errorRate,\n      avgEntriesPerMinute,\n    };\n  }\n\n  // ---------------------------------------------------------------------------\n  // Private Helpers\n  // ---------------------------------------------------------------------------\n\n  private passesFilter(entry: LogEntry): boolean {\n    const filter = this.config.filter!;\n\n    // Check includes\n    if (filter.levels && filter.levels.length > 0) {\n      if (!filter.levels.includes(entry.level)) return false;\n    }\n\n    if (filter.loggers && filter.loggers.length > 0) {\n      if (!entry.logger || !filter.loggers.some(l =>\n        entry.logger!.startsWith(l) || l === \"*\"\n      )) return false;\n    }\n\n    if (filter.tags && filter.tags.length > 0) {\n      if (!entry.tags || !filter.tags.some(t => entry.tags!.includes(t))) return false;\n    }\n\n    if (filter.pattern) {\n      const regex = new RegExp(filter.pattern);\n      if (!regex.test(entry.message)) return false;\n    }\n\n    // Check excludes\n    if (filter.exclude) {\n      if (filter.exclude.levels?.includes(entry.level)) return false;\n\n      if (filter.exclude.loggers && entry.logger) {\n        if (filter.exclude.loggers.some(l =>\n          entry.logger!.startsWith(l) || l === \"*\"\n        )) return false;\n      }\n\n      if (filter.exclude.tags && entry.tags) {\n        if (filter.exclude.tags.some(t => entry.tags!.includes(t))) return false;\n      }\n\n      if (filter.exclude.pattern) {\n        const regex = new RegExp(filter.exclude.pattern);\n        if (regex.test(entry.message)) return false;\n      }\n    }\n\n    return true;\n  }\n\n  private passesSampling(entry: LogEntry): boolean {\n    const sampling = this.config.sampling!;\n\n    // Check specific rules first\n    if (sampling.rules) {\n      for (const rule of sampling.rules) {\n        if (this.matchesFilter(entry, rule.match)) {\n          return Math.random() < rule.rate;\n        }\n      }\n    }\n\n    // Apply default rate\n    return Math.random() < sampling.rate;\n  }\n\n  private matchesFilter(entry: LogEntry, filter: typeof this.config.filter): boolean {\n    if (!filter) return true;\n\n    if (filter.levels?.length && !filter.levels.includes(entry.level)) return false;\n    if (filter.loggers?.length && (!entry.logger || !filter.loggers.includes(entry.logger))) return false;\n    if (filter.tags?.length && (!entry.tags || !filter.tags.some(t => entry.tags!.includes(t)))) return false;\n    if (filter.pattern && !new RegExp(filter.pattern).test(entry.message)) return false;\n\n    return true;\n  }\n\n  private applyRedaction(entry: LogEntry): void {\n    const redaction = this.config.redaction!;\n    const redactedFields: string[] = [];\n\n    const redactValue = (value: string): string => {\n      if (redaction.hash) {\n        return createHash(\"sha256\").update(value).digest(\"hex\").slice(0, 8);\n      }\n      return redaction.replacement;\n    };\n\n    const redactObject = (obj: Record<string, unknown>, path: string = \"\"): void => {\n      for (const key of Object.keys(obj)) {\n        const fullPath = path ? `${path}.${key}` : key;\n        const lowerKey = key.toLowerCase();\n\n        // Check if field should be redacted\n        if (redaction.fields.some(f => lowerKey.includes(f.toLowerCase()))) {\n          if (typeof obj[key] === \"string\") {\n            obj[key] = redactValue(obj[key] as string);\n            redactedFields.push(fullPath);\n          }\n        } else if (typeof obj[key] === \"object\" && obj[key] !== null) {\n          redactObject(obj[key] as Record<string, unknown>, fullPath);\n        }\n      }\n    };\n\n    if (entry.data) {\n      redactObject(entry.data);\n    }\n\n    // Check patterns in message\n    if (redaction.patterns) {\n      for (const pattern of redaction.patterns) {\n        const regex = new RegExp(pattern, \"g\");\n        if (regex.test(entry.message)) {\n          entry.message = entry.message.replace(regex, redaction.replacement);\n          redactedFields.push(\"message\");\n        }\n      }\n    }\n\n    if (redactedFields.length > 0) {\n      this.emit(\"redacted\", entry, redactedFields);\n    }\n  }\n\n  private sendToTransports(entry: LogEntry): void {\n    for (const transport of this.transports) {\n      if (LOG_LEVEL_VALUES[entry.level] >= LOG_LEVEL_VALUES[transport.level]) {\n        transport.log(entry).catch(error => {\n          this.emit(\"transportError\", transport.type, error as Error);\n        });\n      }\n    }\n  }\n\n  private flushBuffer(): void {\n    if (this.buffer.length === 0) return;\n\n    const entries = [...this.buffer];\n    this.buffer = [];\n\n    for (const entry of entries) {\n      this.sendToTransports(entry);\n    }\n\n    this.emit(\"bufferFlushed\", entries.length);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Lifecycle\n  // ---------------------------------------------------------------------------\n\n  async flush(): Promise<void> {\n    this.flushBuffer();\n\n    await Promise.all(\n      this.transports\n        .filter(t => t.flush)\n        .map(t => t.flush!())\n    );\n  }\n\n  async shutdown(): Promise<void> {\n    if (this.bufferInterval) {\n      clearInterval(this.bufferInterval);\n    }\n\n    await this.flush();\n\n    await Promise.all(\n      this.transports\n        .filter(t => t.close)\n        .map(t => t.close!())\n    );\n\n    this.emit(\"shutdown\");\n    this.removeAllListeners();\n  }\n}\n\n// =============================================================================\n// Factory Functions\n// =============================================================================\n\nlet defaultAggregator: LogAggregator | null = null;\n\nexport function getLogAggregator(): LogAggregator {\n  if (!defaultAggregator) {\n    throw new Error(\"Log Aggregator not initialized. Call createLogAggregator first.\");\n  }\n  return defaultAggregator;\n}\n\nexport function createLogAggregator(\n  config: Partial<LogAggregatorConfig> & { service: string }\n): LogAggregator {\n  const aggregator = new LogAggregator(config);\n  if (!defaultAggregator) {\n    defaultAggregator = aggregator;\n  }\n  return aggregator;\n}\n","/**\n * Metrics Registry Types\n * Phase 14C: Metrics Registry\n */\n\nimport { z } from \"zod\";\n\n// =============================================================================\n// Metric Types\n// =============================================================================\n\nexport const MetricKindSchema = z.enum([\n  \"counter\",\n  \"gauge\",\n  \"histogram\",\n  \"summary\",\n]);\nexport type MetricKind = z.infer<typeof MetricKindSchema>;\n\n// =============================================================================\n// Labels\n// =============================================================================\n\nexport const LabelSchema = z.record(z.string());\nexport type Label = z.infer<typeof LabelSchema>;\n\n// =============================================================================\n// Metric Value\n// =============================================================================\n\nexport const MetricValueSchema = z.object({\n  value: z.number(),\n  timestamp: z.number().optional(),\n  labels: LabelSchema.default({}),\n});\nexport type MetricValue = z.infer<typeof MetricValueSchema>;\n\n// =============================================================================\n// Histogram Value\n// =============================================================================\n\nexport const HistogramValueSchema = z.object({\n  buckets: z.record(z.string(), z.number()).describe(\"Bucket boundaries to counts\"),\n  sum: z.number(),\n  count: z.number(),\n  labels: LabelSchema.default({}),\n  timestamp: z.number().optional(),\n});\nexport type HistogramValue = z.infer<typeof HistogramValueSchema>;\n\n// =============================================================================\n// Summary Value\n// =============================================================================\n\nexport const SummaryValueSchema = z.object({\n  quantiles: z.record(z.string(), z.number()).describe(\"Quantile to value\"),\n  sum: z.number(),\n  count: z.number(),\n  labels: LabelSchema.default({}),\n  timestamp: z.number().optional(),\n});\nexport type SummaryValue = z.infer<typeof SummaryValueSchema>;\n\n// =============================================================================\n// Metric Definition\n// =============================================================================\n\nexport const MetricDefSchema = z.object({\n  name: z.string().regex(/^[a-zA-Z_:][a-zA-Z0-9_:]*$/),\n  kind: MetricKindSchema,\n  help: z.string(),\n  unit: z.string().optional(),\n  labelNames: z.array(z.string()).default([]),\n  buckets: z.array(z.number()).optional().describe(\"For histograms\"),\n  quantiles: z.array(z.number()).optional().describe(\"For summaries\"),\n  maxAge: z.number().optional().describe(\"For summaries - window in ms\"),\n});\nexport type MetricDef = z.infer<typeof MetricDefSchema>;\n\n// =============================================================================\n// Metric Sample\n// =============================================================================\n\nexport const MetricSampleSchema = z.object({\n  name: z.string(),\n  kind: MetricKindSchema,\n  help: z.string(),\n  unit: z.string().optional(),\n  values: z.array(z.union([\n    MetricValueSchema,\n    HistogramValueSchema,\n    SummaryValueSchema,\n  ])),\n});\nexport type MetricSample = z.infer<typeof MetricSampleSchema>;\n\n// =============================================================================\n// Collector Config\n// =============================================================================\n\nexport const CollectorConfigSchema = z.object({\n  name: z.string(),\n  collect: z.function().args().returns(z.promise(z.array(MetricSampleSchema))),\n});\nexport type CollectorConfig = z.infer<typeof CollectorConfigSchema>;\n\n// =============================================================================\n// Export Format\n// =============================================================================\n\nexport const ExportFormatSchema = z.enum([\n  \"prometheus\",\n  \"openmetrics\",\n  \"json\",\n  \"statsd\",\n]);\nexport type ExportFormat = z.infer<typeof ExportFormatSchema>;\n\n// =============================================================================\n// Push Gateway Config\n// =============================================================================\n\nexport const PushGatewayConfigSchema = z.object({\n  url: z.string().url(),\n  job: z.string(),\n  instance: z.string().optional(),\n  auth: z.object({\n    type: z.enum([\"basic\", \"bearer\"]),\n    username: z.string().optional(),\n    password: z.string().optional(),\n    token: z.string().optional(),\n  }).optional(),\n  pushInterval: z.number().default(15000),\n  groupings: z.record(z.string()).optional(),\n});\nexport type PushGatewayConfig = z.infer<typeof PushGatewayConfigSchema>;\n\n// =============================================================================\n// Registry Config\n// =============================================================================\n\nexport const MetricsRegistryConfigSchema = z.object({\n  prefix: z.string().optional(),\n  defaultLabels: LabelSchema.default({}),\n  enableDefaultMetrics: z.boolean().default(true),\n  defaultMetricsInterval: z.number().default(10000),\n  pushGateway: PushGatewayConfigSchema.optional(),\n  buckets: z.object({\n    http: z.array(z.number()).default([0.005, 0.01, 0.025, 0.05, 0.1, 0.25, 0.5, 1, 2.5, 5, 10]),\n    default: z.array(z.number()).default([0.005, 0.01, 0.025, 0.05, 0.1, 0.25, 0.5, 1, 2.5, 5, 10]),\n  }).optional(),\n  quantiles: z.array(z.number()).default([0.5, 0.9, 0.95, 0.99]),\n});\nexport type MetricsRegistryConfig = z.infer<typeof MetricsRegistryConfigSchema>;\n\n// =============================================================================\n// Aggregation\n// =============================================================================\n\nexport const AggregationTypeSchema = z.enum([\n  \"sum\",\n  \"avg\",\n  \"min\",\n  \"max\",\n  \"count\",\n  \"rate\",\n  \"increase\",\n]);\nexport type AggregationType = z.infer<typeof AggregationTypeSchema>;\n\nexport const AggregationConfigSchema = z.object({\n  type: AggregationTypeSchema,\n  interval: z.number().optional().describe(\"For rate/increase\"),\n  labels: z.array(z.string()).optional().describe(\"Group by labels\"),\n});\nexport type AggregationConfig = z.infer<typeof AggregationConfigSchema>;\n\n// =============================================================================\n// Query\n// =============================================================================\n\nexport const MetricsQuerySchema = z.object({\n  name: z.string(),\n  labels: LabelSchema.optional(),\n  start: z.number().optional(),\n  end: z.number().optional(),\n  step: z.number().optional(),\n  aggregation: AggregationConfigSchema.optional(),\n});\nexport type MetricsQuery = z.infer<typeof MetricsQuerySchema>;\n\n// =============================================================================\n// Time Series\n// =============================================================================\n\nexport const TimeSeriesPointSchema = z.object({\n  timestamp: z.number(),\n  value: z.number(),\n});\nexport type TimeSeriesPoint = z.infer<typeof TimeSeriesPointSchema>;\n\nexport const TimeSeriesSchema = z.object({\n  metric: z.string(),\n  labels: LabelSchema,\n  points: z.array(TimeSeriesPointSchema),\n});\nexport type TimeSeries = z.infer<typeof TimeSeriesSchema>;\n\n// =============================================================================\n// Events\n// =============================================================================\n\nexport type MetricsEvents = {\n  // Metric Events\n  metricRegistered: (def: MetricDef) => void;\n  metricUpdated: (name: string, labels: Label, value: number) => void;\n  metricRemoved: (name: string) => void;\n\n  // Collection Events\n  collectionStarted: () => void;\n  collectionCompleted: (metrics: MetricSample[]) => void;\n\n  // Push Events\n  pushStarted: () => void;\n  pushCompleted: (success: boolean) => void;\n  pushError: (error: Error) => void;\n\n  // Errors\n  error: (error: Error) => void;\n};\n\n// =============================================================================\n// Default Metrics\n// =============================================================================\n\nexport const DEFAULT_METRICS: MetricDef[] = [\n  {\n    name: \"process_cpu_seconds_total\",\n    kind: \"counter\",\n    help: \"Total user and system CPU time spent in seconds\",\n  },\n  {\n    name: \"process_resident_memory_bytes\",\n    kind: \"gauge\",\n    help: \"Resident memory size in bytes\",\n  },\n  {\n    name: \"process_heap_bytes\",\n    kind: \"gauge\",\n    help: \"Process heap size in bytes\",\n  },\n  {\n    name: \"process_open_fds\",\n    kind: \"gauge\",\n    help: \"Number of open file descriptors\",\n  },\n  {\n    name: \"process_start_time_seconds\",\n    kind: \"gauge\",\n    help: \"Start time of the process since unix epoch in seconds\",\n  },\n  {\n    name: \"nodejs_eventloop_lag_seconds\",\n    kind: \"gauge\",\n    help: \"Lag of event loop in seconds\",\n  },\n  {\n    name: \"nodejs_active_handles_total\",\n    kind: \"gauge\",\n    help: \"Number of active handles\",\n  },\n  {\n    name: \"nodejs_active_requests_total\",\n    kind: \"gauge\",\n    help: \"Number of active requests\",\n  },\n  {\n    name: \"nodejs_heap_size_total_bytes\",\n    kind: \"gauge\",\n    help: \"Process heap size from Node.js in bytes\",\n  },\n  {\n    name: \"nodejs_heap_size_used_bytes\",\n    kind: \"gauge\",\n    help: \"Process heap size used from Node.js in bytes\",\n  },\n  {\n    name: \"nodejs_external_memory_bytes\",\n    kind: \"gauge\",\n    help: \"Node.js external memory size in bytes\",\n  },\n  {\n    name: \"nodejs_gc_duration_seconds\",\n    kind: \"histogram\",\n    help: \"Garbage collection duration\",\n    labelNames: [\"gc_type\"],\n    buckets: [0.001, 0.01, 0.1, 1, 2, 5],\n  },\n];\n\n// =============================================================================\n// Common Metric Definitions\n// =============================================================================\n\nexport const HTTP_METRICS: MetricDef[] = [\n  {\n    name: \"http_requests_total\",\n    kind: \"counter\",\n    help: \"Total number of HTTP requests\",\n    labelNames: [\"method\", \"route\", \"status_code\"],\n  },\n  {\n    name: \"http_request_duration_seconds\",\n    kind: \"histogram\",\n    help: \"HTTP request duration in seconds\",\n    labelNames: [\"method\", \"route\", \"status_code\"],\n    buckets: [0.005, 0.01, 0.025, 0.05, 0.1, 0.25, 0.5, 1, 2.5, 5, 10],\n  },\n  {\n    name: \"http_request_size_bytes\",\n    kind: \"histogram\",\n    help: \"HTTP request size in bytes\",\n    labelNames: [\"method\", \"route\"],\n    buckets: [100, 1000, 10000, 100000, 1000000],\n  },\n  {\n    name: \"http_response_size_bytes\",\n    kind: \"histogram\",\n    help: \"HTTP response size in bytes\",\n    labelNames: [\"method\", \"route\"],\n    buckets: [100, 1000, 10000, 100000, 1000000],\n  },\n  {\n    name: \"http_requests_in_flight\",\n    kind: \"gauge\",\n    help: \"Number of HTTP requests currently in flight\",\n    labelNames: [\"method\"],\n  },\n];\n\nexport const DB_METRICS: MetricDef[] = [\n  {\n    name: \"db_queries_total\",\n    kind: \"counter\",\n    help: \"Total number of database queries\",\n    labelNames: [\"operation\", \"table\", \"status\"],\n  },\n  {\n    name: \"db_query_duration_seconds\",\n    kind: \"histogram\",\n    help: \"Database query duration in seconds\",\n    labelNames: [\"operation\", \"table\"],\n    buckets: [0.001, 0.005, 0.01, 0.025, 0.05, 0.1, 0.25, 0.5, 1, 2.5, 5],\n  },\n  {\n    name: \"db_connections_total\",\n    kind: \"gauge\",\n    help: \"Number of database connections\",\n    labelNames: [\"state\"],\n  },\n];\n\nexport const CACHE_METRICS: MetricDef[] = [\n  {\n    name: \"cache_hits_total\",\n    kind: \"counter\",\n    help: \"Total number of cache hits\",\n    labelNames: [\"cache\"],\n  },\n  {\n    name: \"cache_misses_total\",\n    kind: \"counter\",\n    help: \"Total number of cache misses\",\n    labelNames: [\"cache\"],\n  },\n  {\n    name: \"cache_size_bytes\",\n    kind: \"gauge\",\n    help: \"Current size of cache in bytes\",\n    labelNames: [\"cache\"],\n  },\n  {\n    name: \"cache_items_total\",\n    kind: \"gauge\",\n    help: \"Number of items in cache\",\n    labelNames: [\"cache\"],\n  },\n];\n","/**\n * Metrics Registry Implementation\n * Phase 14C: Metrics Registry\n */\n\nimport { EventEmitter } from \"eventemitter3\";\nimport {\n  type MetricsRegistryConfig,\n  MetricsRegistryConfigSchema,\n  type MetricDef,\n  type MetricSample,\n  type MetricValue,\n  type HistogramValue,\n  type SummaryValue,\n  type Label,\n  type ExportFormat,\n  type MetricsEvents,\n  type TimeSeries,\n  DEFAULT_METRICS,\n} from \"./types.js\";\n\n// =============================================================================\n// Helper Functions\n// =============================================================================\n\nfunction labelHash(labels: Label): string {\n  return Object.entries(labels)\n    .sort(([a], [b]) => a.localeCompare(b))\n    .map(([k, v]) => `${k}=\"${v}\"`)\n    .join(\",\");\n}\n\nfunction labelsMatch(actual: Label, query: Label): boolean {\n  for (const [key, value] of Object.entries(query)) {\n    if (actual[key] !== value) return false;\n  }\n  return true;\n}\n\n// =============================================================================\n// Counter\n// =============================================================================\n\nexport class Counter {\n  private values = new Map<string, number>();\n\n  constructor(\n    private registry: MetricsRegistry,\n    private def: MetricDef\n  ) {}\n\n  inc(labels: Label = {}, value: number = 1): void {\n    if (value < 0) {\n      throw new Error(\"Counter value cannot be negative\");\n    }\n\n    const hash = labelHash(labels);\n    const current = this.values.get(hash) ?? 0;\n    this.values.set(hash, current + value);\n    this.registry[\"emit\"](\"metricUpdated\", this.def.name, labels, current + value);\n  }\n\n  get(labels: Label = {}): number {\n    return this.values.get(labelHash(labels)) ?? 0;\n  }\n\n  reset(): void {\n    this.values.clear();\n  }\n\n  collect(): MetricValue[] {\n    const result: MetricValue[] = [];\n    for (const [hash, value] of this.values) {\n      const labels = this.parseLabels(hash);\n      result.push({ value, labels, timestamp: Date.now() });\n    }\n    return result;\n  }\n\n  private parseLabels(hash: string): Label {\n    if (!hash) return {};\n    const labels: Label = {};\n    for (const pair of hash.split(\",\")) {\n      const match = pair.match(/^([^=]+)=\"([^\"]*)\"$/);\n      if (match) {\n        labels[match[1]] = match[2];\n      }\n    }\n    return labels;\n  }\n}\n\n// =============================================================================\n// Gauge\n// =============================================================================\n\nexport class Gauge {\n  private values = new Map<string, number>();\n\n  constructor(\n    private registry: MetricsRegistry,\n    private def: MetricDef\n  ) {}\n\n  set(labels: Label, value: number): void;\n  set(value: number): void;\n  set(labelsOrValue: Label | number, maybeValue?: number): void {\n    const labels = typeof labelsOrValue === \"object\" ? labelsOrValue : {};\n    const value = typeof labelsOrValue === \"number\" ? labelsOrValue : maybeValue!;\n\n    const hash = labelHash(labels);\n    this.values.set(hash, value);\n    this.registry[\"emit\"](\"metricUpdated\", this.def.name, labels, value);\n  }\n\n  inc(labels: Label = {}, value: number = 1): void {\n    const hash = labelHash(labels);\n    const current = this.values.get(hash) ?? 0;\n    this.values.set(hash, current + value);\n  }\n\n  dec(labels: Label = {}, value: number = 1): void {\n    const hash = labelHash(labels);\n    const current = this.values.get(hash) ?? 0;\n    this.values.set(hash, current - value);\n  }\n\n  get(labels: Label = {}): number {\n    return this.values.get(labelHash(labels)) ?? 0;\n  }\n\n  setToCurrentTime(labels: Label = {}): void {\n    this.set(labels, Date.now() / 1000);\n  }\n\n  reset(): void {\n    this.values.clear();\n  }\n\n  collect(): MetricValue[] {\n    const result: MetricValue[] = [];\n    for (const [hash, value] of this.values) {\n      const labels = this.parseLabels(hash);\n      result.push({ value, labels, timestamp: Date.now() });\n    }\n    return result;\n  }\n\n  private parseLabels(hash: string): Label {\n    if (!hash) return {};\n    const labels: Label = {};\n    for (const pair of hash.split(\",\")) {\n      const match = pair.match(/^([^=]+)=\"([^\"]*)\"$/);\n      if (match) {\n        labels[match[1]] = match[2];\n      }\n    }\n    return labels;\n  }\n}\n\n// =============================================================================\n// Histogram\n// =============================================================================\n\nexport class Histogram {\n  private data = new Map<string, {\n    buckets: Map<number, number>;\n    sum: number;\n    count: number;\n  }>();\n  private buckets: number[];\n\n  constructor(\n    private registry: MetricsRegistry,\n    private def: MetricDef\n  ) {\n    this.buckets = def.buckets ?? [0.005, 0.01, 0.025, 0.05, 0.1, 0.25, 0.5, 1, 2.5, 5, 10];\n  }\n\n  observe(labels: Label, value: number): void;\n  observe(value: number): void;\n  observe(labelsOrValue: Label | number, maybeValue?: number): void {\n    const labels = typeof labelsOrValue === \"object\" ? labelsOrValue : {};\n    const value = typeof labelsOrValue === \"number\" ? labelsOrValue : maybeValue!;\n\n    const hash = labelHash(labels);\n    let data = this.data.get(hash);\n\n    if (!data) {\n      data = {\n        buckets: new Map(this.buckets.map(b => [b, 0])),\n        sum: 0,\n        count: 0,\n      };\n      this.data.set(hash, data);\n    }\n\n    // Update buckets\n    for (const bucket of this.buckets) {\n      if (value <= bucket) {\n        data.buckets.set(bucket, (data.buckets.get(bucket) ?? 0) + 1);\n      }\n    }\n\n    data.sum += value;\n    data.count += 1;\n\n    this.registry[\"emit\"](\"metricUpdated\", this.def.name, labels, value);\n  }\n\n  startTimer(labels: Label = {}): () => number {\n    const start = process.hrtime.bigint();\n    return () => {\n      const end = process.hrtime.bigint();\n      const duration = Number(end - start) / 1e9; // Convert to seconds\n      this.observe(labels, duration);\n      return duration;\n    };\n  }\n\n  reset(): void {\n    this.data.clear();\n  }\n\n  collect(): HistogramValue[] {\n    const result: HistogramValue[] = [];\n    for (const [hash, data] of this.data) {\n      const labels = this.parseLabels(hash);\n      const buckets: Record<string, number> = {};\n\n      // Add +Inf bucket\n      let total = 0;\n      for (const [boundary, count] of data.buckets) {\n        total += count;\n        buckets[String(boundary)] = total;\n      }\n      buckets[\"+Inf\"] = data.count;\n\n      result.push({\n        buckets,\n        sum: data.sum,\n        count: data.count,\n        labels,\n        timestamp: Date.now(),\n      });\n    }\n    return result;\n  }\n\n  private parseLabels(hash: string): Label {\n    if (!hash) return {};\n    const labels: Label = {};\n    for (const pair of hash.split(\",\")) {\n      const match = pair.match(/^([^=]+)=\"([^\"]*)\"$/);\n      if (match) {\n        labels[match[1]] = match[2];\n      }\n    }\n    return labels;\n  }\n}\n\n// =============================================================================\n// Summary\n// =============================================================================\n\nexport class Summary {\n  private data = new Map<string, {\n    values: number[];\n    sum: number;\n    count: number;\n  }>();\n  private quantiles: number[];\n  private maxAge: number;\n\n  constructor(\n    private registry: MetricsRegistry,\n    private def: MetricDef\n  ) {\n    this.quantiles = def.quantiles ?? [0.5, 0.9, 0.95, 0.99];\n    this.maxAge = def.maxAge ?? 600000; // 10 minutes default\n  }\n\n  observe(labels: Label, value: number): void;\n  observe(value: number): void;\n  observe(labelsOrValue: Label | number, maybeValue?: number): void {\n    const labels = typeof labelsOrValue === \"object\" ? labelsOrValue : {};\n    const value = typeof labelsOrValue === \"number\" ? labelsOrValue : maybeValue!;\n\n    const hash = labelHash(labels);\n    let data = this.data.get(hash);\n\n    if (!data) {\n      data = { values: [], sum: 0, count: 0 };\n      this.data.set(hash, data);\n    }\n\n    data.values.push(value);\n    data.sum += value;\n    data.count += 1;\n\n    // Trim old values (simplified - real implementation would use time-based windows)\n    if (data.values.length > 10000) {\n      data.values = data.values.slice(-5000);\n    }\n\n    this.registry[\"emit\"](\"metricUpdated\", this.def.name, labels, value);\n  }\n\n  startTimer(labels: Label = {}): () => number {\n    const start = process.hrtime.bigint();\n    return () => {\n      const end = process.hrtime.bigint();\n      const duration = Number(end - start) / 1e9;\n      this.observe(labels, duration);\n      return duration;\n    };\n  }\n\n  reset(): void {\n    this.data.clear();\n  }\n\n  collect(): SummaryValue[] {\n    const result: SummaryValue[] = [];\n    for (const [hash, data] of this.data) {\n      const labels = this.parseLabels(hash);\n      const sorted = [...data.values].sort((a, b) => a - b);\n      const quantiles: Record<string, number> = {};\n\n      for (const q of this.quantiles) {\n        const index = Math.floor(q * sorted.length);\n        quantiles[String(q)] = sorted[index] ?? 0;\n      }\n\n      result.push({\n        quantiles,\n        sum: data.sum,\n        count: data.count,\n        labels,\n        timestamp: Date.now(),\n      });\n    }\n    return result;\n  }\n\n  private parseLabels(hash: string): Label {\n    if (!hash) return {};\n    const labels: Label = {};\n    for (const pair of hash.split(\",\")) {\n      const match = pair.match(/^([^=]+)=\"([^\"]*)\"$/);\n      if (match) {\n        labels[match[1]] = match[2];\n      }\n    }\n    return labels;\n  }\n}\n\n// =============================================================================\n// Metrics Registry\n// =============================================================================\n\nexport class MetricsRegistry extends EventEmitter<MetricsEvents> {\n  private config: MetricsRegistryConfig;\n  private metrics = new Map<string, Counter | Gauge | Histogram | Summary>();\n  private definitions = new Map<string, MetricDef>();\n  private collectors: Array<{ name: string; collect: () => Promise<MetricSample[]> }> = [];\n  private defaultMetricsInterval?: ReturnType<typeof setInterval>;\n  private pushInterval?: ReturnType<typeof setInterval>;\n  private timeSeries = new Map<string, TimeSeries>();\n\n  constructor(config: Partial<MetricsRegistryConfig> = {}) {\n    super();\n    this.config = MetricsRegistryConfigSchema.parse(config);\n\n    // Register default metrics\n    if (this.config.enableDefaultMetrics) {\n      for (const def of DEFAULT_METRICS) {\n        this.registerMetric(def);\n      }\n      this.startDefaultMetrics();\n    }\n\n    // Start push gateway\n    if (this.config.pushGateway) {\n      this.startPushGateway();\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Metric Registration\n  // ---------------------------------------------------------------------------\n\n  registerMetric(def: MetricDef): Counter | Gauge | Histogram | Summary {\n    const name = this.prefixName(def.name);\n    const fullDef = { ...def, name };\n\n    if (this.metrics.has(name)) {\n      throw new Error(`Metric '${name}' already registered`);\n    }\n\n    let metric: Counter | Gauge | Histogram | Summary;\n\n    switch (def.kind) {\n      case \"counter\":\n        metric = new Counter(this, fullDef);\n        break;\n      case \"gauge\":\n        metric = new Gauge(this, fullDef);\n        break;\n      case \"histogram\":\n        metric = new Histogram(this, fullDef);\n        break;\n      case \"summary\":\n        metric = new Summary(this, fullDef);\n        break;\n    }\n\n    this.metrics.set(name, metric);\n    this.definitions.set(name, fullDef);\n    this.emit(\"metricRegistered\", fullDef);\n\n    return metric;\n  }\n\n  counter(name: string, help: string, labelNames: string[] = []): Counter {\n    return this.registerMetric({\n      name,\n      kind: \"counter\",\n      help,\n      labelNames,\n    }) as Counter;\n  }\n\n  gauge(name: string, help: string, labelNames: string[] = []): Gauge {\n    return this.registerMetric({\n      name,\n      kind: \"gauge\",\n      help,\n      labelNames,\n    }) as Gauge;\n  }\n\n  histogram(\n    name: string,\n    help: string,\n    labelNames: string[] = [],\n    buckets?: number[]\n  ): Histogram {\n    return this.registerMetric({\n      name,\n      kind: \"histogram\",\n      help,\n      labelNames,\n      buckets: buckets ?? this.config.buckets?.default,\n    }) as Histogram;\n  }\n\n  summary(\n    name: string,\n    help: string,\n    labelNames: string[] = [],\n    quantiles?: number[]\n  ): Summary {\n    return this.registerMetric({\n      name,\n      kind: \"summary\",\n      help,\n      labelNames,\n      quantiles: quantiles ?? this.config.quantiles,\n    }) as Summary;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Metric Access\n  // ---------------------------------------------------------------------------\n\n  getMetric(name: string): Counter | Gauge | Histogram | Summary | undefined {\n    return this.metrics.get(this.prefixName(name));\n  }\n\n  removeMetric(name: string): boolean {\n    const fullName = this.prefixName(name);\n    if (this.metrics.has(fullName)) {\n      this.metrics.delete(fullName);\n      this.definitions.delete(fullName);\n      this.emit(\"metricRemoved\", fullName);\n      return true;\n    }\n    return false;\n  }\n\n  resetMetrics(): void {\n    for (const metric of this.metrics.values()) {\n      metric.reset();\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Collectors\n  // ---------------------------------------------------------------------------\n\n  registerCollector(\n    name: string,\n    collect: () => Promise<MetricSample[]>\n  ): void {\n    this.collectors.push({ name, collect });\n  }\n\n  removeCollector(name: string): boolean {\n    const index = this.collectors.findIndex(c => c.name === name);\n    if (index >= 0) {\n      this.collectors.splice(index, 1);\n      return true;\n    }\n    return false;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Collection\n  // ---------------------------------------------------------------------------\n\n  async collect(): Promise<MetricSample[]> {\n    this.emit(\"collectionStarted\");\n\n    const samples: MetricSample[] = [];\n\n    // Collect from registered metrics\n    for (const [name, metric] of this.metrics) {\n      const def = this.definitions.get(name)!;\n      const values = metric.collect();\n\n      // Add default labels\n      for (const value of values) {\n        value.labels = { ...this.config.defaultLabels, ...value.labels };\n      }\n\n      samples.push({\n        name,\n        kind: def.kind,\n        help: def.help,\n        unit: def.unit,\n        values,\n      });\n    }\n\n    // Collect from custom collectors\n    for (const collector of this.collectors) {\n      try {\n        const collectorSamples = await collector.collect();\n        samples.push(...collectorSamples);\n      } catch (error) {\n        this.emit(\"error\", error as Error);\n      }\n    }\n\n    this.emit(\"collectionCompleted\", samples);\n    return samples;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Export\n  // ---------------------------------------------------------------------------\n\n  async export(format: ExportFormat = \"prometheus\"): Promise<string> {\n    const samples = await this.collect();\n\n    switch (format) {\n      case \"prometheus\":\n      case \"openmetrics\":\n        return this.formatPrometheus(samples, format === \"openmetrics\");\n      case \"json\":\n        return JSON.stringify(samples, null, 2);\n      case \"statsd\":\n        return this.formatStatsd(samples);\n      default:\n        throw new Error(`Unknown format: ${format}`);\n    }\n  }\n\n  private formatPrometheus(samples: MetricSample[], openMetrics: boolean): string {\n    const lines: string[] = [];\n\n    for (const sample of samples) {\n      // Type and help\n      lines.push(`# HELP ${sample.name} ${sample.help}`);\n      lines.push(`# TYPE ${sample.name} ${sample.kind}`);\n\n      if (sample.unit && openMetrics) {\n        lines.push(`# UNIT ${sample.name} ${sample.unit}`);\n      }\n\n      for (const value of sample.values) {\n        if (\"buckets\" in value) {\n          // Histogram\n          const hv = value as HistogramValue;\n          const labelsStr = this.formatLabels(hv.labels);\n\n          for (const [le, count] of Object.entries(hv.buckets)) {\n            const bucketLabels = labelsStr ? `{${labelsStr},le=\"${le}\"}` : `{le=\"${le}\"}`;\n            lines.push(`${sample.name}_bucket${bucketLabels} ${count}`);\n          }\n\n          const baseLabels = labelsStr ? `{${labelsStr}}` : \"\";\n          lines.push(`${sample.name}_sum${baseLabels} ${hv.sum}`);\n          lines.push(`${sample.name}_count${baseLabels} ${hv.count}`);\n        } else if (\"quantiles\" in value) {\n          // Summary\n          const sv = value as SummaryValue;\n          const labelsStr = this.formatLabels(sv.labels);\n\n          for (const [q, v] of Object.entries(sv.quantiles)) {\n            const quantileLabels = labelsStr ? `{${labelsStr},quantile=\"${q}\"}` : `{quantile=\"${q}\"}`;\n            lines.push(`${sample.name}${quantileLabels} ${v}`);\n          }\n\n          const baseLabels = labelsStr ? `{${labelsStr}}` : \"\";\n          lines.push(`${sample.name}_sum${baseLabels} ${sv.sum}`);\n          lines.push(`${sample.name}_count${baseLabels} ${sv.count}`);\n        } else {\n          // Counter or Gauge\n          const mv = value as MetricValue;\n          const labelsStr = this.formatLabels(mv.labels);\n          const labelPart = labelsStr ? `{${labelsStr}}` : \"\";\n          lines.push(`${sample.name}${labelPart} ${mv.value}`);\n        }\n      }\n\n      lines.push(\"\");\n    }\n\n    if (openMetrics) {\n      lines.push(\"# EOF\");\n    }\n\n    return lines.join(\"\\n\");\n  }\n\n  private formatStatsd(samples: MetricSample[]): string {\n    const lines: string[] = [];\n\n    for (const sample of samples) {\n      for (const value of sample.values) {\n        const tags = Object.entries((value as MetricValue).labels)\n          .map(([k, v]) => `${k}:${v}`)\n          .join(\",\");\n\n        const tagPart = tags ? `|#${tags}` : \"\";\n\n        if (\"buckets\" in value || \"quantiles\" in value) {\n          // Skip complex types for statsd\n          continue;\n        }\n\n        const mv = value as MetricValue;\n        const type = sample.kind === \"counter\" ? \"c\" : \"g\";\n        lines.push(`${sample.name}:${mv.value}|${type}${tagPart}`);\n      }\n    }\n\n    return lines.join(\"\\n\");\n  }\n\n  private formatLabels(labels: Label): string {\n    return Object.entries(labels)\n      .map(([k, v]) => `${k}=\"${v}\"`)\n      .join(\",\");\n  }\n\n  // ---------------------------------------------------------------------------\n  // Default Metrics\n  // ---------------------------------------------------------------------------\n\n  private startDefaultMetrics(): void {\n    const collectDefaultMetrics = () => {\n      const memUsage = process.memoryUsage();\n\n      const residentMem = this.getMetric(\"process_resident_memory_bytes\") as Gauge;\n      if (residentMem) residentMem.set(memUsage.rss);\n\n      const heapTotal = this.getMetric(\"nodejs_heap_size_total_bytes\") as Gauge;\n      if (heapTotal) heapTotal.set(memUsage.heapTotal);\n\n      const heapUsed = this.getMetric(\"nodejs_heap_size_used_bytes\") as Gauge;\n      if (heapUsed) heapUsed.set(memUsage.heapUsed);\n\n      const external = this.getMetric(\"nodejs_external_memory_bytes\") as Gauge;\n      if (external) external.set(memUsage.external);\n\n      const heapBytes = this.getMetric(\"process_heap_bytes\") as Gauge;\n      if (heapBytes) heapBytes.set(memUsage.heapUsed);\n\n      // Process start time\n      const startTime = this.getMetric(\"process_start_time_seconds\") as Gauge;\n      if (startTime) startTime.set(Date.now() / 1000 - process.uptime());\n    };\n\n    // Collect immediately and then at intervals\n    collectDefaultMetrics();\n    this.defaultMetricsInterval = setInterval(\n      collectDefaultMetrics,\n      this.config.defaultMetricsInterval\n    );\n  }\n\n  // ---------------------------------------------------------------------------\n  // Push Gateway\n  // ---------------------------------------------------------------------------\n\n  private startPushGateway(): void {\n    const push = async () => {\n      this.emit(\"pushStarted\");\n      try {\n        const metrics = await this.export(\"prometheus\");\n        // In real implementation, would POST to push gateway\n        console.log(`[Push Gateway] Would push metrics to ${this.config.pushGateway!.url}`);\n        this.emit(\"pushCompleted\", true);\n      } catch (error) {\n        this.emit(\"pushError\", error as Error);\n        this.emit(\"pushCompleted\", false);\n      }\n    };\n\n    this.pushInterval = setInterval(push, this.config.pushGateway!.pushInterval);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Helpers\n  // ---------------------------------------------------------------------------\n\n  private prefixName(name: string): string {\n    if (this.config.prefix && !name.startsWith(this.config.prefix)) {\n      return `${this.config.prefix}_${name}`;\n    }\n    return name;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Lifecycle\n  // ---------------------------------------------------------------------------\n\n  async shutdown(): Promise<void> {\n    if (this.defaultMetricsInterval) {\n      clearInterval(this.defaultMetricsInterval);\n    }\n    if (this.pushInterval) {\n      clearInterval(this.pushInterval);\n    }\n    this.removeAllListeners();\n  }\n}\n\n// =============================================================================\n// Factory Functions\n// =============================================================================\n\nlet defaultRegistry: MetricsRegistry | null = null;\n\nexport function getMetricsRegistry(): MetricsRegistry {\n  if (!defaultRegistry) {\n    defaultRegistry = new MetricsRegistry();\n  }\n  return defaultRegistry;\n}\n\nexport function createMetricsRegistry(\n  config: Partial<MetricsRegistryConfig> = {}\n): MetricsRegistry {\n  const registry = new MetricsRegistry(config);\n  if (!defaultRegistry) {\n    defaultRegistry = registry;\n  }\n  return registry;\n}\n","/**\n * SLO Manager Types\n * Phase 14D: Service Level Objectives\n */\n\nimport { z } from \"zod\";\n\n// =============================================================================\n// SLI (Service Level Indicator) Types\n// =============================================================================\n\nexport const SLITypeSchema = z.enum([\n  \"availability\", // Percentage of successful requests\n  \"latency\", // Response time percentiles\n  \"throughput\", // Requests per second\n  \"error_rate\", // Percentage of errors\n  \"saturation\", // Resource utilization\n  \"freshness\", // Data freshness/staleness\n  \"correctness\", // Data accuracy\n  \"coverage\", // Feature/data coverage\n  \"durability\", // Data durability\n]);\nexport type SLIType = z.infer<typeof SLITypeSchema>;\n\nexport const SLIMetricSourceSchema = z.enum([\n  \"prometheus\",\n  \"custom\",\n  \"logs\",\n  \"traces\",\n  \"synthetic\",\n]);\nexport type SLIMetricSource = z.infer<typeof SLIMetricSourceSchema>;\n\nexport const SLIConfigSchema = z.object({\n  type: SLITypeSchema,\n  name: z.string(),\n  description: z.string().optional(),\n  source: SLIMetricSourceSchema.default(\"prometheus\"),\n\n  // Metric query configuration\n  metric: z.object({\n    good: z.string().describe(\"Query for good events\"),\n    total: z.string().describe(\"Query for total events\"),\n    // Alternative: ratio-based\n    ratio: z.string().optional().describe(\"Direct ratio query\"),\n  }),\n\n  // Latency-specific config\n  latencyThreshold: z.number().optional().describe(\"Threshold in ms for latency SLIs\"),\n  latencyPercentile: z.number().optional().describe(\"Percentile (e.g., 99 for p99)\"),\n\n  // Filters\n  filters: z.record(z.string()).optional(),\n});\nexport type SLIConfig = z.infer<typeof SLIConfigSchema>;\n\nexport const SLIMeasurementSchema = z.object({\n  timestamp: z.number(),\n  good: z.number(),\n  total: z.number(),\n  value: z.number().describe(\"SLI value (0-1 or percentage)\"),\n});\nexport type SLIMeasurement = z.infer<typeof SLIMeasurementSchema>;\n\n// =============================================================================\n// SLO Types\n// =============================================================================\n\nexport const SLOWindowTypeSchema = z.enum([\n  \"rolling\", // Rolling window (e.g., last 30 days)\n  \"calendar\", // Calendar-aligned (e.g., monthly)\n]);\nexport type SLOWindowType = z.infer<typeof SLOWindowTypeSchema>;\n\nexport const SLOWindowSchema = z.object({\n  type: SLOWindowTypeSchema,\n  duration: z.number().describe(\"Window duration in seconds\"),\n  // Calendar-specific\n  calendarUnit: z.enum([\"day\", \"week\", \"month\", \"quarter\"]).optional(),\n});\nexport type SLOWindow = z.infer<typeof SLOWindowSchema>;\n\nexport const SLOTargetSchema = z.object({\n  value: z.number().min(0).max(100).describe(\"Target percentage (e.g., 99.9)\"),\n  // Multi-window targets\n  windows: z.array(z.object({\n    window: SLOWindowSchema,\n    target: z.number().min(0).max(100),\n  })).optional(),\n});\nexport type SLOTarget = z.infer<typeof SLOTargetSchema>;\n\nexport const SLOStatusSchema = z.enum([\n  \"healthy\", // Within budget\n  \"warning\", // Budget running low\n  \"critical\", // Budget nearly exhausted\n  \"breached\", // SLO violated\n  \"unknown\", // Insufficient data\n]);\nexport type SLOStatus = z.infer<typeof SLOStatusSchema>;\n\nexport const SLODefinitionSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  description: z.string().optional(),\n  service: z.string(),\n  team: z.string().optional(),\n\n  // SLI configuration\n  sli: SLIConfigSchema,\n\n  // Target\n  target: SLOTargetSchema,\n\n  // Window\n  window: SLOWindowSchema,\n\n  // Alert thresholds\n  alertThresholds: z.object({\n    warning: z.number().default(50).describe(\"Warning when budget < X%\"),\n    critical: z.number().default(20).describe(\"Critical when budget < X%\"),\n  }).optional(),\n\n  // Metadata\n  tags: z.array(z.string()).default([]),\n  metadata: z.record(z.unknown()).optional(),\n  createdAt: z.number(),\n  updatedAt: z.number(),\n  enabled: z.boolean().default(true),\n});\nexport type SLODefinition = z.infer<typeof SLODefinitionSchema>;\n\n// =============================================================================\n// Error Budget Types\n// =============================================================================\n\nexport const ErrorBudgetSchema = z.object({\n  sloId: z.string(),\n  windowStart: z.number(),\n  windowEnd: z.number(),\n\n  // Budget calculations\n  total: z.number().describe(\"Total error budget (events or percentage)\"),\n  consumed: z.number().describe(\"Consumed error budget\"),\n  remaining: z.number().describe(\"Remaining error budget\"),\n  remainingPercent: z.number().describe(\"Remaining budget as percentage\"),\n\n  // Burn rate\n  burnRate: z.number().describe(\"Current burn rate (1 = normal, 2 = 2x burn)\"),\n  burnRateTrend: z.enum([\"increasing\", \"stable\", \"decreasing\"]),\n\n  // Projections\n  projectedExhaustion: z.number().optional().describe(\"Timestamp when budget exhausts\"),\n  daysRemaining: z.number().optional().describe(\"Days until budget exhausts\"),\n});\nexport type ErrorBudget = z.infer<typeof ErrorBudgetSchema>;\n\nexport const BurnRateAlertSchema = z.object({\n  id: z.string(),\n  sloId: z.string(),\n  name: z.string(),\n\n  // Multi-window burn rate alerting\n  shortWindow: z.object({\n    duration: z.number().describe(\"Short window in seconds (e.g., 5m)\"),\n    burnRateThreshold: z.number().describe(\"Burn rate threshold\"),\n  }),\n  longWindow: z.object({\n    duration: z.number().describe(\"Long window in seconds (e.g., 1h)\"),\n    burnRateThreshold: z.number().describe(\"Burn rate threshold\"),\n  }),\n\n  // Page severity\n  severity: z.enum([\"page\", \"ticket\", \"log\"]),\n  enabled: z.boolean().default(true),\n});\nexport type BurnRateAlert = z.infer<typeof BurnRateAlertSchema>;\n\n// =============================================================================\n// SLO State & History\n// =============================================================================\n\nexport const SLOStateSchema = z.object({\n  sloId: z.string(),\n  status: SLOStatusSchema,\n  currentValue: z.number().describe(\"Current SLI value\"),\n  targetValue: z.number().describe(\"Target SLI value\"),\n\n  // Error budget\n  errorBudget: ErrorBudgetSchema,\n\n  // Time range\n  windowStart: z.number(),\n  windowEnd: z.number(),\n\n  // Measurements\n  totalGood: z.number(),\n  totalEvents: z.number(),\n\n  // Last update\n  lastMeasurement: z.number(),\n  measurementCount: z.number(),\n});\nexport type SLOState = z.infer<typeof SLOStateSchema>;\n\nexport const SLOHistoryEntrySchema = z.object({\n  timestamp: z.number(),\n  sloId: z.string(),\n  value: z.number(),\n  target: z.number(),\n  status: SLOStatusSchema,\n  errorBudgetRemaining: z.number(),\n  burnRate: z.number(),\n});\nexport type SLOHistoryEntry = z.infer<typeof SLOHistoryEntrySchema>;\n\n// =============================================================================\n// SLO Report Types\n// =============================================================================\n\nexport const SLOReportPeriodSchema = z.enum([\n  \"day\",\n  \"week\",\n  \"month\",\n  \"quarter\",\n  \"year\",\n  \"custom\",\n]);\nexport type SLOReportPeriod = z.infer<typeof SLOReportPeriodSchema>;\n\nexport const SLOReportSchema = z.object({\n  sloId: z.string(),\n  sloName: z.string(),\n  service: z.string(),\n  period: SLOReportPeriodSchema,\n  startTime: z.number(),\n  endTime: z.number(),\n\n  // Performance\n  achievedValue: z.number(),\n  targetValue: z.number(),\n  met: z.boolean(),\n  uptime: z.number().describe(\"Percentage of time SLO was met\"),\n\n  // Error budget\n  budgetTotal: z.number(),\n  budgetConsumed: z.number(),\n  budgetRemaining: z.number(),\n\n  // Incidents\n  incidentCount: z.number(),\n  totalDowntime: z.number().describe(\"Total downtime in seconds\"),\n  mttr: z.number().optional().describe(\"Mean time to recovery\"),\n\n  // Trends\n  trend: z.enum([\"improving\", \"stable\", \"degrading\"]),\n  previousPeriodValue: z.number().optional(),\n  changePercent: z.number().optional(),\n});\nexport type SLOReport = z.infer<typeof SLOReportSchema>;\n\nexport const SLOSummarySchema = z.object({\n  totalSLOs: z.number(),\n  healthy: z.number(),\n  warning: z.number(),\n  critical: z.number(),\n  breached: z.number(),\n  unknown: z.number(),\n  overallHealth: z.number().describe(\"Percentage of healthy SLOs\"),\n  avgErrorBudgetRemaining: z.number(),\n});\nexport type SLOSummary = z.infer<typeof SLOSummarySchema>;\n\n// =============================================================================\n// Alert Types\n// =============================================================================\n\nexport const SLOAlertTypeSchema = z.enum([\n  \"budget_warning\", // Budget below warning threshold\n  \"budget_critical\", // Budget below critical threshold\n  \"budget_exhausted\", // Budget fully consumed\n  \"burn_rate_high\", // High burn rate detected\n  \"slo_breached\", // SLO target missed\n  \"slo_recovered\", // SLO recovered from breach\n]);\nexport type SLOAlertType = z.infer<typeof SLOAlertTypeSchema>;\n\nexport const SLOAlertSchema = z.object({\n  id: z.string(),\n  type: SLOAlertTypeSchema,\n  sloId: z.string(),\n  sloName: z.string(),\n  service: z.string(),\n  timestamp: z.number(),\n  severity: z.enum([\"info\", \"warning\", \"critical\"]),\n\n  // Context\n  currentValue: z.number(),\n  targetValue: z.number(),\n  errorBudgetRemaining: z.number(),\n  burnRate: z.number().optional(),\n\n  // Message\n  message: z.string(),\n  details: z.record(z.unknown()).optional(),\n\n  // State\n  acknowledged: z.boolean().default(false),\n  acknowledgedBy: z.string().optional(),\n  acknowledgedAt: z.number().optional(),\n  resolved: z.boolean().default(false),\n  resolvedAt: z.number().optional(),\n});\nexport type SLOAlert = z.infer<typeof SLOAlertSchema>;\n\n// =============================================================================\n// Configuration\n// =============================================================================\n\nexport const SLOManagerConfigSchema = z.object({\n  // Measurement\n  measurementInterval: z.number().default(60).describe(\"Measurement interval in seconds\"),\n  retentionDays: z.number().default(90).describe(\"History retention in days\"),\n\n  // Alerting\n  alerting: z.object({\n    enabled: z.boolean().default(true),\n    defaultWarningThreshold: z.number().default(50),\n    defaultCriticalThreshold: z.number().default(20),\n    burnRateAlerts: z.boolean().default(true),\n  }).optional(),\n\n  // Reporting\n  reporting: z.object({\n    enabled: z.boolean().default(true),\n    defaultPeriod: SLOReportPeriodSchema.default(\"week\"),\n    autoGenerate: z.boolean().default(false),\n  }).optional(),\n\n  // Integrations\n  integrations: z.object({\n    prometheus: z.object({\n      url: z.string(),\n      auth: z.object({\n        type: z.enum([\"none\", \"basic\", \"bearer\"]),\n        credentials: z.string().optional(),\n      }).optional(),\n    }).optional(),\n    pagerduty: z.object({\n      integrationKey: z.string(),\n    }).optional(),\n    slack: z.object({\n      webhookUrl: z.string(),\n      channel: z.string().optional(),\n    }).optional(),\n  }).optional(),\n});\nexport type SLOManagerConfig = z.infer<typeof SLOManagerConfigSchema>;\n\n// =============================================================================\n// Events\n// =============================================================================\n\nexport type SLOEvents = {\n  // SLO Lifecycle\n  sloCreated: (slo: SLODefinition) => void;\n  sloUpdated: (slo: SLODefinition) => void;\n  sloDeleted: (sloId: string) => void;\n\n  // Measurements\n  measured: (sloId: string, measurement: SLIMeasurement) => void;\n  stateChanged: (sloId: string, state: SLOState, previousStatus: SLOStatus) => void;\n\n  // Alerts\n  alertTriggered: (alert: SLOAlert) => void;\n  alertAcknowledged: (alertId: string, by: string) => void;\n  alertResolved: (alertId: string) => void;\n\n  // Error Budget\n  budgetWarning: (sloId: string, remainingPercent: number) => void;\n  budgetCritical: (sloId: string, remainingPercent: number) => void;\n  budgetExhausted: (sloId: string) => void;\n  budgetReset: (sloId: string, newBudget: ErrorBudget) => void;\n\n  // Burn Rate\n  burnRateHigh: (sloId: string, burnRate: number, window: string) => void;\n\n  // Reports\n  reportGenerated: (report: SLOReport) => void;\n\n  // Errors\n  error: (error: Error) => void;\n};\n\n// =============================================================================\n// Storage Interface\n// =============================================================================\n\nexport interface SLOStorage {\n  // SLO Definitions\n  getSLO(id: string): Promise<SLODefinition | null>;\n  saveSLO(slo: SLODefinition): Promise<void>;\n  deleteSLO(id: string): Promise<void>;\n  listSLOs(filters?: { service?: string; team?: string; enabled?: boolean }): Promise<SLODefinition[]>;\n\n  // SLO State\n  getState(sloId: string): Promise<SLOState | null>;\n  saveState(state: SLOState): Promise<void>;\n\n  // History\n  addHistoryEntry(entry: SLOHistoryEntry): Promise<void>;\n  getHistory(sloId: string, startTime: number, endTime: number): Promise<SLOHistoryEntry[]>;\n  pruneHistory(olderThan: number): Promise<number>;\n\n  // Alerts\n  saveAlert(alert: SLOAlert): Promise<void>;\n  getAlert(id: string): Promise<SLOAlert | null>;\n  listAlerts(filters?: { sloId?: string; resolved?: boolean; severity?: string }): Promise<SLOAlert[]>;\n  updateAlert(id: string, updates: Partial<SLOAlert>): Promise<void>;\n\n  // Burn Rate Alerts\n  saveBurnRateAlert(alert: BurnRateAlert): Promise<void>;\n  getBurnRateAlerts(sloId: string): Promise<BurnRateAlert[]>;\n  deleteBurnRateAlert(id: string): Promise<void>;\n}\n\n// =============================================================================\n// Metric Provider Interface\n// =============================================================================\n\nexport interface SLIMetricProvider {\n  readonly source: SLIMetricSource;\n  query(query: string, startTime: number, endTime: number): Promise<number>;\n  queryRange(query: string, startTime: number, endTime: number, step: number): Promise<Array<{ timestamp: number; value: number }>>;\n}\n\n// =============================================================================\n// Presets\n// =============================================================================\n\nexport const SLO_PRESETS = {\n  // Availability SLOs\n  availability_99: {\n    sli: {\n      type: \"availability\" as const,\n      name: \"Availability\",\n      source: \"prometheus\" as const,\n      metric: {\n        good: 'sum(rate(http_requests_total{status!~\"5..\"}[5m]))',\n        total: 'sum(rate(http_requests_total[5m]))',\n      },\n    },\n    target: { value: 99 },\n    window: { type: \"rolling\" as const, duration: 30 * 24 * 60 * 60 },\n  },\n  availability_999: {\n    sli: {\n      type: \"availability\" as const,\n      name: \"High Availability\",\n      source: \"prometheus\" as const,\n      metric: {\n        good: 'sum(rate(http_requests_total{status!~\"5..\"}[5m]))',\n        total: 'sum(rate(http_requests_total[5m]))',\n      },\n    },\n    target: { value: 99.9 },\n    window: { type: \"rolling\" as const, duration: 30 * 24 * 60 * 60 },\n  },\n\n  // Latency SLOs\n  latency_p99_500ms: {\n    sli: {\n      type: \"latency\" as const,\n      name: \"P99 Latency\",\n      source: \"prometheus\" as const,\n      metric: {\n        good: 'sum(rate(http_request_duration_seconds_bucket{le=\"0.5\"}[5m]))',\n        total: 'sum(rate(http_request_duration_seconds_count[5m]))',\n      },\n      latencyThreshold: 500,\n      latencyPercentile: 99,\n    },\n    target: { value: 99 },\n    window: { type: \"rolling\" as const, duration: 7 * 24 * 60 * 60 },\n  },\n\n  // Error Rate SLOs\n  error_rate_1pct: {\n    sli: {\n      type: \"error_rate\" as const,\n      name: \"Error Rate\",\n      source: \"prometheus\" as const,\n      metric: {\n        good: 'sum(rate(http_requests_total{status!~\"5..\"}[5m]))',\n        total: 'sum(rate(http_requests_total[5m]))',\n      },\n    },\n    target: { value: 99 },\n    window: { type: \"rolling\" as const, duration: 7 * 24 * 60 * 60 },\n  },\n} as const;\n\nexport const BURN_RATE_PRESETS = {\n  // Google SRE book multi-window, multi-burn-rate alerting\n  page_1h: {\n    name: \"1h Page Alert\",\n    shortWindow: { duration: 5 * 60, burnRateThreshold: 14.4 },\n    longWindow: { duration: 60 * 60, burnRateThreshold: 14.4 },\n    severity: \"page\" as const,\n  },\n  page_6h: {\n    name: \"6h Page Alert\",\n    shortWindow: { duration: 30 * 60, burnRateThreshold: 6 },\n    longWindow: { duration: 6 * 60 * 60, burnRateThreshold: 6 },\n    severity: \"page\" as const,\n  },\n  ticket_1d: {\n    name: \"1d Ticket Alert\",\n    shortWindow: { duration: 2 * 60 * 60, burnRateThreshold: 3 },\n    longWindow: { duration: 24 * 60 * 60, burnRateThreshold: 3 },\n    severity: \"ticket\" as const,\n  },\n  ticket_3d: {\n    name: \"3d Ticket Alert\",\n    shortWindow: { duration: 6 * 60 * 60, burnRateThreshold: 1 },\n    longWindow: { duration: 3 * 24 * 60 * 60, burnRateThreshold: 1 },\n    severity: \"ticket\" as const,\n  },\n} as const;\n","/**\n * SLO Manager Implementation\n * Phase 14D: Service Level Objectives\n */\n\nimport { EventEmitter } from \"eventemitter3\";\nimport { randomUUID } from \"crypto\";\nimport {\n  SLODefinition,\n  SLODefinitionSchema,\n  SLIConfig,\n  SLIMeasurement,\n  SLOState,\n  SLOStatus,\n  ErrorBudget,\n  BurnRateAlert,\n  SLOAlert,\n  SLOAlertType,\n  SLOReport,\n  SLOReportPeriod,\n  SLOSummary,\n  SLOHistoryEntry,\n  SLOManagerConfig,\n  SLOManagerConfigSchema,\n  SLOEvents,\n  SLOStorage,\n  SLIMetricProvider,\n  SLIMetricSource,\n} from \"./types.js\";\n\n// =============================================================================\n// In-Memory Storage\n// =============================================================================\n\nclass InMemorySLOStorage implements SLOStorage {\n  private slos = new Map<string, SLODefinition>();\n  private states = new Map<string, SLOState>();\n  private history = new Map<string, SLOHistoryEntry[]>();\n  private alerts = new Map<string, SLOAlert>();\n  private burnRateAlerts = new Map<string, BurnRateAlert[]>();\n\n  async getSLO(id: string): Promise<SLODefinition | null> {\n    return this.slos.get(id) ?? null;\n  }\n\n  async saveSLO(slo: SLODefinition): Promise<void> {\n    this.slos.set(slo.id, slo);\n  }\n\n  async deleteSLO(id: string): Promise<void> {\n    this.slos.delete(id);\n    this.states.delete(id);\n    this.history.delete(id);\n  }\n\n  async listSLOs(filters?: { service?: string; team?: string; enabled?: boolean }): Promise<SLODefinition[]> {\n    let results = Array.from(this.slos.values());\n    if (filters) {\n      if (filters.service !== undefined) {\n        results = results.filter(s => s.service === filters.service);\n      }\n      if (filters.team !== undefined) {\n        results = results.filter(s => s.team === filters.team);\n      }\n      if (filters.enabled !== undefined) {\n        results = results.filter(s => s.enabled === filters.enabled);\n      }\n    }\n    return results;\n  }\n\n  async getState(sloId: string): Promise<SLOState | null> {\n    return this.states.get(sloId) ?? null;\n  }\n\n  async saveState(state: SLOState): Promise<void> {\n    this.states.set(state.sloId, state);\n  }\n\n  async addHistoryEntry(entry: SLOHistoryEntry): Promise<void> {\n    const entries = this.history.get(entry.sloId) ?? [];\n    entries.push(entry);\n    this.history.set(entry.sloId, entries);\n  }\n\n  async getHistory(sloId: string, startTime: number, endTime: number): Promise<SLOHistoryEntry[]> {\n    const entries = this.history.get(sloId) ?? [];\n    return entries.filter(e => e.timestamp >= startTime && e.timestamp <= endTime);\n  }\n\n  async pruneHistory(olderThan: number): Promise<number> {\n    let pruned = 0;\n    for (const [sloId, entries] of this.history) {\n      const filtered = entries.filter(e => e.timestamp >= olderThan);\n      pruned += entries.length - filtered.length;\n      this.history.set(sloId, filtered);\n    }\n    return pruned;\n  }\n\n  async saveAlert(alert: SLOAlert): Promise<void> {\n    this.alerts.set(alert.id, alert);\n  }\n\n  async getAlert(id: string): Promise<SLOAlert | null> {\n    return this.alerts.get(id) ?? null;\n  }\n\n  async listAlerts(filters?: { sloId?: string; resolved?: boolean; severity?: string }): Promise<SLOAlert[]> {\n    let results = Array.from(this.alerts.values());\n    if (filters) {\n      if (filters.sloId !== undefined) {\n        results = results.filter(a => a.sloId === filters.sloId);\n      }\n      if (filters.resolved !== undefined) {\n        results = results.filter(a => a.resolved === filters.resolved);\n      }\n      if (filters.severity !== undefined) {\n        results = results.filter(a => a.severity === filters.severity);\n      }\n    }\n    return results.sort((a, b) => b.timestamp - a.timestamp);\n  }\n\n  async updateAlert(id: string, updates: Partial<SLOAlert>): Promise<void> {\n    const alert = this.alerts.get(id);\n    if (alert) {\n      this.alerts.set(id, { ...alert, ...updates });\n    }\n  }\n\n  async saveBurnRateAlert(alert: BurnRateAlert): Promise<void> {\n    const alerts = this.burnRateAlerts.get(alert.sloId) ?? [];\n    const idx = alerts.findIndex(a => a.id === alert.id);\n    if (idx >= 0) {\n      alerts[idx] = alert;\n    } else {\n      alerts.push(alert);\n    }\n    this.burnRateAlerts.set(alert.sloId, alerts);\n  }\n\n  async getBurnRateAlerts(sloId: string): Promise<BurnRateAlert[]> {\n    return this.burnRateAlerts.get(sloId) ?? [];\n  }\n\n  async deleteBurnRateAlert(id: string): Promise<void> {\n    for (const [sloId, alerts] of this.burnRateAlerts) {\n      const filtered = alerts.filter(a => a.id !== id);\n      if (filtered.length !== alerts.length) {\n        this.burnRateAlerts.set(sloId, filtered);\n        break;\n      }\n    }\n  }\n}\n\n// =============================================================================\n// Custom Metric Provider (for testing/mocking)\n// =============================================================================\n\nclass CustomMetricProvider implements SLIMetricProvider {\n  readonly source: SLIMetricSource = \"custom\";\n  private handlers = new Map<string, (start: number, end: number) => Promise<number>>();\n\n  registerQuery(query: string, handler: (start: number, end: number) => Promise<number>): void {\n    this.handlers.set(query, handler);\n  }\n\n  async query(query: string, startTime: number, endTime: number): Promise<number> {\n    const handler = this.handlers.get(query);\n    if (handler) {\n      return handler(startTime, endTime);\n    }\n    // Return mock data for testing\n    return Math.random() * 100;\n  }\n\n  async queryRange(\n    query: string,\n    startTime: number,\n    endTime: number,\n    step: number\n  ): Promise<Array<{ timestamp: number; value: number }>> {\n    const results: Array<{ timestamp: number; value: number }> = [];\n    for (let ts = startTime; ts <= endTime; ts += step) {\n      results.push({\n        timestamp: ts,\n        value: await this.query(query, ts - step, ts),\n      });\n    }\n    return results;\n  }\n}\n\n// =============================================================================\n// SLO Manager\n// =============================================================================\n\nexport class SLOManager extends EventEmitter<SLOEvents> {\n  private config: SLOManagerConfig;\n  private storage: SLOStorage;\n  private metricProviders = new Map<SLIMetricSource, SLIMetricProvider>();\n  private measurementIntervals = new Map<string, NodeJS.Timeout>();\n  private running = false;\n\n  constructor(config: Partial<SLOManagerConfig> = {}) {\n    super();\n    this.config = SLOManagerConfigSchema.parse(config);\n    this.storage = new InMemorySLOStorage();\n\n    // Register default custom provider\n    const customProvider = new CustomMetricProvider();\n    this.metricProviders.set(\"custom\", customProvider);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Configuration\n  // ---------------------------------------------------------------------------\n\n  setStorage(storage: SLOStorage): void {\n    this.storage = storage;\n  }\n\n  registerMetricProvider(provider: SLIMetricProvider): void {\n    this.metricProviders.set(provider.source, provider);\n  }\n\n  getMetricProvider(source: SLIMetricSource): SLIMetricProvider | undefined {\n    return this.metricProviders.get(source);\n  }\n\n  // ---------------------------------------------------------------------------\n  // SLO CRUD\n  // ---------------------------------------------------------------------------\n\n  async createSLO(input: Omit<SLODefinition, \"id\" | \"createdAt\" | \"updatedAt\">): Promise<SLODefinition> {\n    const now = Date.now();\n    const slo = SLODefinitionSchema.parse({\n      ...input,\n      id: randomUUID(),\n      createdAt: now,\n      updatedAt: now,\n    });\n\n    await this.storage.saveSLO(slo);\n\n    // Initialize state\n    const initialState = await this.initializeState(slo);\n    await this.storage.saveState(initialState);\n\n    // Start measurement if running\n    if (this.running && slo.enabled) {\n      this.startMeasurement(slo);\n    }\n\n    this.emit(\"sloCreated\", slo);\n    return slo;\n  }\n\n  async getSLO(id: string): Promise<SLODefinition | null> {\n    return this.storage.getSLO(id);\n  }\n\n  async updateSLO(id: string, updates: Partial<SLODefinition>): Promise<SLODefinition | null> {\n    const existing = await this.storage.getSLO(id);\n    if (!existing) return null;\n\n    const updated = SLODefinitionSchema.parse({\n      ...existing,\n      ...updates,\n      id: existing.id,\n      createdAt: existing.createdAt,\n      updatedAt: Date.now(),\n    });\n\n    await this.storage.saveSLO(updated);\n\n    // Restart measurement if enabled changed\n    if (existing.enabled !== updated.enabled) {\n      if (updated.enabled && this.running) {\n        this.startMeasurement(updated);\n      } else {\n        this.stopMeasurement(id);\n      }\n    }\n\n    this.emit(\"sloUpdated\", updated);\n    return updated;\n  }\n\n  async deleteSLO(id: string): Promise<boolean> {\n    const existing = await this.storage.getSLO(id);\n    if (!existing) return false;\n\n    this.stopMeasurement(id);\n    await this.storage.deleteSLO(id);\n    this.emit(\"sloDeleted\", id);\n    return true;\n  }\n\n  async listSLOs(filters?: { service?: string; team?: string; enabled?: boolean }): Promise<SLODefinition[]> {\n    return this.storage.listSLOs(filters);\n  }\n\n  // ---------------------------------------------------------------------------\n  // State Management\n  // ---------------------------------------------------------------------------\n\n  async getState(sloId: string): Promise<SLOState | null> {\n    return this.storage.getState(sloId);\n  }\n\n  private async initializeState(slo: SLODefinition): Promise<SLOState> {\n    const now = Date.now();\n    const windowStart = now - slo.window.duration * 1000;\n\n    return {\n      sloId: slo.id,\n      status: \"unknown\",\n      currentValue: 0,\n      targetValue: slo.target.value,\n      errorBudget: {\n        sloId: slo.id,\n        windowStart,\n        windowEnd: now,\n        total: 100 - slo.target.value,\n        consumed: 0,\n        remaining: 100 - slo.target.value,\n        remainingPercent: 100,\n        burnRate: 0,\n        burnRateTrend: \"stable\",\n      },\n      windowStart,\n      windowEnd: now,\n      totalGood: 0,\n      totalEvents: 0,\n      lastMeasurement: now,\n      measurementCount: 0,\n    };\n  }\n\n  // ---------------------------------------------------------------------------\n  // Measurement\n  // ---------------------------------------------------------------------------\n\n  async measure(sloId: string): Promise<SLIMeasurement | null> {\n    const slo = await this.storage.getSLO(sloId);\n    if (!slo || !slo.enabled) return null;\n\n    const provider = this.metricProviders.get(slo.sli.source);\n    if (!provider) {\n      this.emit(\"error\", new Error(`No metric provider for source: ${slo.sli.source}`));\n      return null;\n    }\n\n    const now = Date.now();\n    const windowStart = now - slo.window.duration * 1000;\n\n    try {\n      let good: number;\n      let total: number;\n\n      if (slo.sli.metric.ratio) {\n        // Direct ratio query\n        const ratio = await provider.query(slo.sli.metric.ratio, windowStart, now);\n        good = ratio;\n        total = 100;\n      } else {\n        // Good/total queries\n        [good, total] = await Promise.all([\n          provider.query(slo.sli.metric.good, windowStart, now),\n          provider.query(slo.sli.metric.total, windowStart, now),\n        ]);\n      }\n\n      const value = total > 0 ? (good / total) * 100 : 0;\n\n      const measurement: SLIMeasurement = {\n        timestamp: now,\n        good,\n        total,\n        value,\n      };\n\n      // Update state\n      await this.updateState(slo, measurement);\n      this.emit(\"measured\", sloId, measurement);\n\n      return measurement;\n    } catch (error) {\n      this.emit(\"error\", error instanceof Error ? error : new Error(String(error)));\n      return null;\n    }\n  }\n\n  private async updateState(slo: SLODefinition, measurement: SLIMeasurement): Promise<void> {\n    const currentState = await this.storage.getState(slo.id);\n    const now = Date.now();\n    const windowStart = now - slo.window.duration * 1000;\n\n    // Calculate new totals\n    const totalGood = (currentState?.totalGood ?? 0) + measurement.good;\n    const totalEvents = (currentState?.totalEvents ?? 0) + measurement.total;\n    const currentValue = totalEvents > 0 ? (totalGood / totalEvents) * 100 : 0;\n\n    // Calculate error budget\n    const errorBudget = this.calculateErrorBudget(slo, currentValue, windowStart, now);\n\n    // Determine status\n    const status = this.calculateStatus(slo, errorBudget);\n    const previousStatus = currentState?.status ?? \"unknown\";\n\n    const newState: SLOState = {\n      sloId: slo.id,\n      status,\n      currentValue,\n      targetValue: slo.target.value,\n      errorBudget,\n      windowStart,\n      windowEnd: now,\n      totalGood,\n      totalEvents,\n      lastMeasurement: now,\n      measurementCount: (currentState?.measurementCount ?? 0) + 1,\n    };\n\n    await this.storage.saveState(newState);\n\n    // Add history entry\n    const historyEntry: SLOHistoryEntry = {\n      timestamp: now,\n      sloId: slo.id,\n      value: currentValue,\n      target: slo.target.value,\n      status,\n      errorBudgetRemaining: errorBudget.remainingPercent,\n      burnRate: errorBudget.burnRate,\n    };\n    await this.storage.addHistoryEntry(historyEntry);\n\n    // Emit state change if status changed\n    if (status !== previousStatus) {\n      this.emit(\"stateChanged\", slo.id, newState, previousStatus);\n    }\n\n    // Check alerts\n    await this.checkAlerts(slo, newState, previousStatus);\n  }\n\n  private calculateErrorBudget(\n    slo: SLODefinition,\n    currentValue: number,\n    windowStart: number,\n    windowEnd: number\n  ): ErrorBudget {\n    const totalBudget = 100 - slo.target.value; // e.g., 99.9% target = 0.1% budget\n    const consumed = Math.max(0, slo.target.value - currentValue);\n    const remaining = Math.max(0, totalBudget - consumed);\n    const remainingPercent = totalBudget > 0 ? (remaining / totalBudget) * 100 : 0;\n\n    // Calculate burn rate (how fast we're consuming budget)\n    // 1 = normal rate, 2 = 2x normal rate, etc.\n    const windowDuration = windowEnd - windowStart;\n    const expectedConsumed = totalBudget * (windowDuration / (slo.window.duration * 1000));\n    const burnRate = expectedConsumed > 0 ? consumed / expectedConsumed : 0;\n\n    // Project exhaustion\n    let projectedExhaustion: number | undefined;\n    let daysRemaining: number | undefined;\n\n    if (burnRate > 1 && remaining > 0) {\n      const remainingMs = (remaining / consumed) * windowDuration;\n      projectedExhaustion = windowEnd + remainingMs;\n      daysRemaining = remainingMs / (24 * 60 * 60 * 1000);\n    }\n\n    return {\n      sloId: slo.id,\n      windowStart,\n      windowEnd,\n      total: totalBudget,\n      consumed,\n      remaining,\n      remainingPercent,\n      burnRate,\n      burnRateTrend: burnRate > 1.5 ? \"increasing\" : burnRate < 0.5 ? \"decreasing\" : \"stable\",\n      projectedExhaustion,\n      daysRemaining,\n    };\n  }\n\n  private calculateStatus(slo: SLODefinition, errorBudget: ErrorBudget): SLOStatus {\n    const thresholds = slo.alertThresholds ?? { warning: 50, critical: 20 };\n\n    if (errorBudget.remainingPercent <= 0) {\n      return \"breached\";\n    }\n    if (errorBudget.remainingPercent < thresholds.critical) {\n      return \"critical\";\n    }\n    if (errorBudget.remainingPercent < thresholds.warning) {\n      return \"warning\";\n    }\n    return \"healthy\";\n  }\n\n  // ---------------------------------------------------------------------------\n  // Alerting\n  // ---------------------------------------------------------------------------\n\n  private async checkAlerts(slo: SLODefinition, state: SLOState, previousStatus: SLOStatus): Promise<void> {\n    if (!this.config.alerting?.enabled) return;\n\n    const thresholds = slo.alertThresholds ?? {\n      warning: this.config.alerting.defaultWarningThreshold,\n      critical: this.config.alerting.defaultCriticalThreshold,\n    };\n\n    // Status-based alerts\n    if (state.status !== previousStatus) {\n      if (state.status === \"warning\" && previousStatus === \"healthy\") {\n        await this.createAlert(slo, state, \"budget_warning\", \"warning\");\n        this.emit(\"budgetWarning\", slo.id, state.errorBudget.remainingPercent);\n      }\n\n      if (state.status === \"critical\") {\n        await this.createAlert(slo, state, \"budget_critical\", \"critical\");\n        this.emit(\"budgetCritical\", slo.id, state.errorBudget.remainingPercent);\n      }\n\n      if (state.status === \"breached\") {\n        await this.createAlert(slo, state, \"budget_exhausted\", \"critical\");\n        this.emit(\"budgetExhausted\", slo.id);\n      }\n\n      if (state.status === \"healthy\" && previousStatus !== \"unknown\") {\n        await this.createAlert(slo, state, \"slo_recovered\", \"info\");\n      }\n    }\n\n    // Burn rate alerts\n    if (this.config.alerting.burnRateAlerts) {\n      await this.checkBurnRateAlerts(slo, state);\n    }\n  }\n\n  private async checkBurnRateAlerts(slo: SLODefinition, state: SLOState): Promise<void> {\n    const burnRateAlerts = await this.storage.getBurnRateAlerts(slo.id);\n\n    for (const alert of burnRateAlerts) {\n      if (!alert.enabled) continue;\n\n      // Check both windows\n      const shortWindowMet = state.errorBudget.burnRate >= alert.shortWindow.burnRateThreshold;\n      const longWindowMet = state.errorBudget.burnRate >= alert.longWindow.burnRateThreshold;\n\n      if (shortWindowMet && longWindowMet) {\n        await this.createAlert(\n          slo,\n          state,\n          \"burn_rate_high\",\n          alert.severity === \"page\" ? \"critical\" : \"warning\"\n        );\n        this.emit(\"burnRateHigh\", slo.id, state.errorBudget.burnRate, alert.name);\n      }\n    }\n  }\n\n  private async createAlert(\n    slo: SLODefinition,\n    state: SLOState,\n    type: SLOAlertType,\n    severity: \"info\" | \"warning\" | \"critical\"\n  ): Promise<SLOAlert> {\n    const messages: Record<SLOAlertType, string> = {\n      budget_warning: `Error budget for ${slo.name} is running low (${state.errorBudget.remainingPercent.toFixed(1)}% remaining)`,\n      budget_critical: `Error budget for ${slo.name} is critically low (${state.errorBudget.remainingPercent.toFixed(1)}% remaining)`,\n      budget_exhausted: `Error budget for ${slo.name} has been exhausted`,\n      burn_rate_high: `High burn rate detected for ${slo.name} (${state.errorBudget.burnRate.toFixed(2)}x)`,\n      slo_breached: `SLO ${slo.name} has been breached (${state.currentValue.toFixed(2)}% vs ${state.targetValue}% target)`,\n      slo_recovered: `SLO ${slo.name} has recovered to healthy status`,\n    };\n\n    const alert: SLOAlert = {\n      id: randomUUID(),\n      type,\n      sloId: slo.id,\n      sloName: slo.name,\n      service: slo.service,\n      timestamp: Date.now(),\n      severity,\n      currentValue: state.currentValue,\n      targetValue: state.targetValue,\n      errorBudgetRemaining: state.errorBudget.remainingPercent,\n      burnRate: state.errorBudget.burnRate,\n      message: messages[type],\n      acknowledged: false,\n      resolved: type === \"slo_recovered\",\n      resolvedAt: type === \"slo_recovered\" ? Date.now() : undefined,\n    };\n\n    await this.storage.saveAlert(alert);\n    this.emit(\"alertTriggered\", alert);\n\n    return alert;\n  }\n\n  async acknowledgeAlert(alertId: string, by: string): Promise<boolean> {\n    const alert = await this.storage.getAlert(alertId);\n    if (!alert) return false;\n\n    await this.storage.updateAlert(alertId, {\n      acknowledged: true,\n      acknowledgedBy: by,\n      acknowledgedAt: Date.now(),\n    });\n\n    this.emit(\"alertAcknowledged\", alertId, by);\n    return true;\n  }\n\n  async resolveAlert(alertId: string): Promise<boolean> {\n    const alert = await this.storage.getAlert(alertId);\n    if (!alert) return false;\n\n    await this.storage.updateAlert(alertId, {\n      resolved: true,\n      resolvedAt: Date.now(),\n    });\n\n    this.emit(\"alertResolved\", alertId);\n    return true;\n  }\n\n  async listAlerts(filters?: { sloId?: string; resolved?: boolean; severity?: string }): Promise<SLOAlert[]> {\n    return this.storage.listAlerts(filters);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Burn Rate Alert Configuration\n  // ---------------------------------------------------------------------------\n\n  async addBurnRateAlert(sloId: string, alert: Omit<BurnRateAlert, \"id\" | \"sloId\">): Promise<BurnRateAlert> {\n    const fullAlert: BurnRateAlert = {\n      ...alert,\n      id: randomUUID(),\n      sloId,\n    };\n\n    await this.storage.saveBurnRateAlert(fullAlert);\n    return fullAlert;\n  }\n\n  async getBurnRateAlerts(sloId: string): Promise<BurnRateAlert[]> {\n    return this.storage.getBurnRateAlerts(sloId);\n  }\n\n  async deleteBurnRateAlert(alertId: string): Promise<void> {\n    await this.storage.deleteBurnRateAlert(alertId);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Reporting\n  // ---------------------------------------------------------------------------\n\n  async generateReport(sloId: string, period: SLOReportPeriod, customRange?: { start: number; end: number }): Promise<SLOReport | null> {\n    const slo = await this.storage.getSLO(sloId);\n    if (!slo) return null;\n\n    const now = Date.now();\n    let startTime: number;\n    let endTime = now;\n\n    if (customRange) {\n      startTime = customRange.start;\n      endTime = customRange.end;\n    } else {\n      switch (period) {\n        case \"day\":\n          startTime = now - 24 * 60 * 60 * 1000;\n          break;\n        case \"week\":\n          startTime = now - 7 * 24 * 60 * 60 * 1000;\n          break;\n        case \"month\":\n          startTime = now - 30 * 24 * 60 * 60 * 1000;\n          break;\n        case \"quarter\":\n          startTime = now - 90 * 24 * 60 * 60 * 1000;\n          break;\n        case \"year\":\n          startTime = now - 365 * 24 * 60 * 60 * 1000;\n          break;\n        default:\n          startTime = now - 7 * 24 * 60 * 60 * 1000;\n      }\n    }\n\n    const history = await this.storage.getHistory(sloId, startTime, endTime);\n    if (history.length === 0) {\n      return null;\n    }\n\n    // Calculate metrics\n    const values = history.map(h => h.value);\n    const achievedValue = values.reduce((a, b) => a + b, 0) / values.length;\n\n    const metEntries = history.filter(h => h.status === \"healthy\" || h.status === \"warning\");\n    const uptime = (metEntries.length / history.length) * 100;\n\n    // Budget calculations\n    const errorBudgets = history.map(h => h.errorBudgetRemaining);\n    const avgBudgetRemaining = errorBudgets.reduce((a, b) => a + b, 0) / errorBudgets.length;\n\n    // Count incidents (transitions to critical or breached)\n    let incidentCount = 0;\n    let totalDowntime = 0;\n    let inIncident = false;\n    let incidentStart = 0;\n\n    for (let i = 0; i < history.length; i++) {\n      const entry = history[i];\n      if ((entry.status === \"critical\" || entry.status === \"breached\") && !inIncident) {\n        inIncident = true;\n        incidentStart = entry.timestamp;\n        incidentCount++;\n      } else if ((entry.status === \"healthy\" || entry.status === \"warning\") && inIncident) {\n        inIncident = false;\n        totalDowntime += entry.timestamp - incidentStart;\n      }\n    }\n\n    const mttr = incidentCount > 0 ? totalDowntime / incidentCount / 1000 : undefined;\n\n    // Trend analysis\n    const midpoint = Math.floor(history.length / 2);\n    const firstHalf = values.slice(0, midpoint);\n    const secondHalf = values.slice(midpoint);\n    const firstAvg = firstHalf.reduce((a, b) => a + b, 0) / firstHalf.length;\n    const secondAvg = secondHalf.reduce((a, b) => a + b, 0) / secondHalf.length;\n    const trend = secondAvg > firstAvg + 0.1 ? \"improving\" : secondAvg < firstAvg - 0.1 ? \"degrading\" : \"stable\";\n\n    const report: SLOReport = {\n      sloId,\n      sloName: slo.name,\n      service: slo.service,\n      period,\n      startTime,\n      endTime,\n      achievedValue,\n      targetValue: slo.target.value,\n      met: achievedValue >= slo.target.value,\n      uptime,\n      budgetTotal: 100 - slo.target.value,\n      budgetConsumed: (100 - slo.target.value) - avgBudgetRemaining * (100 - slo.target.value) / 100,\n      budgetRemaining: avgBudgetRemaining * (100 - slo.target.value) / 100,\n      incidentCount,\n      totalDowntime: totalDowntime / 1000,\n      mttr,\n      trend,\n      previousPeriodValue: firstAvg,\n      changePercent: firstAvg > 0 ? ((secondAvg - firstAvg) / firstAvg) * 100 : 0,\n    };\n\n    this.emit(\"reportGenerated\", report);\n    return report;\n  }\n\n  async getSummary(): Promise<SLOSummary> {\n    const slos = await this.storage.listSLOs({ enabled: true });\n    const states = await Promise.all(slos.map(s => this.storage.getState(s.id)));\n\n    let healthy = 0;\n    let warning = 0;\n    let critical = 0;\n    let breached = 0;\n    let unknown = 0;\n    let totalBudgetRemaining = 0;\n\n    for (const state of states) {\n      if (!state) {\n        unknown++;\n        continue;\n      }\n\n      totalBudgetRemaining += state.errorBudget.remainingPercent;\n\n      switch (state.status) {\n        case \"healthy\":\n          healthy++;\n          break;\n        case \"warning\":\n          warning++;\n          break;\n        case \"critical\":\n          critical++;\n          break;\n        case \"breached\":\n          breached++;\n          break;\n        default:\n          unknown++;\n      }\n    }\n\n    const validStates = states.filter(s => s !== null).length;\n\n    return {\n      totalSLOs: slos.length,\n      healthy,\n      warning,\n      critical,\n      breached,\n      unknown,\n      overallHealth: slos.length > 0 ? (healthy / slos.length) * 100 : 0,\n      avgErrorBudgetRemaining: validStates > 0 ? totalBudgetRemaining / validStates : 0,\n    };\n  }\n\n  // ---------------------------------------------------------------------------\n  // History\n  // ---------------------------------------------------------------------------\n\n  async getHistory(sloId: string, startTime: number, endTime: number): Promise<SLOHistoryEntry[]> {\n    return this.storage.getHistory(sloId, startTime, endTime);\n  }\n\n  async pruneHistory(retentionDays?: number): Promise<number> {\n    const days = retentionDays ?? this.config.retentionDays;\n    const cutoff = Date.now() - days * 24 * 60 * 60 * 1000;\n    return this.storage.pruneHistory(cutoff);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Lifecycle\n  // ---------------------------------------------------------------------------\n\n  async start(): Promise<void> {\n    if (this.running) return;\n    this.running = true;\n\n    const slos = await this.storage.listSLOs({ enabled: true });\n    for (const slo of slos) {\n      this.startMeasurement(slo);\n    }\n  }\n\n  async stop(): Promise<void> {\n    this.running = false;\n\n    for (const [sloId] of this.measurementIntervals) {\n      this.stopMeasurement(sloId);\n    }\n  }\n\n  private startMeasurement(slo: SLODefinition): void {\n    if (this.measurementIntervals.has(slo.id)) return;\n\n    // Initial measurement\n    this.measure(slo.id).catch(err => this.emit(\"error\", err));\n\n    // Schedule periodic measurements\n    const interval = setInterval(() => {\n      this.measure(slo.id).catch(err => this.emit(\"error\", err));\n    }, this.config.measurementInterval * 1000);\n\n    this.measurementIntervals.set(slo.id, interval);\n  }\n\n  private stopMeasurement(sloId: string): void {\n    const interval = this.measurementIntervals.get(sloId);\n    if (interval) {\n      clearInterval(interval);\n      this.measurementIntervals.delete(sloId);\n    }\n  }\n\n  isRunning(): boolean {\n    return this.running;\n  }\n}\n\n// =============================================================================\n// Factory Functions\n// =============================================================================\n\nlet defaultManager: SLOManager | null = null;\n\nexport function getSLOManager(): SLOManager {\n  if (!defaultManager) {\n    defaultManager = new SLOManager();\n  }\n  return defaultManager;\n}\n\nexport function createSLOManager(config?: Partial<SLOManagerConfig>): SLOManager {\n  return new SLOManager(config);\n}\n","/**\n * Feature Flags Types\n * Phase 15A: Feature Flags & Progressive Rollouts\n */\n\nimport { z } from \"zod\";\n\n// =============================================================================\n// Flag Types & Variations\n// =============================================================================\n\nexport const FlagTypeSchema = z.enum([\n  \"boolean\", // Simple on/off\n  \"string\", // String variations\n  \"number\", // Numeric variations\n  \"json\", // Complex JSON variations\n]);\nexport type FlagType = z.infer<typeof FlagTypeSchema>;\n\nexport const FlagVariationSchema = z.object({\n  id: z.string(),\n  value: z.unknown(),\n  name: z.string(),\n  description: z.string().optional(),\n});\nexport type FlagVariation = z.infer<typeof FlagVariationSchema>;\n\nexport const FlagStatusSchema = z.enum([\n  \"active\", // Flag is active and being evaluated\n  \"inactive\", // Flag is turned off\n  \"archived\", // Flag is archived (soft deleted)\n]);\nexport type FlagStatus = z.infer<typeof FlagStatusSchema>;\n\n// =============================================================================\n// Targeting Rules\n// =============================================================================\n\nexport const OperatorSchema = z.enum([\n  \"eq\", // equals\n  \"neq\", // not equals\n  \"gt\", // greater than\n  \"gte\", // greater than or equal\n  \"lt\", // less than\n  \"lte\", // less than or equal\n  \"contains\", // string contains\n  \"not_contains\", // string does not contain\n  \"starts_with\", // string starts with\n  \"ends_with\", // string ends with\n  \"matches\", // regex match\n  \"in\", // in list\n  \"not_in\", // not in list\n  \"semver_eq\", // semantic version equals\n  \"semver_gt\", // semantic version greater than\n  \"semver_lt\", // semantic version less than\n]);\nexport type Operator = z.infer<typeof OperatorSchema>;\n\nexport const TargetingConditionSchema = z.object({\n  attribute: z.string(),\n  operator: OperatorSchema,\n  value: z.unknown(),\n  negate: z.boolean().default(false),\n});\nexport type TargetingCondition = z.infer<typeof TargetingConditionSchema>;\n\nexport const TargetingRuleSchema = z.object({\n  id: z.string(),\n  name: z.string().optional(),\n  description: z.string().optional(),\n  conditions: z.array(TargetingConditionSchema).min(1),\n  conditionLogic: z.enum([\"and\", \"or\"]).default(\"and\"),\n  variationId: z.string(),\n  priority: z.number().default(0),\n  enabled: z.boolean().default(true),\n});\nexport type TargetingRule = z.infer<typeof TargetingRuleSchema>;\n\n// =============================================================================\n// Segments\n// =============================================================================\n\nexport const SegmentSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  description: z.string().optional(),\n  conditions: z.array(TargetingConditionSchema),\n  conditionLogic: z.enum([\"and\", \"or\"]).default(\"and\"),\n  createdAt: z.number(),\n  updatedAt: z.number(),\n});\nexport type Segment = z.infer<typeof SegmentSchema>;\n\nexport const SegmentRuleSchema = z.object({\n  id: z.string(),\n  segmentId: z.string(),\n  variationId: z.string(),\n  priority: z.number().default(0),\n  enabled: z.boolean().default(true),\n});\nexport type SegmentRule = z.infer<typeof SegmentRuleSchema>;\n\n// =============================================================================\n// Percentage Rollout\n// =============================================================================\n\nexport const RolloutWeightSchema = z.object({\n  variationId: z.string(),\n  weight: z.number().min(0).max(100),\n});\nexport type RolloutWeight = z.infer<typeof RolloutWeightSchema>;\n\nexport const PercentageRolloutSchema = z.object({\n  enabled: z.boolean().default(false),\n  weights: z.array(RolloutWeightSchema),\n  bucketBy: z.string().default(\"userId\").describe(\"Attribute to bucket by for consistent assignment\"),\n  seed: z.string().optional().describe(\"Seed for hash function\"),\n});\nexport type PercentageRollout = z.infer<typeof PercentageRolloutSchema>;\n\n// =============================================================================\n// Scheduled Rollout\n// =============================================================================\n\nexport const ScheduledChangeSchema = z.object({\n  id: z.string(),\n  scheduledAt: z.number(),\n  action: z.enum([\"enable\", \"disable\", \"update_rollout\", \"update_default\"]),\n  payload: z.record(z.unknown()).optional(),\n  executed: z.boolean().default(false),\n  executedAt: z.number().optional(),\n});\nexport type ScheduledChange = z.infer<typeof ScheduledChangeSchema>;\n\n// =============================================================================\n// Flag Definition\n// =============================================================================\n\nexport const FlagDefinitionSchema = z.object({\n  id: z.string(),\n  key: z.string().regex(/^[a-z][a-z0-9_-]*$/, \"Key must be lowercase alphanumeric with underscores/hyphens\"),\n  name: z.string(),\n  description: z.string().optional(),\n  type: FlagTypeSchema,\n  status: FlagStatusSchema.default(\"active\"),\n\n  // Variations\n  variations: z.array(FlagVariationSchema).min(2),\n  defaultVariationId: z.string(),\n  offVariationId: z.string().describe(\"Variation to serve when flag is off\"),\n\n  // Targeting\n  targetingRules: z.array(TargetingRuleSchema).default([]),\n  segmentRules: z.array(SegmentRuleSchema).default([]),\n  percentageRollout: PercentageRolloutSchema.optional(),\n\n  // Individual targets (allowlist/blocklist)\n  individualTargets: z.array(z.object({\n    userId: z.string(),\n    variationId: z.string(),\n  })).default([]),\n\n  // Prerequisites (flags that must be enabled)\n  prerequisites: z.array(z.object({\n    flagKey: z.string(),\n    variationId: z.string(),\n  })).default([]),\n\n  // Scheduling\n  scheduledChanges: z.array(ScheduledChangeSchema).default([]),\n\n  // Metadata\n  tags: z.array(z.string()).default([]),\n  owner: z.string().optional(),\n  environment: z.string().default(\"production\"),\n  project: z.string().optional(),\n\n  // Audit\n  createdAt: z.number(),\n  updatedAt: z.number(),\n  createdBy: z.string().optional(),\n  updatedBy: z.string().optional(),\n});\nexport type FlagDefinition = z.infer<typeof FlagDefinitionSchema>;\n\n// =============================================================================\n// Evaluation Context\n// =============================================================================\n\nexport const EvaluationContextSchema = z.object({\n  // User attributes\n  userId: z.string().optional(),\n  email: z.string().optional(),\n  name: z.string().optional(),\n\n  // Organization/team\n  organizationId: z.string().optional(),\n  teamId: z.string().optional(),\n\n  // Device/platform\n  platform: z.string().optional(),\n  deviceType: z.string().optional(),\n  browser: z.string().optional(),\n  os: z.string().optional(),\n  appVersion: z.string().optional(),\n\n  // Location\n  country: z.string().optional(),\n  region: z.string().optional(),\n  city: z.string().optional(),\n  timezone: z.string().optional(),\n\n  // Custom attributes\n  custom: z.record(z.unknown()).default({}),\n\n  // Request metadata\n  requestId: z.string().optional(),\n  timestamp: z.number().optional(),\n});\nexport type EvaluationContext = z.infer<typeof EvaluationContextSchema>;\n\n// =============================================================================\n// Evaluation Result\n// =============================================================================\n\nexport const EvaluationReasonSchema = z.enum([\n  \"off\", // Flag is off\n  \"fallthrough\", // Default variation\n  \"target_match\", // Individual target matched\n  \"rule_match\", // Targeting rule matched\n  \"segment_match\", // Segment rule matched\n  \"percentage_rollout\", // Percentage rollout\n  \"prerequisite_failed\", // Prerequisite not met\n  \"error\", // Evaluation error\n  \"stale\", // Using stale/cached value\n]);\nexport type EvaluationReason = z.infer<typeof EvaluationReasonSchema>;\n\nexport const EvaluationResultSchema = z.object({\n  flagKey: z.string(),\n  value: z.unknown(),\n  variationId: z.string(),\n  reason: EvaluationReasonSchema,\n  ruleId: z.string().optional(),\n  segmentId: z.string().optional(),\n  isDefaultValue: z.boolean().default(false),\n  evaluationTime: z.number().describe(\"Evaluation time in ms\"),\n  metadata: z.record(z.unknown()).optional(),\n});\nexport type EvaluationResult = z.infer<typeof EvaluationResultSchema>;\n\n// =============================================================================\n// Flag Analytics\n// =============================================================================\n\nexport const FlagEvaluationEventSchema = z.object({\n  id: z.string(),\n  timestamp: z.number(),\n  flagKey: z.string(),\n  variationId: z.string(),\n  reason: EvaluationReasonSchema,\n  context: EvaluationContextSchema.partial(),\n  evaluationTime: z.number(),\n});\nexport type FlagEvaluationEvent = z.infer<typeof FlagEvaluationEventSchema>;\n\nexport const FlagStatsSchema = z.object({\n  flagKey: z.string(),\n  totalEvaluations: z.number(),\n  uniqueUsers: z.number(),\n  variationCounts: z.record(z.number()),\n  reasonCounts: z.record(z.number()),\n  avgEvaluationTime: z.number(),\n  lastEvaluatedAt: z.number().optional(),\n});\nexport type FlagStats = z.infer<typeof FlagStatsSchema>;\n\n// =============================================================================\n// Configuration\n// =============================================================================\n\nexport const FlagManagerConfigSchema = z.object({\n  // Environment\n  environment: z.string().default(\"production\"),\n  project: z.string().optional(),\n\n  // Caching\n  cacheEnabled: z.boolean().default(true),\n  cacheTtlSeconds: z.number().default(60),\n  staleTtlSeconds: z.number().default(300).describe(\"How long to serve stale data on error\"),\n\n  // Streaming/Polling\n  streamingEnabled: z.boolean().default(false),\n  pollingIntervalSeconds: z.number().default(30),\n\n  // Analytics\n  analyticsEnabled: z.boolean().default(true),\n  analyticsSampleRate: z.number().min(0).max(1).default(1),\n  analyticsFlushIntervalSeconds: z.number().default(60),\n\n  // Defaults\n  defaultOnError: z.boolean().default(false),\n\n  // Bootstrap (initial flag values)\n  bootstrap: z.record(z.unknown()).optional(),\n\n  // Provider integration\n  provider: z.enum([\"memory\", \"launchdarkly\", \"unleash\", \"flagsmith\", \"custom\"]).default(\"memory\"),\n  providerConfig: z.record(z.unknown()).optional(),\n});\nexport type FlagManagerConfig = z.infer<typeof FlagManagerConfigSchema>;\n\n// =============================================================================\n// Events\n// =============================================================================\n\nexport type FlagEvents = {\n  // Flag Lifecycle\n  flagCreated: (flag: FlagDefinition) => void;\n  flagUpdated: (flag: FlagDefinition, changes: string[]) => void;\n  flagDeleted: (flagKey: string) => void;\n  flagStatusChanged: (flagKey: string, status: FlagStatus) => void;\n\n  // Evaluation\n  evaluated: (result: EvaluationResult, context: EvaluationContext) => void;\n  evaluationError: (flagKey: string, error: Error, context: EvaluationContext) => void;\n\n  // Targeting\n  targetingRuleAdded: (flagKey: string, rule: TargetingRule) => void;\n  targetingRuleRemoved: (flagKey: string, ruleId: string) => void;\n\n  // Rollout\n  rolloutUpdated: (flagKey: string, rollout: PercentageRollout) => void;\n\n  // Scheduled\n  scheduledChangeExecuted: (flagKey: string, change: ScheduledChange) => void;\n\n  // Cache\n  cacheUpdated: (flagKeys: string[]) => void;\n  cacheMiss: (flagKey: string) => void;\n\n  // Analytics\n  analyticsFlush: (events: FlagEvaluationEvent[]) => void;\n\n  // Errors\n  error: (error: Error) => void;\n};\n\n// =============================================================================\n// Storage Interface\n// =============================================================================\n\nexport interface FlagStorage {\n  // Flags\n  getFlag(key: string): Promise<FlagDefinition | null>;\n  saveFlag(flag: FlagDefinition): Promise<void>;\n  deleteFlag(key: string): Promise<void>;\n  listFlags(filters?: { status?: FlagStatus; environment?: string; project?: string; tags?: string[] }): Promise<FlagDefinition[]>;\n\n  // Segments\n  getSegment(id: string): Promise<Segment | null>;\n  saveSegment(segment: Segment): Promise<void>;\n  deleteSegment(id: string): Promise<void>;\n  listSegments(): Promise<Segment[]>;\n\n  // Analytics\n  saveEvaluationEvent(event: FlagEvaluationEvent): Promise<void>;\n  getEvaluationEvents(flagKey: string, startTime: number, endTime: number): Promise<FlagEvaluationEvent[]>;\n  getStats(flagKey: string): Promise<FlagStats | null>;\n}\n\n// =============================================================================\n// Provider Interface\n// =============================================================================\n\nexport interface FlagProvider {\n  readonly name: string;\n  initialize(): Promise<void>;\n  shutdown(): Promise<void>;\n  getFlag(key: string): Promise<FlagDefinition | null>;\n  getAllFlags(): Promise<FlagDefinition[]>;\n  subscribe?(callback: (flags: FlagDefinition[]) => void): () => void;\n}\n\n// =============================================================================\n// Helpers\n// =============================================================================\n\nexport function createBooleanFlag(\n  key: string,\n  name: string,\n  defaultValue: boolean = false\n): Omit<FlagDefinition, \"id\" | \"createdAt\" | \"updatedAt\"> {\n  return {\n    key,\n    name,\n    type: \"boolean\",\n    status: \"active\",\n    variations: [\n      { id: \"true\", value: true, name: \"Enabled\" },\n      { id: \"false\", value: false, name: \"Disabled\" },\n    ],\n    defaultVariationId: defaultValue ? \"true\" : \"false\",\n    offVariationId: \"false\",\n    targetingRules: [],\n    segmentRules: [],\n    individualTargets: [],\n    prerequisites: [],\n    scheduledChanges: [],\n    tags: [],\n    environment: \"production\",\n  };\n}\n\nexport function createStringFlag(\n  key: string,\n  name: string,\n  variations: Array<{ id: string; value: string; name: string }>,\n  defaultVariationId: string\n): Omit<FlagDefinition, \"id\" | \"createdAt\" | \"updatedAt\"> {\n  return {\n    key,\n    name,\n    type: \"string\",\n    status: \"active\",\n    variations: variations.map(v => ({ ...v, value: v.value })),\n    defaultVariationId,\n    offVariationId: variations[0]?.id ?? defaultVariationId,\n    targetingRules: [],\n    segmentRules: [],\n    individualTargets: [],\n    prerequisites: [],\n    scheduledChanges: [],\n    tags: [],\n    environment: \"production\",\n  };\n}\n\nexport function createPercentageRollout(\n  enabledPercent: number,\n  bucketBy: string = \"userId\"\n): PercentageRollout {\n  return {\n    enabled: true,\n    weights: [\n      { variationId: \"true\", weight: enabledPercent },\n      { variationId: \"false\", weight: 100 - enabledPercent },\n    ],\n    bucketBy,\n  };\n}\n\nexport function createTargetingRule(\n  attribute: string,\n  operator: Operator,\n  value: unknown,\n  variationId: string\n): Omit<TargetingRule, \"id\"> {\n  return {\n    conditions: [{ attribute, operator, value, negate: false }],\n    conditionLogic: \"and\",\n    variationId,\n    priority: 0,\n    enabled: true,\n  };\n}\n","/**\n * Feature Flags Manager Implementation\n * Phase 15A: Feature Flags & Progressive Rollouts\n */\n\nimport { EventEmitter } from \"eventemitter3\";\nimport { createHash } from \"crypto\";\nimport { randomUUID } from \"crypto\";\nimport {\n  FlagDefinition,\n  FlagDefinitionSchema,\n  FlagStatus,\n  FlagVariation,\n  TargetingRule,\n  TargetingCondition,\n  Operator,\n  Segment,\n  SegmentSchema,\n  PercentageRollout,\n  ScheduledChange,\n  EvaluationContext,\n  EvaluationContextSchema,\n  EvaluationResult,\n  EvaluationReason,\n  FlagEvaluationEvent,\n  FlagStats,\n  FlagManagerConfig,\n  FlagManagerConfigSchema,\n  FlagEvents,\n  FlagStorage,\n  FlagProvider,\n} from \"./types.js\";\n\n// =============================================================================\n// In-Memory Storage\n// =============================================================================\n\nclass InMemoryFlagStorage implements FlagStorage {\n  private flags = new Map<string, FlagDefinition>();\n  private segments = new Map<string, Segment>();\n  private events = new Map<string, FlagEvaluationEvent[]>();\n  private stats = new Map<string, FlagStats>();\n\n  async getFlag(key: string): Promise<FlagDefinition | null> {\n    return this.flags.get(key) ?? null;\n  }\n\n  async saveFlag(flag: FlagDefinition): Promise<void> {\n    this.flags.set(flag.key, flag);\n  }\n\n  async deleteFlag(key: string): Promise<void> {\n    this.flags.delete(key);\n    this.events.delete(key);\n    this.stats.delete(key);\n  }\n\n  async listFlags(filters?: {\n    status?: FlagStatus;\n    environment?: string;\n    project?: string;\n    tags?: string[];\n  }): Promise<FlagDefinition[]> {\n    let results = Array.from(this.flags.values());\n\n    if (filters) {\n      if (filters.status) {\n        results = results.filter(f => f.status === filters.status);\n      }\n      if (filters.environment) {\n        results = results.filter(f => f.environment === filters.environment);\n      }\n      if (filters.project) {\n        results = results.filter(f => f.project === filters.project);\n      }\n      if (filters.tags && filters.tags.length > 0) {\n        results = results.filter(f => filters.tags!.some(t => f.tags.includes(t)));\n      }\n    }\n\n    return results;\n  }\n\n  async getSegment(id: string): Promise<Segment | null> {\n    return this.segments.get(id) ?? null;\n  }\n\n  async saveSegment(segment: Segment): Promise<void> {\n    this.segments.set(segment.id, segment);\n  }\n\n  async deleteSegment(id: string): Promise<void> {\n    this.segments.delete(id);\n  }\n\n  async listSegments(): Promise<Segment[]> {\n    return Array.from(this.segments.values());\n  }\n\n  async saveEvaluationEvent(event: FlagEvaluationEvent): Promise<void> {\n    const events = this.events.get(event.flagKey) ?? [];\n    events.push(event);\n    // Keep only last 1000 events per flag\n    if (events.length > 1000) {\n      events.shift();\n    }\n    this.events.set(event.flagKey, events);\n\n    // Update stats\n    await this.updateStats(event);\n  }\n\n  private async updateStats(event: FlagEvaluationEvent): Promise<void> {\n    const existing = this.stats.get(event.flagKey) ?? {\n      flagKey: event.flagKey,\n      totalEvaluations: 0,\n      uniqueUsers: 0,\n      variationCounts: {},\n      reasonCounts: {},\n      avgEvaluationTime: 0,\n    };\n\n    existing.totalEvaluations++;\n    existing.variationCounts[event.variationId] = (existing.variationCounts[event.variationId] ?? 0) + 1;\n    existing.reasonCounts[event.reason] = (existing.reasonCounts[event.reason] ?? 0) + 1;\n    existing.avgEvaluationTime =\n      (existing.avgEvaluationTime * (existing.totalEvaluations - 1) + event.evaluationTime) /\n      existing.totalEvaluations;\n    existing.lastEvaluatedAt = event.timestamp;\n\n    this.stats.set(event.flagKey, existing);\n  }\n\n  async getEvaluationEvents(flagKey: string, startTime: number, endTime: number): Promise<FlagEvaluationEvent[]> {\n    const events = this.events.get(flagKey) ?? [];\n    return events.filter(e => e.timestamp >= startTime && e.timestamp <= endTime);\n  }\n\n  async getStats(flagKey: string): Promise<FlagStats | null> {\n    return this.stats.get(flagKey) ?? null;\n  }\n}\n\n// =============================================================================\n// Condition Evaluator\n// =============================================================================\n\nfunction evaluateCondition(condition: TargetingCondition, context: EvaluationContext): boolean {\n  const { attribute, operator, value, negate } = condition;\n\n  // Get attribute value from context\n  let attrValue: unknown;\n  if (attribute in context) {\n    attrValue = (context as Record<string, unknown>)[attribute];\n  } else if (context.custom && attribute in context.custom) {\n    attrValue = context.custom[attribute];\n  } else {\n    attrValue = undefined;\n  }\n\n  let result: boolean;\n\n  switch (operator) {\n    case \"eq\":\n      result = attrValue === value;\n      break;\n    case \"neq\":\n      result = attrValue !== value;\n      break;\n    case \"gt\":\n      result = typeof attrValue === \"number\" && typeof value === \"number\" && attrValue > value;\n      break;\n    case \"gte\":\n      result = typeof attrValue === \"number\" && typeof value === \"number\" && attrValue >= value;\n      break;\n    case \"lt\":\n      result = typeof attrValue === \"number\" && typeof value === \"number\" && attrValue < value;\n      break;\n    case \"lte\":\n      result = typeof attrValue === \"number\" && typeof value === \"number\" && attrValue <= value;\n      break;\n    case \"contains\":\n      result = typeof attrValue === \"string\" && typeof value === \"string\" && attrValue.includes(value);\n      break;\n    case \"not_contains\":\n      result = typeof attrValue === \"string\" && typeof value === \"string\" && !attrValue.includes(value);\n      break;\n    case \"starts_with\":\n      result = typeof attrValue === \"string\" && typeof value === \"string\" && attrValue.startsWith(value);\n      break;\n    case \"ends_with\":\n      result = typeof attrValue === \"string\" && typeof value === \"string\" && attrValue.endsWith(value);\n      break;\n    case \"matches\":\n      try {\n        result = typeof attrValue === \"string\" && typeof value === \"string\" && new RegExp(value).test(attrValue);\n      } catch {\n        result = false;\n      }\n      break;\n    case \"in\":\n      result = Array.isArray(value) && value.includes(attrValue);\n      break;\n    case \"not_in\":\n      result = Array.isArray(value) && !value.includes(attrValue);\n      break;\n    case \"semver_eq\":\n    case \"semver_gt\":\n    case \"semver_lt\":\n      result = compareSemver(String(attrValue), String(value), operator);\n      break;\n    default:\n      result = false;\n  }\n\n  return negate ? !result : result;\n}\n\nfunction compareSemver(a: string, b: string, op: \"semver_eq\" | \"semver_gt\" | \"semver_lt\"): boolean {\n  const parseVersion = (v: string): number[] => {\n    return v.split(\".\").map(n => parseInt(n, 10) || 0);\n  };\n\n  const va = parseVersion(a);\n  const vb = parseVersion(b);\n  const maxLen = Math.max(va.length, vb.length);\n\n  for (let i = 0; i < maxLen; i++) {\n    const ai = va[i] ?? 0;\n    const bi = vb[i] ?? 0;\n    if (ai !== bi) {\n      switch (op) {\n        case \"semver_eq\":\n          return false;\n        case \"semver_gt\":\n          return ai > bi;\n        case \"semver_lt\":\n          return ai < bi;\n      }\n    }\n  }\n\n  return op === \"semver_eq\";\n}\n\nfunction evaluateConditions(\n  conditions: TargetingCondition[],\n  logic: \"and\" | \"or\",\n  context: EvaluationContext\n): boolean {\n  if (logic === \"and\") {\n    return conditions.every(c => evaluateCondition(c, context));\n  } else {\n    return conditions.some(c => evaluateCondition(c, context));\n  }\n}\n\n// =============================================================================\n// Bucketing\n// =============================================================================\n\nfunction hashString(str: string, seed?: string): number {\n  const hash = createHash(\"sha256\");\n  hash.update(seed ? `${seed}:${str}` : str);\n  const digest = hash.digest(\"hex\");\n  // Convert first 8 hex chars to a number between 0-100\n  const num = parseInt(digest.slice(0, 8), 16);\n  return (num % 10000) / 100;\n}\n\nfunction getBucket(context: EvaluationContext, bucketBy: string, seed?: string): number {\n  let bucketValue: string;\n\n  if (bucketBy in context) {\n    bucketValue = String((context as Record<string, unknown>)[bucketBy] ?? \"\");\n  } else if (context.custom && bucketBy in context.custom) {\n    bucketValue = String(context.custom[bucketBy] ?? \"\");\n  } else {\n    bucketValue = context.userId ?? context.requestId ?? randomUUID();\n  }\n\n  return hashString(bucketValue, seed);\n}\n\nfunction selectVariationByWeight(\n  weights: Array<{ variationId: string; weight: number }>,\n  bucket: number\n): string | null {\n  let cumulative = 0;\n  for (const w of weights) {\n    cumulative += w.weight;\n    if (bucket < cumulative) {\n      return w.variationId;\n    }\n  }\n  return weights[weights.length - 1]?.variationId ?? null;\n}\n\n// =============================================================================\n// Feature Flags Manager\n// =============================================================================\n\nexport class FeatureFlagsManager extends EventEmitter<FlagEvents> {\n  private config: FlagManagerConfig;\n  private storage: FlagStorage;\n  private cache = new Map<string, { flag: FlagDefinition; fetchedAt: number }>();\n  private analyticsBuffer: FlagEvaluationEvent[] = [];\n  private pollingInterval?: NodeJS.Timeout;\n  private analyticsFlushInterval?: NodeJS.Timeout;\n  private schedulerInterval?: NodeJS.Timeout;\n  private running = false;\n\n  constructor(config: Partial<FlagManagerConfig> = {}) {\n    super();\n    this.config = FlagManagerConfigSchema.parse(config);\n    this.storage = new InMemoryFlagStorage();\n  }\n\n  // ---------------------------------------------------------------------------\n  // Configuration\n  // ---------------------------------------------------------------------------\n\n  setStorage(storage: FlagStorage): void {\n    this.storage = storage;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Flag CRUD\n  // ---------------------------------------------------------------------------\n\n  async createFlag(input: Omit<FlagDefinition, \"id\" | \"createdAt\" | \"updatedAt\">): Promise<FlagDefinition> {\n    const now = Date.now();\n    const flag = FlagDefinitionSchema.parse({\n      ...input,\n      id: randomUUID(),\n      createdAt: now,\n      updatedAt: now,\n    });\n\n    await this.storage.saveFlag(flag);\n    this.invalidateCache(flag.key);\n    this.emit(\"flagCreated\", flag);\n    return flag;\n  }\n\n  async getFlag(key: string): Promise<FlagDefinition | null> {\n    // Check cache first\n    if (this.config.cacheEnabled) {\n      const cached = this.cache.get(key);\n      const now = Date.now();\n\n      if (cached) {\n        const age = now - cached.fetchedAt;\n        if (age < this.config.cacheTtlSeconds * 1000) {\n          return cached.flag;\n        }\n        // Check stale TTL\n        if (age < this.config.staleTtlSeconds * 1000) {\n          // Refresh in background\n          this.refreshCache(key).catch(() => {});\n          return cached.flag;\n        }\n      }\n    }\n\n    const flag = await this.storage.getFlag(key);\n    if (flag && this.config.cacheEnabled) {\n      this.cache.set(key, { flag, fetchedAt: Date.now() });\n    }\n    return flag;\n  }\n\n  async updateFlag(key: string, updates: Partial<FlagDefinition>): Promise<FlagDefinition | null> {\n    const existing = await this.storage.getFlag(key);\n    if (!existing) return null;\n\n    const changes: string[] = [];\n    for (const [k, v] of Object.entries(updates)) {\n      if (JSON.stringify((existing as Record<string, unknown>)[k]) !== JSON.stringify(v)) {\n        changes.push(k);\n      }\n    }\n\n    const updated = FlagDefinitionSchema.parse({\n      ...existing,\n      ...updates,\n      id: existing.id,\n      key: existing.key,\n      createdAt: existing.createdAt,\n      updatedAt: Date.now(),\n    });\n\n    await this.storage.saveFlag(updated);\n    this.invalidateCache(key);\n\n    if (updates.status && updates.status !== existing.status) {\n      this.emit(\"flagStatusChanged\", key, updates.status);\n    }\n\n    this.emit(\"flagUpdated\", updated, changes);\n    return updated;\n  }\n\n  async deleteFlag(key: string): Promise<boolean> {\n    const existing = await this.storage.getFlag(key);\n    if (!existing) return false;\n\n    await this.storage.deleteFlag(key);\n    this.invalidateCache(key);\n    this.emit(\"flagDeleted\", key);\n    return true;\n  }\n\n  async listFlags(filters?: {\n    status?: FlagStatus;\n    environment?: string;\n    project?: string;\n    tags?: string[];\n  }): Promise<FlagDefinition[]> {\n    return this.storage.listFlags(filters);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Segments\n  // ---------------------------------------------------------------------------\n\n  async createSegment(input: Omit<Segment, \"id\" | \"createdAt\" | \"updatedAt\">): Promise<Segment> {\n    const now = Date.now();\n    const segment = SegmentSchema.parse({\n      ...input,\n      id: randomUUID(),\n      createdAt: now,\n      updatedAt: now,\n    });\n\n    await this.storage.saveSegment(segment);\n    return segment;\n  }\n\n  async getSegment(id: string): Promise<Segment | null> {\n    return this.storage.getSegment(id);\n  }\n\n  async listSegments(): Promise<Segment[]> {\n    return this.storage.listSegments();\n  }\n\n  async deleteSegment(id: string): Promise<void> {\n    await this.storage.deleteSegment(id);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Evaluation\n  // ---------------------------------------------------------------------------\n\n  async evaluate(flagKey: string, context: Partial<EvaluationContext> = {}): Promise<EvaluationResult> {\n    const startTime = performance.now();\n    const fullContext = EvaluationContextSchema.parse({\n      ...context,\n      timestamp: Date.now(),\n    });\n\n    try {\n      const flag = await this.getFlag(flagKey);\n\n      if (!flag) {\n        return this.createErrorResult(flagKey, \"off\", startTime, \"Flag not found\");\n      }\n\n      // Check if flag is active\n      if (flag.status !== \"active\") {\n        const variation = this.getVariation(flag, flag.offVariationId);\n        return this.createResult(flagKey, variation, \"off\", startTime);\n      }\n\n      // Check prerequisites\n      for (const prereq of flag.prerequisites) {\n        const prereqResult = await this.evaluate(prereq.flagKey, context);\n        if (prereqResult.variationId !== prereq.variationId) {\n          const variation = this.getVariation(flag, flag.offVariationId);\n          return this.createResult(flagKey, variation, \"prerequisite_failed\", startTime);\n        }\n      }\n\n      // Check individual targets\n      if (fullContext.userId) {\n        const target = flag.individualTargets.find(t => t.userId === fullContext.userId);\n        if (target) {\n          const variation = this.getVariation(flag, target.variationId);\n          return this.createResult(flagKey, variation, \"target_match\", startTime);\n        }\n      }\n\n      // Check targeting rules (by priority)\n      const sortedRules = [...flag.targetingRules]\n        .filter(r => r.enabled)\n        .sort((a, b) => b.priority - a.priority);\n\n      for (const rule of sortedRules) {\n        if (evaluateConditions(rule.conditions, rule.conditionLogic, fullContext)) {\n          const variation = this.getVariation(flag, rule.variationId);\n          return this.createResult(flagKey, variation, \"rule_match\", startTime, rule.id);\n        }\n      }\n\n      // Check segment rules\n      for (const segmentRule of flag.segmentRules.filter(r => r.enabled)) {\n        const segment = await this.storage.getSegment(segmentRule.segmentId);\n        if (segment && evaluateConditions(segment.conditions, segment.conditionLogic, fullContext)) {\n          const variation = this.getVariation(flag, segmentRule.variationId);\n          return this.createResult(flagKey, variation, \"segment_match\", startTime, undefined, segment.id);\n        }\n      }\n\n      // Check percentage rollout\n      if (flag.percentageRollout?.enabled) {\n        const bucket = getBucket(fullContext, flag.percentageRollout.bucketBy, flag.percentageRollout.seed);\n        const variationId = selectVariationByWeight(flag.percentageRollout.weights, bucket);\n        if (variationId) {\n          const variation = this.getVariation(flag, variationId);\n          return this.createResult(flagKey, variation, \"percentage_rollout\", startTime);\n        }\n      }\n\n      // Fallthrough to default\n      const variation = this.getVariation(flag, flag.defaultVariationId);\n      return this.createResult(flagKey, variation, \"fallthrough\", startTime, undefined, undefined, true);\n    } catch (error) {\n      this.emit(\"evaluationError\", flagKey, error instanceof Error ? error : new Error(String(error)), fullContext);\n      return this.createErrorResult(flagKey, \"error\", startTime, String(error));\n    }\n  }\n\n  // Convenience methods for typed evaluation\n  async evaluateBoolean(flagKey: string, context: Partial<EvaluationContext> = {}, defaultValue = false): Promise<boolean> {\n    const result = await this.evaluate(flagKey, context);\n    return typeof result.value === \"boolean\" ? result.value : defaultValue;\n  }\n\n  async evaluateString(flagKey: string, context: Partial<EvaluationContext> = {}, defaultValue = \"\"): Promise<string> {\n    const result = await this.evaluate(flagKey, context);\n    return typeof result.value === \"string\" ? result.value : defaultValue;\n  }\n\n  async evaluateNumber(flagKey: string, context: Partial<EvaluationContext> = {}, defaultValue = 0): Promise<number> {\n    const result = await this.evaluate(flagKey, context);\n    return typeof result.value === \"number\" ? result.value : defaultValue;\n  }\n\n  async evaluateJSON<T>(flagKey: string, context: Partial<EvaluationContext> = {}, defaultValue: T): Promise<T> {\n    const result = await this.evaluate(flagKey, context);\n    return (result.value as T) ?? defaultValue;\n  }\n\n  private getVariation(flag: FlagDefinition, variationId: string): FlagVariation {\n    const variation = flag.variations.find(v => v.id === variationId);\n    if (!variation) {\n      // Return first variation as fallback\n      return flag.variations[0] ?? { id: \"unknown\", value: null, name: \"Unknown\" };\n    }\n    return variation;\n  }\n\n  private createResult(\n    flagKey: string,\n    variation: FlagVariation,\n    reason: EvaluationReason,\n    startTime: number,\n    ruleId?: string,\n    segmentId?: string,\n    isDefaultValue = false\n  ): EvaluationResult {\n    const evaluationTime = performance.now() - startTime;\n    const result: EvaluationResult = {\n      flagKey,\n      value: variation.value,\n      variationId: variation.id,\n      reason,\n      ruleId,\n      segmentId,\n      isDefaultValue,\n      evaluationTime,\n    };\n\n    this.recordEvaluation(result);\n    return result;\n  }\n\n  private createErrorResult(\n    flagKey: string,\n    reason: EvaluationReason,\n    startTime: number,\n    error?: string\n  ): EvaluationResult {\n    const evaluationTime = performance.now() - startTime;\n    return {\n      flagKey,\n      value: this.config.defaultOnError,\n      variationId: \"error\",\n      reason,\n      isDefaultValue: true,\n      evaluationTime,\n      metadata: error ? { error } : undefined,\n    };\n  }\n\n  // ---------------------------------------------------------------------------\n  // Analytics\n  // ---------------------------------------------------------------------------\n\n  private recordEvaluation(result: EvaluationResult): void {\n    if (!this.config.analyticsEnabled) return;\n\n    // Sample\n    if (Math.random() > this.config.analyticsSampleRate) return;\n\n    const event: FlagEvaluationEvent = {\n      id: randomUUID(),\n      timestamp: Date.now(),\n      flagKey: result.flagKey,\n      variationId: result.variationId,\n      reason: result.reason,\n      context: {},\n      evaluationTime: result.evaluationTime,\n    };\n\n    this.analyticsBuffer.push(event);\n  }\n\n  private async flushAnalytics(): Promise<void> {\n    if (this.analyticsBuffer.length === 0) return;\n\n    const events = [...this.analyticsBuffer];\n    this.analyticsBuffer = [];\n\n    for (const event of events) {\n      await this.storage.saveEvaluationEvent(event);\n    }\n\n    this.emit(\"analyticsFlush\", events);\n  }\n\n  async getStats(flagKey: string): Promise<FlagStats | null> {\n    return this.storage.getStats(flagKey);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Cache Management\n  // ---------------------------------------------------------------------------\n\n  private invalidateCache(key: string): void {\n    this.cache.delete(key);\n  }\n\n  private async refreshCache(key: string): Promise<void> {\n    const flag = await this.storage.getFlag(key);\n    if (flag) {\n      this.cache.set(key, { flag, fetchedAt: Date.now() });\n    }\n  }\n\n  async refreshAllCaches(): Promise<void> {\n    const flags = await this.storage.listFlags({ status: \"active\" });\n    const keys = flags.map(f => f.key);\n\n    for (const flag of flags) {\n      this.cache.set(flag.key, { flag, fetchedAt: Date.now() });\n    }\n\n    this.emit(\"cacheUpdated\", keys);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Scheduled Changes\n  // ---------------------------------------------------------------------------\n\n  async addScheduledChange(\n    flagKey: string,\n    change: Omit<ScheduledChange, \"id\" | \"executed\">\n  ): Promise<ScheduledChange> {\n    const flag = await this.storage.getFlag(flagKey);\n    if (!flag) {\n      throw new Error(`Flag not found: ${flagKey}`);\n    }\n\n    const scheduledChange: ScheduledChange = {\n      ...change,\n      id: randomUUID(),\n      executed: false,\n    };\n\n    await this.updateFlag(flagKey, {\n      scheduledChanges: [...flag.scheduledChanges, scheduledChange],\n    });\n\n    return scheduledChange;\n  }\n\n  private async processScheduledChanges(): Promise<void> {\n    const now = Date.now();\n    const flags = await this.storage.listFlags({ status: \"active\" });\n\n    for (const flag of flags) {\n      const pendingChanges = flag.scheduledChanges.filter(\n        c => !c.executed && c.scheduledAt <= now\n      );\n\n      for (const change of pendingChanges) {\n        try {\n          await this.executeScheduledChange(flag, change);\n        } catch (error) {\n          this.emit(\"error\", error instanceof Error ? error : new Error(String(error)));\n        }\n      }\n    }\n  }\n\n  private async executeScheduledChange(flag: FlagDefinition, change: ScheduledChange): Promise<void> {\n    let updates: Partial<FlagDefinition> = {};\n\n    switch (change.action) {\n      case \"enable\":\n        updates = { status: \"active\" };\n        break;\n      case \"disable\":\n        updates = { status: \"inactive\" };\n        break;\n      case \"update_rollout\":\n        if (change.payload?.rollout) {\n          updates = { percentageRollout: change.payload.rollout as PercentageRollout };\n        }\n        break;\n      case \"update_default\":\n        if (change.payload?.defaultVariationId) {\n          updates = { defaultVariationId: change.payload.defaultVariationId as string };\n        }\n        break;\n    }\n\n    // Mark as executed\n    const updatedChanges = flag.scheduledChanges.map(c =>\n      c.id === change.id ? { ...c, executed: true, executedAt: Date.now() } : c\n    );\n\n    await this.updateFlag(flag.key, {\n      ...updates,\n      scheduledChanges: updatedChanges,\n    });\n\n    this.emit(\"scheduledChangeExecuted\", flag.key, { ...change, executed: true, executedAt: Date.now() });\n  }\n\n  // ---------------------------------------------------------------------------\n  // Targeting Rules\n  // ---------------------------------------------------------------------------\n\n  async addTargetingRule(\n    flagKey: string,\n    rule: Omit<TargetingRule, \"id\">\n  ): Promise<TargetingRule> {\n    const flag = await this.storage.getFlag(flagKey);\n    if (!flag) {\n      throw new Error(`Flag not found: ${flagKey}`);\n    }\n\n    const fullRule: TargetingRule = {\n      ...rule,\n      id: randomUUID(),\n    };\n\n    await this.updateFlag(flagKey, {\n      targetingRules: [...flag.targetingRules, fullRule],\n    });\n\n    this.emit(\"targetingRuleAdded\", flagKey, fullRule);\n    return fullRule;\n  }\n\n  async removeTargetingRule(flagKey: string, ruleId: string): Promise<boolean> {\n    const flag = await this.storage.getFlag(flagKey);\n    if (!flag) return false;\n\n    const filtered = flag.targetingRules.filter(r => r.id !== ruleId);\n    if (filtered.length === flag.targetingRules.length) return false;\n\n    await this.updateFlag(flagKey, { targetingRules: filtered });\n    this.emit(\"targetingRuleRemoved\", flagKey, ruleId);\n    return true;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Rollout Management\n  // ---------------------------------------------------------------------------\n\n  async updateRollout(flagKey: string, rollout: PercentageRollout): Promise<void> {\n    await this.updateFlag(flagKey, { percentageRollout: rollout });\n    this.emit(\"rolloutUpdated\", flagKey, rollout);\n  }\n\n  async setRolloutPercentage(flagKey: string, enabledPercent: number): Promise<void> {\n    const flag = await this.storage.getFlag(flagKey);\n    if (!flag) {\n      throw new Error(`Flag not found: ${flagKey}`);\n    }\n\n    // Assume boolean flag with \"true\" and \"false\" variations\n    const rollout: PercentageRollout = {\n      enabled: true,\n      weights: [\n        { variationId: \"true\", weight: enabledPercent },\n        { variationId: \"false\", weight: 100 - enabledPercent },\n      ],\n      bucketBy: flag.percentageRollout?.bucketBy ?? \"userId\",\n      seed: flag.percentageRollout?.seed,\n    };\n\n    await this.updateRollout(flagKey, rollout);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Lifecycle\n  // ---------------------------------------------------------------------------\n\n  async start(): Promise<void> {\n    if (this.running) return;\n    this.running = true;\n\n    // Start polling\n    if (this.config.pollingIntervalSeconds > 0) {\n      this.pollingInterval = setInterval(() => {\n        this.refreshAllCaches().catch(err => this.emit(\"error\", err));\n      }, this.config.pollingIntervalSeconds * 1000);\n    }\n\n    // Start analytics flush\n    if (this.config.analyticsEnabled) {\n      this.analyticsFlushInterval = setInterval(() => {\n        this.flushAnalytics().catch(err => this.emit(\"error\", err));\n      }, this.config.analyticsFlushIntervalSeconds * 1000);\n    }\n\n    // Start scheduler for scheduled changes\n    this.schedulerInterval = setInterval(() => {\n      this.processScheduledChanges().catch(err => this.emit(\"error\", err));\n    }, 60000); // Check every minute\n\n    // Initial cache load\n    await this.refreshAllCaches();\n  }\n\n  async stop(): Promise<void> {\n    this.running = false;\n\n    if (this.pollingInterval) {\n      clearInterval(this.pollingInterval);\n      this.pollingInterval = undefined;\n    }\n\n    if (this.analyticsFlushInterval) {\n      clearInterval(this.analyticsFlushInterval);\n      this.analyticsFlushInterval = undefined;\n    }\n\n    if (this.schedulerInterval) {\n      clearInterval(this.schedulerInterval);\n      this.schedulerInterval = undefined;\n    }\n\n    // Final flush\n    await this.flushAnalytics();\n  }\n\n  isRunning(): boolean {\n    return this.running;\n  }\n}\n\n// =============================================================================\n// Factory Functions\n// =============================================================================\n\nlet defaultManager: FeatureFlagsManager | null = null;\n\nexport function getFeatureFlagsManager(): FeatureFlagsManager {\n  if (!defaultManager) {\n    defaultManager = new FeatureFlagsManager();\n  }\n  return defaultManager;\n}\n\nexport function createFeatureFlagsManager(config?: Partial<FlagManagerConfig>): FeatureFlagsManager {\n  return new FeatureFlagsManager(config);\n}\n","/**\n * Config Manager Types\n * Phase 15B: Dynamic Configuration Management\n */\n\nimport { z } from \"zod\";\n\n// =============================================================================\n// Config Value Types\n// =============================================================================\n\nexport const ConfigValueTypeSchema = z.enum([\n  \"string\",\n  \"number\",\n  \"boolean\",\n  \"json\",\n  \"secret\", // Encrypted/sensitive value\n  \"array\",\n  \"enum\",\n]);\nexport type ConfigValueType = z.infer<typeof ConfigValueTypeSchema>;\n\nexport const ConfigValueSchema = z.object({\n  type: ConfigValueTypeSchema,\n  value: z.unknown(),\n  encrypted: z.boolean().default(false),\n});\nexport type ConfigValue = z.infer<typeof ConfigValueSchema>;\n\n// =============================================================================\n// Config Sources\n// =============================================================================\n\nexport const ConfigSourceTypeSchema = z.enum([\n  \"env\", // Environment variables\n  \"file\", // Config files (JSON, YAML, etc.)\n  \"remote\", // Remote config service\n  \"vault\", // Secret vault (HashiCorp Vault, AWS Secrets Manager, etc.)\n  \"database\", // Database-stored config\n  \"memory\", // In-memory (bootstrap/defaults)\n]);\nexport type ConfigSourceType = z.infer<typeof ConfigSourceTypeSchema>;\n\nexport const ConfigSourceSchema = z.object({\n  type: ConfigSourceTypeSchema,\n  name: z.string(),\n  priority: z.number().default(0).describe(\"Higher priority overrides lower\"),\n  enabled: z.boolean().default(true),\n\n  // Source-specific config\n  config: z.record(z.unknown()).optional(),\n});\nexport type ConfigSource = z.infer<typeof ConfigSourceSchema>;\n\n// =============================================================================\n// Config Definition\n// =============================================================================\n\nexport const ConfigValidationSchema = z.object({\n  required: z.boolean().default(false),\n  min: z.number().optional(),\n  max: z.number().optional(),\n  minLength: z.number().optional(),\n  maxLength: z.number().optional(),\n  pattern: z.string().optional(),\n  enum: z.array(z.unknown()).optional(),\n  custom: z.string().optional().describe(\"Custom validation function name\"),\n});\nexport type ConfigValidation = z.infer<typeof ConfigValidationSchema>;\n\nexport const ConfigDefinitionSchema = z.object({\n  key: z.string(),\n  name: z.string(),\n  description: z.string().optional(),\n  type: ConfigValueTypeSchema,\n  defaultValue: z.unknown().optional(),\n  validation: ConfigValidationSchema.optional(),\n\n  // Environment overrides\n  environmentOverrides: z.record(z.unknown()).optional().describe(\"Override values per environment\"),\n\n  // Metadata\n  category: z.string().default(\"general\"),\n  tags: z.array(z.string()).default([]),\n  sensitive: z.boolean().default(false),\n  deprecated: z.boolean().default(false),\n  deprecationMessage: z.string().optional(),\n\n  // Documentation\n  examples: z.array(z.unknown()).optional(),\n  links: z.array(z.string()).optional(),\n});\nexport type ConfigDefinition = z.infer<typeof ConfigDefinitionSchema>;\n\n// =============================================================================\n// Config Entry (Runtime Value)\n// =============================================================================\n\nexport const ConfigEntrySchema = z.object({\n  key: z.string(),\n  value: z.unknown(),\n  type: ConfigValueTypeSchema,\n  source: ConfigSourceTypeSchema,\n  environment: z.string(),\n  version: z.number().default(1),\n  updatedAt: z.number(),\n  updatedBy: z.string().optional(),\n  encrypted: z.boolean().default(false),\n  metadata: z.record(z.unknown()).optional(),\n});\nexport type ConfigEntry = z.infer<typeof ConfigEntrySchema>;\n\n// =============================================================================\n// Config Change\n// =============================================================================\n\nexport const ConfigChangeTypeSchema = z.enum([\n  \"created\",\n  \"updated\",\n  \"deleted\",\n  \"rolled_back\",\n]);\nexport type ConfigChangeType = z.infer<typeof ConfigChangeTypeSchema>;\n\nexport const ConfigChangeSchema = z.object({\n  id: z.string(),\n  timestamp: z.number(),\n  key: z.string(),\n  type: ConfigChangeTypeSchema,\n  previousValue: z.unknown().optional(),\n  newValue: z.unknown().optional(),\n  source: ConfigSourceTypeSchema,\n  environment: z.string(),\n  changedBy: z.string().optional(),\n  reason: z.string().optional(),\n});\nexport type ConfigChange = z.infer<typeof ConfigChangeSchema>;\n\n// =============================================================================\n// Config Snapshot (for rollback)\n// =============================================================================\n\nexport const ConfigSnapshotSchema = z.object({\n  id: z.string(),\n  name: z.string().optional(),\n  description: z.string().optional(),\n  timestamp: z.number(),\n  environment: z.string(),\n  entries: z.array(ConfigEntrySchema),\n  createdBy: z.string().optional(),\n});\nexport type ConfigSnapshot = z.infer<typeof ConfigSnapshotSchema>;\n\n// =============================================================================\n// Environment\n// =============================================================================\n\nexport const EnvironmentSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  displayName: z.string().optional(),\n  description: z.string().optional(),\n  isProduction: z.boolean().default(false),\n  parentId: z.string().optional().describe(\"Inherit from parent environment\"),\n  locked: z.boolean().default(false),\n  metadata: z.record(z.unknown()).optional(),\n});\nexport type Environment = z.infer<typeof EnvironmentSchema>;\n\n// =============================================================================\n// Config Namespace\n// =============================================================================\n\nexport const ConfigNamespaceSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  description: z.string().optional(),\n  prefix: z.string().describe(\"Key prefix for namespaced configs\"),\n  owner: z.string().optional(),\n  locked: z.boolean().default(false),\n});\nexport type ConfigNamespace = z.infer<typeof ConfigNamespaceSchema>;\n\n// =============================================================================\n// Watch & Hot Reload\n// =============================================================================\n\nexport const WatchCallbackSchema = z.function()\n  .args(z.string(), z.unknown(), z.unknown().optional())\n  .returns(z.void());\nexport type WatchCallback = (key: string, newValue: unknown, oldValue?: unknown) => void;\n\nexport const WatchOptionsSchema = z.object({\n  keys: z.array(z.string()).optional().describe(\"Specific keys to watch\"),\n  prefix: z.string().optional().describe(\"Watch keys with prefix\"),\n  namespace: z.string().optional(),\n  debounceMs: z.number().default(100),\n});\nexport type WatchOptions = z.infer<typeof WatchOptionsSchema>;\n\n// =============================================================================\n// Validation Result\n// =============================================================================\n\nexport const ConfigValidationResultSchema = z.object({\n  valid: z.boolean(),\n  errors: z.array(z.object({\n    key: z.string(),\n    message: z.string(),\n    value: z.unknown().optional(),\n  })),\n  warnings: z.array(z.object({\n    key: z.string(),\n    message: z.string(),\n  })),\n});\nexport type ConfigValidationResult = z.infer<typeof ConfigValidationResultSchema>;\n\n// =============================================================================\n// Configuration\n// =============================================================================\n\nexport const ConfigManagerConfigSchema = z.object({\n  // Environment\n  environment: z.string().default(\"development\"),\n  environments: z.array(EnvironmentSchema).default([]),\n\n  // Sources\n  sources: z.array(ConfigSourceSchema).default([]),\n\n  // Hot reload\n  hotReload: z.object({\n    enabled: z.boolean().default(false),\n    intervalSeconds: z.number().default(30),\n    watchFiles: z.array(z.string()).default([]),\n  }).optional(),\n\n  // Validation\n  validation: z.object({\n    strict: z.boolean().default(false),\n    failOnWarning: z.boolean().default(false),\n  }).optional(),\n\n  // Encryption\n  encryption: z.object({\n    enabled: z.boolean().default(false),\n    keyId: z.string().optional(),\n    algorithm: z.enum([\"aes-256-gcm\", \"aes-256-cbc\"]).default(\"aes-256-gcm\"),\n  }).optional(),\n\n  // Caching\n  cache: z.object({\n    enabled: z.boolean().default(true),\n    ttlSeconds: z.number().default(60),\n  }).optional(),\n\n  // History\n  history: z.object({\n    enabled: z.boolean().default(true),\n    maxEntries: z.number().default(100),\n    retentionDays: z.number().default(30),\n  }).optional(),\n\n  // Defaults\n  defaults: z.record(z.unknown()).default({}),\n});\nexport type ConfigManagerConfig = z.infer<typeof ConfigManagerConfigSchema>;\n\n// =============================================================================\n// Events\n// =============================================================================\n\nexport type ConfigEvents = {\n  // Config changes\n  changed: (key: string, newValue: unknown, oldValue: unknown | undefined) => void;\n  created: (key: string, value: unknown) => void;\n  updated: (key: string, newValue: unknown, oldValue: unknown) => void;\n  deleted: (key: string, oldValue: unknown) => void;\n\n  // Bulk operations\n  reloaded: (keys: string[]) => void;\n  rolledBack: (snapshotId: string, keys: string[]) => void;\n\n  // Sources\n  sourceLoaded: (source: ConfigSource, count: number) => void;\n  sourceError: (source: ConfigSource, error: Error) => void;\n\n  // Validation\n  validationFailed: (result: ConfigValidationResult) => void;\n\n  // Lifecycle\n  initialized: () => void;\n  shutDown: () => void;\n\n  // Errors\n  error: (error: Error) => void;\n};\n\n// =============================================================================\n// Storage Interface\n// =============================================================================\n\nexport interface ConfigStorage {\n  // Entries\n  get(key: string, environment: string): Promise<ConfigEntry | null>;\n  set(entry: ConfigEntry): Promise<void>;\n  delete(key: string, environment: string): Promise<void>;\n  list(filters?: { environment?: string; prefix?: string; namespace?: string }): Promise<ConfigEntry[]>;\n\n  // History\n  addChange(change: ConfigChange): Promise<void>;\n  getHistory(key: string, environment: string, limit?: number): Promise<ConfigChange[]>;\n\n  // Snapshots\n  saveSnapshot(snapshot: ConfigSnapshot): Promise<void>;\n  getSnapshot(id: string): Promise<ConfigSnapshot | null>;\n  listSnapshots(environment: string): Promise<ConfigSnapshot[]>;\n  deleteSnapshot(id: string): Promise<void>;\n\n  // Definitions\n  getDefinition(key: string): Promise<ConfigDefinition | null>;\n  saveDefinition(definition: ConfigDefinition): Promise<void>;\n  listDefinitions(): Promise<ConfigDefinition[]>;\n}\n\n// =============================================================================\n// Source Provider Interface\n// =============================================================================\n\nexport interface ConfigSourceProvider {\n  readonly type: ConfigSourceType;\n  readonly name: string;\n  load(): Promise<Map<string, unknown>>;\n  watch?(callback: (changes: Map<string, unknown>) => void): () => void;\n  set?(key: string, value: unknown): Promise<void>;\n  delete?(key: string): Promise<void>;\n}\n\n// =============================================================================\n// Default Environments\n// =============================================================================\n\nexport const DEFAULT_ENVIRONMENTS: Environment[] = [\n  {\n    id: \"development\",\n    name: \"development\",\n    displayName: \"Development\",\n    description: \"Local development environment\",\n    isProduction: false,\n    locked: false,\n  },\n  {\n    id: \"staging\",\n    name: \"staging\",\n    displayName: \"Staging\",\n    description: \"Pre-production testing environment\",\n    isProduction: false,\n    parentId: \"development\",\n    locked: false,\n  },\n  {\n    id: \"production\",\n    name: \"production\",\n    displayName: \"Production\",\n    description: \"Live production environment\",\n    isProduction: true,\n    parentId: \"staging\",\n    locked: true,\n  },\n];\n\n// =============================================================================\n// Config Categories\n// =============================================================================\n\nexport const CONFIG_CATEGORIES = {\n  general: \"General\",\n  database: \"Database\",\n  cache: \"Cache\",\n  security: \"Security\",\n  api: \"API\",\n  features: \"Features\",\n  limits: \"Limits & Quotas\",\n  notifications: \"Notifications\",\n  integrations: \"Integrations\",\n  experimental: \"Experimental\",\n} as const;\n\nexport type ConfigCategory = keyof typeof CONFIG_CATEGORIES;\n","/**\n * Config Manager Implementation\n * Phase 15B: Dynamic Configuration Management\n */\n\nimport { EventEmitter } from \"eventemitter3\";\nimport { randomUUID } from \"crypto\";\nimport {\n  ConfigValueType,\n  ConfigSourceType,\n  ConfigSource,\n  ConfigDefinition,\n  ConfigEntry,\n  ConfigChange,\n  ConfigSnapshot,\n  Environment,\n  WatchCallback,\n  WatchOptions,\n  ConfigValidationResult,\n  ConfigManagerConfig,\n  ConfigManagerConfigSchema,\n  ConfigEvents,\n  ConfigStorage,\n  ConfigSourceProvider,\n  DEFAULT_ENVIRONMENTS,\n} from \"./types.js\";\n\n// =============================================================================\n// In-Memory Storage\n// =============================================================================\n\nclass InMemoryConfigStorage implements ConfigStorage {\n  private entries = new Map<string, ConfigEntry>();\n  private history = new Map<string, ConfigChange[]>();\n  private snapshots = new Map<string, ConfigSnapshot>();\n  private definitions = new Map<string, ConfigDefinition>();\n\n  private getKey(key: string, environment: string): string {\n    return `${environment}:${key}`;\n  }\n\n  async get(key: string, environment: string): Promise<ConfigEntry | null> {\n    return this.entries.get(this.getKey(key, environment)) ?? null;\n  }\n\n  async set(entry: ConfigEntry): Promise<void> {\n    this.entries.set(this.getKey(entry.key, entry.environment), entry);\n  }\n\n  async delete(key: string, environment: string): Promise<void> {\n    this.entries.delete(this.getKey(key, environment));\n  }\n\n  async list(filters?: {\n    environment?: string;\n    prefix?: string;\n    namespace?: string;\n  }): Promise<ConfigEntry[]> {\n    let results = Array.from(this.entries.values());\n\n    if (filters) {\n      if (filters.environment) {\n        results = results.filter(e => e.environment === filters.environment);\n      }\n      if (filters.prefix) {\n        results = results.filter(e => e.key.startsWith(filters.prefix!));\n      }\n      if (filters.namespace) {\n        results = results.filter(e => e.key.startsWith(`${filters.namespace}:`));\n      }\n    }\n\n    return results;\n  }\n\n  async addChange(change: ConfigChange): Promise<void> {\n    const key = `${change.environment}:${change.key}`;\n    const changes = this.history.get(key) ?? [];\n    changes.unshift(change);\n    // Keep only last 100 changes per key\n    if (changes.length > 100) {\n      changes.pop();\n    }\n    this.history.set(key, changes);\n  }\n\n  async getHistory(key: string, environment: string, limit = 50): Promise<ConfigChange[]> {\n    const changes = this.history.get(`${environment}:${key}`) ?? [];\n    return changes.slice(0, limit);\n  }\n\n  async saveSnapshot(snapshot: ConfigSnapshot): Promise<void> {\n    this.snapshots.set(snapshot.id, snapshot);\n  }\n\n  async getSnapshot(id: string): Promise<ConfigSnapshot | null> {\n    return this.snapshots.get(id) ?? null;\n  }\n\n  async listSnapshots(environment: string): Promise<ConfigSnapshot[]> {\n    return Array.from(this.snapshots.values())\n      .filter(s => s.environment === environment)\n      .sort((a, b) => b.timestamp - a.timestamp);\n  }\n\n  async deleteSnapshot(id: string): Promise<void> {\n    this.snapshots.delete(id);\n  }\n\n  async getDefinition(key: string): Promise<ConfigDefinition | null> {\n    return this.definitions.get(key) ?? null;\n  }\n\n  async saveDefinition(definition: ConfigDefinition): Promise<void> {\n    this.definitions.set(definition.key, definition);\n  }\n\n  async listDefinitions(): Promise<ConfigDefinition[]> {\n    return Array.from(this.definitions.values());\n  }\n}\n\n// =============================================================================\n// Environment Source Provider\n// =============================================================================\n\nclass EnvSourceProvider implements ConfigSourceProvider {\n  readonly type: ConfigSourceType = \"env\";\n  readonly name: string;\n  private prefix: string;\n\n  constructor(name: string, prefix = \"\") {\n    this.name = name;\n    this.prefix = prefix;\n  }\n\n  async load(): Promise<Map<string, unknown>> {\n    const result = new Map<string, unknown>();\n\n    for (const [key, value] of Object.entries(process.env)) {\n      if (value === undefined) continue;\n\n      if (this.prefix && !key.startsWith(this.prefix)) continue;\n\n      const configKey = this.prefix\n        ? key.slice(this.prefix.length).toLowerCase().replace(/_/g, \".\")\n        : key.toLowerCase().replace(/_/g, \".\");\n\n      // Try to parse JSON, otherwise keep as string\n      try {\n        result.set(configKey, JSON.parse(value));\n      } catch {\n        result.set(configKey, value);\n      }\n    }\n\n    return result;\n  }\n}\n\n// =============================================================================\n// Memory Source Provider\n// =============================================================================\n\nclass MemorySourceProvider implements ConfigSourceProvider {\n  readonly type: ConfigSourceType = \"memory\";\n  readonly name: string;\n  private values: Map<string, unknown>;\n  private watchers: Array<(changes: Map<string, unknown>) => void> = [];\n\n  constructor(name: string, values: Record<string, unknown> = {}) {\n    this.name = name;\n    this.values = new Map(Object.entries(values));\n  }\n\n  async load(): Promise<Map<string, unknown>> {\n    return new Map(this.values);\n  }\n\n  async set(key: string, value: unknown): Promise<void> {\n    this.values.set(key, value);\n    const changes = new Map([[key, value]]);\n    for (const watcher of this.watchers) {\n      watcher(changes);\n    }\n  }\n\n  async delete(key: string): Promise<void> {\n    this.values.delete(key);\n    const changes = new Map([[key, undefined]]);\n    for (const watcher of this.watchers) {\n      watcher(changes);\n    }\n  }\n\n  watch(callback: (changes: Map<string, unknown>) => void): () => void {\n    this.watchers.push(callback);\n    return () => {\n      const idx = this.watchers.indexOf(callback);\n      if (idx >= 0) this.watchers.splice(idx, 1);\n    };\n  }\n}\n\n// =============================================================================\n// Config Manager\n// =============================================================================\n\nexport class ConfigManager extends EventEmitter<ConfigEvents> {\n  private config: ConfigManagerConfig;\n  private storage: ConfigStorage;\n  private sources = new Map<string, ConfigSourceProvider>();\n  private cache = new Map<string, { value: unknown; fetchedAt: number }>();\n  private watchers = new Map<string, Set<WatchCallback>>();\n  private environments: Environment[];\n  private currentEnvironment: string;\n  private hotReloadInterval?: NodeJS.Timeout;\n  private running = false;\n\n  constructor(config: Partial<ConfigManagerConfig> = {}) {\n    super();\n    this.config = ConfigManagerConfigSchema.parse(config);\n    this.storage = new InMemoryConfigStorage();\n    this.environments = this.config.environments.length > 0\n      ? this.config.environments\n      : DEFAULT_ENVIRONMENTS;\n    this.currentEnvironment = this.config.environment;\n\n    // Register default sources\n    this.registerSource(new MemorySourceProvider(\"defaults\", this.config.defaults));\n    this.registerSource(new EnvSourceProvider(\"env\"));\n  }\n\n  // ---------------------------------------------------------------------------\n  // Configuration\n  // ---------------------------------------------------------------------------\n\n  setStorage(storage: ConfigStorage): void {\n    this.storage = storage;\n  }\n\n  registerSource(provider: ConfigSourceProvider): void {\n    this.sources.set(provider.name, provider);\n  }\n\n  setEnvironment(environment: string): void {\n    if (!this.environments.find(e => e.name === environment)) {\n      throw new Error(`Unknown environment: ${environment}`);\n    }\n    this.currentEnvironment = environment;\n    this.cache.clear();\n  }\n\n  getEnvironment(): string {\n    return this.currentEnvironment;\n  }\n\n  listEnvironments(): Environment[] {\n    return [...this.environments];\n  }\n\n  // ---------------------------------------------------------------------------\n  // Get Config Values\n  // ---------------------------------------------------------------------------\n\n  async get<T = unknown>(key: string, defaultValue?: T): Promise<T> {\n    // Check cache\n    if (this.config.cache?.enabled) {\n      const cached = this.cache.get(key);\n      if (cached && Date.now() - cached.fetchedAt < (this.config.cache.ttlSeconds ?? 60) * 1000) {\n        return cached.value as T;\n      }\n    }\n\n    // Check storage\n    const entry = await this.storage.get(key, this.currentEnvironment);\n    if (entry) {\n      this.updateCache(key, entry.value);\n      return entry.value as T;\n    }\n\n    // Check environment inheritance\n    const inheritedValue = await this.getInheritedValue<T>(key);\n    if (inheritedValue !== undefined) {\n      this.updateCache(key, inheritedValue);\n      return inheritedValue;\n    }\n\n    // Use default\n    if (defaultValue !== undefined) {\n      return defaultValue;\n    }\n\n    // Check definition for default\n    const definition = await this.storage.getDefinition(key);\n    if (definition?.defaultValue !== undefined) {\n      return definition.defaultValue as T;\n    }\n\n    return undefined as T;\n  }\n\n  async getString(key: string, defaultValue = \"\"): Promise<string> {\n    const value = await this.get(key, defaultValue);\n    return String(value);\n  }\n\n  async getNumber(key: string, defaultValue = 0): Promise<number> {\n    const value = await this.get(key, defaultValue);\n    return typeof value === \"number\" ? value : Number(value) || defaultValue;\n  }\n\n  async getBoolean(key: string, defaultValue = false): Promise<boolean> {\n    const value = await this.get(key, defaultValue);\n    if (typeof value === \"boolean\") return value;\n    if (typeof value === \"string\") return value.toLowerCase() === \"true\" || value === \"1\";\n    return Boolean(value);\n  }\n\n  async getJSON<T>(key: string, defaultValue: T): Promise<T> {\n    const value = await this.get(key, defaultValue);\n    if (typeof value === \"object\") return value as T;\n    if (typeof value === \"string\") {\n      try {\n        return JSON.parse(value) as T;\n      } catch {\n        return defaultValue;\n      }\n    }\n    return defaultValue;\n  }\n\n  async getArray<T>(key: string, defaultValue: T[] = []): Promise<T[]> {\n    const value = await this.get(key, defaultValue);\n    return Array.isArray(value) ? value : defaultValue;\n  }\n\n  private async getInheritedValue<T>(key: string): Promise<T | undefined> {\n    const currentEnv = this.environments.find(e => e.name === this.currentEnvironment);\n    if (!currentEnv?.parentId) return undefined;\n\n    let parentId: string | undefined = currentEnv.parentId;\n    while (parentId) {\n      const entry = await this.storage.get(key, parentId);\n      if (entry) {\n        return entry.value as T;\n      }\n\n      const parentEnv = this.environments.find(e => e.id === parentId);\n      parentId = parentEnv?.parentId;\n    }\n\n    return undefined;\n  }\n\n  private updateCache(key: string, value: unknown): void {\n    if (this.config.cache?.enabled) {\n      this.cache.set(key, { value, fetchedAt: Date.now() });\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Set Config Values\n  // ---------------------------------------------------------------------------\n\n  async set(key: string, value: unknown, options: { type?: ConfigValueType; changedBy?: string; reason?: string } = {}): Promise<void> {\n    const oldEntry = await this.storage.get(key, this.currentEnvironment);\n    const oldValue = oldEntry?.value;\n    const isNew = !oldEntry;\n\n    const entry: ConfigEntry = {\n      key,\n      value,\n      type: options.type ?? this.inferType(value),\n      source: \"memory\",\n      environment: this.currentEnvironment,\n      version: (oldEntry?.version ?? 0) + 1,\n      updatedAt: Date.now(),\n      updatedBy: options.changedBy,\n      encrypted: false,\n    };\n\n    // Validate\n    await this.validateEntry(entry);\n\n    // Save\n    await this.storage.set(entry);\n    this.updateCache(key, value);\n\n    // Record change\n    if (this.config.history?.enabled) {\n      const change: ConfigChange = {\n        id: randomUUID(),\n        timestamp: Date.now(),\n        key,\n        type: isNew ? \"created\" : \"updated\",\n        previousValue: oldValue,\n        newValue: value,\n        source: \"memory\",\n        environment: this.currentEnvironment,\n        changedBy: options.changedBy,\n        reason: options.reason,\n      };\n      await this.storage.addChange(change);\n    }\n\n    // Notify\n    this.notifyWatchers(key, value, oldValue);\n\n    if (isNew) {\n      this.emit(\"created\", key, value);\n    } else {\n      this.emit(\"updated\", key, value, oldValue);\n    }\n    this.emit(\"changed\", key, value, oldValue);\n  }\n\n  async delete(key: string, options: { changedBy?: string; reason?: string } = {}): Promise<boolean> {\n    const entry = await this.storage.get(key, this.currentEnvironment);\n    if (!entry) return false;\n\n    await this.storage.delete(key, this.currentEnvironment);\n    this.cache.delete(key);\n\n    // Record change\n    if (this.config.history?.enabled) {\n      const change: ConfigChange = {\n        id: randomUUID(),\n        timestamp: Date.now(),\n        key,\n        type: \"deleted\",\n        previousValue: entry.value,\n        source: \"memory\",\n        environment: this.currentEnvironment,\n        changedBy: options.changedBy,\n        reason: options.reason,\n      };\n      await this.storage.addChange(change);\n    }\n\n    this.notifyWatchers(key, undefined, entry.value);\n    this.emit(\"deleted\", key, entry.value);\n\n    return true;\n  }\n\n  private inferType(value: unknown): ConfigValueType {\n    if (typeof value === \"boolean\") return \"boolean\";\n    if (typeof value === \"number\") return \"number\";\n    if (typeof value === \"string\") return \"string\";\n    if (Array.isArray(value)) return \"array\";\n    if (typeof value === \"object\") return \"json\";\n    return \"string\";\n  }\n\n  // ---------------------------------------------------------------------------\n  // Bulk Operations\n  // ---------------------------------------------------------------------------\n\n  async setMany(values: Record<string, unknown>, options: { changedBy?: string } = {}): Promise<void> {\n    for (const [key, value] of Object.entries(values)) {\n      await this.set(key, value, options);\n    }\n  }\n\n  async getMany(keys: string[]): Promise<Map<string, unknown>> {\n    const result = new Map<string, unknown>();\n    await Promise.all(keys.map(async key => {\n      result.set(key, await this.get(key));\n    }));\n    return result;\n  }\n\n  async list(filters?: { prefix?: string; namespace?: string }): Promise<ConfigEntry[]> {\n    return this.storage.list({ environment: this.currentEnvironment, ...filters });\n  }\n\n  // ---------------------------------------------------------------------------\n  // Watching\n  // ---------------------------------------------------------------------------\n\n  watch(callback: WatchCallback, options: WatchOptions = {}): () => void {\n    const watchKey = options.keys?.join(\",\") ?? options.prefix ?? options.namespace ?? \"*\";\n\n    let watchers = this.watchers.get(watchKey);\n    if (!watchers) {\n      watchers = new Set();\n      this.watchers.set(watchKey, watchers);\n    }\n    watchers.add(callback);\n\n    return () => {\n      watchers?.delete(callback);\n    };\n  }\n\n  private notifyWatchers(key: string, newValue: unknown, oldValue: unknown | undefined): void {\n    // Global watchers\n    const globalWatchers = this.watchers.get(\"*\");\n    if (globalWatchers) {\n      for (const callback of globalWatchers) {\n        try {\n          callback(key, newValue, oldValue);\n        } catch (error) {\n          this.emit(\"error\", error instanceof Error ? error : new Error(String(error)));\n        }\n      }\n    }\n\n    // Prefix watchers\n    for (const [watchKey, watchers] of this.watchers) {\n      if (watchKey === \"*\") continue;\n      if (key.startsWith(watchKey) || watchKey.includes(key)) {\n        for (const callback of watchers) {\n          try {\n            callback(key, newValue, oldValue);\n          } catch (error) {\n            this.emit(\"error\", error instanceof Error ? error : new Error(String(error)));\n          }\n        }\n      }\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Validation\n  // ---------------------------------------------------------------------------\n\n  private async validateEntry(entry: ConfigEntry): Promise<void> {\n    const definition = await this.storage.getDefinition(entry.key);\n    if (!definition) return;\n\n    const result = await this.validateValue(entry.key, entry.value, definition);\n    if (!result.valid) {\n      const errorMessages = result.errors.map(e => e.message).join(\", \");\n      throw new Error(`Validation failed for ${entry.key}: ${errorMessages}`);\n    }\n  }\n\n  private async validateValue(\n    key: string,\n    value: unknown,\n    definition: ConfigDefinition\n  ): Promise<ConfigValidationResult> {\n    const errors: Array<{ key: string; message: string; value?: unknown }> = [];\n    const warnings: Array<{ key: string; message: string }> = [];\n\n    if (definition.deprecated) {\n      warnings.push({\n        key,\n        message: definition.deprecationMessage ?? `Config ${key} is deprecated`,\n      });\n    }\n\n    const validation = definition.validation;\n    if (!validation) {\n      return { valid: true, errors, warnings };\n    }\n\n    // Required check\n    if (validation.required && (value === undefined || value === null || value === \"\")) {\n      errors.push({ key, message: `${key} is required`, value });\n    }\n\n    // Type-specific validation\n    if (value !== undefined && value !== null) {\n      if (typeof value === \"number\") {\n        if (validation.min !== undefined && value < validation.min) {\n          errors.push({ key, message: `${key} must be >= ${validation.min}`, value });\n        }\n        if (validation.max !== undefined && value > validation.max) {\n          errors.push({ key, message: `${key} must be <= ${validation.max}`, value });\n        }\n      }\n\n      if (typeof value === \"string\") {\n        if (validation.minLength !== undefined && value.length < validation.minLength) {\n          errors.push({ key, message: `${key} must be at least ${validation.minLength} characters`, value });\n        }\n        if (validation.maxLength !== undefined && value.length > validation.maxLength) {\n          errors.push({ key, message: `${key} must be at most ${validation.maxLength} characters`, value });\n        }\n        if (validation.pattern && !new RegExp(validation.pattern).test(value)) {\n          errors.push({ key, message: `${key} must match pattern ${validation.pattern}`, value });\n        }\n      }\n\n      if (validation.enum && !validation.enum.includes(value)) {\n        errors.push({ key, message: `${key} must be one of: ${validation.enum.join(\", \")}`, value });\n      }\n    }\n\n    return { valid: errors.length === 0, errors, warnings };\n  }\n\n  async validate(): Promise<ConfigValidationResult> {\n    const definitions = await this.storage.listDefinitions();\n    const allErrors: Array<{ key: string; message: string; value?: unknown }> = [];\n    const allWarnings: Array<{ key: string; message: string }> = [];\n\n    for (const def of definitions) {\n      const value = await this.get(def.key);\n      const result = await this.validateValue(def.key, value, def);\n      allErrors.push(...result.errors);\n      allWarnings.push(...result.warnings);\n    }\n\n    const result = {\n      valid: allErrors.length === 0,\n      errors: allErrors,\n      warnings: allWarnings,\n    };\n\n    if (!result.valid) {\n      this.emit(\"validationFailed\", result);\n    }\n\n    return result;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Definitions\n  // ---------------------------------------------------------------------------\n\n  async defineConfig(definition: ConfigDefinition): Promise<void> {\n    await this.storage.saveDefinition(definition);\n  }\n\n  async getDefinition(key: string): Promise<ConfigDefinition | null> {\n    return this.storage.getDefinition(key);\n  }\n\n  async listDefinitions(): Promise<ConfigDefinition[]> {\n    return this.storage.listDefinitions();\n  }\n\n  // ---------------------------------------------------------------------------\n  // History\n  // ---------------------------------------------------------------------------\n\n  async getHistory(key: string, limit?: number): Promise<ConfigChange[]> {\n    return this.storage.getHistory(key, this.currentEnvironment, limit);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Snapshots\n  // ---------------------------------------------------------------------------\n\n  async createSnapshot(name?: string, description?: string): Promise<ConfigSnapshot> {\n    const entries = await this.storage.list({ environment: this.currentEnvironment });\n\n    const snapshot: ConfigSnapshot = {\n      id: randomUUID(),\n      name,\n      description,\n      timestamp: Date.now(),\n      environment: this.currentEnvironment,\n      entries,\n    };\n\n    await this.storage.saveSnapshot(snapshot);\n    return snapshot;\n  }\n\n  async listSnapshots(): Promise<ConfigSnapshot[]> {\n    return this.storage.listSnapshots(this.currentEnvironment);\n  }\n\n  async rollback(snapshotId: string): Promise<string[]> {\n    const snapshot = await this.storage.getSnapshot(snapshotId);\n    if (!snapshot) {\n      throw new Error(`Snapshot not found: ${snapshotId}`);\n    }\n\n    const rolledBackKeys: string[] = [];\n\n    for (const entry of snapshot.entries) {\n      await this.set(entry.key, entry.value, { reason: `Rollback to snapshot ${snapshotId}` });\n      rolledBackKeys.push(entry.key);\n    }\n\n    this.emit(\"rolledBack\", snapshotId, rolledBackKeys);\n    return rolledBackKeys;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Source Loading\n  // ---------------------------------------------------------------------------\n\n  async loadFromSources(): Promise<void> {\n    const sortedSources = [...this.config.sources]\n      .filter(s => s.enabled)\n      .sort((a, b) => a.priority - b.priority);\n\n    for (const sourceConfig of sortedSources) {\n      const provider = this.sources.get(sourceConfig.name);\n      if (!provider) continue;\n\n      try {\n        const values = await provider.load();\n        let count = 0;\n\n        for (const [key, value] of values) {\n          await this.storage.set({\n            key,\n            value,\n            type: this.inferType(value),\n            source: provider.type,\n            environment: this.currentEnvironment,\n            version: 1,\n            updatedAt: Date.now(),\n            encrypted: false,\n          });\n          this.updateCache(key, value);\n          count++;\n        }\n\n        this.emit(\"sourceLoaded\", sourceConfig, count);\n      } catch (error) {\n        this.emit(\"sourceError\", sourceConfig, error instanceof Error ? error : new Error(String(error)));\n      }\n    }\n\n    this.emit(\"reloaded\", Array.from(this.cache.keys()));\n  }\n\n  // ---------------------------------------------------------------------------\n  // Lifecycle\n  // ---------------------------------------------------------------------------\n\n  async start(): Promise<void> {\n    if (this.running) return;\n    this.running = true;\n\n    // Load from sources\n    await this.loadFromSources();\n\n    // Start hot reload\n    if (this.config.hotReload?.enabled) {\n      this.hotReloadInterval = setInterval(() => {\n        this.loadFromSources().catch(err => this.emit(\"error\", err));\n      }, (this.config.hotReload.intervalSeconds ?? 30) * 1000);\n    }\n\n    this.emit(\"initialized\");\n  }\n\n  async stop(): Promise<void> {\n    this.running = false;\n\n    if (this.hotReloadInterval) {\n      clearInterval(this.hotReloadInterval);\n      this.hotReloadInterval = undefined;\n    }\n\n    this.emit(\"shutDown\");\n  }\n\n  isRunning(): boolean {\n    return this.running;\n  }\n}\n\n// =============================================================================\n// Factory Functions\n// =============================================================================\n\nlet defaultManager: ConfigManager | null = null;\n\nexport function getConfigManager(): ConfigManager {\n  if (!defaultManager) {\n    defaultManager = new ConfigManager();\n  }\n  return defaultManager;\n}\n\nexport function createConfigManager(config?: Partial<ConfigManagerConfig>): ConfigManager {\n  return new ConfigManager(config);\n}\n","/**\n * Multi-Region Types\n * Phase 15C: Multi-Region Support\n */\n\nimport { z } from \"zod\";\n\n// =============================================================================\n// Region Types\n// =============================================================================\n\nexport const RegionIdSchema = z.string().regex(/^[a-z]{2,3}-[a-z]+-\\d+$/, \"Region ID format: us-east-1\");\nexport type RegionId = z.infer<typeof RegionIdSchema>;\n\nexport const RegionStatusSchema = z.enum([\n  \"active\", // Region is healthy and serving traffic\n  \"degraded\", // Region has issues but still serving\n  \"draining\", // Region is being drained for maintenance\n  \"inactive\", // Region is offline\n  \"provisioning\", // Region is being set up\n]);\nexport type RegionStatus = z.infer<typeof RegionStatusSchema>;\n\nexport const RegionRoleSchema = z.enum([\n  \"primary\", // Primary region for writes\n  \"secondary\", // Secondary region for reads\n  \"standby\", // Hot standby for failover\n  \"disaster_recovery\", // DR site\n]);\nexport type RegionRole = z.infer<typeof RegionRoleSchema>;\n\nexport const RegionDefinitionSchema = z.object({\n  id: RegionIdSchema,\n  name: z.string(),\n  displayName: z.string().optional(),\n  provider: z.enum([\"aws\", \"gcp\", \"azure\", \"custom\"]),\n  role: RegionRoleSchema.default(\"secondary\"),\n  status: RegionStatusSchema.default(\"active\"),\n\n  // Location\n  location: z.object({\n    country: z.string(),\n    city: z.string().optional(),\n    latitude: z.number().optional(),\n    longitude: z.number().optional(),\n  }),\n\n  // Capacity\n  capacity: z.object({\n    maxConnections: z.number().default(10000),\n    maxRPS: z.number().default(10000),\n    currentLoad: z.number().default(0),\n  }).optional(),\n\n  // Endpoints\n  endpoints: z.object({\n    api: z.string().optional(),\n    internal: z.string().optional(),\n    database: z.string().optional(),\n    cache: z.string().optional(),\n  }).optional(),\n\n  // Metadata\n  tags: z.array(z.string()).default([]),\n  metadata: z.record(z.unknown()).optional(),\n  createdAt: z.number(),\n  updatedAt: z.number(),\n});\nexport type RegionDefinition = z.infer<typeof RegionDefinitionSchema>;\n\n// =============================================================================\n// Replication Types\n// =============================================================================\n\nexport const ReplicationModeSchema = z.enum([\n  \"sync\", // Synchronous replication (strong consistency)\n  \"async\", // Asynchronous replication (eventual consistency)\n  \"semi_sync\", // Semi-synchronous (ack from at least one replica)\n]);\nexport type ReplicationMode = z.infer<typeof ReplicationModeSchema>;\n\nexport const ConflictResolutionSchema = z.enum([\n  \"last_write_wins\", // LWW based on timestamp\n  \"first_write_wins\", // FWW\n  \"merge\", // Automatic merge\n  \"custom\", // Custom resolver\n  \"manual\", // Queue for manual resolution\n]);\nexport type ConflictResolution = z.infer<typeof ConflictResolutionSchema>;\n\nexport const ReplicationConfigSchema = z.object({\n  mode: ReplicationModeSchema.default(\"async\"),\n  conflictResolution: ConflictResolutionSchema.default(\"last_write_wins\"),\n\n  // Targets\n  sourceRegion: RegionIdSchema,\n  targetRegions: z.array(RegionIdSchema),\n\n  // Filters\n  includeCollections: z.array(z.string()).optional(),\n  excludeCollections: z.array(z.string()).optional(),\n  filter: z.string().optional().describe(\"Custom filter expression\"),\n\n  // Timing\n  batchSize: z.number().default(100),\n  batchIntervalMs: z.number().default(100),\n  maxLagMs: z.number().default(5000).describe(\"Max acceptable replication lag\"),\n\n  // Retry\n  retryAttempts: z.number().default(3),\n  retryBackoffMs: z.number().default(1000),\n});\nexport type ReplicationConfig = z.infer<typeof ReplicationConfigSchema>;\n\nexport const ReplicationStatusSchema = z.object({\n  sourceRegion: RegionIdSchema,\n  targetRegion: RegionIdSchema,\n  status: z.enum([\"active\", \"paused\", \"error\", \"catching_up\"]),\n  lagMs: z.number(),\n  lastSyncedAt: z.number().optional(),\n  pendingOperations: z.number(),\n  bytesReplicated: z.number(),\n  errors: z.array(z.object({\n    timestamp: z.number(),\n    message: z.string(),\n    retryCount: z.number(),\n  })).default([]),\n});\nexport type ReplicationStatus = z.infer<typeof ReplicationStatusSchema>;\n\n// =============================================================================\n// Conflict Types\n// =============================================================================\n\nexport const ConflictSchema = z.object({\n  id: z.string(),\n  timestamp: z.number(),\n  collection: z.string(),\n  documentId: z.string(),\n  sourceRegion: RegionIdSchema,\n  targetRegion: RegionIdSchema,\n  sourceVersion: z.unknown(),\n  targetVersion: z.unknown(),\n  resolution: ConflictResolutionSchema.optional(),\n  resolvedAt: z.number().optional(),\n  resolvedBy: z.string().optional(),\n  resolvedValue: z.unknown().optional(),\n});\nexport type Conflict = z.infer<typeof ConflictSchema>;\n\n// =============================================================================\n// Routing Types\n// =============================================================================\n\nexport const RoutingStrategySchema = z.enum([\n  \"latency\", // Route to lowest latency region\n  \"geo\", // Route based on geography\n  \"round_robin\", // Round robin across regions\n  \"weighted\", // Weighted distribution\n  \"failover\", // Primary with failover\n  \"custom\", // Custom routing logic\n]);\nexport type RoutingStrategy = z.infer<typeof RoutingStrategySchema>;\n\nexport const RoutingRuleSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  priority: z.number().default(0),\n  enabled: z.boolean().default(true),\n\n  // Conditions\n  conditions: z.array(z.object({\n    type: z.enum([\"geo\", \"header\", \"path\", \"query\", \"custom\"]),\n    field: z.string(),\n    operator: z.enum([\"eq\", \"neq\", \"contains\", \"starts_with\", \"in\"]),\n    value: z.unknown(),\n  })).default([]),\n\n  // Action\n  action: z.object({\n    type: z.enum([\"route\", \"redirect\", \"reject\"]),\n    regions: z.array(RegionIdSchema).optional(),\n    weights: z.record(z.number()).optional(),\n  }),\n});\nexport type RoutingRule = z.infer<typeof RoutingRuleSchema>;\n\nexport const RoutingDecisionSchema = z.object({\n  requestId: z.string(),\n  timestamp: z.number(),\n  sourceRegion: RegionIdSchema.optional(),\n  targetRegion: RegionIdSchema,\n  strategy: RoutingStrategySchema,\n  ruleId: z.string().optional(),\n  latencyMs: z.number().optional(),\n  metadata: z.record(z.unknown()).optional(),\n});\nexport type RoutingDecision = z.infer<typeof RoutingDecisionSchema>;\n\n// =============================================================================\n// Sync Types\n// =============================================================================\n\nexport const SyncOperationSchema = z.object({\n  id: z.string(),\n  type: z.enum([\"create\", \"update\", \"delete\"]),\n  collection: z.string(),\n  documentId: z.string(),\n  data: z.unknown().optional(),\n  timestamp: z.number(),\n  sourceRegion: RegionIdSchema,\n  vectorClock: z.record(z.number()).optional(),\n});\nexport type SyncOperation = z.infer<typeof SyncOperationSchema>;\n\nexport const SyncBatchSchema = z.object({\n  id: z.string(),\n  sourceRegion: RegionIdSchema,\n  targetRegion: RegionIdSchema,\n  operations: z.array(SyncOperationSchema),\n  createdAt: z.number(),\n  sentAt: z.number().optional(),\n  ackedAt: z.number().optional(),\n  status: z.enum([\"pending\", \"sent\", \"acked\", \"failed\"]),\n});\nexport type SyncBatch = z.infer<typeof SyncBatchSchema>;\n\n// =============================================================================\n// Health Types\n// =============================================================================\n\nexport const RegionHealthSchema = z.object({\n  regionId: RegionIdSchema,\n  timestamp: z.number(),\n  status: RegionStatusSchema,\n  latencyMs: z.number(),\n  errorRate: z.number(),\n  availability: z.number(),\n  cpuUsage: z.number().optional(),\n  memoryUsage: z.number().optional(),\n  activeConnections: z.number().optional(),\n  replicationLagMs: z.number().optional(),\n});\nexport type RegionHealth = z.infer<typeof RegionHealthSchema>;\n\n// =============================================================================\n// Failover Types\n// =============================================================================\n\nexport const FailoverTriggerSchema = z.enum([\n  \"manual\", // Manual failover\n  \"health_check\", // Automated based on health\n  \"latency\", // Latency threshold exceeded\n  \"error_rate\", // Error rate threshold exceeded\n  \"scheduled\", // Scheduled maintenance\n]);\nexport type FailoverTrigger = z.infer<typeof FailoverTriggerSchema>;\n\nexport const FailoverEventSchema = z.object({\n  id: z.string(),\n  timestamp: z.number(),\n  trigger: FailoverTriggerSchema,\n  fromRegion: RegionIdSchema,\n  toRegion: RegionIdSchema,\n  reason: z.string(),\n  duration: z.number().optional(),\n  status: z.enum([\"initiated\", \"in_progress\", \"completed\", \"failed\", \"rolled_back\"]),\n  initiatedBy: z.string().optional(),\n});\nexport type FailoverEvent = z.infer<typeof FailoverEventSchema>;\n\n// =============================================================================\n// Configuration\n// =============================================================================\n\nexport const MultiRegionConfigSchema = z.object({\n  // Current region\n  currentRegion: RegionIdSchema,\n\n  // Regions\n  regions: z.array(RegionDefinitionSchema).min(1),\n\n  // Replication\n  replication: ReplicationConfigSchema.optional(),\n\n  // Routing\n  routing: z.object({\n    strategy: RoutingStrategySchema.default(\"latency\"),\n    rules: z.array(RoutingRuleSchema).default([]),\n    weights: z.record(z.number()).optional(),\n  }).optional(),\n\n  // Failover\n  failover: z.object({\n    enabled: z.boolean().default(true),\n    healthCheckIntervalSeconds: z.number().default(10),\n    failoverThreshold: z.number().default(3).describe(\"Consecutive failures before failover\"),\n    autoFailback: z.boolean().default(false),\n    failbackDelaySeconds: z.number().default(300),\n  }).optional(),\n\n  // Sync\n  sync: z.object({\n    enabled: z.boolean().default(true),\n    batchSize: z.number().default(100),\n    flushIntervalMs: z.number().default(100),\n  }).optional(),\n\n  // Consistency\n  consistency: z.object({\n    readConsistency: z.enum([\"eventual\", \"session\", \"strong\"]).default(\"eventual\"),\n    writeConsistency: z.enum([\"local\", \"quorum\", \"all\"]).default(\"local\"),\n  }).optional(),\n});\nexport type MultiRegionConfig = z.infer<typeof MultiRegionConfigSchema>;\n\n// =============================================================================\n// Events\n// =============================================================================\n\nexport type MultiRegionEvents = {\n  // Region Events\n  regionAdded: (region: RegionDefinition) => void;\n  regionRemoved: (regionId: RegionId) => void;\n  regionStatusChanged: (regionId: RegionId, status: RegionStatus, previousStatus: RegionStatus) => void;\n  regionRoleChanged: (regionId: RegionId, role: RegionRole, previousRole: RegionRole) => void;\n\n  // Replication Events\n  replicationStarted: (sourceRegion: RegionId, targetRegion: RegionId) => void;\n  replicationStopped: (sourceRegion: RegionId, targetRegion: RegionId) => void;\n  replicationLagWarning: (targetRegion: RegionId, lagMs: number) => void;\n  replicationError: (targetRegion: RegionId, error: Error) => void;\n\n  // Sync Events\n  syncBatchSent: (batch: SyncBatch) => void;\n  syncBatchAcked: (batchId: string) => void;\n  syncBatchFailed: (batchId: string, error: Error) => void;\n\n  // Conflict Events\n  conflictDetected: (conflict: Conflict) => void;\n  conflictResolved: (conflict: Conflict) => void;\n\n  // Failover Events\n  failoverInitiated: (event: FailoverEvent) => void;\n  failoverCompleted: (event: FailoverEvent) => void;\n  failoverFailed: (event: FailoverEvent, error: Error) => void;\n  failbackInitiated: (event: FailoverEvent) => void;\n\n  // Routing Events\n  routingDecision: (decision: RoutingDecision) => void;\n\n  // Health Events\n  healthCheck: (health: RegionHealth) => void;\n  regionUnhealthy: (regionId: RegionId, health: RegionHealth) => void;\n  regionRecovered: (regionId: RegionId) => void;\n\n  // Errors\n  error: (error: Error) => void;\n};\n\n// =============================================================================\n// Storage Interface\n// =============================================================================\n\nexport interface MultiRegionStorage {\n  // Regions\n  getRegion(id: RegionId): Promise<RegionDefinition | null>;\n  saveRegion(region: RegionDefinition): Promise<void>;\n  deleteRegion(id: RegionId): Promise<void>;\n  listRegions(): Promise<RegionDefinition[]>;\n\n  // Replication Status\n  getReplicationStatus(sourceRegion: RegionId, targetRegion: RegionId): Promise<ReplicationStatus | null>;\n  saveReplicationStatus(status: ReplicationStatus): Promise<void>;\n\n  // Conflicts\n  saveConflict(conflict: Conflict): Promise<void>;\n  getConflict(id: string): Promise<Conflict | null>;\n  listConflicts(filters?: { resolved?: boolean }): Promise<Conflict[]>;\n\n  // Sync Operations\n  enqueueSyncOperation(operation: SyncOperation): Promise<void>;\n  dequeueSyncOperations(targetRegion: RegionId, limit: number): Promise<SyncOperation[]>;\n  ackSyncOperations(ids: string[]): Promise<void>;\n\n  // Failover History\n  saveFailoverEvent(event: FailoverEvent): Promise<void>;\n  getFailoverHistory(limit?: number): Promise<FailoverEvent[]>;\n\n  // Health\n  saveRegionHealth(health: RegionHealth): Promise<void>;\n  getRegionHealth(regionId: RegionId): Promise<RegionHealth | null>;\n}\n\n// =============================================================================\n// Constants\n// =============================================================================\n\nexport const DEFAULT_REGIONS = {\n  \"us-east-1\": { name: \"US East (N. Virginia)\", provider: \"aws\" as const, location: { country: \"US\", city: \"Virginia\" } },\n  \"us-west-2\": { name: \"US West (Oregon)\", provider: \"aws\" as const, location: { country: \"US\", city: \"Oregon\" } },\n  \"eu-west-1\": { name: \"EU (Ireland)\", provider: \"aws\" as const, location: { country: \"IE\", city: \"Dublin\" } },\n  \"eu-central-1\": { name: \"EU (Frankfurt)\", provider: \"aws\" as const, location: { country: \"DE\", city: \"Frankfurt\" } },\n  \"ap-southeast-1\": { name: \"Asia Pacific (Singapore)\", provider: \"aws\" as const, location: { country: \"SG\", city: \"Singapore\" } },\n  \"ap-northeast-1\": { name: \"Asia Pacific (Tokyo)\", provider: \"aws\" as const, location: { country: \"JP\", city: \"Tokyo\" } },\n} as const;\n\nexport const REPLICATION_LAG_THRESHOLDS = {\n  healthy: 100, // < 100ms\n  warning: 1000, // 100ms - 1s\n  critical: 5000, // > 5s\n} as const;\n","/**\n * Multi-Region Manager Implementation\n * Phase 15C: Multi-Region Support\n */\n\nimport { EventEmitter } from \"eventemitter3\";\nimport { randomUUID } from \"crypto\";\nimport {\n  RegionId,\n  RegionStatus,\n  RegionRole,\n  RegionDefinition,\n  RegionDefinitionSchema,\n  ReplicationConfig,\n  ReplicationStatus,\n  Conflict,\n  ConflictResolution,\n  RoutingStrategy,\n  RoutingRule,\n  RoutingDecision,\n  SyncOperation,\n  SyncBatch,\n  RegionHealth,\n  FailoverTrigger,\n  FailoverEvent,\n  MultiRegionConfig,\n  MultiRegionConfigSchema,\n  MultiRegionEvents,\n  MultiRegionStorage,\n  REPLICATION_LAG_THRESHOLDS,\n} from \"./types.js\";\n\n// =============================================================================\n// In-Memory Storage\n// =============================================================================\n\nclass InMemoryMultiRegionStorage implements MultiRegionStorage {\n  private regions = new Map<RegionId, RegionDefinition>();\n  private replicationStatus = new Map<string, ReplicationStatus>();\n  private conflicts = new Map<string, Conflict>();\n  private syncQueue = new Map<RegionId, SyncOperation[]>();\n  private failoverHistory: FailoverEvent[] = [];\n  private healthData = new Map<RegionId, RegionHealth>();\n\n  private getReplicationKey(source: RegionId, target: RegionId): string {\n    return `${source}:${target}`;\n  }\n\n  async getRegion(id: RegionId): Promise<RegionDefinition | null> {\n    return this.regions.get(id) ?? null;\n  }\n\n  async saveRegion(region: RegionDefinition): Promise<void> {\n    this.regions.set(region.id, region);\n  }\n\n  async deleteRegion(id: RegionId): Promise<void> {\n    this.regions.delete(id);\n  }\n\n  async listRegions(): Promise<RegionDefinition[]> {\n    return Array.from(this.regions.values());\n  }\n\n  async getReplicationStatus(sourceRegion: RegionId, targetRegion: RegionId): Promise<ReplicationStatus | null> {\n    return this.replicationStatus.get(this.getReplicationKey(sourceRegion, targetRegion)) ?? null;\n  }\n\n  async saveReplicationStatus(status: ReplicationStatus): Promise<void> {\n    this.replicationStatus.set(this.getReplicationKey(status.sourceRegion, status.targetRegion), status);\n  }\n\n  async saveConflict(conflict: Conflict): Promise<void> {\n    this.conflicts.set(conflict.id, conflict);\n  }\n\n  async getConflict(id: string): Promise<Conflict | null> {\n    return this.conflicts.get(id) ?? null;\n  }\n\n  async listConflicts(filters?: { resolved?: boolean }): Promise<Conflict[]> {\n    let results = Array.from(this.conflicts.values());\n    if (filters?.resolved !== undefined) {\n      results = results.filter(c => (c.resolvedAt !== undefined) === filters.resolved);\n    }\n    return results;\n  }\n\n  async enqueueSyncOperation(operation: SyncOperation): Promise<void> {\n    // Enqueue for all target regions except source\n    for (const region of this.regions.values()) {\n      if (region.id === operation.sourceRegion) continue;\n      const queue = this.syncQueue.get(region.id) ?? [];\n      queue.push(operation);\n      this.syncQueue.set(region.id, queue);\n    }\n  }\n\n  async dequeueSyncOperations(targetRegion: RegionId, limit: number): Promise<SyncOperation[]> {\n    const queue = this.syncQueue.get(targetRegion) ?? [];\n    const ops = queue.splice(0, limit);\n    this.syncQueue.set(targetRegion, queue);\n    return ops;\n  }\n\n  async ackSyncOperations(ids: string[]): Promise<void> {\n    // In memory, operations are removed on dequeue\n  }\n\n  async saveFailoverEvent(event: FailoverEvent): Promise<void> {\n    this.failoverHistory.unshift(event);\n    if (this.failoverHistory.length > 100) {\n      this.failoverHistory.pop();\n    }\n  }\n\n  async getFailoverHistory(limit = 50): Promise<FailoverEvent[]> {\n    return this.failoverHistory.slice(0, limit);\n  }\n\n  async saveRegionHealth(health: RegionHealth): Promise<void> {\n    this.healthData.set(health.regionId, health);\n  }\n\n  async getRegionHealth(regionId: RegionId): Promise<RegionHealth | null> {\n    return this.healthData.get(regionId) ?? null;\n  }\n}\n\n// =============================================================================\n// Multi-Region Manager\n// =============================================================================\n\nexport class MultiRegionManager extends EventEmitter<MultiRegionEvents> {\n  private config: MultiRegionConfig;\n  private storage: MultiRegionStorage;\n  private healthCheckInterval?: NodeJS.Timeout;\n  private syncInterval?: NodeJS.Timeout;\n  private failedHealthChecks = new Map<RegionId, number>();\n  private running = false;\n\n  constructor(config: Partial<MultiRegionConfig> & { currentRegion: RegionId; regions: RegionDefinition[] }) {\n    super();\n    this.config = MultiRegionConfigSchema.parse(config);\n    this.storage = new InMemoryMultiRegionStorage();\n\n    // Initialize regions\n    for (const region of this.config.regions) {\n      this.storage.saveRegion(region);\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Configuration\n  // ---------------------------------------------------------------------------\n\n  setStorage(storage: MultiRegionStorage): void {\n    this.storage = storage;\n  }\n\n  getCurrentRegion(): RegionId {\n    return this.config.currentRegion;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Region Management\n  // ---------------------------------------------------------------------------\n\n  async addRegion(region: Omit<RegionDefinition, \"createdAt\" | \"updatedAt\">): Promise<RegionDefinition> {\n    const now = Date.now();\n    const fullRegion = RegionDefinitionSchema.parse({\n      ...region,\n      createdAt: now,\n      updatedAt: now,\n    });\n\n    await this.storage.saveRegion(fullRegion);\n    this.emit(\"regionAdded\", fullRegion);\n    return fullRegion;\n  }\n\n  async getRegion(id: RegionId): Promise<RegionDefinition | null> {\n    return this.storage.getRegion(id);\n  }\n\n  async updateRegion(id: RegionId, updates: Partial<RegionDefinition>): Promise<RegionDefinition | null> {\n    const existing = await this.storage.getRegion(id);\n    if (!existing) return null;\n\n    const previousStatus = existing.status;\n    const previousRole = existing.role;\n\n    const updated = RegionDefinitionSchema.parse({\n      ...existing,\n      ...updates,\n      id: existing.id,\n      createdAt: existing.createdAt,\n      updatedAt: Date.now(),\n    });\n\n    await this.storage.saveRegion(updated);\n\n    if (updates.status && updates.status !== previousStatus) {\n      this.emit(\"regionStatusChanged\", id, updates.status, previousStatus);\n    }\n\n    if (updates.role && updates.role !== previousRole) {\n      this.emit(\"regionRoleChanged\", id, updates.role, previousRole);\n    }\n\n    return updated;\n  }\n\n  async removeRegion(id: RegionId): Promise<boolean> {\n    const existing = await this.storage.getRegion(id);\n    if (!existing) return false;\n\n    // Don't allow removing current region\n    if (id === this.config.currentRegion) {\n      throw new Error(\"Cannot remove current region\");\n    }\n\n    await this.storage.deleteRegion(id);\n    this.emit(\"regionRemoved\", id);\n    return true;\n  }\n\n  async listRegions(): Promise<RegionDefinition[]> {\n    return this.storage.listRegions();\n  }\n\n  async getActiveRegions(): Promise<RegionDefinition[]> {\n    const regions = await this.storage.listRegions();\n    return regions.filter(r => r.status === \"active\" || r.status === \"degraded\");\n  }\n\n  async getPrimaryRegion(): Promise<RegionDefinition | null> {\n    const regions = await this.storage.listRegions();\n    return regions.find(r => r.role === \"primary\") ?? null;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Routing\n  // ---------------------------------------------------------------------------\n\n  async routeRequest(context: {\n    path?: string;\n    headers?: Record<string, string>;\n    geo?: { country?: string; region?: string; city?: string };\n    clientLatencies?: Record<RegionId, number>;\n  }): Promise<RoutingDecision> {\n    const requestId = randomUUID();\n    const startTime = Date.now();\n\n    const strategy = this.config.routing?.strategy ?? \"latency\";\n    const rules = this.config.routing?.rules ?? [];\n    const activeRegions = await this.getActiveRegions();\n\n    if (activeRegions.length === 0) {\n      throw new Error(\"No active regions available\");\n    }\n\n    let targetRegion: RegionId | undefined;\n    let matchedRuleId: string | undefined;\n\n    // Check routing rules first\n    for (const rule of rules.filter(r => r.enabled).sort((a, b) => b.priority - a.priority)) {\n      if (this.matchesRoutingRule(rule, context)) {\n        if (rule.action.type === \"route\" && rule.action.regions?.length) {\n          targetRegion = rule.action.regions.find(r => activeRegions.some(ar => ar.id === r));\n          matchedRuleId = rule.id;\n          break;\n        }\n      }\n    }\n\n    // Fall back to strategy if no rule matched\n    if (!targetRegion) {\n      targetRegion = await this.selectRegionByStrategy(strategy, activeRegions, context);\n    }\n\n    const decision: RoutingDecision = {\n      requestId,\n      timestamp: startTime,\n      sourceRegion: context.geo?.region as RegionId | undefined,\n      targetRegion: targetRegion ?? activeRegions[0].id,\n      strategy,\n      ruleId: matchedRuleId,\n      latencyMs: Date.now() - startTime,\n    };\n\n    this.emit(\"routingDecision\", decision);\n    return decision;\n  }\n\n  private matchesRoutingRule(\n    rule: RoutingRule,\n    context: { path?: string; headers?: Record<string, string>; geo?: { country?: string; region?: string; city?: string } }\n  ): boolean {\n    if (rule.conditions.length === 0) return true;\n\n    return rule.conditions.every(cond => {\n      let value: unknown;\n\n      switch (cond.type) {\n        case \"geo\":\n          value = context.geo?.[cond.field as keyof typeof context.geo];\n          break;\n        case \"header\":\n          value = context.headers?.[cond.field];\n          break;\n        case \"path\":\n          value = context.path;\n          break;\n        default:\n          return false;\n      }\n\n      switch (cond.operator) {\n        case \"eq\":\n          return value === cond.value;\n        case \"neq\":\n          return value !== cond.value;\n        case \"contains\":\n          return typeof value === \"string\" && typeof cond.value === \"string\" && value.includes(cond.value);\n        case \"starts_with\":\n          return typeof value === \"string\" && typeof cond.value === \"string\" && value.startsWith(cond.value);\n        case \"in\":\n          return Array.isArray(cond.value) && cond.value.includes(value);\n        default:\n          return false;\n      }\n    });\n  }\n\n  private async selectRegionByStrategy(\n    strategy: RoutingStrategy,\n    regions: RegionDefinition[],\n    context: { clientLatencies?: Record<RegionId, number>; geo?: { country?: string; region?: string } }\n  ): Promise<RegionId> {\n    switch (strategy) {\n      case \"latency\":\n        if (context.clientLatencies) {\n          const sorted = regions.sort((a, b) => {\n            const latA = context.clientLatencies![a.id] ?? Infinity;\n            const latB = context.clientLatencies![b.id] ?? Infinity;\n            return latA - latB;\n          });\n          return sorted[0].id;\n        }\n        // Fall through to geo if no latencies\n\n      case \"geo\":\n        if (context.geo?.country) {\n          const sameCountry = regions.find(r => r.location.country === context.geo!.country);\n          if (sameCountry) return sameCountry.id;\n        }\n        // Fall through to failover\n\n      case \"failover\":\n        const primary = regions.find(r => r.role === \"primary\" && r.status === \"active\");\n        if (primary) return primary.id;\n        const secondary = regions.find(r => r.status === \"active\");\n        return secondary?.id ?? regions[0].id;\n\n      case \"round_robin\":\n        const idx = Math.floor(Math.random() * regions.length);\n        return regions[idx].id;\n\n      case \"weighted\":\n        const weights = this.config.routing?.weights ?? {};\n        const totalWeight = Object.values(weights).reduce((a, b) => a + b, 0);\n        if (totalWeight === 0) return regions[0].id;\n\n        let random = Math.random() * totalWeight;\n        for (const region of regions) {\n          random -= weights[region.id] ?? 0;\n          if (random <= 0) return region.id;\n        }\n        return regions[0].id;\n\n      default:\n        return regions[0].id;\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Replication\n  // ---------------------------------------------------------------------------\n\n  async enqueueReplication(operation: Omit<SyncOperation, \"id\" | \"timestamp\" | \"sourceRegion\">): Promise<void> {\n    const fullOp: SyncOperation = {\n      ...operation,\n      id: randomUUID(),\n      timestamp: Date.now(),\n      sourceRegion: this.config.currentRegion,\n    };\n\n    await this.storage.enqueueSyncOperation(fullOp);\n  }\n\n  async getReplicationStatus(targetRegion: RegionId): Promise<ReplicationStatus | null> {\n    return this.storage.getReplicationStatus(this.config.currentRegion, targetRegion);\n  }\n\n  async getAllReplicationStatus(): Promise<ReplicationStatus[]> {\n    const regions = await this.storage.listRegions();\n    const statuses: ReplicationStatus[] = [];\n\n    for (const region of regions) {\n      if (region.id === this.config.currentRegion) continue;\n      const status = await this.storage.getReplicationStatus(this.config.currentRegion, region.id);\n      if (status) {\n        statuses.push(status);\n      }\n    }\n\n    return statuses;\n  }\n\n  private async processSyncQueue(): Promise<void> {\n    const regions = await this.storage.listRegions();\n\n    for (const region of regions) {\n      if (region.id === this.config.currentRegion) continue;\n      if (region.status !== \"active\" && region.status !== \"degraded\") continue;\n\n      const batchSize = this.config.sync?.batchSize ?? 100;\n      const operations = await this.storage.dequeueSyncOperations(region.id, batchSize);\n\n      if (operations.length === 0) continue;\n\n      const batch: SyncBatch = {\n        id: randomUUID(),\n        sourceRegion: this.config.currentRegion,\n        targetRegion: region.id,\n        operations,\n        createdAt: Date.now(),\n        status: \"pending\",\n      };\n\n      // In real implementation, send to target region\n      // For now, just emit event\n      batch.status = \"sent\";\n      batch.sentAt = Date.now();\n      this.emit(\"syncBatchSent\", batch);\n\n      // Simulate ack\n      batch.status = \"acked\";\n      batch.ackedAt = Date.now();\n      this.emit(\"syncBatchAcked\", batch.id);\n\n      // Update replication status\n      const status: ReplicationStatus = {\n        sourceRegion: this.config.currentRegion,\n        targetRegion: region.id,\n        status: \"active\",\n        lagMs: Date.now() - operations[operations.length - 1].timestamp,\n        lastSyncedAt: Date.now(),\n        pendingOperations: 0,\n        bytesReplicated: JSON.stringify(operations).length,\n        errors: [],\n      };\n\n      await this.storage.saveReplicationStatus(status);\n\n      // Check lag thresholds\n      if (status.lagMs > REPLICATION_LAG_THRESHOLDS.critical) {\n        this.emit(\"replicationLagWarning\", region.id, status.lagMs);\n      }\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Conflict Resolution\n  // ---------------------------------------------------------------------------\n\n  async detectConflict(\n    collection: string,\n    documentId: string,\n    sourceVersion: unknown,\n    targetVersion: unknown,\n    targetRegion: RegionId\n  ): Promise<Conflict> {\n    const conflict: Conflict = {\n      id: randomUUID(),\n      timestamp: Date.now(),\n      collection,\n      documentId,\n      sourceRegion: this.config.currentRegion,\n      targetRegion,\n      sourceVersion,\n      targetVersion,\n    };\n\n    await this.storage.saveConflict(conflict);\n    this.emit(\"conflictDetected\", conflict);\n    return conflict;\n  }\n\n  async resolveConflict(\n    conflictId: string,\n    resolution: ConflictResolution,\n    resolvedValue: unknown,\n    resolvedBy?: string\n  ): Promise<Conflict | null> {\n    const conflict = await this.storage.getConflict(conflictId);\n    if (!conflict) return null;\n\n    const resolved: Conflict = {\n      ...conflict,\n      resolution,\n      resolvedAt: Date.now(),\n      resolvedBy,\n      resolvedValue,\n    };\n\n    await this.storage.saveConflict(resolved);\n    this.emit(\"conflictResolved\", resolved);\n    return resolved;\n  }\n\n  async listConflicts(resolved?: boolean): Promise<Conflict[]> {\n    return this.storage.listConflicts({ resolved });\n  }\n\n  // ---------------------------------------------------------------------------\n  // Failover\n  // ---------------------------------------------------------------------------\n\n  async initiateFailover(\n    fromRegion: RegionId,\n    toRegion: RegionId,\n    trigger: FailoverTrigger,\n    reason: string,\n    initiatedBy?: string\n  ): Promise<FailoverEvent> {\n    const event: FailoverEvent = {\n      id: randomUUID(),\n      timestamp: Date.now(),\n      trigger,\n      fromRegion,\n      toRegion,\n      reason,\n      status: \"initiated\",\n      initiatedBy,\n    };\n\n    await this.storage.saveFailoverEvent(event);\n    this.emit(\"failoverInitiated\", event);\n\n    try {\n      // Update region roles\n      await this.updateRegion(fromRegion, { role: \"standby\", status: \"draining\" });\n      await this.updateRegion(toRegion, { role: \"primary\", status: \"active\" });\n\n      event.status = \"completed\";\n      event.duration = Date.now() - event.timestamp;\n      await this.storage.saveFailoverEvent(event);\n      this.emit(\"failoverCompleted\", event);\n    } catch (error) {\n      event.status = \"failed\";\n      await this.storage.saveFailoverEvent(event);\n      this.emit(\"failoverFailed\", event, error instanceof Error ? error : new Error(String(error)));\n      throw error;\n    }\n\n    return event;\n  }\n\n  async getFailoverHistory(limit?: number): Promise<FailoverEvent[]> {\n    return this.storage.getFailoverHistory(limit);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Health Checks\n  // ---------------------------------------------------------------------------\n\n  async checkRegionHealth(regionId: RegionId): Promise<RegionHealth> {\n    const region = await this.storage.getRegion(regionId);\n    if (!region) {\n      throw new Error(`Region not found: ${regionId}`);\n    }\n\n    // In real implementation, ping the region endpoints\n    // For now, generate simulated health data\n    const health: RegionHealth = {\n      regionId,\n      timestamp: Date.now(),\n      status: region.status,\n      latencyMs: Math.random() * 100 + 10, // 10-110ms\n      errorRate: Math.random() * 0.01, // 0-1%\n      availability: 99.9 + Math.random() * 0.1, // 99.9-100%\n      cpuUsage: Math.random() * 50 + 20, // 20-70%\n      memoryUsage: Math.random() * 40 + 30, // 30-70%\n      activeConnections: Math.floor(Math.random() * 1000),\n    };\n\n    await this.storage.saveRegionHealth(health);\n    this.emit(\"healthCheck\", health);\n\n    return health;\n  }\n\n  async getRegionHealth(regionId: RegionId): Promise<RegionHealth | null> {\n    return this.storage.getRegionHealth(regionId);\n  }\n\n  private async runHealthChecks(): Promise<void> {\n    const regions = await this.storage.listRegions();\n\n    for (const region of regions) {\n      try {\n        const health = await this.checkRegionHealth(region.id);\n\n        // Check if region is unhealthy\n        const isUnhealthy = health.errorRate > 0.05 || health.availability < 99;\n\n        if (isUnhealthy) {\n          const failCount = (this.failedHealthChecks.get(region.id) ?? 0) + 1;\n          this.failedHealthChecks.set(region.id, failCount);\n\n          if (failCount >= (this.config.failover?.failoverThreshold ?? 3)) {\n            this.emit(\"regionUnhealthy\", region.id, health);\n\n            // Auto-failover if enabled\n            if (this.config.failover?.enabled && region.role === \"primary\") {\n              const standby = regions.find(r => r.role === \"standby\" && r.status === \"active\");\n              if (standby) {\n                await this.initiateFailover(\n                  region.id,\n                  standby.id,\n                  \"health_check\",\n                  `Region ${region.id} failed ${failCount} consecutive health checks`\n                );\n              }\n            }\n          }\n        } else {\n          const prevFailCount = this.failedHealthChecks.get(region.id) ?? 0;\n          if (prevFailCount > 0) {\n            this.failedHealthChecks.set(region.id, 0);\n            this.emit(\"regionRecovered\", region.id);\n          }\n        }\n      } catch (error) {\n        this.emit(\"error\", error instanceof Error ? error : new Error(String(error)));\n      }\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Lifecycle\n  // ---------------------------------------------------------------------------\n\n  async start(): Promise<void> {\n    if (this.running) return;\n    this.running = true;\n\n    // Start health checks\n    if (this.config.failover?.enabled) {\n      const interval = (this.config.failover.healthCheckIntervalSeconds ?? 10) * 1000;\n      this.healthCheckInterval = setInterval(() => {\n        this.runHealthChecks().catch(err => this.emit(\"error\", err));\n      }, interval);\n    }\n\n    // Start sync processing\n    if (this.config.sync?.enabled) {\n      const interval = this.config.sync.flushIntervalMs ?? 100;\n      this.syncInterval = setInterval(() => {\n        this.processSyncQueue().catch(err => this.emit(\"error\", err));\n      }, interval);\n    }\n  }\n\n  async stop(): Promise<void> {\n    this.running = false;\n\n    if (this.healthCheckInterval) {\n      clearInterval(this.healthCheckInterval);\n      this.healthCheckInterval = undefined;\n    }\n\n    if (this.syncInterval) {\n      clearInterval(this.syncInterval);\n      this.syncInterval = undefined;\n    }\n  }\n\n  isRunning(): boolean {\n    return this.running;\n  }\n}\n\n// =============================================================================\n// Factory Functions\n// =============================================================================\n\nlet defaultManager: MultiRegionManager | null = null;\n\nexport function getMultiRegionManager(): MultiRegionManager {\n  if (!defaultManager) {\n    throw new Error(\"MultiRegionManager not initialized. Call createMultiRegionManager first.\");\n  }\n  return defaultManager;\n}\n\nexport function createMultiRegionManager(\n  config: Partial<MultiRegionConfig> & { currentRegion: RegionId; regions: RegionDefinition[] }\n): MultiRegionManager {\n  defaultManager = new MultiRegionManager(config);\n  return defaultManager;\n}\n","/**\n * Deployment Manager Types\n * Phase 15D: Deployment Automation\n */\n\nimport { z } from \"zod\";\n\n// =============================================================================\n// Deployment Strategy Types\n// =============================================================================\n\nexport const DeploymentStrategySchema = z.enum([\n  \"rolling\", // Rolling update (replace instances gradually)\n  \"blue_green\", // Blue/green deployment (switch between two environments)\n  \"canary\", // Canary deployment (gradual traffic shift)\n  \"recreate\", // Recreate (stop old, start new)\n  \"shadow\", // Shadow deployment (duplicate traffic)\n  \"feature_flag\", // Feature flag controlled\n]);\nexport type DeploymentStrategy = z.infer<typeof DeploymentStrategySchema>;\n\nexport const DeploymentStatusSchema = z.enum([\n  \"pending\", // Waiting to start\n  \"running\", // In progress\n  \"paused\", // Manually paused\n  \"completed\", // Successfully finished\n  \"failed\", // Failed\n  \"rolled_back\", // Rolled back\n  \"cancelled\", // Cancelled by user\n]);\nexport type DeploymentStatus = z.infer<typeof DeploymentStatusSchema>;\n\n// =============================================================================\n// Version & Artifact\n// =============================================================================\n\nexport const SemanticVersionSchema = z.string().regex(\n  /^\\d+\\.\\d+\\.\\d+(-[a-zA-Z0-9]+(\\.[a-zA-Z0-9]+)*)?(\\+[a-zA-Z0-9]+(\\.[a-zA-Z0-9]+)*)?$/,\n  \"Must be valid semver\"\n);\nexport type SemanticVersion = z.infer<typeof SemanticVersionSchema>;\n\nexport const ArtifactTypeSchema = z.enum([\n  \"docker\", // Docker image\n  \"npm\", // NPM package\n  \"binary\", // Binary executable\n  \"archive\", // Archive (zip, tar)\n  \"serverless\", // Serverless function\n]);\nexport type ArtifactType = z.infer<typeof ArtifactTypeSchema>;\n\nexport const ArtifactSchema = z.object({\n  id: z.string(),\n  type: ArtifactTypeSchema,\n  name: z.string(),\n  version: SemanticVersionSchema,\n  digest: z.string().optional().describe(\"SHA256 digest\"),\n  size: z.number().optional().describe(\"Size in bytes\"),\n  registry: z.string().optional(),\n  url: z.string().optional(),\n  metadata: z.record(z.unknown()).optional(),\n  createdAt: z.number(),\n});\nexport type Artifact = z.infer<typeof ArtifactSchema>;\n\n// =============================================================================\n// Environment & Target\n// =============================================================================\n\nexport const DeploymentEnvironmentSchema = z.enum([\n  \"development\",\n  \"staging\",\n  \"production\",\n  \"canary\",\n  \"preview\",\n]);\nexport type DeploymentEnvironment = z.infer<typeof DeploymentEnvironmentSchema>;\n\nexport const DeploymentTargetSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  type: z.enum([\"kubernetes\", \"ecs\", \"lambda\", \"vm\", \"container\", \"static\"]),\n  environment: DeploymentEnvironmentSchema,\n  region: z.string().optional(),\n  cluster: z.string().optional(),\n  namespace: z.string().optional(),\n  replicas: z.number().optional(),\n  config: z.record(z.unknown()).optional(),\n});\nexport type DeploymentTarget = z.infer<typeof DeploymentTargetSchema>;\n\n// =============================================================================\n// Deployment Configuration\n// =============================================================================\n\nexport const RollingConfigSchema = z.object({\n  maxSurge: z.number().default(25).describe(\"Max % of instances above desired\"),\n  maxUnavailable: z.number().default(25).describe(\"Max % unavailable during update\"),\n  minReadySeconds: z.number().default(30),\n});\nexport type RollingConfig = z.infer<typeof RollingConfigSchema>;\n\nexport const BlueGreenConfigSchema = z.object({\n  blueTarget: z.string().describe(\"Blue environment target ID\"),\n  greenTarget: z.string().describe(\"Green environment target ID\"),\n  switchTrafficPercent: z.number().default(100).describe(\"Traffic % to switch\"),\n  warmupSeconds: z.number().default(60),\n});\nexport type BlueGreenConfig = z.infer<typeof BlueGreenConfigSchema>;\n\nexport const CanaryConfigSchema = z.object({\n  steps: z.array(z.object({\n    percent: z.number().min(0).max(100),\n    durationSeconds: z.number(),\n    pauseForAnalysis: z.boolean().default(false),\n  })),\n  analysisInterval: z.number().default(60).describe(\"Analysis interval in seconds\"),\n  successThreshold: z.number().default(95).describe(\"Success rate threshold %\"),\n  errorThreshold: z.number().default(5).describe(\"Error rate threshold %\"),\n  latencyThreshold: z.number().default(500).describe(\"P99 latency threshold in ms\"),\n});\nexport type CanaryConfig = z.infer<typeof CanaryConfigSchema>;\n\nexport const StrategyConfigSchema = z.object({\n  rolling: RollingConfigSchema.optional(),\n  blueGreen: BlueGreenConfigSchema.optional(),\n  canary: CanaryConfigSchema.optional(),\n});\nexport type StrategyConfig = z.infer<typeof StrategyConfigSchema>;\n\n// =============================================================================\n// Deployment Definition\n// =============================================================================\n\nexport const DeploymentDefinitionSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  description: z.string().optional(),\n\n  // What to deploy\n  artifact: ArtifactSchema,\n  previousArtifact: ArtifactSchema.optional(),\n\n  // Where to deploy\n  targets: z.array(DeploymentTargetSchema),\n  environment: DeploymentEnvironmentSchema,\n\n  // How to deploy\n  strategy: DeploymentStrategySchema,\n  strategyConfig: StrategyConfigSchema.optional(),\n\n  // Gates & Approvals\n  requiresApproval: z.boolean().default(false),\n  approvers: z.array(z.string()).default([]),\n  preDeploymentChecks: z.array(z.string()).default([]),\n  postDeploymentChecks: z.array(z.string()).default([]),\n\n  // Rollback\n  autoRollback: z.boolean().default(true),\n  rollbackOnFailedChecks: z.boolean().default(true),\n\n  // Notifications\n  notifyChannels: z.array(z.string()).default([]),\n\n  // Metadata\n  labels: z.record(z.string()).default({}),\n  annotations: z.record(z.string()).default({}),\n  createdAt: z.number(),\n  createdBy: z.string().optional(),\n});\nexport type DeploymentDefinition = z.infer<typeof DeploymentDefinitionSchema>;\n\n// =============================================================================\n// Deployment State\n// =============================================================================\n\nexport const DeploymentPhaseSchema = z.enum([\n  \"validation\", // Validating deployment configuration\n  \"approval\", // Waiting for approval\n  \"preparation\", // Preparing artifacts\n  \"pre_checks\", // Running pre-deployment checks\n  \"deploying\", // Actively deploying\n  \"canary_analysis\", // Analyzing canary metrics\n  \"traffic_shift\", // Shifting traffic\n  \"post_checks\", // Running post-deployment checks\n  \"cleanup\", // Cleaning up old resources\n  \"finalization\", // Finalizing deployment\n]);\nexport type DeploymentPhase = z.infer<typeof DeploymentPhaseSchema>;\n\nexport const DeploymentStateSchema = z.object({\n  deploymentId: z.string(),\n  status: DeploymentStatusSchema,\n  phase: DeploymentPhaseSchema,\n  startedAt: z.number(),\n  updatedAt: z.number(),\n  completedAt: z.number().optional(),\n\n  // Progress\n  progress: z.number().min(0).max(100),\n  currentStep: z.number(),\n  totalSteps: z.number(),\n\n  // Traffic (for canary)\n  trafficPercent: z.number().default(0),\n\n  // Instances\n  totalInstances: z.number().default(0),\n  updatedInstances: z.number().default(0),\n  healthyInstances: z.number().default(0),\n  unhealthyInstances: z.number().default(0),\n\n  // Errors\n  errors: z.array(z.object({\n    timestamp: z.number(),\n    phase: DeploymentPhaseSchema,\n    message: z.string(),\n    details: z.record(z.unknown()).optional(),\n  })).default([]),\n\n  // Logs\n  logs: z.array(z.object({\n    timestamp: z.number(),\n    level: z.enum([\"debug\", \"info\", \"warn\", \"error\"]),\n    message: z.string(),\n  })).default([]),\n});\nexport type DeploymentState = z.infer<typeof DeploymentStateSchema>;\n\n// =============================================================================\n// Check Results\n// =============================================================================\n\nexport const CheckResultSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  type: z.enum([\"health\", \"smoke\", \"load\", \"security\", \"custom\"]),\n  status: z.enum([\"pending\", \"running\", \"passed\", \"failed\", \"skipped\"]),\n  startedAt: z.number().optional(),\n  completedAt: z.number().optional(),\n  duration: z.number().optional(),\n  message: z.string().optional(),\n  details: z.record(z.unknown()).optional(),\n});\nexport type CheckResult = z.infer<typeof CheckResultSchema>;\n\n// =============================================================================\n// Approval\n// =============================================================================\n\nexport const ApprovalStatusSchema = z.enum([\n  \"pending\",\n  \"approved\",\n  \"rejected\",\n  \"expired\",\n]);\nexport type ApprovalStatus = z.infer<typeof ApprovalStatusSchema>;\n\nexport const ApprovalSchema = z.object({\n  id: z.string(),\n  deploymentId: z.string(),\n  status: ApprovalStatusSchema,\n  requestedAt: z.number(),\n  requestedBy: z.string().optional(),\n  respondedAt: z.number().optional(),\n  respondedBy: z.string().optional(),\n  comment: z.string().optional(),\n  expiresAt: z.number().optional(),\n});\nexport type Approval = z.infer<typeof ApprovalSchema>;\n\n// =============================================================================\n// Metrics & Analysis\n// =============================================================================\n\nexport const DeploymentMetricsSchema = z.object({\n  deploymentId: z.string(),\n  timestamp: z.number(),\n  requestCount: z.number(),\n  errorCount: z.number(),\n  errorRate: z.number(),\n  latencyP50: z.number(),\n  latencyP95: z.number(),\n  latencyP99: z.number(),\n  cpuUsage: z.number().optional(),\n  memoryUsage: z.number().optional(),\n  custom: z.record(z.number()).optional(),\n});\nexport type DeploymentMetrics = z.infer<typeof DeploymentMetricsSchema>;\n\nexport const AnalysisResultSchema = z.object({\n  deploymentId: z.string(),\n  timestamp: z.number(),\n  verdict: z.enum([\"pass\", \"fail\", \"inconclusive\"]),\n  score: z.number().min(0).max(100),\n  metrics: DeploymentMetricsSchema,\n  thresholds: z.record(z.number()),\n  violations: z.array(z.object({\n    metric: z.string(),\n    expected: z.number(),\n    actual: z.number(),\n  })).default([]),\n});\nexport type AnalysisResult = z.infer<typeof AnalysisResultSchema>;\n\n// =============================================================================\n// Rollback\n// =============================================================================\n\nexport const RollbackReasonSchema = z.enum([\n  \"manual\", // Manual rollback\n  \"failed_checks\", // Pre/post checks failed\n  \"error_threshold\", // Error rate exceeded\n  \"latency_threshold\", // Latency exceeded\n  \"health_check\", // Health check failure\n  \"approval_rejected\", // Approval was rejected\n  \"timeout\", // Deployment timed out\n]);\nexport type RollbackReason = z.infer<typeof RollbackReasonSchema>;\n\nexport const RollbackSchema = z.object({\n  id: z.string(),\n  deploymentId: z.string(),\n  reason: RollbackReasonSchema,\n  initiatedAt: z.number(),\n  completedAt: z.number().optional(),\n  status: z.enum([\"in_progress\", \"completed\", \"failed\"]),\n  targetArtifact: ArtifactSchema,\n  initiatedBy: z.string().optional(),\n  message: z.string().optional(),\n});\nexport type Rollback = z.infer<typeof RollbackSchema>;\n\n// =============================================================================\n// Configuration\n// =============================================================================\n\nexport const DeploymentManagerConfigSchema = z.object({\n  // Defaults\n  defaultStrategy: DeploymentStrategySchema.default(\"rolling\"),\n  defaultEnvironment: DeploymentEnvironmentSchema.default(\"staging\"),\n\n  // Timeouts\n  deploymentTimeoutSeconds: z.number().default(1800), // 30 min\n  approvalTimeoutSeconds: z.number().default(86400), // 24 hours\n  checkTimeoutSeconds: z.number().default(300), // 5 min\n\n  // Analysis\n  analysisIntervalSeconds: z.number().default(30),\n  metricsRetentionDays: z.number().default(30),\n\n  // Rollback\n  autoRollbackEnabled: z.boolean().default(true),\n  rollbackCooldownSeconds: z.number().default(300),\n\n  // Notifications\n  notifyOnStart: z.boolean().default(true),\n  notifyOnComplete: z.boolean().default(true),\n  notifyOnFailure: z.boolean().default(true),\n  notifyOnRollback: z.boolean().default(true),\n\n  // Integrations\n  metricsProvider: z.enum([\"prometheus\", \"datadog\", \"cloudwatch\", \"custom\"]).optional(),\n  notificationProvider: z.enum([\"slack\", \"email\", \"webhook\", \"custom\"]).optional(),\n});\nexport type DeploymentManagerConfig = z.infer<typeof DeploymentManagerConfigSchema>;\n\n// =============================================================================\n// Events\n// =============================================================================\n\nexport type DeploymentEvents = {\n  // Lifecycle\n  deploymentCreated: (deployment: DeploymentDefinition) => void;\n  deploymentStarted: (deploymentId: string) => void;\n  deploymentCompleted: (deploymentId: string, duration: number) => void;\n  deploymentFailed: (deploymentId: string, error: Error) => void;\n  deploymentCancelled: (deploymentId: string) => void;\n\n  // Phases\n  phaseStarted: (deploymentId: string, phase: DeploymentPhase) => void;\n  phaseCompleted: (deploymentId: string, phase: DeploymentPhase) => void;\n  phaseFailed: (deploymentId: string, phase: DeploymentPhase, error: Error) => void;\n\n  // Progress\n  progressUpdated: (deploymentId: string, progress: number) => void;\n  trafficShifted: (deploymentId: string, percent: number) => void;\n  instanceUpdated: (deploymentId: string, instanceId: string, healthy: boolean) => void;\n\n  // Checks\n  checkStarted: (deploymentId: string, checkId: string) => void;\n  checkCompleted: (deploymentId: string, result: CheckResult) => void;\n\n  // Approval\n  approvalRequested: (approval: Approval) => void;\n  approvalReceived: (approval: Approval) => void;\n\n  // Analysis\n  analysisCompleted: (result: AnalysisResult) => void;\n\n  // Rollback\n  rollbackStarted: (rollback: Rollback) => void;\n  rollbackCompleted: (rollback: Rollback) => void;\n  rollbackFailed: (rollback: Rollback, error: Error) => void;\n\n  // Errors\n  error: (error: Error) => void;\n};\n\n// =============================================================================\n// Storage Interface\n// =============================================================================\n\nexport interface DeploymentStorage {\n  // Deployments\n  getDeployment(id: string): Promise<DeploymentDefinition | null>;\n  saveDeployment(deployment: DeploymentDefinition): Promise<void>;\n  listDeployments(filters?: { environment?: DeploymentEnvironment; status?: DeploymentStatus }): Promise<DeploymentDefinition[]>;\n\n  // State\n  getState(deploymentId: string): Promise<DeploymentState | null>;\n  saveState(state: DeploymentState): Promise<void>;\n\n  // Approvals\n  getApproval(deploymentId: string): Promise<Approval | null>;\n  saveApproval(approval: Approval): Promise<void>;\n\n  // Checks\n  saveCheckResult(deploymentId: string, result: CheckResult): Promise<void>;\n  getCheckResults(deploymentId: string): Promise<CheckResult[]>;\n\n  // Metrics\n  saveMetrics(metrics: DeploymentMetrics): Promise<void>;\n  getMetrics(deploymentId: string, startTime: number, endTime: number): Promise<DeploymentMetrics[]>;\n\n  // Rollbacks\n  saveRollback(rollback: Rollback): Promise<void>;\n  getRollback(id: string): Promise<Rollback | null>;\n  listRollbacks(deploymentId: string): Promise<Rollback[]>;\n\n  // Artifacts\n  getArtifact(id: string): Promise<Artifact | null>;\n  saveArtifact(artifact: Artifact): Promise<void>;\n  listArtifacts(name: string): Promise<Artifact[]>;\n}\n","/**\n * Deployment Manager Implementation\n * Phase 15D: Deployment Automation\n */\n\nimport { EventEmitter } from \"eventemitter3\";\nimport { randomUUID } from \"crypto\";\nimport {\n  DeploymentStrategy,\n  DeploymentStatus,\n  DeploymentEnvironment,\n  DeploymentPhase,\n  Artifact,\n  ArtifactSchema,\n  DeploymentTarget,\n  DeploymentDefinition,\n  DeploymentDefinitionSchema,\n  DeploymentState,\n  CheckResult,\n  Approval,\n  ApprovalStatus,\n  DeploymentMetrics,\n  AnalysisResult,\n  Rollback,\n  RollbackReason,\n  DeploymentManagerConfig,\n  DeploymentManagerConfigSchema,\n  DeploymentEvents,\n  DeploymentStorage,\n  CanaryConfig,\n} from \"./types.js\";\n\n// =============================================================================\n// In-Memory Storage\n// =============================================================================\n\nclass InMemoryDeploymentStorage implements DeploymentStorage {\n  private deployments = new Map<string, DeploymentDefinition>();\n  private states = new Map<string, DeploymentState>();\n  private approvals = new Map<string, Approval>();\n  private checks = new Map<string, CheckResult[]>();\n  private metrics = new Map<string, DeploymentMetrics[]>();\n  private rollbacks = new Map<string, Rollback[]>();\n  private artifacts = new Map<string, Artifact>();\n\n  async getDeployment(id: string): Promise<DeploymentDefinition | null> {\n    return this.deployments.get(id) ?? null;\n  }\n\n  async saveDeployment(deployment: DeploymentDefinition): Promise<void> {\n    this.deployments.set(deployment.id, deployment);\n  }\n\n  async listDeployments(filters?: {\n    environment?: DeploymentEnvironment;\n    status?: DeploymentStatus;\n  }): Promise<DeploymentDefinition[]> {\n    let results = Array.from(this.deployments.values());\n\n    if (filters?.environment) {\n      results = results.filter(d => d.environment === filters.environment);\n    }\n\n    return results.sort((a, b) => b.createdAt - a.createdAt);\n  }\n\n  async getState(deploymentId: string): Promise<DeploymentState | null> {\n    return this.states.get(deploymentId) ?? null;\n  }\n\n  async saveState(state: DeploymentState): Promise<void> {\n    this.states.set(state.deploymentId, state);\n  }\n\n  async getApproval(deploymentId: string): Promise<Approval | null> {\n    return this.approvals.get(deploymentId) ?? null;\n  }\n\n  async saveApproval(approval: Approval): Promise<void> {\n    this.approvals.set(approval.deploymentId, approval);\n  }\n\n  async saveCheckResult(deploymentId: string, result: CheckResult): Promise<void> {\n    const checks = this.checks.get(deploymentId) ?? [];\n    const idx = checks.findIndex(c => c.id === result.id);\n    if (idx >= 0) {\n      checks[idx] = result;\n    } else {\n      checks.push(result);\n    }\n    this.checks.set(deploymentId, checks);\n  }\n\n  async getCheckResults(deploymentId: string): Promise<CheckResult[]> {\n    return this.checks.get(deploymentId) ?? [];\n  }\n\n  async saveMetrics(metrics: DeploymentMetrics): Promise<void> {\n    const existing = this.metrics.get(metrics.deploymentId) ?? [];\n    existing.push(metrics);\n    this.metrics.set(metrics.deploymentId, existing);\n  }\n\n  async getMetrics(deploymentId: string, startTime: number, endTime: number): Promise<DeploymentMetrics[]> {\n    const all = this.metrics.get(deploymentId) ?? [];\n    return all.filter(m => m.timestamp >= startTime && m.timestamp <= endTime);\n  }\n\n  async saveRollback(rollback: Rollback): Promise<void> {\n    const existing = this.rollbacks.get(rollback.deploymentId) ?? [];\n    const idx = existing.findIndex(r => r.id === rollback.id);\n    if (idx >= 0) {\n      existing[idx] = rollback;\n    } else {\n      existing.push(rollback);\n    }\n    this.rollbacks.set(rollback.deploymentId, existing);\n  }\n\n  async getRollback(id: string): Promise<Rollback | null> {\n    for (const rollbacks of this.rollbacks.values()) {\n      const found = rollbacks.find(r => r.id === id);\n      if (found) return found;\n    }\n    return null;\n  }\n\n  async listRollbacks(deploymentId: string): Promise<Rollback[]> {\n    return this.rollbacks.get(deploymentId) ?? [];\n  }\n\n  async getArtifact(id: string): Promise<Artifact | null> {\n    return this.artifacts.get(id) ?? null;\n  }\n\n  async saveArtifact(artifact: Artifact): Promise<void> {\n    this.artifacts.set(artifact.id, artifact);\n  }\n\n  async listArtifacts(name: string): Promise<Artifact[]> {\n    return Array.from(this.artifacts.values())\n      .filter(a => a.name === name)\n      .sort((a, b) => b.createdAt - a.createdAt);\n  }\n}\n\n// =============================================================================\n// Deployment Manager\n// =============================================================================\n\nexport class DeploymentManager extends EventEmitter<DeploymentEvents> {\n  private config: DeploymentManagerConfig;\n  private storage: DeploymentStorage;\n  private activeDeployments = new Map<string, NodeJS.Timeout>();\n  private running = false;\n\n  constructor(config: Partial<DeploymentManagerConfig> = {}) {\n    super();\n    this.config = DeploymentManagerConfigSchema.parse(config);\n    this.storage = new InMemoryDeploymentStorage();\n  }\n\n  // ---------------------------------------------------------------------------\n  // Configuration\n  // ---------------------------------------------------------------------------\n\n  setStorage(storage: DeploymentStorage): void {\n    this.storage = storage;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Artifact Management\n  // ---------------------------------------------------------------------------\n\n  async registerArtifact(input: Omit<Artifact, \"id\" | \"createdAt\">): Promise<Artifact> {\n    const artifact = ArtifactSchema.parse({\n      ...input,\n      id: randomUUID(),\n      createdAt: Date.now(),\n    });\n\n    await this.storage.saveArtifact(artifact);\n    return artifact;\n  }\n\n  async getArtifact(id: string): Promise<Artifact | null> {\n    return this.storage.getArtifact(id);\n  }\n\n  async listArtifacts(name: string): Promise<Artifact[]> {\n    return this.storage.listArtifacts(name);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Deployment CRUD\n  // ---------------------------------------------------------------------------\n\n  async createDeployment(\n    input: Omit<DeploymentDefinition, \"id\" | \"createdAt\">\n  ): Promise<DeploymentDefinition> {\n    const deployment = DeploymentDefinitionSchema.parse({\n      ...input,\n      id: randomUUID(),\n      createdAt: Date.now(),\n    });\n\n    await this.storage.saveDeployment(deployment);\n\n    // Initialize state\n    const state: DeploymentState = {\n      deploymentId: deployment.id,\n      status: \"pending\",\n      phase: \"validation\",\n      startedAt: Date.now(),\n      updatedAt: Date.now(),\n      progress: 0,\n      currentStep: 0,\n      totalSteps: this.calculateTotalSteps(deployment),\n      trafficPercent: 0,\n      totalInstances: 0,\n      updatedInstances: 0,\n      healthyInstances: 0,\n      unhealthyInstances: 0,\n      errors: [],\n      logs: [],\n    };\n\n    await this.storage.saveState(state);\n    this.emit(\"deploymentCreated\", deployment);\n\n    return deployment;\n  }\n\n  async getDeployment(id: string): Promise<DeploymentDefinition | null> {\n    return this.storage.getDeployment(id);\n  }\n\n  async listDeployments(filters?: {\n    environment?: DeploymentEnvironment;\n    status?: DeploymentStatus;\n  }): Promise<DeploymentDefinition[]> {\n    return this.storage.listDeployments(filters);\n  }\n\n  async getState(deploymentId: string): Promise<DeploymentState | null> {\n    return this.storage.getState(deploymentId);\n  }\n\n  private calculateTotalSteps(deployment: DeploymentDefinition): number {\n    let steps = 3; // validation, deploying, finalization\n    if (deployment.requiresApproval) steps++;\n    if (deployment.preDeploymentChecks.length > 0) steps++;\n    if (deployment.postDeploymentChecks.length > 0) steps++;\n    if (deployment.strategy === \"canary\") {\n      steps += (deployment.strategyConfig?.canary?.steps.length ?? 0);\n    }\n    return steps;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Deployment Execution\n  // ---------------------------------------------------------------------------\n\n  async startDeployment(deploymentId: string): Promise<void> {\n    const deployment = await this.storage.getDeployment(deploymentId);\n    if (!deployment) {\n      throw new Error(`Deployment not found: ${deploymentId}`);\n    }\n\n    const state = await this.storage.getState(deploymentId);\n    if (!state || state.status !== \"pending\") {\n      throw new Error(\"Deployment is not in pending state\");\n    }\n\n    await this.updateState(deploymentId, { status: \"running\" });\n    this.emit(\"deploymentStarted\", deploymentId);\n\n    // Run deployment async\n    this.runDeployment(deployment).catch(error => {\n      this.emit(\"deploymentFailed\", deploymentId, error);\n    });\n  }\n\n  private async runDeployment(deployment: DeploymentDefinition): Promise<void> {\n    const deploymentId = deployment.id;\n\n    try {\n      // Phase 1: Validation\n      await this.runPhase(deploymentId, \"validation\", async () => {\n        await this.validateDeployment(deployment);\n      });\n\n      // Phase 2: Approval (if required)\n      if (deployment.requiresApproval) {\n        await this.runPhase(deploymentId, \"approval\", async () => {\n          await this.waitForApproval(deploymentId);\n        });\n      }\n\n      // Phase 3: Preparation\n      await this.runPhase(deploymentId, \"preparation\", async () => {\n        await this.prepareDeployment(deployment);\n      });\n\n      // Phase 4: Pre-deployment checks\n      if (deployment.preDeploymentChecks.length > 0) {\n        await this.runPhase(deploymentId, \"pre_checks\", async () => {\n          await this.runChecks(deploymentId, deployment.preDeploymentChecks, \"pre\");\n        });\n      }\n\n      // Phase 5: Deploying\n      await this.runPhase(deploymentId, \"deploying\", async () => {\n        await this.executeDeployment(deployment);\n      });\n\n      // Phase 6: Post-deployment checks\n      if (deployment.postDeploymentChecks.length > 0) {\n        await this.runPhase(deploymentId, \"post_checks\", async () => {\n          await this.runChecks(deploymentId, deployment.postDeploymentChecks, \"post\");\n        });\n      }\n\n      // Phase 7: Finalization\n      await this.runPhase(deploymentId, \"finalization\", async () => {\n        await this.finalizeDeployment(deployment);\n      });\n\n      // Complete\n      const state = await this.storage.getState(deploymentId);\n      const duration = Date.now() - (state?.startedAt ?? Date.now());\n\n      await this.updateState(deploymentId, {\n        status: \"completed\",\n        progress: 100,\n        completedAt: Date.now(),\n      });\n\n      this.emit(\"deploymentCompleted\", deploymentId, duration);\n    } catch (error) {\n      await this.handleDeploymentFailure(deployment, error instanceof Error ? error : new Error(String(error)));\n    }\n  }\n\n  private async runPhase(\n    deploymentId: string,\n    phase: DeploymentPhase,\n    execute: () => Promise<void>\n  ): Promise<void> {\n    const state = await this.storage.getState(deploymentId);\n    if (!state || state.status !== \"running\") return;\n\n    await this.updateState(deploymentId, { phase });\n    this.emit(\"phaseStarted\", deploymentId, phase);\n\n    try {\n      await execute();\n      this.emit(\"phaseCompleted\", deploymentId, phase);\n    } catch (error) {\n      this.emit(\"phaseFailed\", deploymentId, phase, error instanceof Error ? error : new Error(String(error)));\n      throw error;\n    }\n\n    // Update progress\n    const currentState = await this.storage.getState(deploymentId);\n    if (currentState) {\n      await this.updateState(deploymentId, {\n        currentStep: currentState.currentStep + 1,\n        progress: Math.round(((currentState.currentStep + 1) / currentState.totalSteps) * 100),\n      });\n    }\n  }\n\n  private async validateDeployment(deployment: DeploymentDefinition): Promise<void> {\n    // Validate artifact exists\n    if (!deployment.artifact) {\n      throw new Error(\"No artifact specified\");\n    }\n\n    // Validate targets\n    if (!deployment.targets || deployment.targets.length === 0) {\n      throw new Error(\"No deployment targets specified\");\n    }\n\n    // Validate strategy config\n    if (deployment.strategy === \"canary\" && !deployment.strategyConfig?.canary) {\n      throw new Error(\"Canary strategy requires canary configuration\");\n    }\n\n    if (deployment.strategy === \"blue_green\" && !deployment.strategyConfig?.blueGreen) {\n      throw new Error(\"Blue/green strategy requires blueGreen configuration\");\n    }\n\n    await this.addLog(deployment.id, \"info\", \"Deployment validation completed\");\n  }\n\n  private async prepareDeployment(deployment: DeploymentDefinition): Promise<void> {\n    // In real implementation: pull artifacts, prepare resources\n    await this.addLog(deployment.id, \"info\", `Preparing artifact: ${deployment.artifact.name}:${deployment.artifact.version}`);\n    await this.sleep(500); // Simulate preparation\n  }\n\n  private async executeDeployment(deployment: DeploymentDefinition): Promise<void> {\n    switch (deployment.strategy) {\n      case \"rolling\":\n        await this.executeRollingDeployment(deployment);\n        break;\n      case \"blue_green\":\n        await this.executeBlueGreenDeployment(deployment);\n        break;\n      case \"canary\":\n        await this.executeCanaryDeployment(deployment);\n        break;\n      case \"recreate\":\n        await this.executeRecreateDeployment(deployment);\n        break;\n      default:\n        await this.executeRollingDeployment(deployment);\n    }\n  }\n\n  private async executeRollingDeployment(deployment: DeploymentDefinition): Promise<void> {\n    const totalInstances = deployment.targets.reduce((sum, t) => sum + (t.replicas ?? 1), 0);\n    await this.updateState(deployment.id, { totalInstances });\n\n    for (let i = 0; i < totalInstances; i++) {\n      await this.addLog(deployment.id, \"info\", `Updating instance ${i + 1}/${totalInstances}`);\n      await this.sleep(100); // Simulate instance update\n\n      await this.updateState(deployment.id, {\n        updatedInstances: i + 1,\n        healthyInstances: i + 1,\n      });\n\n      this.emit(\"instanceUpdated\", deployment.id, `instance-${i}`, true);\n    }\n  }\n\n  private async executeBlueGreenDeployment(deployment: DeploymentDefinition): Promise<void> {\n    const config = deployment.strategyConfig?.blueGreen;\n    if (!config) return;\n\n    await this.addLog(deployment.id, \"info\", \"Deploying to green environment\");\n    await this.sleep(500);\n\n    await this.addLog(deployment.id, \"info\", \"Warming up green environment\");\n    await this.sleep(config.warmupSeconds * 10); // Accelerated for demo\n\n    await this.addLog(deployment.id, \"info\", `Switching ${config.switchTrafficPercent}% traffic to green`);\n    await this.updateState(deployment.id, { trafficPercent: config.switchTrafficPercent });\n    this.emit(\"trafficShifted\", deployment.id, config.switchTrafficPercent);\n  }\n\n  private async executeCanaryDeployment(deployment: DeploymentDefinition): Promise<void> {\n    const config = deployment.strategyConfig?.canary;\n    if (!config) return;\n\n    for (const step of config.steps) {\n      await this.addLog(deployment.id, \"info\", `Shifting ${step.percent}% traffic to canary`);\n      await this.updateState(deployment.id, { trafficPercent: step.percent, phase: \"canary_analysis\" });\n      this.emit(\"trafficShifted\", deployment.id, step.percent);\n\n      // Run analysis\n      await this.sleep(step.durationSeconds * 10); // Accelerated\n\n      const metrics = await this.collectMetrics(deployment.id);\n      const analysis = this.analyzeMetrics(deployment.id, metrics, config);\n\n      this.emit(\"analysisCompleted\", analysis);\n\n      if (analysis.verdict === \"fail\") {\n        throw new Error(`Canary analysis failed at ${step.percent}%: ${analysis.violations.map(v => v.metric).join(\", \")}`);\n      }\n\n      if (step.pauseForAnalysis) {\n        await this.addLog(deployment.id, \"info\", \"Paused for manual analysis review\");\n      }\n    }\n\n    await this.updateState(deployment.id, { trafficPercent: 100 });\n  }\n\n  private async executeRecreateDeployment(deployment: DeploymentDefinition): Promise<void> {\n    await this.addLog(deployment.id, \"info\", \"Stopping existing instances\");\n    await this.updateState(deployment.id, { healthyInstances: 0 });\n    await this.sleep(300);\n\n    await this.addLog(deployment.id, \"info\", \"Starting new instances\");\n    const totalInstances = deployment.targets.reduce((sum, t) => sum + (t.replicas ?? 1), 0);\n    await this.updateState(deployment.id, {\n      totalInstances,\n      updatedInstances: totalInstances,\n      healthyInstances: totalInstances,\n    });\n  }\n\n  private async runChecks(deploymentId: string, checkNames: string[], phase: \"pre\" | \"post\"): Promise<void> {\n    for (const checkName of checkNames) {\n      const check: CheckResult = {\n        id: randomUUID(),\n        name: checkName,\n        type: \"custom\",\n        status: \"running\",\n        startedAt: Date.now(),\n      };\n\n      await this.storage.saveCheckResult(deploymentId, check);\n      this.emit(\"checkStarted\", deploymentId, check.id);\n\n      await this.sleep(200); // Simulate check execution\n\n      check.status = \"passed\";\n      check.completedAt = Date.now();\n      check.duration = check.completedAt - check.startedAt!;\n\n      await this.storage.saveCheckResult(deploymentId, check);\n      this.emit(\"checkCompleted\", deploymentId, check);\n    }\n  }\n\n  private async finalizeDeployment(deployment: DeploymentDefinition): Promise<void> {\n    await this.addLog(deployment.id, \"info\", \"Finalizing deployment\");\n    await this.sleep(200);\n\n    // In real implementation: cleanup old resources, update DNS, etc.\n  }\n\n  private async collectMetrics(deploymentId: string): Promise<DeploymentMetrics> {\n    const metrics: DeploymentMetrics = {\n      deploymentId,\n      timestamp: Date.now(),\n      requestCount: Math.floor(Math.random() * 1000) + 100,\n      errorCount: Math.floor(Math.random() * 10),\n      errorRate: Math.random() * 2, // 0-2%\n      latencyP50: Math.random() * 100 + 20,\n      latencyP95: Math.random() * 200 + 50,\n      latencyP99: Math.random() * 300 + 100,\n    };\n\n    await this.storage.saveMetrics(metrics);\n    return metrics;\n  }\n\n  private analyzeMetrics(deploymentId: string, metrics: DeploymentMetrics, config: CanaryConfig): AnalysisResult {\n    const violations: Array<{ metric: string; expected: number; actual: number }> = [];\n\n    if (metrics.errorRate > config.errorThreshold) {\n      violations.push({ metric: \"errorRate\", expected: config.errorThreshold, actual: metrics.errorRate });\n    }\n\n    if (metrics.latencyP99 > config.latencyThreshold) {\n      violations.push({ metric: \"latencyP99\", expected: config.latencyThreshold, actual: metrics.latencyP99 });\n    }\n\n    const successRate = 100 - metrics.errorRate;\n    if (successRate < config.successThreshold) {\n      violations.push({ metric: \"successRate\", expected: config.successThreshold, actual: successRate });\n    }\n\n    return {\n      deploymentId,\n      timestamp: Date.now(),\n      verdict: violations.length === 0 ? \"pass\" : \"fail\",\n      score: Math.max(0, 100 - violations.length * 25),\n      metrics,\n      thresholds: {\n        errorThreshold: config.errorThreshold,\n        latencyThreshold: config.latencyThreshold,\n        successThreshold: config.successThreshold,\n      },\n      violations,\n    };\n  }\n\n  // ---------------------------------------------------------------------------\n  // Approval\n  // ---------------------------------------------------------------------------\n\n  async requestApproval(deploymentId: string, requestedBy?: string): Promise<Approval> {\n    const approval: Approval = {\n      id: randomUUID(),\n      deploymentId,\n      status: \"pending\",\n      requestedAt: Date.now(),\n      requestedBy,\n      expiresAt: Date.now() + this.config.approvalTimeoutSeconds * 1000,\n    };\n\n    await this.storage.saveApproval(approval);\n    this.emit(\"approvalRequested\", approval);\n    return approval;\n  }\n\n  async approveDeployment(deploymentId: string, respondedBy: string, comment?: string): Promise<void> {\n    const approval = await this.storage.getApproval(deploymentId);\n    if (!approval || approval.status !== \"pending\") {\n      throw new Error(\"No pending approval found\");\n    }\n\n    approval.status = \"approved\";\n    approval.respondedAt = Date.now();\n    approval.respondedBy = respondedBy;\n    approval.comment = comment;\n\n    await this.storage.saveApproval(approval);\n    this.emit(\"approvalReceived\", approval);\n  }\n\n  async rejectDeployment(deploymentId: string, respondedBy: string, comment?: string): Promise<void> {\n    const approval = await this.storage.getApproval(deploymentId);\n    if (!approval || approval.status !== \"pending\") {\n      throw new Error(\"No pending approval found\");\n    }\n\n    approval.status = \"rejected\";\n    approval.respondedAt = Date.now();\n    approval.respondedBy = respondedBy;\n    approval.comment = comment;\n\n    await this.storage.saveApproval(approval);\n    this.emit(\"approvalReceived\", approval);\n  }\n\n  private async waitForApproval(deploymentId: string): Promise<void> {\n    const approval = await this.requestApproval(deploymentId);\n\n    // Poll for approval\n    const startTime = Date.now();\n    while (Date.now() - startTime < this.config.approvalTimeoutSeconds * 1000) {\n      const current = await this.storage.getApproval(deploymentId);\n\n      if (current?.status === \"approved\") {\n        return;\n      }\n\n      if (current?.status === \"rejected\") {\n        throw new Error(`Deployment rejected: ${current.comment ?? \"No reason provided\"}`);\n      }\n\n      await this.sleep(5000);\n    }\n\n    throw new Error(\"Approval timeout\");\n  }\n\n  // ---------------------------------------------------------------------------\n  // Rollback\n  // ---------------------------------------------------------------------------\n\n  async rollback(deploymentId: string, reason: RollbackReason, initiatedBy?: string): Promise<Rollback> {\n    const deployment = await this.storage.getDeployment(deploymentId);\n    if (!deployment) {\n      throw new Error(`Deployment not found: ${deploymentId}`);\n    }\n\n    if (!deployment.previousArtifact) {\n      throw new Error(\"No previous artifact to rollback to\");\n    }\n\n    const rollback: Rollback = {\n      id: randomUUID(),\n      deploymentId,\n      reason,\n      initiatedAt: Date.now(),\n      status: \"in_progress\",\n      targetArtifact: deployment.previousArtifact,\n      initiatedBy,\n    };\n\n    await this.storage.saveRollback(rollback);\n    await this.updateState(deploymentId, { status: \"rolled_back\" });\n    this.emit(\"rollbackStarted\", rollback);\n\n    try {\n      // Execute rollback\n      await this.addLog(deploymentId, \"warn\", `Initiating rollback: ${reason}`);\n\n      // Create rollback deployment\n      const rollbackDeployment = await this.createDeployment({\n        ...deployment,\n        name: `${deployment.name} (rollback)`,\n        artifact: deployment.previousArtifact,\n        previousArtifact: deployment.artifact,\n        requiresApproval: false,\n      });\n\n      await this.startDeployment(rollbackDeployment.id);\n\n      rollback.status = \"completed\";\n      rollback.completedAt = Date.now();\n      await this.storage.saveRollback(rollback);\n      this.emit(\"rollbackCompleted\", rollback);\n    } catch (error) {\n      rollback.status = \"failed\";\n      await this.storage.saveRollback(rollback);\n      this.emit(\"rollbackFailed\", rollback, error instanceof Error ? error : new Error(String(error)));\n      throw error;\n    }\n\n    return rollback;\n  }\n\n  private async handleDeploymentFailure(deployment: DeploymentDefinition, error: Error): Promise<void> {\n    const state = await this.storage.getState(deployment.id);\n\n    await this.updateState(deployment.id, {\n      status: \"failed\",\n      errors: [...(state?.errors ?? []), {\n        timestamp: Date.now(),\n        phase: state?.phase ?? \"deploying\",\n        message: error.message,\n      }],\n    });\n\n    this.emit(\"deploymentFailed\", deployment.id, error);\n\n    // Auto-rollback if enabled\n    if (deployment.autoRollback && deployment.previousArtifact) {\n      await this.addLog(deployment.id, \"warn\", \"Auto-rollback triggered\");\n      await this.rollback(deployment.id, \"failed_checks\");\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Cancel\n  // ---------------------------------------------------------------------------\n\n  async cancelDeployment(deploymentId: string): Promise<void> {\n    const state = await this.storage.getState(deploymentId);\n    if (!state || state.status !== \"running\") {\n      throw new Error(\"Deployment is not running\");\n    }\n\n    await this.updateState(deploymentId, { status: \"cancelled\" });\n    this.emit(\"deploymentCancelled\", deploymentId);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Helpers\n  // ---------------------------------------------------------------------------\n\n  private async updateState(deploymentId: string, updates: Partial<DeploymentState>): Promise<void> {\n    const state = await this.storage.getState(deploymentId);\n    if (!state) return;\n\n    const updated: DeploymentState = {\n      ...state,\n      ...updates,\n      updatedAt: Date.now(),\n    };\n\n    await this.storage.saveState(updated);\n\n    if (updates.progress !== undefined) {\n      this.emit(\"progressUpdated\", deploymentId, updates.progress);\n    }\n  }\n\n  private async addLog(deploymentId: string, level: \"debug\" | \"info\" | \"warn\" | \"error\", message: string): Promise<void> {\n    const state = await this.storage.getState(deploymentId);\n    if (!state) return;\n\n    state.logs.push({ timestamp: Date.now(), level, message });\n    await this.storage.saveState(state);\n  }\n\n  private sleep(ms: number): Promise<void> {\n    return new Promise(resolve => setTimeout(resolve, ms));\n  }\n\n  // ---------------------------------------------------------------------------\n  // Lifecycle\n  // ---------------------------------------------------------------------------\n\n  async start(): Promise<void> {\n    this.running = true;\n  }\n\n  async stop(): Promise<void> {\n    this.running = false;\n    for (const [id, timeout] of this.activeDeployments) {\n      clearTimeout(timeout);\n    }\n    this.activeDeployments.clear();\n  }\n\n  isRunning(): boolean {\n    return this.running;\n  }\n}\n\n// =============================================================================\n// Factory Functions\n// =============================================================================\n\nlet defaultManager: DeploymentManager | null = null;\n\nexport function getDeploymentManager(): DeploymentManager {\n  if (!defaultManager) {\n    defaultManager = new DeploymentManager();\n  }\n  return defaultManager;\n}\n\nexport function createDeploymentManager(config?: Partial<DeploymentManagerConfig>): DeploymentManager {\n  return new DeploymentManager(config);\n}\n","/**\n * LLM Cost Tracker Types\n * Phase 16A: AI Operations - Cost Tracking & Budgeting\n */\n\nimport { z } from \"zod\";\n\n// =============================================================================\n// Model & Provider Definitions\n// =============================================================================\n\nexport const LLMProviderSchema = z.enum([\n  \"openai\",\n  \"anthropic\",\n  \"google\",\n  \"cohere\",\n  \"mistral\",\n  \"azure\",\n  \"aws_bedrock\",\n  \"groq\",\n  \"together\",\n  \"perplexity\",\n  \"replicate\",\n  \"huggingface\",\n  \"local\",\n  \"custom\",\n]);\nexport type LLMProvider = z.infer<typeof LLMProviderSchema>;\n\nexport const ModelTierSchema = z.enum([\n  \"free\",\n  \"standard\",\n  \"premium\",\n  \"enterprise\",\n]);\nexport type ModelTier = z.infer<typeof ModelTierSchema>;\n\nexport const ModelCapabilitySchema = z.enum([\n  \"text\",\n  \"chat\",\n  \"code\",\n  \"vision\",\n  \"audio\",\n  \"embedding\",\n  \"image_generation\",\n  \"function_calling\",\n  \"streaming\",\n]);\nexport type ModelCapability = z.infer<typeof ModelCapabilitySchema>;\n\nexport const ModelDefinitionSchema = z.object({\n  id: z.string(),\n  provider: LLMProviderSchema,\n  name: z.string(),\n  displayName: z.string().optional(),\n  tier: ModelTierSchema.default(\"standard\"),\n  capabilities: z.array(ModelCapabilitySchema).default([\"text\"]),\n\n  // Token limits\n  contextWindow: z.number().describe(\"Max context length in tokens\"),\n  maxOutputTokens: z.number().optional(),\n\n  // Pricing (per 1M tokens)\n  inputPricePerMillion: z.number().describe(\"USD per 1M input tokens\"),\n  outputPricePerMillion: z.number().describe(\"USD per 1M output tokens\"),\n  cachedInputPricePerMillion: z.number().optional().describe(\"USD per 1M cached input tokens\"),\n\n  // Image pricing (for vision models)\n  imagePricePerUnit: z.number().optional(),\n\n  // Additional costs\n  requestBaseCost: z.number().default(0).describe(\"Fixed cost per request\"),\n\n  // Metadata\n  deprecated: z.boolean().default(false),\n  deprecationDate: z.string().optional(),\n  releaseDate: z.string().optional(),\n  description: z.string().optional(),\n});\nexport type ModelDefinition = z.infer<typeof ModelDefinitionSchema>;\n\n// =============================================================================\n// Usage Tracking\n// =============================================================================\n\nexport const TokenUsageSchema = z.object({\n  inputTokens: z.number().default(0),\n  outputTokens: z.number().default(0),\n  cachedTokens: z.number().default(0),\n  totalTokens: z.number().default(0),\n});\nexport type TokenUsage = z.infer<typeof TokenUsageSchema>;\n\nexport const LLMRequestSchema = z.object({\n  id: z.string(),\n  timestamp: z.number(),\n\n  // Model info\n  provider: LLMProviderSchema,\n  model: z.string(),\n\n  // Request details\n  requestType: z.enum([\"completion\", \"chat\", \"embedding\", \"image\", \"audio\", \"function\"]).default(\"chat\"),\n  streaming: z.boolean().default(false),\n\n  // Token usage\n  usage: TokenUsageSchema,\n\n  // Cost calculation\n  inputCost: z.number(),\n  outputCost: z.number(),\n  cachedCost: z.number().default(0),\n  additionalCosts: z.number().default(0),\n  totalCost: z.number(),\n\n  // Latency\n  latencyMs: z.number().optional(),\n  timeToFirstTokenMs: z.number().optional(),\n\n  // Context\n  projectId: z.string().optional(),\n  userId: z.string().optional(),\n  sessionId: z.string().optional(),\n  tags: z.array(z.string()).default([]),\n  metadata: z.record(z.unknown()).optional(),\n\n  // Status\n  success: z.boolean().default(true),\n  errorCode: z.string().optional(),\n  errorMessage: z.string().optional(),\n});\nexport type LLMRequest = z.infer<typeof LLMRequestSchema>;\n\n// =============================================================================\n// Cost Aggregation\n// =============================================================================\n\nexport const AggregationPeriodSchema = z.enum([\n  \"hour\",\n  \"day\",\n  \"week\",\n  \"month\",\n  \"quarter\",\n  \"year\",\n]);\nexport type AggregationPeriod = z.infer<typeof AggregationPeriodSchema>;\n\nexport const CostAggregationSchema = z.object({\n  period: AggregationPeriodSchema,\n  startTime: z.number(),\n  endTime: z.number(),\n\n  // Totals\n  totalRequests: z.number(),\n  totalTokens: z.number(),\n  totalInputTokens: z.number(),\n  totalOutputTokens: z.number(),\n  totalCachedTokens: z.number(),\n  totalCost: z.number(),\n\n  // By provider\n  byProvider: z.record(z.object({\n    requests: z.number(),\n    tokens: z.number(),\n    cost: z.number(),\n  })),\n\n  // By model\n  byModel: z.record(z.object({\n    requests: z.number(),\n    tokens: z.number(),\n    cost: z.number(),\n  })),\n\n  // By project\n  byProject: z.record(z.object({\n    requests: z.number(),\n    tokens: z.number(),\n    cost: z.number(),\n  })),\n\n  // By user\n  byUser: z.record(z.object({\n    requests: z.number(),\n    tokens: z.number(),\n    cost: z.number(),\n  })),\n\n  // Averages\n  avgCostPerRequest: z.number(),\n  avgTokensPerRequest: z.number(),\n  avgLatencyMs: z.number().optional(),\n\n  // Success rate\n  successRate: z.number(),\n  errorCount: z.number(),\n});\nexport type CostAggregation = z.infer<typeof CostAggregationSchema>;\n\n// =============================================================================\n// Budgets & Alerts\n// =============================================================================\n\nexport const BudgetPeriodSchema = z.enum([\n  \"daily\",\n  \"weekly\",\n  \"monthly\",\n  \"quarterly\",\n  \"yearly\",\n  \"custom\",\n]);\nexport type BudgetPeriod = z.infer<typeof BudgetPeriodSchema>;\n\nexport const BudgetScopeSchema = z.enum([\n  \"global\",\n  \"provider\",\n  \"model\",\n  \"project\",\n  \"user\",\n  \"tag\",\n]);\nexport type BudgetScope = z.infer<typeof BudgetScopeSchema>;\n\nexport const BudgetDefinitionSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  description: z.string().optional(),\n\n  // Scope\n  scope: BudgetScopeSchema,\n  scopeId: z.string().optional().describe(\"Provider/model/project/user ID when scope is not global\"),\n\n  // Period\n  period: BudgetPeriodSchema,\n  customPeriodDays: z.number().optional(),\n  startDate: z.number().optional(),\n\n  // Limits\n  budgetAmount: z.number().describe(\"Budget limit in USD\"),\n  softLimitPercent: z.number().default(80).describe(\"Percentage for soft warning\"),\n  hardLimitPercent: z.number().default(100).describe(\"Percentage for hard limit\"),\n\n  // Actions\n  alertOnSoftLimit: z.boolean().default(true),\n  alertOnHardLimit: z.boolean().default(true),\n  blockOnHardLimit: z.boolean().default(false).describe(\"Block requests when hard limit reached\"),\n\n  // Rollover\n  rolloverEnabled: z.boolean().default(false),\n  maxRolloverPercent: z.number().default(25),\n\n  // Status\n  enabled: z.boolean().default(true),\n  createdAt: z.number(),\n  updatedAt: z.number(),\n});\nexport type BudgetDefinition = z.infer<typeof BudgetDefinitionSchema>;\n\nexport const BudgetStatusSchema = z.enum([\n  \"under_budget\",\n  \"soft_limit\",\n  \"hard_limit\",\n  \"exceeded\",\n]);\nexport type BudgetStatus = z.infer<typeof BudgetStatusSchema>;\n\nexport const BudgetStateSchema = z.object({\n  budgetId: z.string(),\n  periodStart: z.number(),\n  periodEnd: z.number(),\n\n  // Usage\n  currentSpend: z.number(),\n  remainingBudget: z.number(),\n  percentUsed: z.number(),\n\n  // Status\n  status: BudgetStatusSchema,\n  estimatedEndSpend: z.number().optional().describe(\"Projected spend by end of period\"),\n\n  // Rollover\n  rolloverAmount: z.number().default(0),\n  effectiveBudget: z.number().describe(\"Budget + rollover\"),\n\n  // History\n  lastUpdated: z.number(),\n  lastAlertSent: z.number().optional(),\n});\nexport type BudgetState = z.infer<typeof BudgetStateSchema>;\n\nexport const CostAlertTypeSchema = z.enum([\n  \"soft_limit_reached\",\n  \"hard_limit_reached\",\n  \"budget_exceeded\",\n  \"anomaly_detected\",\n  \"spend_spike\",\n  \"daily_summary\",\n  \"weekly_summary\",\n]);\nexport type CostAlertType = z.infer<typeof CostAlertTypeSchema>;\n\nexport const CostAlertSchema = z.object({\n  id: z.string(),\n  type: CostAlertTypeSchema,\n  severity: z.enum([\"info\", \"warning\", \"critical\"]),\n  timestamp: z.number(),\n\n  // Context\n  budgetId: z.string().optional(),\n  scope: BudgetScopeSchema.optional(),\n  scopeId: z.string().optional(),\n\n  // Details\n  title: z.string(),\n  message: z.string(),\n  currentSpend: z.number(),\n  threshold: z.number().optional(),\n  percentUsed: z.number().optional(),\n\n  // Recommendations\n  recommendations: z.array(z.string()).default([]),\n\n  // Status\n  acknowledged: z.boolean().default(false),\n  acknowledgedBy: z.string().optional(),\n  acknowledgedAt: z.number().optional(),\n});\nexport type CostAlert = z.infer<typeof CostAlertSchema>;\n\n// =============================================================================\n// Cost Optimization\n// =============================================================================\n\nexport const CostOptimizationTypeSchema = z.enum([\n  \"model_downgrade\",\n  \"caching_opportunity\",\n  \"batch_processing\",\n  \"prompt_optimization\",\n  \"provider_switch\",\n  \"unused_capacity\",\n]);\nexport type CostOptimizationType = z.infer<typeof CostOptimizationTypeSchema>;\n\nexport const CostOptimizationSchema = z.object({\n  id: z.string(),\n  type: CostOptimizationTypeSchema,\n  priority: z.enum([\"low\", \"medium\", \"high\"]),\n  timestamp: z.number(),\n\n  // Impact\n  estimatedSavings: z.number().describe(\"USD savings per period\"),\n  savingsPercent: z.number(),\n  effort: z.enum([\"minimal\", \"moderate\", \"significant\"]),\n\n  // Details\n  title: z.string(),\n  description: z.string(),\n  currentState: z.string(),\n  recommendedAction: z.string(),\n\n  // Context\n  affectedModels: z.array(z.string()).default([]),\n  affectedProjects: z.array(z.string()).default([]),\n\n  // Implementation\n  implemented: z.boolean().default(false),\n  implementedAt: z.number().optional(),\n  actualSavings: z.number().optional(),\n});\nexport type CostOptimization = z.infer<typeof CostOptimizationSchema>;\n\n// =============================================================================\n// Reports\n// =============================================================================\n\nexport const CostReportTypeSchema = z.enum([\n  \"summary\",\n  \"detailed\",\n  \"comparison\",\n  \"forecast\",\n  \"optimization\",\n]);\nexport type CostReportType = z.infer<typeof CostReportTypeSchema>;\n\nexport const CostReportSchema = z.object({\n  id: z.string(),\n  type: CostReportTypeSchema,\n  generatedAt: z.number(),\n  period: AggregationPeriodSchema,\n  startTime: z.number(),\n  endTime: z.number(),\n\n  // Summary\n  totalCost: z.number(),\n  totalRequests: z.number(),\n  totalTokens: z.number(),\n\n  // Breakdown\n  aggregation: CostAggregationSchema,\n\n  // Comparison (if applicable)\n  previousPeriodCost: z.number().optional(),\n  costChange: z.number().optional(),\n  costChangePercent: z.number().optional(),\n\n  // Forecast (if applicable)\n  forecastedCost: z.number().optional(),\n  forecastConfidence: z.number().optional(),\n\n  // Top consumers\n  topModels: z.array(z.object({\n    model: z.string(),\n    cost: z.number(),\n    percent: z.number(),\n  })).default([]),\n  topProjects: z.array(z.object({\n    projectId: z.string(),\n    cost: z.number(),\n    percent: z.number(),\n  })).default([]),\n  topUsers: z.array(z.object({\n    userId: z.string(),\n    cost: z.number(),\n    percent: z.number(),\n  })).default([]),\n\n  // Optimizations\n  optimizations: z.array(CostOptimizationSchema).default([]),\n  potentialSavings: z.number().default(0),\n\n  // Alerts in period\n  alertCount: z.number().default(0),\n  budgetExceededCount: z.number().default(0),\n});\nexport type CostReport = z.infer<typeof CostReportSchema>;\n\n// =============================================================================\n// Configuration\n// =============================================================================\n\nexport const LLMCostTrackerConfigSchema = z.object({\n  // Tracking\n  enabled: z.boolean().default(true),\n  trackingLevel: z.enum([\"basic\", \"detailed\", \"full\"]).default(\"detailed\"),\n\n  // Storage\n  retentionDays: z.number().default(90),\n  aggregationEnabled: z.boolean().default(true),\n\n  // Budgets\n  budgetsEnabled: z.boolean().default(true),\n  defaultBudgetPeriod: BudgetPeriodSchema.default(\"monthly\"),\n\n  // Alerts\n  alertsEnabled: z.boolean().default(true),\n  alertCooldownMinutes: z.number().default(60),\n  dailySummaryEnabled: z.boolean().default(true),\n  dailySummaryHour: z.number().default(9).describe(\"Hour to send daily summary (0-23)\"),\n\n  // Optimization\n  optimizationScanEnabled: z.boolean().default(true),\n  optimizationScanIntervalHours: z.number().default(24),\n\n  // Anomaly detection\n  anomalyDetectionEnabled: z.boolean().default(true),\n  anomalyThresholdPercent: z.number().default(200).describe(\"Percent above average to trigger anomaly\"),\n\n  // Currency\n  currency: z.string().default(\"USD\"),\n  exchangeRateUpdateHours: z.number().default(24),\n\n  // Custom model pricing\n  customModelPricing: z.record(z.object({\n    inputPricePerMillion: z.number(),\n    outputPricePerMillion: z.number(),\n  })).optional(),\n});\nexport type LLMCostTrackerConfig = z.infer<typeof LLMCostTrackerConfigSchema>;\n\n// =============================================================================\n// Events\n// =============================================================================\n\nexport type LLMCostEvents = {\n  // Request tracking\n  requestTracked: (request: LLMRequest) => void;\n  requestFailed: (request: LLMRequest, error: Error) => void;\n\n  // Budget\n  budgetCreated: (budget: BudgetDefinition) => void;\n  budgetUpdated: (budget: BudgetDefinition) => void;\n  budgetDeleted: (budgetId: string) => void;\n  softLimitReached: (budget: BudgetDefinition, state: BudgetState) => void;\n  hardLimitReached: (budget: BudgetDefinition, state: BudgetState) => void;\n  budgetExceeded: (budget: BudgetDefinition, state: BudgetState) => void;\n  requestBlocked: (request: Partial<LLMRequest>, budget: BudgetDefinition) => void;\n\n  // Alerts\n  alertCreated: (alert: CostAlert) => void;\n  alertAcknowledged: (alert: CostAlert) => void;\n\n  // Optimization\n  optimizationFound: (optimization: CostOptimization) => void;\n\n  // Reports\n  reportGenerated: (report: CostReport) => void;\n\n  // Anomaly\n  anomalyDetected: (model: string, currentCost: number, averageCost: number) => void;\n\n  // Errors\n  error: (error: Error) => void;\n};\n\n// =============================================================================\n// Storage Interface\n// =============================================================================\n\nexport interface LLMCostStorage {\n  // Requests\n  saveRequest(request: LLMRequest): Promise<void>;\n  getRequests(filters: {\n    startTime?: number;\n    endTime?: number;\n    provider?: LLMProvider;\n    model?: string;\n    projectId?: string;\n    userId?: string;\n  }): Promise<LLMRequest[]>;\n\n  // Aggregations\n  saveAggregation(aggregation: CostAggregation): Promise<void>;\n  getAggregation(period: AggregationPeriod, startTime: number): Promise<CostAggregation | null>;\n  getAggregations(period: AggregationPeriod, startTime: number, endTime: number): Promise<CostAggregation[]>;\n\n  // Budgets\n  saveBudget(budget: BudgetDefinition): Promise<void>;\n  getBudget(id: string): Promise<BudgetDefinition | null>;\n  deleteBudget(id: string): Promise<void>;\n  listBudgets(): Promise<BudgetDefinition[]>;\n  saveBudgetState(state: BudgetState): Promise<void>;\n  getBudgetState(budgetId: string): Promise<BudgetState | null>;\n\n  // Alerts\n  saveAlert(alert: CostAlert): Promise<void>;\n  getAlerts(filters?: { acknowledged?: boolean; type?: CostAlertType }): Promise<CostAlert[]>;\n  acknowledgeAlert(alertId: string, acknowledgedBy: string): Promise<void>;\n\n  // Optimizations\n  saveOptimization(optimization: CostOptimization): Promise<void>;\n  getOptimizations(implemented?: boolean): Promise<CostOptimization[]>;\n\n  // Reports\n  saveReport(report: CostReport): Promise<void>;\n  getReport(id: string): Promise<CostReport | null>;\n  getReports(type?: CostReportType): Promise<CostReport[]>;\n}\n\n// =============================================================================\n// Model Pricing Database (Common Models)\n// =============================================================================\n\nexport const MODEL_PRICING: Record<string, Omit<ModelDefinition, \"id\">> = {\n  // OpenAI\n  \"gpt-4o\": {\n    provider: \"openai\",\n    name: \"gpt-4o\",\n    displayName: \"GPT-4o\",\n    tier: \"premium\",\n    capabilities: [\"chat\", \"vision\", \"function_calling\", \"streaming\"],\n    contextWindow: 128000,\n    maxOutputTokens: 16384,\n    inputPricePerMillion: 2.5,\n    outputPricePerMillion: 10,\n    cachedInputPricePerMillion: 1.25,\n    requestBaseCost: 0,\n  },\n  \"gpt-4o-mini\": {\n    provider: \"openai\",\n    name: \"gpt-4o-mini\",\n    displayName: \"GPT-4o Mini\",\n    tier: \"standard\",\n    capabilities: [\"chat\", \"vision\", \"function_calling\", \"streaming\"],\n    contextWindow: 128000,\n    maxOutputTokens: 16384,\n    inputPricePerMillion: 0.15,\n    outputPricePerMillion: 0.6,\n    cachedInputPricePerMillion: 0.075,\n    requestBaseCost: 0,\n  },\n  \"gpt-4-turbo\": {\n    provider: \"openai\",\n    name: \"gpt-4-turbo\",\n    displayName: \"GPT-4 Turbo\",\n    tier: \"premium\",\n    capabilities: [\"chat\", \"vision\", \"function_calling\", \"streaming\"],\n    contextWindow: 128000,\n    maxOutputTokens: 4096,\n    inputPricePerMillion: 10,\n    outputPricePerMillion: 30,\n    requestBaseCost: 0,\n  },\n  \"o1\": {\n    provider: \"openai\",\n    name: \"o1\",\n    displayName: \"o1\",\n    tier: \"enterprise\",\n    capabilities: [\"chat\", \"code\"],\n    contextWindow: 200000,\n    maxOutputTokens: 100000,\n    inputPricePerMillion: 15,\n    outputPricePerMillion: 60,\n    cachedInputPricePerMillion: 7.5,\n    requestBaseCost: 0,\n  },\n  \"o1-mini\": {\n    provider: \"openai\",\n    name: \"o1-mini\",\n    displayName: \"o1-mini\",\n    tier: \"premium\",\n    capabilities: [\"chat\", \"code\"],\n    contextWindow: 128000,\n    maxOutputTokens: 65536,\n    inputPricePerMillion: 3,\n    outputPricePerMillion: 12,\n    cachedInputPricePerMillion: 1.5,\n    requestBaseCost: 0,\n  },\n\n  // Anthropic\n  \"claude-3-5-sonnet-20241022\": {\n    provider: \"anthropic\",\n    name: \"claude-3-5-sonnet-20241022\",\n    displayName: \"Claude 3.5 Sonnet\",\n    tier: \"premium\",\n    capabilities: [\"chat\", \"vision\", \"code\", \"function_calling\", \"streaming\"],\n    contextWindow: 200000,\n    maxOutputTokens: 8192,\n    inputPricePerMillion: 3,\n    outputPricePerMillion: 15,\n    cachedInputPricePerMillion: 0.3,\n    requestBaseCost: 0,\n  },\n  \"claude-3-5-haiku-20241022\": {\n    provider: \"anthropic\",\n    name: \"claude-3-5-haiku-20241022\",\n    displayName: \"Claude 3.5 Haiku\",\n    tier: \"standard\",\n    capabilities: [\"chat\", \"vision\", \"code\", \"function_calling\", \"streaming\"],\n    contextWindow: 200000,\n    maxOutputTokens: 8192,\n    inputPricePerMillion: 0.8,\n    outputPricePerMillion: 4,\n    cachedInputPricePerMillion: 0.08,\n    requestBaseCost: 0,\n  },\n  \"claude-3-opus-20240229\": {\n    provider: \"anthropic\",\n    name: \"claude-3-opus-20240229\",\n    displayName: \"Claude 3 Opus\",\n    tier: \"enterprise\",\n    capabilities: [\"chat\", \"vision\", \"code\", \"function_calling\", \"streaming\"],\n    contextWindow: 200000,\n    maxOutputTokens: 4096,\n    inputPricePerMillion: 15,\n    outputPricePerMillion: 75,\n    cachedInputPricePerMillion: 1.5,\n    requestBaseCost: 0,\n  },\n\n  // Google\n  \"gemini-2.0-flash\": {\n    provider: \"google\",\n    name: \"gemini-2.0-flash\",\n    displayName: \"Gemini 2.0 Flash\",\n    tier: \"standard\",\n    capabilities: [\"chat\", \"vision\", \"code\", \"audio\", \"function_calling\", \"streaming\"],\n    contextWindow: 1048576,\n    maxOutputTokens: 8192,\n    inputPricePerMillion: 0.1,\n    outputPricePerMillion: 0.4,\n    requestBaseCost: 0,\n  },\n  \"gemini-1.5-pro\": {\n    provider: \"google\",\n    name: \"gemini-1.5-pro\",\n    displayName: \"Gemini 1.5 Pro\",\n    tier: \"premium\",\n    capabilities: [\"chat\", \"vision\", \"code\", \"audio\", \"function_calling\", \"streaming\"],\n    contextWindow: 2097152,\n    maxOutputTokens: 8192,\n    inputPricePerMillion: 1.25,\n    outputPricePerMillion: 5,\n    requestBaseCost: 0,\n  },\n\n  // Mistral\n  \"mistral-large-latest\": {\n    provider: \"mistral\",\n    name: \"mistral-large-latest\",\n    displayName: \"Mistral Large\",\n    tier: \"premium\",\n    capabilities: [\"chat\", \"code\", \"function_calling\", \"streaming\"],\n    contextWindow: 128000,\n    maxOutputTokens: 8192,\n    inputPricePerMillion: 2,\n    outputPricePerMillion: 6,\n    requestBaseCost: 0,\n  },\n  \"mistral-small-latest\": {\n    provider: \"mistral\",\n    name: \"mistral-small-latest\",\n    displayName: \"Mistral Small\",\n    tier: \"standard\",\n    capabilities: [\"chat\", \"code\", \"function_calling\", \"streaming\"],\n    contextWindow: 32000,\n    maxOutputTokens: 8192,\n    inputPricePerMillion: 0.2,\n    outputPricePerMillion: 0.6,\n    requestBaseCost: 0,\n  },\n\n  // Groq\n  \"llama-3.3-70b-versatile\": {\n    provider: \"groq\",\n    name: \"llama-3.3-70b-versatile\",\n    displayName: \"Llama 3.3 70B\",\n    tier: \"standard\",\n    capabilities: [\"chat\", \"code\", \"streaming\"],\n    contextWindow: 128000,\n    maxOutputTokens: 32768,\n    inputPricePerMillion: 0.59,\n    outputPricePerMillion: 0.79,\n    requestBaseCost: 0,\n  },\n  \"mixtral-8x7b-32768\": {\n    provider: \"groq\",\n    name: \"mixtral-8x7b-32768\",\n    displayName: \"Mixtral 8x7B\",\n    tier: \"standard\",\n    capabilities: [\"chat\", \"code\", \"streaming\"],\n    contextWindow: 32768,\n    maxOutputTokens: 8192,\n    inputPricePerMillion: 0.24,\n    outputPricePerMillion: 0.24,\n    requestBaseCost: 0,\n  },\n\n  // Embeddings\n  \"text-embedding-3-small\": {\n    provider: \"openai\",\n    name: \"text-embedding-3-small\",\n    displayName: \"Text Embedding 3 Small\",\n    tier: \"standard\",\n    capabilities: [\"embedding\"],\n    contextWindow: 8191,\n    inputPricePerMillion: 0.02,\n    outputPricePerMillion: 0,\n    requestBaseCost: 0,\n  },\n  \"text-embedding-3-large\": {\n    provider: \"openai\",\n    name: \"text-embedding-3-large\",\n    displayName: \"Text Embedding 3 Large\",\n    tier: \"standard\",\n    capabilities: [\"embedding\"],\n    contextWindow: 8191,\n    inputPricePerMillion: 0.13,\n    outputPricePerMillion: 0,\n    requestBaseCost: 0,\n  },\n};\n\n// =============================================================================\n// Helpers\n// =============================================================================\n\nexport function calculateRequestCost(\n  model: string,\n  usage: TokenUsage,\n  customPricing?: { inputPricePerMillion: number; outputPricePerMillion: number }\n): { inputCost: number; outputCost: number; cachedCost: number; totalCost: number } {\n  const pricing = customPricing || MODEL_PRICING[model];\n\n  if (!pricing) {\n    return { inputCost: 0, outputCost: 0, cachedCost: 0, totalCost: 0 };\n  }\n\n  const inputCost = (usage.inputTokens / 1_000_000) * pricing.inputPricePerMillion;\n  const outputCost = (usage.outputTokens / 1_000_000) * pricing.outputPricePerMillion;\n  const cachedCost = pricing.cachedInputPricePerMillion\n    ? (usage.cachedTokens / 1_000_000) * pricing.cachedInputPricePerMillion\n    : 0;\n  const baseCost = \"requestBaseCost\" in pricing ? pricing.requestBaseCost || 0 : 0;\n\n  return {\n    inputCost,\n    outputCost,\n    cachedCost,\n    totalCost: inputCost + outputCost + cachedCost + baseCost,\n  };\n}\n\nexport function getPeriodBounds(period: BudgetPeriod, referenceDate?: Date): { start: number; end: number } {\n  const now = referenceDate || new Date();\n\n  switch (period) {\n    case \"daily\": {\n      const start = new Date(now);\n      start.setHours(0, 0, 0, 0);\n      const end = new Date(start);\n      end.setDate(end.getDate() + 1);\n      return { start: start.getTime(), end: end.getTime() };\n    }\n    case \"weekly\": {\n      const start = new Date(now);\n      start.setDate(start.getDate() - start.getDay());\n      start.setHours(0, 0, 0, 0);\n      const end = new Date(start);\n      end.setDate(end.getDate() + 7);\n      return { start: start.getTime(), end: end.getTime() };\n    }\n    case \"monthly\": {\n      const start = new Date(now.getFullYear(), now.getMonth(), 1);\n      const end = new Date(now.getFullYear(), now.getMonth() + 1, 1);\n      return { start: start.getTime(), end: end.getTime() };\n    }\n    case \"quarterly\": {\n      const quarter = Math.floor(now.getMonth() / 3);\n      const start = new Date(now.getFullYear(), quarter * 3, 1);\n      const end = new Date(now.getFullYear(), (quarter + 1) * 3, 1);\n      return { start: start.getTime(), end: end.getTime() };\n    }\n    case \"yearly\": {\n      const start = new Date(now.getFullYear(), 0, 1);\n      const end = new Date(now.getFullYear() + 1, 0, 1);\n      return { start: start.getTime(), end: end.getTime() };\n    }\n    default:\n      return { start: now.getTime(), end: now.getTime() + 30 * 24 * 60 * 60 * 1000 };\n  }\n}\n\nexport function formatCost(amount: number, currency: string = \"USD\"): string {\n  return new Intl.NumberFormat(\"en-US\", {\n    style: \"currency\",\n    currency,\n    minimumFractionDigits: 2,\n    maximumFractionDigits: 4,\n  }).format(amount);\n}\n\nexport function formatTokenCount(tokens: number): string {\n  if (tokens >= 1_000_000) {\n    return `${(tokens / 1_000_000).toFixed(2)}M`;\n  }\n  if (tokens >= 1_000) {\n    return `${(tokens / 1_000).toFixed(1)}K`;\n  }\n  return tokens.toString();\n}\n","/**\n * LLM Cost Tracker Implementation\n * Phase 16A: AI Operations - Cost Tracking & Budgeting\n */\n\nimport { EventEmitter } from \"eventemitter3\";\nimport { randomUUID } from \"crypto\";\nimport {\n  type LLMCostTrackerConfig,\n  LLMCostTrackerConfigSchema,\n  type LLMCostEvents,\n  type LLMCostStorage,\n  type LLMRequest,\n  type TokenUsage,\n  type LLMProvider,\n  type CostAggregation,\n  type AggregationPeriod,\n  type BudgetDefinition,\n  type BudgetState,\n  type BudgetStatus,\n  type CostAlert,\n  type CostAlertType,\n  type CostOptimization,\n  type CostReport,\n  type CostReportType,\n  MODEL_PRICING,\n  calculateRequestCost,\n  getPeriodBounds,\n  formatCost,\n  formatTokenCount,\n} from \"./types.js\";\n\n// =============================================================================\n// In-Memory Storage\n// =============================================================================\n\nclass InMemoryLLMCostStorage implements LLMCostStorage {\n  private requests: Map<string, LLMRequest> = new Map();\n  private aggregations: Map<string, CostAggregation> = new Map();\n  private budgets: Map<string, BudgetDefinition> = new Map();\n  private budgetStates: Map<string, BudgetState> = new Map();\n  private alerts: Map<string, CostAlert> = new Map();\n  private optimizations: Map<string, CostOptimization> = new Map();\n  private reports: Map<string, CostReport> = new Map();\n\n  async saveRequest(request: LLMRequest): Promise<void> {\n    this.requests.set(request.id, request);\n  }\n\n  async getRequests(filters: {\n    startTime?: number;\n    endTime?: number;\n    provider?: LLMProvider;\n    model?: string;\n    projectId?: string;\n    userId?: string;\n  }): Promise<LLMRequest[]> {\n    return Array.from(this.requests.values()).filter((req) => {\n      if (filters.startTime && req.timestamp < filters.startTime) return false;\n      if (filters.endTime && req.timestamp > filters.endTime) return false;\n      if (filters.provider && req.provider !== filters.provider) return false;\n      if (filters.model && req.model !== filters.model) return false;\n      if (filters.projectId && req.projectId !== filters.projectId) return false;\n      if (filters.userId && req.userId !== filters.userId) return false;\n      return true;\n    });\n  }\n\n  async saveAggregation(aggregation: CostAggregation): Promise<void> {\n    const key = `${aggregation.period}-${aggregation.startTime}`;\n    this.aggregations.set(key, aggregation);\n  }\n\n  async getAggregation(period: AggregationPeriod, startTime: number): Promise<CostAggregation | null> {\n    const key = `${period}-${startTime}`;\n    return this.aggregations.get(key) || null;\n  }\n\n  async getAggregations(\n    period: AggregationPeriod,\n    startTime: number,\n    endTime: number\n  ): Promise<CostAggregation[]> {\n    return Array.from(this.aggregations.values()).filter(\n      (agg) =>\n        agg.period === period &&\n        agg.startTime >= startTime &&\n        agg.endTime <= endTime\n    );\n  }\n\n  async saveBudget(budget: BudgetDefinition): Promise<void> {\n    this.budgets.set(budget.id, budget);\n  }\n\n  async getBudget(id: string): Promise<BudgetDefinition | null> {\n    return this.budgets.get(id) || null;\n  }\n\n  async deleteBudget(id: string): Promise<void> {\n    this.budgets.delete(id);\n    this.budgetStates.delete(id);\n  }\n\n  async listBudgets(): Promise<BudgetDefinition[]> {\n    return Array.from(this.budgets.values());\n  }\n\n  async saveBudgetState(state: BudgetState): Promise<void> {\n    this.budgetStates.set(state.budgetId, state);\n  }\n\n  async getBudgetState(budgetId: string): Promise<BudgetState | null> {\n    return this.budgetStates.get(budgetId) || null;\n  }\n\n  async saveAlert(alert: CostAlert): Promise<void> {\n    this.alerts.set(alert.id, alert);\n  }\n\n  async getAlerts(filters?: { acknowledged?: boolean; type?: CostAlertType }): Promise<CostAlert[]> {\n    return Array.from(this.alerts.values()).filter((alert) => {\n      if (filters?.acknowledged !== undefined && alert.acknowledged !== filters.acknowledged) return false;\n      if (filters?.type && alert.type !== filters.type) return false;\n      return true;\n    });\n  }\n\n  async acknowledgeAlert(alertId: string, acknowledgedBy: string): Promise<void> {\n    const alert = this.alerts.get(alertId);\n    if (alert) {\n      alert.acknowledged = true;\n      alert.acknowledgedBy = acknowledgedBy;\n      alert.acknowledgedAt = Date.now();\n    }\n  }\n\n  async saveOptimization(optimization: CostOptimization): Promise<void> {\n    this.optimizations.set(optimization.id, optimization);\n  }\n\n  async getOptimizations(implemented?: boolean): Promise<CostOptimization[]> {\n    return Array.from(this.optimizations.values()).filter((opt) => {\n      if (implemented !== undefined && opt.implemented !== implemented) return false;\n      return true;\n    });\n  }\n\n  async saveReport(report: CostReport): Promise<void> {\n    this.reports.set(report.id, report);\n  }\n\n  async getReport(id: string): Promise<CostReport | null> {\n    return this.reports.get(id) || null;\n  }\n\n  async getReports(type?: CostReportType): Promise<CostReport[]> {\n    return Array.from(this.reports.values()).filter((report) => {\n      if (type && report.type !== type) return false;\n      return true;\n    });\n  }\n}\n\n// =============================================================================\n// LLM Cost Tracker\n// =============================================================================\n\nexport class LLMCostTracker extends EventEmitter<LLMCostEvents> {\n  private config: LLMCostTrackerConfig;\n  private storage: LLMCostStorage;\n  private alertCooldowns: Map<string, number> = new Map();\n  private aggregationIntervals: Map<string, NodeJS.Timeout> = new Map();\n  private started: boolean = false;\n\n  constructor(config: Partial<LLMCostTrackerConfig> = {}, storage?: LLMCostStorage) {\n    super();\n    this.config = LLMCostTrackerConfigSchema.parse(config);\n    this.storage = storage || new InMemoryLLMCostStorage();\n  }\n\n  // ===========================================================================\n  // Lifecycle\n  // ===========================================================================\n\n  async start(): Promise<void> {\n    if (this.started) return;\n\n    if (this.config.aggregationEnabled) {\n      this.startAggregationTimers();\n    }\n\n    if (this.config.optimizationScanEnabled) {\n      this.scheduleOptimizationScan();\n    }\n\n    this.started = true;\n  }\n\n  async stop(): Promise<void> {\n    for (const interval of this.aggregationIntervals.values()) {\n      clearInterval(interval);\n    }\n    this.aggregationIntervals.clear();\n    this.started = false;\n  }\n\n  // ===========================================================================\n  // Request Tracking\n  // ===========================================================================\n\n  async trackRequest(input: {\n    provider: LLMProvider;\n    model: string;\n    requestType?: \"completion\" | \"chat\" | \"embedding\" | \"image\" | \"audio\" | \"function\";\n    streaming?: boolean;\n    usage: TokenUsage;\n    latencyMs?: number;\n    timeToFirstTokenMs?: number;\n    projectId?: string;\n    userId?: string;\n    sessionId?: string;\n    tags?: string[];\n    metadata?: Record<string, unknown>;\n    success?: boolean;\n    errorCode?: string;\n    errorMessage?: string;\n  }): Promise<LLMRequest> {\n    if (!this.config.enabled) {\n      throw new Error(\"Cost tracking is disabled\");\n    }\n\n    // Calculate cost\n    const customPricing = this.config.customModelPricing?.[input.model];\n    const costs = calculateRequestCost(input.model, input.usage, customPricing);\n\n    const request: LLMRequest = {\n      id: randomUUID(),\n      timestamp: Date.now(),\n      provider: input.provider,\n      model: input.model,\n      requestType: input.requestType || \"chat\",\n      streaming: input.streaming || false,\n      usage: {\n        ...input.usage,\n        totalTokens: input.usage.inputTokens + input.usage.outputTokens,\n      },\n      ...costs,\n      latencyMs: input.latencyMs,\n      timeToFirstTokenMs: input.timeToFirstTokenMs,\n      projectId: input.projectId,\n      userId: input.userId,\n      sessionId: input.sessionId,\n      tags: input.tags || [],\n      metadata: input.metadata,\n      success: input.success ?? true,\n      errorCode: input.errorCode,\n      errorMessage: input.errorMessage,\n    };\n\n    // Check budgets before saving\n    const budgetCheck = await this.checkBudgets(request);\n    if (budgetCheck.blocked) {\n      this.emit(\"requestBlocked\", request, budgetCheck.budget!);\n      throw new Error(`Request blocked: Budget \"${budgetCheck.budget!.name}\" hard limit reached`);\n    }\n\n    // Save request\n    await this.storage.saveRequest(request);\n\n    // Update budget states\n    await this.updateBudgetStates(request);\n\n    this.emit(\"requestTracked\", request);\n\n    return request;\n  }\n\n  // ===========================================================================\n  // Budget Management\n  // ===========================================================================\n\n  async createBudget(input: Omit<BudgetDefinition, \"id\" | \"createdAt\" | \"updatedAt\">): Promise<BudgetDefinition> {\n    const budget: BudgetDefinition = {\n      ...input,\n      id: randomUUID(),\n      createdAt: Date.now(),\n      updatedAt: Date.now(),\n    };\n\n    await this.storage.saveBudget(budget);\n\n    // Initialize budget state\n    const { start, end } = getPeriodBounds(budget.period);\n    const state: BudgetState = {\n      budgetId: budget.id,\n      periodStart: start,\n      periodEnd: end,\n      currentSpend: 0,\n      remainingBudget: budget.budgetAmount,\n      percentUsed: 0,\n      status: \"under_budget\",\n      rolloverAmount: 0,\n      effectiveBudget: budget.budgetAmount,\n      lastUpdated: Date.now(),\n    };\n    await this.storage.saveBudgetState(state);\n\n    this.emit(\"budgetCreated\", budget);\n    return budget;\n  }\n\n  async updateBudget(\n    id: string,\n    updates: Partial<Omit<BudgetDefinition, \"id\" | \"createdAt\" | \"updatedAt\">>\n  ): Promise<BudgetDefinition | null> {\n    const budget = await this.storage.getBudget(id);\n    if (!budget) return null;\n\n    const updated: BudgetDefinition = {\n      ...budget,\n      ...updates,\n      updatedAt: Date.now(),\n    };\n\n    await this.storage.saveBudget(updated);\n    this.emit(\"budgetUpdated\", updated);\n    return updated;\n  }\n\n  async deleteBudget(id: string): Promise<boolean> {\n    const budget = await this.storage.getBudget(id);\n    if (!budget) return false;\n\n    await this.storage.deleteBudget(id);\n    this.emit(\"budgetDeleted\", id);\n    return true;\n  }\n\n  async getBudget(id: string): Promise<BudgetDefinition | null> {\n    return this.storage.getBudget(id);\n  }\n\n  async listBudgets(): Promise<BudgetDefinition[]> {\n    return this.storage.listBudgets();\n  }\n\n  async getBudgetState(budgetId: string): Promise<BudgetState | null> {\n    return this.storage.getBudgetState(budgetId);\n  }\n\n  private async checkBudgets(request: Partial<LLMRequest>): Promise<{\n    blocked: boolean;\n    budget?: BudgetDefinition;\n    state?: BudgetState;\n  }> {\n    const budgets = await this.storage.listBudgets();\n\n    for (const budget of budgets) {\n      if (!budget.enabled || !budget.blockOnHardLimit) continue;\n\n      const matches = this.budgetMatchesRequest(budget, request);\n      if (!matches) continue;\n\n      const state = await this.storage.getBudgetState(budget.id);\n      if (!state) continue;\n\n      if (state.percentUsed >= budget.hardLimitPercent) {\n        return { blocked: true, budget, state };\n      }\n    }\n\n    return { blocked: false };\n  }\n\n  private budgetMatchesRequest(budget: BudgetDefinition, request: Partial<LLMRequest>): boolean {\n    switch (budget.scope) {\n      case \"global\":\n        return true;\n      case \"provider\":\n        return request.provider === budget.scopeId;\n      case \"model\":\n        return request.model === budget.scopeId;\n      case \"project\":\n        return request.projectId === budget.scopeId;\n      case \"user\":\n        return request.userId === budget.scopeId;\n      case \"tag\":\n        return request.tags?.includes(budget.scopeId || \"\") || false;\n      default:\n        return false;\n    }\n  }\n\n  private async updateBudgetStates(request: LLMRequest): Promise<void> {\n    const budgets = await this.storage.listBudgets();\n\n    for (const budget of budgets) {\n      if (!budget.enabled) continue;\n\n      const matches = this.budgetMatchesRequest(budget, request);\n      if (!matches) continue;\n\n      let state = await this.storage.getBudgetState(budget.id);\n\n      // Check if period has rolled over\n      const { start, end } = getPeriodBounds(budget.period);\n      if (!state || state.periodEnd <= Date.now()) {\n        // Calculate rollover\n        const rollover = state && budget.rolloverEnabled\n          ? Math.min(\n              state.remainingBudget,\n              budget.budgetAmount * (budget.maxRolloverPercent / 100)\n            )\n          : 0;\n\n        state = {\n          budgetId: budget.id,\n          periodStart: start,\n          periodEnd: end,\n          currentSpend: 0,\n          remainingBudget: budget.budgetAmount + rollover,\n          percentUsed: 0,\n          status: \"under_budget\",\n          rolloverAmount: rollover,\n          effectiveBudget: budget.budgetAmount + rollover,\n          lastUpdated: Date.now(),\n        };\n      }\n\n      // Update state with new request\n      state.currentSpend += request.totalCost;\n      state.remainingBudget = state.effectiveBudget - state.currentSpend;\n      state.percentUsed = (state.currentSpend / state.effectiveBudget) * 100;\n      state.lastUpdated = Date.now();\n\n      // Update status and check alerts\n      const prevStatus = state.status;\n      state.status = this.calculateBudgetStatus(budget, state);\n\n      await this.storage.saveBudgetState(state);\n\n      // Emit alerts for status changes\n      if (state.status !== prevStatus) {\n        await this.handleBudgetStatusChange(budget, state, prevStatus);\n      }\n    }\n  }\n\n  private calculateBudgetStatus(budget: BudgetDefinition, state: BudgetState): BudgetStatus {\n    if (state.percentUsed > 100) return \"exceeded\";\n    if (state.percentUsed >= budget.hardLimitPercent) return \"hard_limit\";\n    if (state.percentUsed >= budget.softLimitPercent) return \"soft_limit\";\n    return \"under_budget\";\n  }\n\n  private async handleBudgetStatusChange(\n    budget: BudgetDefinition,\n    state: BudgetState,\n    prevStatus: BudgetStatus\n  ): Promise<void> {\n    const cooldownKey = `${budget.id}-${state.status}`;\n    const lastAlert = this.alertCooldowns.get(cooldownKey);\n    const cooldownMs = this.config.alertCooldownMinutes * 60 * 1000;\n\n    if (lastAlert && Date.now() - lastAlert < cooldownMs) {\n      return;\n    }\n\n    let alertType: CostAlertType | null = null;\n    let severity: \"info\" | \"warning\" | \"critical\" = \"info\";\n\n    switch (state.status) {\n      case \"soft_limit\":\n        if (budget.alertOnSoftLimit && prevStatus === \"under_budget\") {\n          alertType = \"soft_limit_reached\";\n          severity = \"warning\";\n          this.emit(\"softLimitReached\", budget, state);\n        }\n        break;\n      case \"hard_limit\":\n        if (budget.alertOnHardLimit) {\n          alertType = \"hard_limit_reached\";\n          severity = \"critical\";\n          this.emit(\"hardLimitReached\", budget, state);\n        }\n        break;\n      case \"exceeded\":\n        alertType = \"budget_exceeded\";\n        severity = \"critical\";\n        this.emit(\"budgetExceeded\", budget, state);\n        break;\n    }\n\n    if (alertType) {\n      const alert = await this.createAlert({\n        type: alertType,\n        severity,\n        budgetId: budget.id,\n        scope: budget.scope,\n        scopeId: budget.scopeId,\n        title: `Budget \"${budget.name}\" - ${state.status.replace(\"_\", \" \").toUpperCase()}`,\n        message: `Current spend: ${formatCost(state.currentSpend)} (${state.percentUsed.toFixed(1)}% of ${formatCost(state.effectiveBudget)})`,\n        currentSpend: state.currentSpend,\n        threshold: state.effectiveBudget * (budget.hardLimitPercent / 100),\n        percentUsed: state.percentUsed,\n        recommendations: this.generateBudgetRecommendations(budget, state),\n      });\n\n      this.alertCooldowns.set(cooldownKey, Date.now());\n    }\n  }\n\n  private generateBudgetRecommendations(budget: BudgetDefinition, state: BudgetState): string[] {\n    const recommendations: string[] = [];\n\n    if (state.percentUsed > 80) {\n      recommendations.push(\"Consider switching to more cost-effective models for non-critical tasks\");\n      recommendations.push(\"Review recent usage patterns for optimization opportunities\");\n    }\n\n    if (state.percentUsed > 95) {\n      recommendations.push(\"Immediate action required to avoid service interruption\");\n      recommendations.push(\"Consider increasing budget or implementing request quotas\");\n    }\n\n    return recommendations;\n  }\n\n  // ===========================================================================\n  // Alerts\n  // ===========================================================================\n\n  async createAlert(input: Omit<CostAlert, \"id\" | \"timestamp\" | \"acknowledged\">): Promise<CostAlert> {\n    const alert: CostAlert = {\n      ...input,\n      id: randomUUID(),\n      timestamp: Date.now(),\n      acknowledged: false,\n    };\n\n    await this.storage.saveAlert(alert);\n    this.emit(\"alertCreated\", alert);\n    return alert;\n  }\n\n  async acknowledgeAlert(alertId: string, acknowledgedBy: string): Promise<void> {\n    await this.storage.acknowledgeAlert(alertId, acknowledgedBy);\n    const alerts = await this.storage.getAlerts();\n    const alert = alerts.find((a) => a.id === alertId);\n    if (alert) {\n      this.emit(\"alertAcknowledged\", alert);\n    }\n  }\n\n  async getAlerts(filters?: { acknowledged?: boolean; type?: CostAlertType }): Promise<CostAlert[]> {\n    return this.storage.getAlerts(filters);\n  }\n\n  // ===========================================================================\n  // Aggregation\n  // ===========================================================================\n\n  async aggregate(period: AggregationPeriod, startTime?: number, endTime?: number): Promise<CostAggregation> {\n    const bounds = startTime\n      ? { start: startTime, end: endTime || Date.now() }\n      : this.getAggregationBounds(period);\n\n    const requests = await this.storage.getRequests({\n      startTime: bounds.start,\n      endTime: bounds.end,\n    });\n\n    const aggregation: CostAggregation = {\n      period,\n      startTime: bounds.start,\n      endTime: bounds.end,\n      totalRequests: requests.length,\n      totalTokens: 0,\n      totalInputTokens: 0,\n      totalOutputTokens: 0,\n      totalCachedTokens: 0,\n      totalCost: 0,\n      byProvider: {},\n      byModel: {},\n      byProject: {},\n      byUser: {},\n      avgCostPerRequest: 0,\n      avgTokensPerRequest: 0,\n      avgLatencyMs: 0,\n      successRate: 0,\n      errorCount: 0,\n    };\n\n    let totalLatency = 0;\n    let latencyCount = 0;\n\n    for (const req of requests) {\n      // Totals\n      aggregation.totalTokens += req.usage.totalTokens;\n      aggregation.totalInputTokens += req.usage.inputTokens;\n      aggregation.totalOutputTokens += req.usage.outputTokens;\n      aggregation.totalCachedTokens += req.usage.cachedTokens;\n      aggregation.totalCost += req.totalCost;\n\n      // By provider\n      if (!aggregation.byProvider[req.provider]) {\n        aggregation.byProvider[req.provider] = { requests: 0, tokens: 0, cost: 0 };\n      }\n      aggregation.byProvider[req.provider].requests++;\n      aggregation.byProvider[req.provider].tokens += req.usage.totalTokens;\n      aggregation.byProvider[req.provider].cost += req.totalCost;\n\n      // By model\n      if (!aggregation.byModel[req.model]) {\n        aggregation.byModel[req.model] = { requests: 0, tokens: 0, cost: 0 };\n      }\n      aggregation.byModel[req.model].requests++;\n      aggregation.byModel[req.model].tokens += req.usage.totalTokens;\n      aggregation.byModel[req.model].cost += req.totalCost;\n\n      // By project\n      if (req.projectId) {\n        if (!aggregation.byProject[req.projectId]) {\n          aggregation.byProject[req.projectId] = { requests: 0, tokens: 0, cost: 0 };\n        }\n        aggregation.byProject[req.projectId].requests++;\n        aggregation.byProject[req.projectId].tokens += req.usage.totalTokens;\n        aggregation.byProject[req.projectId].cost += req.totalCost;\n      }\n\n      // By user\n      if (req.userId) {\n        if (!aggregation.byUser[req.userId]) {\n          aggregation.byUser[req.userId] = { requests: 0, tokens: 0, cost: 0 };\n        }\n        aggregation.byUser[req.userId].requests++;\n        aggregation.byUser[req.userId].tokens += req.usage.totalTokens;\n        aggregation.byUser[req.userId].cost += req.totalCost;\n      }\n\n      // Latency\n      if (req.latencyMs) {\n        totalLatency += req.latencyMs;\n        latencyCount++;\n      }\n\n      // Errors\n      if (!req.success) {\n        aggregation.errorCount++;\n      }\n    }\n\n    // Calculate averages\n    if (requests.length > 0) {\n      aggregation.avgCostPerRequest = aggregation.totalCost / requests.length;\n      aggregation.avgTokensPerRequest = aggregation.totalTokens / requests.length;\n      aggregation.successRate = ((requests.length - aggregation.errorCount) / requests.length) * 100;\n    }\n\n    if (latencyCount > 0) {\n      aggregation.avgLatencyMs = totalLatency / latencyCount;\n    }\n\n    await this.storage.saveAggregation(aggregation);\n    return aggregation;\n  }\n\n  private getAggregationBounds(period: AggregationPeriod): { start: number; end: number } {\n    const now = new Date();\n    let start: Date;\n\n    switch (period) {\n      case \"hour\":\n        start = new Date(now);\n        start.setMinutes(0, 0, 0);\n        return { start: start.getTime(), end: now.getTime() };\n      case \"day\":\n        start = new Date(now);\n        start.setHours(0, 0, 0, 0);\n        return { start: start.getTime(), end: now.getTime() };\n      case \"week\":\n        start = new Date(now);\n        start.setDate(start.getDate() - start.getDay());\n        start.setHours(0, 0, 0, 0);\n        return { start: start.getTime(), end: now.getTime() };\n      case \"month\":\n        start = new Date(now.getFullYear(), now.getMonth(), 1);\n        return { start: start.getTime(), end: now.getTime() };\n      case \"quarter\":\n        const quarter = Math.floor(now.getMonth() / 3);\n        start = new Date(now.getFullYear(), quarter * 3, 1);\n        return { start: start.getTime(), end: now.getTime() };\n      case \"year\":\n        start = new Date(now.getFullYear(), 0, 1);\n        return { start: start.getTime(), end: now.getTime() };\n    }\n  }\n\n  private startAggregationTimers(): void {\n    // Hourly aggregation\n    const hourlyInterval = setInterval(async () => {\n      try {\n        await this.aggregate(\"hour\");\n      } catch (error) {\n        this.emit(\"error\", error as Error);\n      }\n    }, 60 * 60 * 1000);\n    this.aggregationIntervals.set(\"hourly\", hourlyInterval);\n\n    // Daily aggregation\n    const dailyInterval = setInterval(async () => {\n      try {\n        await this.aggregate(\"day\");\n        if (this.config.dailySummaryEnabled) {\n          await this.generateDailySummary();\n        }\n      } catch (error) {\n        this.emit(\"error\", error as Error);\n      }\n    }, 24 * 60 * 60 * 1000);\n    this.aggregationIntervals.set(\"daily\", dailyInterval);\n  }\n\n  private async generateDailySummary(): Promise<void> {\n    const report = await this.generateReport(\"summary\", \"day\");\n    await this.createAlert({\n      type: \"daily_summary\",\n      severity: \"info\",\n      title: \"Daily Cost Summary\",\n      message: `Total spend: ${formatCost(report.totalCost)} | Requests: ${report.totalRequests} | Tokens: ${formatTokenCount(report.totalTokens)}`,\n      currentSpend: report.totalCost,\n      recommendations: [],\n    });\n  }\n\n  // ===========================================================================\n  // Reports\n  // ===========================================================================\n\n  async generateReport(type: CostReportType, period: AggregationPeriod): Promise<CostReport> {\n    const aggregation = await this.aggregate(period);\n\n    // Get previous period for comparison\n    const periodMs = aggregation.endTime - aggregation.startTime;\n    const prevRequests = await this.storage.getRequests({\n      startTime: aggregation.startTime - periodMs,\n      endTime: aggregation.startTime,\n    });\n    const previousPeriodCost = prevRequests.reduce((sum, r) => sum + r.totalCost, 0);\n\n    // Top consumers\n    const topModels = Object.entries(aggregation.byModel)\n      .map(([model, data]) => ({\n        model,\n        cost: data.cost,\n        percent: aggregation.totalCost > 0 ? (data.cost / aggregation.totalCost) * 100 : 0,\n      }))\n      .sort((a, b) => b.cost - a.cost)\n      .slice(0, 10);\n\n    const topProjects = Object.entries(aggregation.byProject)\n      .map(([projectId, data]) => ({\n        projectId,\n        cost: data.cost,\n        percent: aggregation.totalCost > 0 ? (data.cost / aggregation.totalCost) * 100 : 0,\n      }))\n      .sort((a, b) => b.cost - a.cost)\n      .slice(0, 10);\n\n    const topUsers = Object.entries(aggregation.byUser)\n      .map(([userId, data]) => ({\n        userId,\n        cost: data.cost,\n        percent: aggregation.totalCost > 0 ? (data.cost / aggregation.totalCost) * 100 : 0,\n      }))\n      .sort((a, b) => b.cost - a.cost)\n      .slice(0, 10);\n\n    // Get optimizations\n    const optimizations = await this.storage.getOptimizations(false);\n    const potentialSavings = optimizations.reduce((sum, o) => sum + o.estimatedSavings, 0);\n\n    // Get alerts\n    const alerts = await this.storage.getAlerts();\n    const periodAlerts = alerts.filter(\n      (a) => a.timestamp >= aggregation.startTime && a.timestamp <= aggregation.endTime\n    );\n\n    const report: CostReport = {\n      id: randomUUID(),\n      type,\n      generatedAt: Date.now(),\n      period,\n      startTime: aggregation.startTime,\n      endTime: aggregation.endTime,\n      totalCost: aggregation.totalCost,\n      totalRequests: aggregation.totalRequests,\n      totalTokens: aggregation.totalTokens,\n      aggregation,\n      previousPeriodCost,\n      costChange: aggregation.totalCost - previousPeriodCost,\n      costChangePercent: previousPeriodCost > 0\n        ? ((aggregation.totalCost - previousPeriodCost) / previousPeriodCost) * 100\n        : 0,\n      topModels,\n      topProjects,\n      topUsers,\n      optimizations,\n      potentialSavings,\n      alertCount: periodAlerts.length,\n      budgetExceededCount: periodAlerts.filter((a) => a.type === \"budget_exceeded\").length,\n    };\n\n    await this.storage.saveReport(report);\n    this.emit(\"reportGenerated\", report);\n    return report;\n  }\n\n  async getReport(id: string): Promise<CostReport | null> {\n    return this.storage.getReport(id);\n  }\n\n  async getReports(type?: CostReportType): Promise<CostReport[]> {\n    return this.storage.getReports(type);\n  }\n\n  // ===========================================================================\n  // Cost Optimization\n  // ===========================================================================\n\n  async scanForOptimizations(): Promise<CostOptimization[]> {\n    const optimizations: CostOptimization[] = [];\n    const aggregation = await this.aggregate(\"month\");\n\n    // Check for model downgrade opportunities\n    const premiumModels = [\"gpt-4o\", \"gpt-4-turbo\", \"claude-3-opus-20240229\", \"claude-3-5-sonnet-20241022\"];\n    const economyAlternatives: Record<string, string> = {\n      \"gpt-4o\": \"gpt-4o-mini\",\n      \"gpt-4-turbo\": \"gpt-4o-mini\",\n      \"claude-3-opus-20240229\": \"claude-3-5-haiku-20241022\",\n      \"claude-3-5-sonnet-20241022\": \"claude-3-5-haiku-20241022\",\n    };\n\n    for (const [model, data] of Object.entries(aggregation.byModel)) {\n      if (premiumModels.includes(model) && data.cost > 10) {\n        const alternative = economyAlternatives[model];\n        if (alternative) {\n          const altPricing = MODEL_PRICING[alternative];\n          const currentPricing = MODEL_PRICING[model];\n\n          if (altPricing && currentPricing) {\n            const savingsRatio = 1 - (altPricing.inputPricePerMillion / currentPricing.inputPricePerMillion);\n            const estimatedSavings = data.cost * savingsRatio * 0.5; // Assume 50% of requests could use cheaper model\n\n            if (estimatedSavings > 1) {\n              const optimization: CostOptimization = {\n                id: randomUUID(),\n                type: \"model_downgrade\",\n                priority: estimatedSavings > 50 ? \"high\" : estimatedSavings > 10 ? \"medium\" : \"low\",\n                timestamp: Date.now(),\n                estimatedSavings,\n                savingsPercent: savingsRatio * 50,\n                effort: \"minimal\",\n                title: `Consider using ${alternative} instead of ${model}`,\n                description: `${data.requests} requests used ${model}. For simpler tasks, ${alternative} can provide similar quality at lower cost.`,\n                currentState: `Using ${model} for all requests (${formatCost(data.cost)}/month)`,\n                recommendedAction: `Route simple requests to ${alternative}`,\n                affectedModels: [model],\n                implemented: false,\n              };\n\n              optimizations.push(optimization);\n              await this.storage.saveOptimization(optimization);\n              this.emit(\"optimizationFound\", optimization);\n            }\n          }\n        }\n      }\n    }\n\n    // Check for caching opportunities (high token usage with similar patterns)\n    if (aggregation.totalCachedTokens / aggregation.totalInputTokens < 0.1) {\n      const cachingSavings = aggregation.totalCost * 0.2; // Estimate 20% savings with caching\n\n      if (cachingSavings > 5) {\n        const optimization: CostOptimization = {\n          id: randomUUID(),\n          type: \"caching_opportunity\",\n          priority: cachingSavings > 50 ? \"high\" : \"medium\",\n          timestamp: Date.now(),\n          estimatedSavings: cachingSavings,\n          savingsPercent: 20,\n          effort: \"moderate\",\n          title: \"Enable prompt caching for repeated context\",\n          description: `Only ${((aggregation.totalCachedTokens / aggregation.totalInputTokens) * 100).toFixed(1)}% of input tokens are cached. Caching can reduce costs significantly.`,\n          currentState: `Cache hit rate: ${((aggregation.totalCachedTokens / aggregation.totalInputTokens) * 100).toFixed(1)}%`,\n          recommendedAction: \"Implement prompt caching for system prompts and repeated context\",\n          affectedModels: Object.keys(aggregation.byModel),\n          implemented: false,\n        };\n\n        optimizations.push(optimization);\n        await this.storage.saveOptimization(optimization);\n        this.emit(\"optimizationFound\", optimization);\n      }\n    }\n\n    return optimizations;\n  }\n\n  private scheduleOptimizationScan(): void {\n    const interval = setInterval(async () => {\n      try {\n        await this.scanForOptimizations();\n      } catch (error) {\n        this.emit(\"error\", error as Error);\n      }\n    }, this.config.optimizationScanIntervalHours * 60 * 60 * 1000);\n\n    this.aggregationIntervals.set(\"optimization\", interval);\n  }\n\n  async getOptimizations(implemented?: boolean): Promise<CostOptimization[]> {\n    return this.storage.getOptimizations(implemented);\n  }\n\n  async markOptimizationImplemented(id: string, actualSavings?: number): Promise<void> {\n    const optimizations = await this.storage.getOptimizations();\n    const optimization = optimizations.find((o) => o.id === id);\n\n    if (optimization) {\n      optimization.implemented = true;\n      optimization.implementedAt = Date.now();\n      optimization.actualSavings = actualSavings;\n      await this.storage.saveOptimization(optimization);\n    }\n  }\n\n  // ===========================================================================\n  // Query Methods\n  // ===========================================================================\n\n  async getRequests(filters: {\n    startTime?: number;\n    endTime?: number;\n    provider?: LLMProvider;\n    model?: string;\n    projectId?: string;\n    userId?: string;\n  }): Promise<LLMRequest[]> {\n    return this.storage.getRequests(filters);\n  }\n\n  async getTotalCost(startTime?: number, endTime?: number): Promise<number> {\n    const requests = await this.storage.getRequests({\n      startTime: startTime || 0,\n      endTime: endTime || Date.now(),\n    });\n    return requests.reduce((sum, r) => sum + r.totalCost, 0);\n  }\n\n  async getCostByModel(startTime?: number, endTime?: number): Promise<Record<string, number>> {\n    const requests = await this.storage.getRequests({\n      startTime: startTime || 0,\n      endTime: endTime || Date.now(),\n    });\n\n    const byModel: Record<string, number> = {};\n    for (const req of requests) {\n      byModel[req.model] = (byModel[req.model] || 0) + req.totalCost;\n    }\n    return byModel;\n  }\n\n  async getCostByProvider(startTime?: number, endTime?: number): Promise<Record<string, number>> {\n    const requests = await this.storage.getRequests({\n      startTime: startTime || 0,\n      endTime: endTime || Date.now(),\n    });\n\n    const byProvider: Record<string, number> = {};\n    for (const req of requests) {\n      byProvider[req.provider] = (byProvider[req.provider] || 0) + req.totalCost;\n    }\n    return byProvider;\n  }\n\n  // ===========================================================================\n  // Utility\n  // ===========================================================================\n\n  getModelPricing(model: string): typeof MODEL_PRICING[string] | undefined {\n    return MODEL_PRICING[model];\n  }\n\n  estimateCost(\n    model: string,\n    inputTokens: number,\n    outputTokens: number\n  ): { inputCost: number; outputCost: number; totalCost: number } {\n    const pricing = this.config.customModelPricing?.[model] || MODEL_PRICING[model];\n\n    if (!pricing) {\n      return { inputCost: 0, outputCost: 0, totalCost: 0 };\n    }\n\n    const inputCost = (inputTokens / 1_000_000) * pricing.inputPricePerMillion;\n    const outputCost = (outputTokens / 1_000_000) * pricing.outputPricePerMillion;\n\n    return {\n      inputCost,\n      outputCost,\n      totalCost: inputCost + outputCost,\n    };\n  }\n}\n\n// =============================================================================\n// Singleton & Factory\n// =============================================================================\n\nlet defaultTracker: LLMCostTracker | null = null;\n\nexport function getLLMCostTracker(): LLMCostTracker {\n  if (!defaultTracker) {\n    defaultTracker = new LLMCostTracker();\n  }\n  return defaultTracker;\n}\n\nexport function createLLMCostTracker(\n  config?: Partial<LLMCostTrackerConfig>,\n  storage?: LLMCostStorage\n): LLMCostTracker {\n  return new LLMCostTracker(config, storage);\n}\n","/**\n * Token Analytics Types\n * Phase 16B: AI Operations - Deep Token Usage Analytics\n */\n\nimport { z } from \"zod\";\n\n// =============================================================================\n// Token Classification\n// =============================================================================\n\nexport const TokenCategorySchema = z.enum([\n  \"system_prompt\",\n  \"user_input\",\n  \"assistant_output\",\n  \"function_call\",\n  \"function_result\",\n  \"context\",\n  \"examples\",\n  \"instructions\",\n  \"cached\",\n  \"padding\",\n  \"special\",\n  \"unknown\",\n]);\nexport type TokenCategory = z.infer<typeof TokenCategorySchema>;\n\nexport const TokenBreakdownSchema = z.object({\n  total: z.number(),\n  byCategory: z.record(TokenCategorySchema, z.number()),\n  inputTokens: z.number(),\n  outputTokens: z.number(),\n  cachedTokens: z.number(),\n  wastedTokens: z.number().describe(\"Tokens that didn't contribute to output\"),\n});\nexport type TokenBreakdown = z.infer<typeof TokenBreakdownSchema>;\n\n// =============================================================================\n// Efficiency Metrics\n// =============================================================================\n\nexport const EfficiencyMetricSchema = z.object({\n  name: z.string(),\n  value: z.number(),\n  unit: z.string(),\n  benchmark: z.number().optional(),\n  rating: z.enum([\"excellent\", \"good\", \"fair\", \"poor\", \"critical\"]),\n  description: z.string().optional(),\n});\nexport type EfficiencyMetric = z.infer<typeof EfficiencyMetricSchema>;\n\nexport const TokenEfficiencySchema = z.object({\n  // Input/Output Ratio\n  inputOutputRatio: z.number().describe(\"Input tokens / Output tokens\"),\n\n  // Useful token ratio\n  usefulTokenRatio: z.number().describe(\"Useful tokens / Total tokens\"),\n\n  // Cache hit rate\n  cacheHitRate: z.number().describe(\"Cached tokens / Total input\"),\n\n  // Context utilization\n  contextUtilization: z.number().describe(\"Used context / Max context window\"),\n\n  // Token cost efficiency\n  costPerUsefulToken: z.number().describe(\"Cost per useful output token\"),\n\n  // Compression ratio (if applicable)\n  compressionRatio: z.number().optional().describe(\"Original length / Token count\"),\n\n  // Throughput\n  tokensPerSecond: z.number().optional(),\n\n  // Latency per token\n  latencyPerToken: z.number().optional().describe(\"ms per output token\"),\n\n  // Overall efficiency score (0-100)\n  overallScore: z.number(),\n});\nexport type TokenEfficiency = z.infer<typeof TokenEfficiencySchema>;\n\n// =============================================================================\n// Usage Patterns\n// =============================================================================\n\nexport const UsagePatternTypeSchema = z.enum([\n  \"consistent\",\n  \"bursty\",\n  \"growing\",\n  \"declining\",\n  \"cyclical\",\n  \"erratic\",\n]);\nexport type UsagePatternType = z.infer<typeof UsagePatternTypeSchema>;\n\nexport const UsagePatternSchema = z.object({\n  type: UsagePatternTypeSchema,\n  confidence: z.number().min(0).max(1),\n  description: z.string(),\n\n  // Statistics\n  mean: z.number(),\n  median: z.number(),\n  stdDev: z.number(),\n  min: z.number(),\n  max: z.number(),\n\n  // Trend\n  trend: z.enum([\"increasing\", \"stable\", \"decreasing\"]),\n  trendStrength: z.number().min(0).max(1),\n\n  // Seasonality\n  hasSeasonality: z.boolean(),\n  seasonalPeriod: z.string().optional().describe(\"e.g., 'daily', 'weekly'\"),\n  peakHours: z.array(z.number()).optional(),\n  peakDays: z.array(z.number()).optional(),\n});\nexport type UsagePattern = z.infer<typeof UsagePatternSchema>;\n\n// =============================================================================\n// Anomaly Detection\n// =============================================================================\n\nexport const TokenAnomalyTypeSchema = z.enum([\n  \"spike\",\n  \"drop\",\n  \"unusual_ratio\",\n  \"excessive_input\",\n  \"minimal_output\",\n  \"high_waste\",\n  \"context_overflow\",\n  \"repetition\",\n  \"encoding_issue\",\n]);\nexport type TokenAnomalyType = z.infer<typeof TokenAnomalyTypeSchema>;\n\nexport const TokenAnomalySchema = z.object({\n  id: z.string(),\n  type: TokenAnomalyTypeSchema,\n  severity: z.enum([\"low\", \"medium\", \"high\", \"critical\"]),\n  timestamp: z.number(),\n\n  // Detection\n  expected: z.number(),\n  actual: z.number(),\n  deviation: z.number().describe(\"Standard deviations from mean\"),\n\n  // Context\n  model: z.string().optional(),\n  requestId: z.string().optional(),\n  projectId: z.string().optional(),\n  userId: z.string().optional(),\n\n  // Details\n  description: z.string(),\n  possibleCauses: z.array(z.string()),\n  recommendations: z.array(z.string()),\n\n  // Status\n  acknowledged: z.boolean().default(false),\n  resolvedAt: z.number().optional(),\n});\nexport type TokenAnomaly = z.infer<typeof TokenAnomalySchema>;\n\n// =============================================================================\n// Model Comparison\n// =============================================================================\n\nexport const ModelComparisonSchema = z.object({\n  model: z.string(),\n  provider: z.string(),\n\n  // Volume\n  totalRequests: z.number(),\n  totalTokens: z.number(),\n  totalCost: z.number(),\n\n  // Efficiency\n  avgInputTokens: z.number(),\n  avgOutputTokens: z.number(),\n  inputOutputRatio: z.number(),\n  cacheHitRate: z.number(),\n\n  // Performance\n  avgLatencyMs: z.number(),\n  tokensPerSecond: z.number(),\n  successRate: z.number(),\n\n  // Cost efficiency\n  costPerRequest: z.number(),\n  costPer1kTokens: z.number(),\n\n  // Quality indicators\n  avgResponseLength: z.number(),\n  consistencyScore: z.number().describe(\"How consistent are response lengths\"),\n});\nexport type ModelComparison = z.infer<typeof ModelComparisonSchema>;\n\n// =============================================================================\n// Project Analytics\n// =============================================================================\n\nexport const ProjectAnalyticsSchema = z.object({\n  projectId: z.string(),\n  periodStart: z.number(),\n  periodEnd: z.number(),\n\n  // Volume\n  totalRequests: z.number(),\n  totalTokens: z.number(),\n  totalCost: z.number(),\n\n  // Breakdown by model\n  byModel: z.record(z.object({\n    requests: z.number(),\n    tokens: z.number(),\n    cost: z.number(),\n    avgLatency: z.number(),\n  })),\n\n  // Token categories\n  tokenBreakdown: TokenBreakdownSchema,\n\n  // Efficiency\n  efficiency: TokenEfficiencySchema,\n\n  // Pattern\n  usagePattern: UsagePatternSchema,\n\n  // Top endpoints/features\n  topEndpoints: z.array(z.object({\n    endpoint: z.string(),\n    requests: z.number(),\n    tokens: z.number(),\n    cost: z.number(),\n  })),\n\n  // Anomalies\n  anomalyCount: z.number(),\n  recentAnomalies: z.array(TokenAnomalySchema),\n\n  // Recommendations\n  recommendations: z.array(z.object({\n    type: z.string(),\n    priority: z.enum([\"low\", \"medium\", \"high\"]),\n    estimatedSavings: z.number(),\n    description: z.string(),\n  })),\n});\nexport type ProjectAnalytics = z.infer<typeof ProjectAnalyticsSchema>;\n\n// =============================================================================\n// Time Series Data\n// =============================================================================\n\nexport const TimeGranularitySchema = z.enum([\n  \"minute\",\n  \"hour\",\n  \"day\",\n  \"week\",\n  \"month\",\n]);\nexport type TimeGranularity = z.infer<typeof TimeGranularitySchema>;\n\nexport const TokenTimeSeriesPointSchema = z.object({\n  timestamp: z.number(),\n  inputTokens: z.number(),\n  outputTokens: z.number(),\n  cachedTokens: z.number(),\n  totalTokens: z.number(),\n  requests: z.number(),\n  cost: z.number(),\n  avgLatency: z.number().optional(),\n});\nexport type TokenTimeSeriesPoint = z.infer<typeof TokenTimeSeriesPointSchema>;\n\nexport const TokenTimeSeriesSchema = z.object({\n  granularity: TimeGranularitySchema,\n  startTime: z.number(),\n  endTime: z.number(),\n  points: z.array(TokenTimeSeriesPointSchema),\n});\nexport type TokenTimeSeries = z.infer<typeof TokenTimeSeriesSchema>;\n\n// =============================================================================\n// Forecasting\n// =============================================================================\n\nexport const ForecastMethodSchema = z.enum([\n  \"linear\",\n  \"exponential\",\n  \"arima\",\n  \"prophet\",\n  \"lstm\",\n  \"ensemble\",\n]);\nexport type ForecastMethod = z.infer<typeof ForecastMethodSchema>;\n\nexport const TokenForecastSchema = z.object({\n  method: ForecastMethodSchema,\n  periodDays: z.number(),\n  generatedAt: z.number(),\n\n  // Projections\n  projectedTokens: z.number(),\n  projectedCost: z.number(),\n  projectedRequests: z.number(),\n\n  // Confidence\n  confidence: z.number().min(0).max(1),\n  lowerBound: z.object({\n    tokens: z.number(),\n    cost: z.number(),\n  }),\n  upperBound: z.object({\n    tokens: z.number(),\n    cost: z.number(),\n  }),\n\n  // Daily breakdown\n  dailyProjections: z.array(z.object({\n    date: z.string(),\n    tokens: z.number(),\n    cost: z.number(),\n  })),\n\n  // Assumptions\n  assumptions: z.array(z.string()),\n  factors: z.array(z.object({\n    name: z.string(),\n    impact: z.enum([\"positive\", \"negative\", \"neutral\"]),\n    weight: z.number(),\n  })),\n});\nexport type TokenForecast = z.infer<typeof TokenForecastSchema>;\n\n// =============================================================================\n// Optimization Recommendations\n// =============================================================================\n\nexport const OptimizationImpactSchema = z.enum([\n  \"cost_reduction\",\n  \"latency_improvement\",\n  \"quality_improvement\",\n  \"efficiency_improvement\",\n  \"reliability_improvement\",\n]);\nexport type OptimizationImpact = z.infer<typeof OptimizationImpactSchema>;\n\nexport const TokenOptimizationSchema = z.object({\n  id: z.string(),\n  type: z.enum([\n    \"prompt_compression\",\n    \"caching_strategy\",\n    \"model_selection\",\n    \"batching\",\n    \"context_pruning\",\n    \"response_streaming\",\n    \"retry_optimization\",\n    \"request_deduplication\",\n  ]),\n  priority: z.enum([\"low\", \"medium\", \"high\", \"critical\"]),\n  timestamp: z.number(),\n\n  // Impact\n  impacts: z.array(OptimizationImpactSchema),\n  estimatedSavings: z.object({\n    tokens: z.number(),\n    cost: z.number(),\n    latencyMs: z.number(),\n  }),\n\n  // Details\n  title: z.string(),\n  description: z.string(),\n  currentState: z.string(),\n  recommendedAction: z.string(),\n  implementation: z.string().optional().describe(\"How to implement\"),\n\n  // Effort\n  effort: z.enum([\"trivial\", \"easy\", \"moderate\", \"complex\"]),\n  riskLevel: z.enum([\"none\", \"low\", \"medium\", \"high\"]),\n\n  // Status\n  status: z.enum([\"suggested\", \"accepted\", \"implemented\", \"rejected\"]),\n  implementedAt: z.number().optional(),\n  actualSavings: z.object({\n    tokens: z.number(),\n    cost: z.number(),\n  }).optional(),\n});\nexport type TokenOptimization = z.infer<typeof TokenOptimizationSchema>;\n\n// =============================================================================\n// Dashboard Summary\n// =============================================================================\n\nexport const TokenAnalyticsSummarySchema = z.object({\n  period: z.object({\n    start: z.number(),\n    end: z.number(),\n    granularity: TimeGranularitySchema,\n  }),\n\n  // Overview\n  totalTokens: z.number(),\n  totalCost: z.number(),\n  totalRequests: z.number(),\n  uniqueModels: z.number(),\n  uniqueProjects: z.number(),\n\n  // Changes from previous period\n  tokenChange: z.number(),\n  costChange: z.number(),\n  requestChange: z.number(),\n\n  // Efficiency\n  overallEfficiency: TokenEfficiencySchema,\n  efficiencyTrend: z.enum([\"improving\", \"stable\", \"declining\"]),\n\n  // Top consumers\n  topModels: z.array(ModelComparisonSchema),\n  topProjects: z.array(z.object({\n    projectId: z.string(),\n    tokens: z.number(),\n    cost: z.number(),\n    efficiency: z.number(),\n  })),\n\n  // Anomalies\n  activeAnomalies: z.number(),\n  anomaliesByType: z.record(TokenAnomalyTypeSchema, z.number()),\n\n  // Optimizations\n  pendingOptimizations: z.number(),\n  potentialSavings: z.number(),\n\n  // Forecast\n  forecast: TokenForecastSchema.optional(),\n});\nexport type TokenAnalyticsSummary = z.infer<typeof TokenAnalyticsSummarySchema>;\n\n// =============================================================================\n// Configuration\n// =============================================================================\n\nexport const TokenAnalyticsConfigSchema = z.object({\n  // General\n  enabled: z.boolean().default(true),\n  retentionDays: z.number().default(90),\n\n  // Anomaly detection\n  anomalyDetectionEnabled: z.boolean().default(true),\n  anomalyThresholdStdDev: z.number().default(2.5),\n  anomalyMinSamples: z.number().default(10),\n\n  // Forecasting\n  forecastingEnabled: z.boolean().default(true),\n  defaultForecastDays: z.number().default(30),\n  forecastMethod: ForecastMethodSchema.default(\"linear\"),\n\n  // Optimization scanning\n  optimizationScanEnabled: z.boolean().default(true),\n  optimizationScanIntervalHours: z.number().default(24),\n\n  // Pattern analysis\n  patternAnalysisEnabled: z.boolean().default(true),\n  patternMinDataPoints: z.number().default(50),\n\n  // Alerts\n  alertOnAnomalies: z.boolean().default(true),\n  alertOnEfficiencyDrop: z.boolean().default(true),\n  efficiencyDropThreshold: z.number().default(10).describe(\"Percentage drop\"),\n\n  // Time series\n  defaultGranularity: TimeGranularitySchema.default(\"hour\"),\n  maxTimeSeriesPoints: z.number().default(1000),\n});\nexport type TokenAnalyticsConfig = z.infer<typeof TokenAnalyticsConfigSchema>;\n\n// =============================================================================\n// Events\n// =============================================================================\n\nexport type TokenAnalyticsEvents = {\n  // Analysis\n  analysisCompleted: (projectId: string, analytics: ProjectAnalytics) => void;\n  summaryGenerated: (summary: TokenAnalyticsSummary) => void;\n\n  // Anomalies\n  anomalyDetected: (anomaly: TokenAnomaly) => void;\n  anomalyResolved: (anomalyId: string) => void;\n\n  // Optimizations\n  optimizationFound: (optimization: TokenOptimization) => void;\n  optimizationImplemented: (optimization: TokenOptimization) => void;\n\n  // Forecasts\n  forecastGenerated: (forecast: TokenForecast) => void;\n  forecastExceeded: (forecast: TokenForecast, actual: number) => void;\n\n  // Efficiency\n  efficiencyDropDetected: (current: number, previous: number, threshold: number) => void;\n\n  // Errors\n  error: (error: Error) => void;\n};\n\n// =============================================================================\n// Storage Interface\n// =============================================================================\n\nexport interface TokenAnalyticsStorage {\n  // Time series\n  saveTimeSeriesPoint(point: TokenTimeSeriesPoint & { projectId?: string; model?: string }): Promise<void>;\n  getTimeSeries(options: {\n    granularity: TimeGranularity;\n    startTime: number;\n    endTime: number;\n    projectId?: string;\n    model?: string;\n  }): Promise<TokenTimeSeries>;\n\n  // Anomalies\n  saveAnomaly(anomaly: TokenAnomaly): Promise<void>;\n  getAnomalies(options?: {\n    type?: TokenAnomalyType;\n    severity?: string;\n    acknowledged?: boolean;\n    startTime?: number;\n    endTime?: number;\n  }): Promise<TokenAnomaly[]>;\n  acknowledgeAnomaly(anomalyId: string): Promise<void>;\n  resolveAnomaly(anomalyId: string): Promise<void>;\n\n  // Optimizations\n  saveOptimization(optimization: TokenOptimization): Promise<void>;\n  getOptimizations(status?: string): Promise<TokenOptimization[]>;\n  updateOptimizationStatus(id: string, status: string, actualSavings?: { tokens: number; cost: number }): Promise<void>;\n\n  // Forecasts\n  saveForecast(forecast: TokenForecast & { projectId?: string }): Promise<void>;\n  getForecast(projectId?: string): Promise<TokenForecast | null>;\n\n  // Project analytics\n  saveProjectAnalytics(analytics: ProjectAnalytics): Promise<void>;\n  getProjectAnalytics(projectId: string, periodStart?: number): Promise<ProjectAnalytics | null>;\n}\n\n// =============================================================================\n// Efficiency Benchmarks\n// =============================================================================\n\nexport const EFFICIENCY_BENCHMARKS = {\n  inputOutputRatio: {\n    excellent: 1.5,\n    good: 3,\n    fair: 5,\n    poor: 10,\n  },\n  cacheHitRate: {\n    excellent: 0.5,\n    good: 0.3,\n    fair: 0.15,\n    poor: 0.05,\n  },\n  contextUtilization: {\n    excellent: 0.7,\n    good: 0.5,\n    fair: 0.3,\n    poor: 0.1,\n  },\n  costPerUsefulToken: {\n    excellent: 0.00001,\n    good: 0.00005,\n    fair: 0.0001,\n    poor: 0.0005,\n  },\n};\n\n// =============================================================================\n// Helpers\n// =============================================================================\n\nexport function calculateEfficiencyRating(\n  value: number,\n  benchmarks: { excellent: number; good: number; fair: number; poor: number },\n  lowerIsBetter: boolean = true\n): \"excellent\" | \"good\" | \"fair\" | \"poor\" | \"critical\" {\n  if (lowerIsBetter) {\n    if (value <= benchmarks.excellent) return \"excellent\";\n    if (value <= benchmarks.good) return \"good\";\n    if (value <= benchmarks.fair) return \"fair\";\n    if (value <= benchmarks.poor) return \"poor\";\n    return \"critical\";\n  } else {\n    if (value >= benchmarks.excellent) return \"excellent\";\n    if (value >= benchmarks.good) return \"good\";\n    if (value >= benchmarks.fair) return \"fair\";\n    if (value >= benchmarks.poor) return \"poor\";\n    return \"critical\";\n  }\n}\n\nexport function formatTokens(tokens: number): string {\n  if (tokens >= 1_000_000_000) {\n    return `${(tokens / 1_000_000_000).toFixed(2)}B`;\n  }\n  if (tokens >= 1_000_000) {\n    return `${(tokens / 1_000_000).toFixed(2)}M`;\n  }\n  if (tokens >= 1_000) {\n    return `${(tokens / 1_000).toFixed(1)}K`;\n  }\n  return tokens.toString();\n}\n\nexport function calculateTokenEfficiency(data: {\n  inputTokens: number;\n  outputTokens: number;\n  cachedTokens: number;\n  totalCost: number;\n  contextWindow: number;\n  usedContext: number;\n  latencyMs?: number;\n}): TokenEfficiency {\n  const totalTokens = data.inputTokens + data.outputTokens;\n  const usefulTokens = data.outputTokens; // Simplified: output is \"useful\"\n\n  const inputOutputRatio = data.inputTokens / (data.outputTokens || 1);\n  const usefulTokenRatio = usefulTokens / (totalTokens || 1);\n  const cacheHitRate = data.cachedTokens / (data.inputTokens || 1);\n  const contextUtilization = data.usedContext / (data.contextWindow || 1);\n  const costPerUsefulToken = data.totalCost / (usefulTokens || 1);\n\n  // Calculate overall score (0-100)\n  const scores = [\n    calculateEfficiencyRating(inputOutputRatio, EFFICIENCY_BENCHMARKS.inputOutputRatio),\n    calculateEfficiencyRating(cacheHitRate, EFFICIENCY_BENCHMARKS.cacheHitRate, false),\n    calculateEfficiencyRating(contextUtilization, EFFICIENCY_BENCHMARKS.contextUtilization, false),\n    calculateEfficiencyRating(costPerUsefulToken, EFFICIENCY_BENCHMARKS.costPerUsefulToken),\n  ];\n\n  const scoreMap = { excellent: 100, good: 75, fair: 50, poor: 25, critical: 0 };\n  const overallScore = scores.reduce((sum, s) => sum + scoreMap[s], 0) / scores.length;\n\n  return {\n    inputOutputRatio,\n    usefulTokenRatio,\n    cacheHitRate,\n    contextUtilization,\n    costPerUsefulToken,\n    tokensPerSecond: data.latencyMs ? (data.outputTokens / data.latencyMs) * 1000 : undefined,\n    latencyPerToken: data.latencyMs ? data.latencyMs / (data.outputTokens || 1) : undefined,\n    overallScore,\n  };\n}\n","/**\n * Token Analytics Implementation\n * Phase 16B: AI Operations - Deep Token Usage Analytics\n */\n\nimport { EventEmitter } from \"eventemitter3\";\nimport { randomUUID } from \"crypto\";\nimport {\n  type TokenAnalyticsConfig,\n  TokenAnalyticsConfigSchema,\n  type TokenAnalyticsEvents,\n  type TokenAnalyticsStorage,\n  type TokenTimeSeriesPoint,\n  type TokenTimeSeries,\n  type TimeGranularity,\n  type TokenAnomaly,\n  type TokenAnomalyType,\n  type TokenOptimization,\n  type TokenForecast,\n  type ProjectAnalytics,\n  type TokenAnalyticsSummary,\n  type TokenEfficiency,\n  type TokenBreakdown,\n  type UsagePattern,\n  type UsagePatternType,\n  type ModelComparison,\n  calculateTokenEfficiency,\n  calculateEfficiencyRating,\n  EFFICIENCY_BENCHMARKS,\n} from \"./types.js\";\n\n// =============================================================================\n// In-Memory Storage\n// =============================================================================\n\nclass InMemoryTokenAnalyticsStorage implements TokenAnalyticsStorage {\n  private timeSeries: Map<string, TokenTimeSeriesPoint[]> = new Map();\n  private anomalies: Map<string, TokenAnomaly> = new Map();\n  private optimizations: Map<string, TokenOptimization> = new Map();\n  private forecasts: Map<string, TokenForecast> = new Map();\n  private projectAnalytics: Map<string, ProjectAnalytics> = new Map();\n\n  private getTimeSeriesKey(granularity: TimeGranularity, projectId?: string, model?: string): string {\n    return `${granularity}-${projectId || \"all\"}-${model || \"all\"}`;\n  }\n\n  async saveTimeSeriesPoint(\n    point: TokenTimeSeriesPoint & { projectId?: string; model?: string }\n  ): Promise<void> {\n    const key = this.getTimeSeriesKey(\"hour\", point.projectId, point.model);\n    const series = this.timeSeries.get(key) || [];\n    series.push(point);\n    this.timeSeries.set(key, series);\n\n    // Also save to global series\n    const globalKey = this.getTimeSeriesKey(\"hour\");\n    const globalSeries = this.timeSeries.get(globalKey) || [];\n    globalSeries.push(point);\n    this.timeSeries.set(globalKey, globalSeries);\n  }\n\n  async getTimeSeries(options: {\n    granularity: TimeGranularity;\n    startTime: number;\n    endTime: number;\n    projectId?: string;\n    model?: string;\n  }): Promise<TokenTimeSeries> {\n    const key = this.getTimeSeriesKey(options.granularity, options.projectId, options.model);\n    const allPoints = this.timeSeries.get(key) || [];\n\n    const points = allPoints.filter(\n      (p) => p.timestamp >= options.startTime && p.timestamp <= options.endTime\n    );\n\n    return {\n      granularity: options.granularity,\n      startTime: options.startTime,\n      endTime: options.endTime,\n      points,\n    };\n  }\n\n  async saveAnomaly(anomaly: TokenAnomaly): Promise<void> {\n    this.anomalies.set(anomaly.id, anomaly);\n  }\n\n  async getAnomalies(options?: {\n    type?: TokenAnomalyType;\n    severity?: string;\n    acknowledged?: boolean;\n    startTime?: number;\n    endTime?: number;\n  }): Promise<TokenAnomaly[]> {\n    return Array.from(this.anomalies.values()).filter((a) => {\n      if (options?.type && a.type !== options.type) return false;\n      if (options?.severity && a.severity !== options.severity) return false;\n      if (options?.acknowledged !== undefined && a.acknowledged !== options.acknowledged) return false;\n      if (options?.startTime && a.timestamp < options.startTime) return false;\n      if (options?.endTime && a.timestamp > options.endTime) return false;\n      return true;\n    });\n  }\n\n  async acknowledgeAnomaly(anomalyId: string): Promise<void> {\n    const anomaly = this.anomalies.get(anomalyId);\n    if (anomaly) {\n      anomaly.acknowledged = true;\n    }\n  }\n\n  async resolveAnomaly(anomalyId: string): Promise<void> {\n    const anomaly = this.anomalies.get(anomalyId);\n    if (anomaly) {\n      anomaly.resolvedAt = Date.now();\n    }\n  }\n\n  async saveOptimization(optimization: TokenOptimization): Promise<void> {\n    this.optimizations.set(optimization.id, optimization);\n  }\n\n  async getOptimizations(status?: string): Promise<TokenOptimization[]> {\n    return Array.from(this.optimizations.values()).filter((o) => {\n      if (status && o.status !== status) return false;\n      return true;\n    });\n  }\n\n  async updateOptimizationStatus(\n    id: string,\n    status: string,\n    actualSavings?: { tokens: number; cost: number }\n  ): Promise<void> {\n    const opt = this.optimizations.get(id);\n    if (opt) {\n      opt.status = status as TokenOptimization[\"status\"];\n      if (status === \"implemented\") {\n        opt.implementedAt = Date.now();\n        opt.actualSavings = actualSavings;\n      }\n    }\n  }\n\n  async saveForecast(forecast: TokenForecast & { projectId?: string }): Promise<void> {\n    const key = forecast.projectId || \"global\";\n    this.forecasts.set(key, forecast);\n  }\n\n  async getForecast(projectId?: string): Promise<TokenForecast | null> {\n    return this.forecasts.get(projectId || \"global\") || null;\n  }\n\n  async saveProjectAnalytics(analytics: ProjectAnalytics): Promise<void> {\n    this.projectAnalytics.set(analytics.projectId, analytics);\n  }\n\n  async getProjectAnalytics(projectId: string): Promise<ProjectAnalytics | null> {\n    return this.projectAnalytics.get(projectId) || null;\n  }\n}\n\n// =============================================================================\n// Token Analytics Manager\n// =============================================================================\n\nexport class TokenAnalyticsManager extends EventEmitter<TokenAnalyticsEvents> {\n  private config: TokenAnalyticsConfig;\n  private storage: TokenAnalyticsStorage;\n  private intervals: Map<string, NodeJS.Timeout> = new Map();\n  private started: boolean = false;\n\n  // Running statistics for anomaly detection\n  private runningStats: Map<string, {\n    count: number;\n    mean: number;\n    m2: number; // For Welford's algorithm\n  }> = new Map();\n\n  constructor(config: Partial<TokenAnalyticsConfig> = {}, storage?: TokenAnalyticsStorage) {\n    super();\n    this.config = TokenAnalyticsConfigSchema.parse(config);\n    this.storage = storage || new InMemoryTokenAnalyticsStorage();\n  }\n\n  // ===========================================================================\n  // Lifecycle\n  // ===========================================================================\n\n  async start(): Promise<void> {\n    if (this.started) return;\n\n    if (this.config.optimizationScanEnabled) {\n      this.scheduleOptimizationScan();\n    }\n\n    this.started = true;\n  }\n\n  async stop(): Promise<void> {\n    for (const interval of this.intervals.values()) {\n      clearInterval(interval);\n    }\n    this.intervals.clear();\n    this.started = false;\n  }\n\n  // ===========================================================================\n  // Data Ingestion\n  // ===========================================================================\n\n  async recordUsage(data: {\n    timestamp?: number;\n    inputTokens: number;\n    outputTokens: number;\n    cachedTokens?: number;\n    cost: number;\n    latencyMs?: number;\n    projectId?: string;\n    model?: string;\n  }): Promise<void> {\n    const point: TokenTimeSeriesPoint & { projectId?: string; model?: string } = {\n      timestamp: data.timestamp || Date.now(),\n      inputTokens: data.inputTokens,\n      outputTokens: data.outputTokens,\n      cachedTokens: data.cachedTokens || 0,\n      totalTokens: data.inputTokens + data.outputTokens,\n      requests: 1,\n      cost: data.cost,\n      avgLatency: data.latencyMs,\n      projectId: data.projectId,\n      model: data.model,\n    };\n\n    await this.storage.saveTimeSeriesPoint(point);\n\n    // Check for anomalies\n    if (this.config.anomalyDetectionEnabled) {\n      await this.checkForAnomalies(point);\n    }\n  }\n\n  // ===========================================================================\n  // Anomaly Detection\n  // ===========================================================================\n\n  private async checkForAnomalies(\n    point: TokenTimeSeriesPoint & { projectId?: string; model?: string }\n  ): Promise<void> {\n    const key = `tokens-${point.projectId || \"global\"}`;\n\n    // Update running statistics using Welford's algorithm\n    let stats = this.runningStats.get(key);\n    if (!stats) {\n      stats = { count: 0, mean: 0, m2: 0 };\n    }\n\n    stats.count++;\n    const delta = point.totalTokens - stats.mean;\n    stats.mean += delta / stats.count;\n    const delta2 = point.totalTokens - stats.mean;\n    stats.m2 += delta * delta2;\n\n    this.runningStats.set(key, stats);\n\n    // Need minimum samples for detection\n    if (stats.count < this.config.anomalyMinSamples) return;\n\n    // Calculate standard deviation\n    const variance = stats.m2 / (stats.count - 1);\n    const stdDev = Math.sqrt(variance);\n\n    // Check for anomalies\n    const deviation = (point.totalTokens - stats.mean) / (stdDev || 1);\n\n    if (Math.abs(deviation) >= this.config.anomalyThresholdStdDev) {\n      const anomaly = await this.createAnomaly({\n        type: deviation > 0 ? \"spike\" : \"drop\",\n        expected: stats.mean,\n        actual: point.totalTokens,\n        deviation,\n        model: point.model,\n        projectId: point.projectId,\n      });\n\n      if (this.config.alertOnAnomalies) {\n        this.emit(\"anomalyDetected\", anomaly);\n      }\n    }\n\n    // Check input/output ratio anomaly\n    const ratio = point.inputTokens / (point.outputTokens || 1);\n    if (ratio > 20) {\n      await this.createAnomaly({\n        type: \"unusual_ratio\",\n        expected: 5,\n        actual: ratio,\n        deviation: (ratio - 5) / 2,\n        model: point.model,\n        projectId: point.projectId,\n        description: `Unusually high input/output ratio: ${ratio.toFixed(1)}:1`,\n      });\n    }\n  }\n\n  private async createAnomaly(data: {\n    type: TokenAnomalyType;\n    expected: number;\n    actual: number;\n    deviation: number;\n    model?: string;\n    projectId?: string;\n    requestId?: string;\n    description?: string;\n  }): Promise<TokenAnomaly> {\n    const severity = this.calculateAnomalySeverity(data.deviation);\n\n    const anomaly: TokenAnomaly = {\n      id: randomUUID(),\n      type: data.type,\n      severity,\n      timestamp: Date.now(),\n      expected: data.expected,\n      actual: data.actual,\n      deviation: data.deviation,\n      model: data.model,\n      projectId: data.projectId,\n      requestId: data.requestId,\n      description: data.description || this.generateAnomalyDescription(data.type, data.expected, data.actual),\n      possibleCauses: this.getPossibleCauses(data.type),\n      recommendations: this.getAnomalyRecommendations(data.type),\n      acknowledged: false,\n    };\n\n    await this.storage.saveAnomaly(anomaly);\n    return anomaly;\n  }\n\n  private calculateAnomalySeverity(deviation: number): \"low\" | \"medium\" | \"high\" | \"critical\" {\n    const absDeviation = Math.abs(deviation);\n    if (absDeviation >= 5) return \"critical\";\n    if (absDeviation >= 4) return \"high\";\n    if (absDeviation >= 3) return \"medium\";\n    return \"low\";\n  }\n\n  private generateAnomalyDescription(type: TokenAnomalyType, expected: number, actual: number): string {\n    const descriptions: Record<TokenAnomalyType, string> = {\n      spike: `Token usage spiked to ${actual.toFixed(0)} (expected ~${expected.toFixed(0)})`,\n      drop: `Token usage dropped to ${actual.toFixed(0)} (expected ~${expected.toFixed(0)})`,\n      unusual_ratio: `Unusual input/output ratio detected`,\n      excessive_input: `Excessive input tokens: ${actual.toFixed(0)}`,\n      minimal_output: `Minimal output tokens: ${actual.toFixed(0)}`,\n      high_waste: `High token waste detected`,\n      context_overflow: `Context window overflow detected`,\n      repetition: `Repetitive content detected in output`,\n      encoding_issue: `Potential encoding issue affecting token count`,\n    };\n    return descriptions[type] || \"Unknown anomaly\";\n  }\n\n  private getPossibleCauses(type: TokenAnomalyType): string[] {\n    const causes: Record<TokenAnomalyType, string[]> = {\n      spike: [\n        \"Large batch of requests processed\",\n        \"Complex query requiring detailed response\",\n        \"New feature deployment\",\n        \"Unusual user activity\",\n      ],\n      drop: [\n        \"Service disruption or downtime\",\n        \"Client-side issues\",\n        \"Rate limiting activated\",\n        \"Reduced user activity\",\n      ],\n      unusual_ratio: [\n        \"Large context/system prompts\",\n        \"Short responses or errors\",\n        \"Caching issues\",\n        \"Prompt engineering needed\",\n      ],\n      excessive_input: [\n        \"Redundant context included\",\n        \"Large document processing\",\n        \"Inefficient prompt design\",\n        \"Missing caching\",\n      ],\n      minimal_output: [\n        \"Model returned error\",\n        \"Query too restrictive\",\n        \"Max tokens set too low\",\n        \"Request timeout\",\n      ],\n      high_waste: [\n        \"Unused context in prompts\",\n        \"Redundant information\",\n        \"Suboptimal prompt structure\",\n      ],\n      context_overflow: [\n        \"Input exceeds context window\",\n        \"No truncation strategy\",\n        \"Document too large\",\n      ],\n      repetition: [\n        \"Model in repetition loop\",\n        \"Prompt encouraging repetition\",\n        \"Temperature too low\",\n      ],\n      encoding_issue: [\n        \"Special characters in input\",\n        \"Unicode handling issues\",\n        \"Binary data in text\",\n      ],\n    };\n    return causes[type] || [\"Unknown cause\"];\n  }\n\n  private getAnomalyRecommendations(type: TokenAnomalyType): string[] {\n    const recommendations: Record<TokenAnomalyType, string[]> = {\n      spike: [\n        \"Review recent changes to prompts or workflows\",\n        \"Check for batch processing jobs\",\n        \"Consider implementing request throttling\",\n      ],\n      drop: [\n        \"Check service health and connectivity\",\n        \"Review error logs for failures\",\n        \"Verify API credentials are valid\",\n      ],\n      unusual_ratio: [\n        \"Review and optimize system prompts\",\n        \"Consider using prompt compression\",\n        \"Enable caching for repeated context\",\n      ],\n      excessive_input: [\n        \"Implement context pruning\",\n        \"Use summarization for long documents\",\n        \"Enable prompt caching\",\n      ],\n      minimal_output: [\n        \"Check for error responses\",\n        \"Increase max_tokens if appropriate\",\n        \"Review query complexity\",\n      ],\n      high_waste: [\n        \"Audit prompt templates\",\n        \"Remove redundant context\",\n        \"Use dynamic prompt generation\",\n      ],\n      context_overflow: [\n        \"Implement chunking strategy\",\n        \"Use summarization\",\n        \"Switch to model with larger context\",\n      ],\n      repetition: [\n        \"Increase temperature slightly\",\n        \"Add presence_penalty\",\n        \"Review prompt for repetition triggers\",\n      ],\n      encoding_issue: [\n        \"Sanitize input text\",\n        \"Check character encoding\",\n        \"Handle special characters\",\n      ],\n    };\n    return recommendations[type] || [\"Contact support for assistance\"];\n  }\n\n  // ===========================================================================\n  // Efficiency Analysis\n  // ===========================================================================\n\n  async analyzeEfficiency(options: {\n    startTime: number;\n    endTime: number;\n    projectId?: string;\n    model?: string;\n  }): Promise<TokenEfficiency> {\n    const timeSeries = await this.storage.getTimeSeries({\n      granularity: \"hour\",\n      ...options,\n    });\n\n    if (timeSeries.points.length === 0) {\n      return this.getEmptyEfficiency();\n    }\n\n    const totals = timeSeries.points.reduce(\n      (acc, p) => ({\n        inputTokens: acc.inputTokens + p.inputTokens,\n        outputTokens: acc.outputTokens + p.outputTokens,\n        cachedTokens: acc.cachedTokens + p.cachedTokens,\n        totalCost: acc.totalCost + p.cost,\n        latencyMs: acc.latencyMs + (p.avgLatency || 0),\n        count: acc.count + 1,\n      }),\n      { inputTokens: 0, outputTokens: 0, cachedTokens: 0, totalCost: 0, latencyMs: 0, count: 0 }\n    );\n\n    return calculateTokenEfficiency({\n      inputTokens: totals.inputTokens,\n      outputTokens: totals.outputTokens,\n      cachedTokens: totals.cachedTokens,\n      totalCost: totals.totalCost,\n      contextWindow: 128000, // Default, should be model-specific\n      usedContext: totals.inputTokens / totals.count,\n      latencyMs: totals.count > 0 ? totals.latencyMs / totals.count : undefined,\n    });\n  }\n\n  private getEmptyEfficiency(): TokenEfficiency {\n    return {\n      inputOutputRatio: 0,\n      usefulTokenRatio: 0,\n      cacheHitRate: 0,\n      contextUtilization: 0,\n      costPerUsefulToken: 0,\n      overallScore: 0,\n    };\n  }\n\n  // ===========================================================================\n  // Pattern Analysis\n  // ===========================================================================\n\n  async analyzeUsagePattern(options: {\n    startTime: number;\n    endTime: number;\n    projectId?: string;\n  }): Promise<UsagePattern> {\n    const timeSeries = await this.storage.getTimeSeries({\n      granularity: \"hour\",\n      ...options,\n    });\n\n    const points = timeSeries.points;\n    if (points.length < this.config.patternMinDataPoints) {\n      return this.getDefaultPattern();\n    }\n\n    const values = points.map((p) => p.totalTokens);\n\n    // Calculate statistics\n    const mean = values.reduce((a, b) => a + b, 0) / values.length;\n    const sorted = [...values].sort((a, b) => a - b);\n    const median = sorted[Math.floor(sorted.length / 2)];\n    const variance = values.reduce((sum, v) => sum + Math.pow(v - mean, 2), 0) / values.length;\n    const stdDev = Math.sqrt(variance);\n    const min = Math.min(...values);\n    const max = Math.max(...values);\n\n    // Detect pattern type\n    const patternType = this.detectPatternType(values, stdDev, mean);\n\n    // Detect trend\n    const trend = this.detectTrend(values);\n\n    // Detect seasonality\n    const seasonality = this.detectSeasonality(points);\n\n    return {\n      type: patternType.type,\n      confidence: patternType.confidence,\n      description: this.generatePatternDescription(patternType.type, trend.direction),\n      mean,\n      median,\n      stdDev,\n      min,\n      max,\n      trend: trend.direction,\n      trendStrength: trend.strength,\n      hasSeasonality: seasonality.hasSeasonality,\n      seasonalPeriod: seasonality.period,\n      peakHours: seasonality.peakHours,\n      peakDays: seasonality.peakDays,\n    };\n  }\n\n  private detectPatternType(values: number[], stdDev: number, mean: number): {\n    type: UsagePatternType;\n    confidence: number;\n  } {\n    const cv = stdDev / (mean || 1); // Coefficient of variation\n\n    if (cv < 0.1) {\n      return { type: \"consistent\", confidence: 0.9 };\n    }\n\n    // Check for growth/decline\n    const firstHalf = values.slice(0, Math.floor(values.length / 2));\n    const secondHalf = values.slice(Math.floor(values.length / 2));\n    const firstAvg = firstHalf.reduce((a, b) => a + b, 0) / firstHalf.length;\n    const secondAvg = secondHalf.reduce((a, b) => a + b, 0) / secondHalf.length;\n\n    if (secondAvg > firstAvg * 1.3) {\n      return { type: \"growing\", confidence: 0.7 };\n    }\n    if (secondAvg < firstAvg * 0.7) {\n      return { type: \"declining\", confidence: 0.7 };\n    }\n\n    if (cv > 0.5) {\n      return { type: \"bursty\", confidence: 0.8 };\n    }\n\n    if (cv > 0.3) {\n      return { type: \"erratic\", confidence: 0.6 };\n    }\n\n    return { type: \"cyclical\", confidence: 0.5 };\n  }\n\n  private detectTrend(values: number[]): {\n    direction: \"increasing\" | \"stable\" | \"decreasing\";\n    strength: number;\n  } {\n    if (values.length < 3) {\n      return { direction: \"stable\", strength: 0 };\n    }\n\n    // Simple linear regression\n    const n = values.length;\n    const sumX = (n * (n - 1)) / 2;\n    const sumY = values.reduce((a, b) => a + b, 0);\n    const sumXY = values.reduce((sum, y, i) => sum + i * y, 0);\n    const sumX2 = (n * (n - 1) * (2 * n - 1)) / 6;\n\n    const slope = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);\n    const avgY = sumY / n;\n    const normalizedSlope = slope / (avgY || 1);\n\n    if (normalizedSlope > 0.05) {\n      return { direction: \"increasing\", strength: Math.min(Math.abs(normalizedSlope) * 5, 1) };\n    }\n    if (normalizedSlope < -0.05) {\n      return { direction: \"decreasing\", strength: Math.min(Math.abs(normalizedSlope) * 5, 1) };\n    }\n    return { direction: \"stable\", strength: 0 };\n  }\n\n  private detectSeasonality(points: TokenTimeSeriesPoint[]): {\n    hasSeasonality: boolean;\n    period?: string;\n    peakHours?: number[];\n    peakDays?: number[];\n  } {\n    if (points.length < 24) {\n      return { hasSeasonality: false };\n    }\n\n    // Group by hour of day\n    const byHour: Map<number, number[]> = new Map();\n    for (const p of points) {\n      const hour = new Date(p.timestamp).getHours();\n      if (!byHour.has(hour)) byHour.set(hour, []);\n      byHour.get(hour)!.push(p.totalTokens);\n    }\n\n    // Find peak hours\n    const hourlyAvgs: [number, number][] = [];\n    for (const [hour, values] of byHour) {\n      const avg = values.reduce((a, b) => a + b, 0) / values.length;\n      hourlyAvgs.push([hour, avg]);\n    }\n\n    hourlyAvgs.sort((a, b) => b[1] - a[1]);\n    const globalAvg = hourlyAvgs.reduce((sum, [, avg]) => sum + avg, 0) / hourlyAvgs.length;\n    const peakHours = hourlyAvgs\n      .filter(([, avg]) => avg > globalAvg * 1.2)\n      .map(([hour]) => hour)\n      .slice(0, 5);\n\n    if (peakHours.length > 0) {\n      return {\n        hasSeasonality: true,\n        period: \"daily\",\n        peakHours,\n      };\n    }\n\n    return { hasSeasonality: false };\n  }\n\n  private generatePatternDescription(type: UsagePatternType, trend: string): string {\n    const descriptions: Record<UsagePatternType, string> = {\n      consistent: \"Usage is steady with minimal variation\",\n      bursty: \"Usage shows periodic bursts of high activity\",\n      growing: \"Usage is steadily increasing over time\",\n      declining: \"Usage is declining over time\",\n      cyclical: \"Usage follows a predictable cycle\",\n      erratic: \"Usage shows unpredictable variation\",\n    };\n    return `${descriptions[type]}. Trend: ${trend}`;\n  }\n\n  private getDefaultPattern(): UsagePattern {\n    return {\n      type: \"consistent\",\n      confidence: 0,\n      description: \"Insufficient data for pattern analysis\",\n      mean: 0,\n      median: 0,\n      stdDev: 0,\n      min: 0,\n      max: 0,\n      trend: \"stable\",\n      trendStrength: 0,\n      hasSeasonality: false,\n    };\n  }\n\n  // ===========================================================================\n  // Forecasting\n  // ===========================================================================\n\n  async generateForecast(options: {\n    periodDays: number;\n    projectId?: string;\n  }): Promise<TokenForecast> {\n    const periodDays = options.periodDays || this.config.defaultForecastDays;\n\n    // Get historical data\n    const endTime = Date.now();\n    const startTime = endTime - 30 * 24 * 60 * 60 * 1000; // Last 30 days\n\n    const timeSeries = await this.storage.getTimeSeries({\n      granularity: \"day\",\n      startTime,\n      endTime,\n      projectId: options.projectId,\n    });\n\n    // Simple linear projection\n    const points = timeSeries.points;\n    if (points.length < 7) {\n      return this.getDefaultForecast(periodDays);\n    }\n\n    const dailyTokens = points.map((p) => p.totalTokens);\n    const dailyCosts = points.map((p) => p.cost);\n    const dailyRequests = points.map((p) => p.requests);\n\n    const avgTokens = dailyTokens.reduce((a, b) => a + b, 0) / dailyTokens.length;\n    const avgCost = dailyCosts.reduce((a, b) => a + b, 0) / dailyCosts.length;\n    const avgRequests = dailyRequests.reduce((a, b) => a + b, 0) / dailyRequests.length;\n\n    // Calculate trend\n    const trend = this.detectTrend(dailyTokens);\n    const trendMultiplier = 1 + (trend.direction === \"increasing\" ? 0.1 : trend.direction === \"decreasing\" ? -0.1 : 0) * trend.strength;\n\n    const projectedTokens = avgTokens * periodDays * trendMultiplier;\n    const projectedCost = avgCost * periodDays * trendMultiplier;\n    const projectedRequests = avgRequests * periodDays * trendMultiplier;\n\n    // Calculate confidence based on data consistency\n    const stdDev = Math.sqrt(dailyTokens.reduce((sum, v) => sum + Math.pow(v - avgTokens, 2), 0) / dailyTokens.length);\n    const cv = stdDev / (avgTokens || 1);\n    const confidence = Math.max(0.3, Math.min(0.95, 1 - cv));\n\n    // Daily projections\n    const dailyProjections = [];\n    const startDate = new Date();\n    for (let i = 0; i < periodDays; i++) {\n      const date = new Date(startDate);\n      date.setDate(date.getDate() + i);\n      const dayMultiplier = 1 + (trendMultiplier - 1) * (i / periodDays);\n      dailyProjections.push({\n        date: date.toISOString().split(\"T\")[0],\n        tokens: Math.round(avgTokens * dayMultiplier),\n        cost: avgCost * dayMultiplier,\n      });\n    }\n\n    const forecast: TokenForecast = {\n      method: this.config.forecastMethod,\n      periodDays,\n      generatedAt: Date.now(),\n      projectedTokens: Math.round(projectedTokens),\n      projectedCost,\n      projectedRequests: Math.round(projectedRequests),\n      confidence,\n      lowerBound: {\n        tokens: Math.round(projectedTokens * 0.7),\n        cost: projectedCost * 0.7,\n      },\n      upperBound: {\n        tokens: Math.round(projectedTokens * 1.3),\n        cost: projectedCost * 1.3,\n      },\n      dailyProjections,\n      assumptions: [\n        \"Based on last 30 days of usage\",\n        `Using ${this.config.forecastMethod} projection method`,\n        trend.direction !== \"stable\" ? `Trend adjustment applied: ${trend.direction}` : \"No significant trend detected\",\n      ],\n      factors: [\n        {\n          name: \"Historical trend\",\n          impact: trend.direction === \"increasing\" ? \"positive\" : trend.direction === \"decreasing\" ? \"negative\" : \"neutral\",\n          weight: trend.strength,\n        },\n      ],\n    };\n\n    await this.storage.saveForecast({ ...forecast, projectId: options.projectId });\n    this.emit(\"forecastGenerated\", forecast);\n    return forecast;\n  }\n\n  private getDefaultForecast(periodDays: number): TokenForecast {\n    return {\n      method: \"linear\",\n      periodDays,\n      generatedAt: Date.now(),\n      projectedTokens: 0,\n      projectedCost: 0,\n      projectedRequests: 0,\n      confidence: 0,\n      lowerBound: { tokens: 0, cost: 0 },\n      upperBound: { tokens: 0, cost: 0 },\n      dailyProjections: [],\n      assumptions: [\"Insufficient historical data for forecast\"],\n      factors: [],\n    };\n  }\n\n  // ===========================================================================\n  // Optimization Recommendations\n  // ===========================================================================\n\n  async scanForOptimizations(options?: { projectId?: string }): Promise<TokenOptimization[]> {\n    const optimizations: TokenOptimization[] = [];\n\n    // Get recent data\n    const endTime = Date.now();\n    const startTime = endTime - 7 * 24 * 60 * 60 * 1000;\n\n    const efficiency = await this.analyzeEfficiency({\n      startTime,\n      endTime,\n      projectId: options?.projectId,\n    });\n\n    // Check cache hit rate\n    if (efficiency.cacheHitRate < 0.2) {\n      const optimization: TokenOptimization = {\n        id: randomUUID(),\n        type: \"caching_strategy\",\n        priority: efficiency.cacheHitRate < 0.05 ? \"high\" : \"medium\",\n        timestamp: Date.now(),\n        impacts: [\"cost_reduction\", \"latency_improvement\"],\n        estimatedSavings: {\n          tokens: 0,\n          cost: efficiency.costPerUsefulToken * 0.3,\n          latencyMs: 100,\n        },\n        title: \"Improve prompt caching\",\n        description: `Cache hit rate is only ${(efficiency.cacheHitRate * 100).toFixed(1)}%. Implementing caching could reduce costs by 20-50%.`,\n        currentState: `Cache hit rate: ${(efficiency.cacheHitRate * 100).toFixed(1)}%`,\n        recommendedAction: \"Enable prompt caching for system prompts and repeated context\",\n        implementation: \"Use cache_control: { type: 'ephemeral' } for system prompts\",\n        effort: \"easy\",\n        riskLevel: \"none\",\n        status: \"suggested\",\n      };\n      optimizations.push(optimization);\n      await this.storage.saveOptimization(optimization);\n      this.emit(\"optimizationFound\", optimization);\n    }\n\n    // Check input/output ratio\n    if (efficiency.inputOutputRatio > 10) {\n      const optimization: TokenOptimization = {\n        id: randomUUID(),\n        type: \"prompt_compression\",\n        priority: efficiency.inputOutputRatio > 20 ? \"high\" : \"medium\",\n        timestamp: Date.now(),\n        impacts: [\"cost_reduction\", \"efficiency_improvement\"],\n        estimatedSavings: {\n          tokens: Math.round(efficiency.inputOutputRatio * 1000),\n          cost: efficiency.costPerUsefulToken * 0.25,\n          latencyMs: 50,\n        },\n        title: \"Reduce input token usage\",\n        description: `Input/output ratio is ${efficiency.inputOutputRatio.toFixed(1)}:1. Consider compressing prompts or removing redundant context.`,\n        currentState: `${efficiency.inputOutputRatio.toFixed(1)} input tokens per output token`,\n        recommendedAction: \"Review and optimize system prompts, use dynamic context injection\",\n        effort: \"moderate\",\n        riskLevel: \"low\",\n        status: \"suggested\",\n      };\n      optimizations.push(optimization);\n      await this.storage.saveOptimization(optimization);\n      this.emit(\"optimizationFound\", optimization);\n    }\n\n    // Check context utilization\n    if (efficiency.contextUtilization < 0.1) {\n      const optimization: TokenOptimization = {\n        id: randomUUID(),\n        type: \"model_selection\",\n        priority: \"low\",\n        timestamp: Date.now(),\n        impacts: [\"cost_reduction\"],\n        estimatedSavings: {\n          tokens: 0,\n          cost: efficiency.costPerUsefulToken * 0.1,\n          latencyMs: 0,\n        },\n        title: \"Consider smaller context model\",\n        description: `Only ${(efficiency.contextUtilization * 100).toFixed(1)}% of context window is used. A model with smaller context might be more cost-effective.`,\n        currentState: `${(efficiency.contextUtilization * 100).toFixed(1)}% context utilization`,\n        recommendedAction: \"Evaluate if a model with smaller context window (and lower cost) would suffice\",\n        effort: \"easy\",\n        riskLevel: \"low\",\n        status: \"suggested\",\n      };\n      optimizations.push(optimization);\n      await this.storage.saveOptimization(optimization);\n      this.emit(\"optimizationFound\", optimization);\n    }\n\n    return optimizations;\n  }\n\n  private scheduleOptimizationScan(): void {\n    const interval = setInterval(async () => {\n      try {\n        await this.scanForOptimizations();\n      } catch (error) {\n        this.emit(\"error\", error as Error);\n      }\n    }, this.config.optimizationScanIntervalHours * 60 * 60 * 1000);\n\n    this.intervals.set(\"optimization\", interval);\n  }\n\n  // ===========================================================================\n  // Summary & Reporting\n  // ===========================================================================\n\n  async generateSummary(options: {\n    startTime: number;\n    endTime: number;\n    granularity?: TimeGranularity;\n  }): Promise<TokenAnalyticsSummary> {\n    const granularity = options.granularity || this.config.defaultGranularity;\n\n    const timeSeries = await this.storage.getTimeSeries({\n      granularity,\n      startTime: options.startTime,\n      endTime: options.endTime,\n    });\n\n    const points = timeSeries.points;\n    const totals = points.reduce(\n      (acc, p) => ({\n        tokens: acc.tokens + p.totalTokens,\n        cost: acc.cost + p.cost,\n        requests: acc.requests + p.requests,\n      }),\n      { tokens: 0, cost: 0, requests: 0 }\n    );\n\n    // Get previous period for comparison\n    const periodMs = options.endTime - options.startTime;\n    const prevTimeSeries = await this.storage.getTimeSeries({\n      granularity,\n      startTime: options.startTime - periodMs,\n      endTime: options.startTime,\n    });\n\n    const prevTotals = prevTimeSeries.points.reduce(\n      (acc, p) => ({\n        tokens: acc.tokens + p.totalTokens,\n        cost: acc.cost + p.cost,\n        requests: acc.requests + p.requests,\n      }),\n      { tokens: 0, cost: 0, requests: 0 }\n    );\n\n    // Get efficiency\n    const efficiency = await this.analyzeEfficiency({\n      startTime: options.startTime,\n      endTime: options.endTime,\n    });\n\n    // Get anomalies\n    const anomalies = await this.storage.getAnomalies({\n      startTime: options.startTime,\n      endTime: options.endTime,\n      acknowledged: false,\n    });\n\n    // Get optimizations\n    const optimizations = await this.storage.getOptimizations(\"suggested\");\n\n    // Get forecast\n    const forecast = await this.storage.getForecast();\n\n    // Calculate changes\n    const tokenChange = prevTotals.tokens > 0\n      ? ((totals.tokens - prevTotals.tokens) / prevTotals.tokens) * 100\n      : 0;\n    const costChange = prevTotals.cost > 0\n      ? ((totals.cost - prevTotals.cost) / prevTotals.cost) * 100\n      : 0;\n    const requestChange = prevTotals.requests > 0\n      ? ((totals.requests - prevTotals.requests) / prevTotals.requests) * 100\n      : 0;\n\n    // Group anomalies by type\n    const anomaliesByType: Record<string, number> = {};\n    for (const a of anomalies) {\n      anomaliesByType[a.type] = (anomaliesByType[a.type] || 0) + 1;\n    }\n\n    const summary: TokenAnalyticsSummary = {\n      period: {\n        start: options.startTime,\n        end: options.endTime,\n        granularity,\n      },\n      totalTokens: totals.tokens,\n      totalCost: totals.cost,\n      totalRequests: totals.requests,\n      uniqueModels: 0, // Would need model tracking\n      uniqueProjects: 0, // Would need project tracking\n      tokenChange,\n      costChange,\n      requestChange,\n      overallEfficiency: efficiency,\n      efficiencyTrend: efficiency.overallScore > 60 ? \"improving\" : efficiency.overallScore < 40 ? \"declining\" : \"stable\",\n      topModels: [], // Would need model aggregation\n      topProjects: [], // Would need project aggregation\n      activeAnomalies: anomalies.length,\n      anomaliesByType: anomaliesByType as Record<TokenAnomalyType, number>,\n      pendingOptimizations: optimizations.length,\n      potentialSavings: optimizations.reduce((sum, o) => sum + o.estimatedSavings.cost, 0),\n      forecast: forecast || undefined,\n    };\n\n    this.emit(\"summaryGenerated\", summary);\n    return summary;\n  }\n\n  // ===========================================================================\n  // Query Methods\n  // ===========================================================================\n\n  async getTimeSeries(options: {\n    granularity: TimeGranularity;\n    startTime: number;\n    endTime: number;\n    projectId?: string;\n    model?: string;\n  }): Promise<TokenTimeSeries> {\n    return this.storage.getTimeSeries(options);\n  }\n\n  async getAnomalies(options?: {\n    type?: TokenAnomalyType;\n    severity?: string;\n    acknowledged?: boolean;\n    startTime?: number;\n    endTime?: number;\n  }): Promise<TokenAnomaly[]> {\n    return this.storage.getAnomalies(options);\n  }\n\n  async acknowledgeAnomaly(anomalyId: string): Promise<void> {\n    await this.storage.acknowledgeAnomaly(anomalyId);\n  }\n\n  async resolveAnomaly(anomalyId: string): Promise<void> {\n    await this.storage.resolveAnomaly(anomalyId);\n    this.emit(\"anomalyResolved\", anomalyId);\n  }\n\n  async getOptimizations(status?: string): Promise<TokenOptimization[]> {\n    return this.storage.getOptimizations(status);\n  }\n\n  async implementOptimization(\n    id: string,\n    actualSavings?: { tokens: number; cost: number }\n  ): Promise<void> {\n    await this.storage.updateOptimizationStatus(id, \"implemented\", actualSavings);\n    const optimizations = await this.storage.getOptimizations();\n    const opt = optimizations.find((o) => o.id === id);\n    if (opt) {\n      this.emit(\"optimizationImplemented\", opt);\n    }\n  }\n\n  async getForecast(projectId?: string): Promise<TokenForecast | null> {\n    return this.storage.getForecast(projectId);\n  }\n}\n\n// =============================================================================\n// Singleton & Factory\n// =============================================================================\n\nlet defaultManager: TokenAnalyticsManager | null = null;\n\nexport function getTokenAnalyticsManager(): TokenAnalyticsManager {\n  if (!defaultManager) {\n    defaultManager = new TokenAnalyticsManager();\n  }\n  return defaultManager;\n}\n\nexport function createTokenAnalyticsManager(\n  config?: Partial<TokenAnalyticsConfig>,\n  storage?: TokenAnalyticsStorage\n): TokenAnalyticsManager {\n  return new TokenAnalyticsManager(config, storage);\n}\n","/**\n * Prompt Manager Types\n * Phase 16C: AI Operations - Prompt Template Management\n */\n\nimport { z } from \"zod\";\n\n// =============================================================================\n// Prompt Templates\n// =============================================================================\n\nexport const PromptTypeSchema = z.enum([\n  \"system\",\n  \"user\",\n  \"assistant\",\n  \"function\",\n  \"tool\",\n  \"completion\",\n  \"chat\",\n  \"few_shot\",\n  \"chain_of_thought\",\n]);\nexport type PromptType = z.infer<typeof PromptTypeSchema>;\n\nexport const PromptStatusSchema = z.enum([\n  \"draft\",\n  \"review\",\n  \"active\",\n  \"deprecated\",\n  \"archived\",\n]);\nexport type PromptStatus = z.infer<typeof PromptStatusSchema>;\n\nexport const VariableTypeSchema = z.enum([\n  \"string\",\n  \"number\",\n  \"boolean\",\n  \"array\",\n  \"object\",\n  \"json\",\n]);\nexport type VariableType = z.infer<typeof VariableTypeSchema>;\n\nexport const PromptVariableSchema = z.object({\n  name: z.string(),\n  type: VariableTypeSchema,\n  description: z.string().optional(),\n  required: z.boolean().default(true),\n  defaultValue: z.unknown().optional(),\n  validation: z.object({\n    minLength: z.number().optional(),\n    maxLength: z.number().optional(),\n    pattern: z.string().optional(),\n    enum: z.array(z.unknown()).optional(),\n    min: z.number().optional(),\n    max: z.number().optional(),\n  }).optional(),\n  examples: z.array(z.unknown()).optional(),\n});\nexport type PromptVariable = z.infer<typeof PromptVariableSchema>;\n\nexport const PromptTemplateSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  slug: z.string().describe(\"URL-friendly identifier\"),\n  description: z.string().optional(),\n  type: PromptTypeSchema,\n  status: PromptStatusSchema.default(\"draft\"),\n\n  // Content\n  content: z.string().describe(\"Template with {{variable}} placeholders\"),\n  systemPrompt: z.string().optional(),\n  fewShotExamples: z.array(z.object({\n    input: z.string(),\n    output: z.string(),\n    explanation: z.string().optional(),\n  })).optional(),\n\n  // Variables\n  variables: z.array(PromptVariableSchema).default([]),\n\n  // Model constraints\n  recommendedModels: z.array(z.string()).optional(),\n  maxTokens: z.number().optional(),\n  temperature: z.number().min(0).max(2).optional(),\n  topP: z.number().min(0).max(1).optional(),\n\n  // Metadata\n  tags: z.array(z.string()).default([]),\n  category: z.string().optional(),\n  author: z.string().optional(),\n\n  // Versioning\n  version: z.string().default(\"1.0.0\"),\n  parentId: z.string().optional().describe(\"ID of parent template if forked\"),\n  changelog: z.string().optional(),\n\n  // Analytics\n  usageCount: z.number().default(0),\n  avgTokens: z.number().optional(),\n  avgLatencyMs: z.number().optional(),\n  successRate: z.number().optional(),\n\n  // Timestamps\n  createdAt: z.number(),\n  updatedAt: z.number(),\n  publishedAt: z.number().optional(),\n  deprecatedAt: z.number().optional(),\n});\nexport type PromptTemplate = z.infer<typeof PromptTemplateSchema>;\n\n// =============================================================================\n// Prompt Versions\n// =============================================================================\n\nexport const PromptVersionSchema = z.object({\n  id: z.string(),\n  templateId: z.string(),\n  version: z.string(),\n  content: z.string(),\n  systemPrompt: z.string().optional(),\n  fewShotExamples: z.array(z.object({\n    input: z.string(),\n    output: z.string(),\n    explanation: z.string().optional(),\n  })).optional(),\n  variables: z.array(PromptVariableSchema),\n  changelog: z.string().optional(),\n  author: z.string().optional(),\n  createdAt: z.number(),\n\n  // Performance at this version\n  usageCount: z.number().default(0),\n  avgTokens: z.number().optional(),\n  avgLatencyMs: z.number().optional(),\n  successRate: z.number().optional(),\n});\nexport type PromptVersion = z.infer<typeof PromptVersionSchema>;\n\n// =============================================================================\n// Prompt Execution\n// =============================================================================\n\nexport const PromptExecutionSchema = z.object({\n  id: z.string(),\n  templateId: z.string(),\n  version: z.string(),\n  timestamp: z.number(),\n\n  // Input\n  variables: z.record(z.unknown()),\n  renderedPrompt: z.string(),\n\n  // Model\n  model: z.string(),\n  provider: z.string(),\n\n  // Output\n  response: z.string().optional(),\n  functionCalls: z.array(z.object({\n    name: z.string(),\n    arguments: z.record(z.unknown()),\n    result: z.unknown().optional(),\n  })).optional(),\n\n  // Metrics\n  inputTokens: z.number(),\n  outputTokens: z.number(),\n  totalTokens: z.number(),\n  latencyMs: z.number(),\n  cost: z.number(),\n\n  // Quality\n  success: z.boolean(),\n  errorCode: z.string().optional(),\n  errorMessage: z.string().optional(),\n\n  // Feedback\n  rating: z.number().min(1).max(5).optional(),\n  feedback: z.string().optional(),\n  flagged: z.boolean().default(false),\n  flagReason: z.string().optional(),\n\n  // Context\n  userId: z.string().optional(),\n  sessionId: z.string().optional(),\n  experimentId: z.string().optional(),\n  variantId: z.string().optional(),\n});\nexport type PromptExecution = z.infer<typeof PromptExecutionSchema>;\n\n// =============================================================================\n// A/B Testing\n// =============================================================================\n\nexport const ExperimentStatusSchema = z.enum([\n  \"draft\",\n  \"running\",\n  \"paused\",\n  \"completed\",\n  \"cancelled\",\n]);\nexport type ExperimentStatus = z.infer<typeof ExperimentStatusSchema>;\n\nexport const ExperimentVariantSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  description: z.string().optional(),\n  templateId: z.string(),\n  version: z.string(),\n  weight: z.number().min(0).max(100).describe(\"Percentage of traffic\"),\n\n  // Metrics\n  impressions: z.number().default(0),\n  conversions: z.number().default(0),\n  avgRating: z.number().optional(),\n  avgLatencyMs: z.number().optional(),\n  avgTokens: z.number().optional(),\n  avgCost: z.number().optional(),\n  successRate: z.number().optional(),\n});\nexport type ExperimentVariant = z.infer<typeof ExperimentVariantSchema>;\n\nexport const ExperimentSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  description: z.string().optional(),\n  hypothesis: z.string().optional(),\n\n  // Status\n  status: ExperimentStatusSchema,\n\n  // Variants\n  variants: z.array(ExperimentVariantSchema).min(2),\n  controlVariantId: z.string().describe(\"ID of the control/baseline variant\"),\n\n  // Configuration\n  sampleSize: z.number().optional().describe(\"Target sample size per variant\"),\n  confidenceLevel: z.number().default(0.95),\n  minimumDetectableEffect: z.number().default(0.05).describe(\"Minimum effect size to detect\"),\n\n  // Targeting\n  targetAudience: z.object({\n    userIds: z.array(z.string()).optional(),\n    userPercentage: z.number().min(0).max(100).optional(),\n    conditions: z.array(z.object({\n      field: z.string(),\n      operator: z.enum([\"eq\", \"neq\", \"gt\", \"lt\", \"in\", \"contains\"]),\n      value: z.unknown(),\n    })).optional(),\n  }).optional(),\n\n  // Metrics\n  primaryMetric: z.enum([\"conversion\", \"rating\", \"latency\", \"cost\", \"tokens\", \"success_rate\"]),\n  secondaryMetrics: z.array(z.enum([\"conversion\", \"rating\", \"latency\", \"cost\", \"tokens\", \"success_rate\"])).optional(),\n\n  // Timestamps\n  createdAt: z.number(),\n  startedAt: z.number().optional(),\n  endedAt: z.number().optional(),\n  scheduledStart: z.number().optional(),\n  scheduledEnd: z.number().optional(),\n\n  // Results\n  winningVariantId: z.string().optional(),\n  statisticalSignificance: z.number().optional(),\n  conclusionNotes: z.string().optional(),\n});\nexport type Experiment = z.infer<typeof ExperimentSchema>;\n\nexport const ExperimentResultSchema = z.object({\n  experimentId: z.string(),\n  calculatedAt: z.number(),\n\n  // Per variant\n  variantResults: z.array(z.object({\n    variantId: z.string(),\n    impressions: z.number(),\n    conversions: z.number(),\n    conversionRate: z.number(),\n    avgRating: z.number().optional(),\n    avgLatencyMs: z.number(),\n    avgTokens: z.number(),\n    avgCost: z.number(),\n    successRate: z.number(),\n  })),\n\n  // Statistical analysis\n  isSignificant: z.boolean(),\n  pValue: z.number(),\n  confidenceInterval: z.object({\n    lower: z.number(),\n    upper: z.number(),\n  }),\n  effectSize: z.number(),\n\n  // Recommendation\n  recommendedVariant: z.string().optional(),\n  recommendation: z.string(),\n});\nexport type ExperimentResult = z.infer<typeof ExperimentResultSchema>;\n\n// =============================================================================\n// Prompt Chains\n// =============================================================================\n\nexport const ChainStepSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  templateId: z.string(),\n  order: z.number(),\n\n  // Input mapping\n  inputMapping: z.record(z.string()).describe(\"Map chain context to template variables\"),\n\n  // Output handling\n  outputKey: z.string().describe(\"Key to store output in chain context\"),\n  parseOutput: z.enum([\"text\", \"json\", \"lines\", \"regex\"]).default(\"text\"),\n  parseConfig: z.object({\n    regex: z.string().optional(),\n    jsonPath: z.string().optional(),\n  }).optional(),\n\n  // Conditions\n  condition: z.string().optional().describe(\"JavaScript expression to evaluate\"),\n  skipOnFailure: z.boolean().default(false),\n  retryOnFailure: z.number().default(0),\n\n  // Branching\n  nextStepOnSuccess: z.string().optional(),\n  nextStepOnFailure: z.string().optional(),\n});\nexport type ChainStep = z.infer<typeof ChainStepSchema>;\n\nexport const PromptChainSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  description: z.string().optional(),\n  status: PromptStatusSchema,\n\n  // Steps\n  steps: z.array(ChainStepSchema),\n  startStepId: z.string(),\n\n  // Global variables\n  inputVariables: z.array(PromptVariableSchema),\n  outputMapping: z.record(z.string()).describe(\"Map final context to chain output\"),\n\n  // Configuration\n  maxSteps: z.number().default(10),\n  timeoutMs: z.number().default(60000),\n  parallelExecution: z.boolean().default(false),\n\n  // Metadata\n  tags: z.array(z.string()).default([]),\n  author: z.string().optional(),\n  createdAt: z.number(),\n  updatedAt: z.number(),\n});\nexport type PromptChain = z.infer<typeof PromptChainSchema>;\n\nexport const ChainExecutionSchema = z.object({\n  id: z.string(),\n  chainId: z.string(),\n  timestamp: z.number(),\n\n  // Input/Output\n  input: z.record(z.unknown()),\n  output: z.record(z.unknown()).optional(),\n  context: z.record(z.unknown()),\n\n  // Steps\n  stepExecutions: z.array(z.object({\n    stepId: z.string(),\n    templateId: z.string(),\n    startedAt: z.number(),\n    completedAt: z.number().optional(),\n    status: z.enum([\"pending\", \"running\", \"completed\", \"failed\", \"skipped\"]),\n    input: z.record(z.unknown()),\n    output: z.unknown().optional(),\n    error: z.string().optional(),\n    tokens: z.number().optional(),\n    cost: z.number().optional(),\n  })),\n\n  // Metrics\n  totalSteps: z.number(),\n  completedSteps: z.number(),\n  totalTokens: z.number(),\n  totalCost: z.number(),\n  totalLatencyMs: z.number(),\n\n  // Status\n  status: z.enum([\"pending\", \"running\", \"completed\", \"failed\", \"cancelled\"]),\n  error: z.string().optional(),\n});\nexport type ChainExecution = z.infer<typeof ChainExecutionSchema>;\n\n// =============================================================================\n// Prompt Optimization\n// =============================================================================\n\nexport const OptimizationGoalSchema = z.enum([\n  \"reduce_tokens\",\n  \"improve_quality\",\n  \"reduce_latency\",\n  \"reduce_cost\",\n  \"improve_consistency\",\n]);\nexport type OptimizationGoal = z.infer<typeof OptimizationGoalSchema>;\n\nexport const PromptOptimizationSchema = z.object({\n  id: z.string(),\n  templateId: z.string(),\n  timestamp: z.number(),\n\n  // Goal\n  goal: OptimizationGoalSchema,\n\n  // Original\n  originalContent: z.string(),\n  originalTokens: z.number(),\n  originalMetrics: z.object({\n    avgLatencyMs: z.number().optional(),\n    avgCost: z.number().optional(),\n    successRate: z.number().optional(),\n    avgRating: z.number().optional(),\n  }),\n\n  // Optimized\n  optimizedContent: z.string(),\n  optimizedTokens: z.number(),\n  estimatedImprovement: z.object({\n    tokenReduction: z.number().optional(),\n    latencyReduction: z.number().optional(),\n    costReduction: z.number().optional(),\n    qualityImprovement: z.number().optional(),\n  }),\n\n  // Techniques applied\n  techniques: z.array(z.enum([\n    \"compression\",\n    \"deduplication\",\n    \"simplification\",\n    \"restructuring\",\n    \"few_shot_reduction\",\n    \"instruction_refinement\",\n  ])),\n\n  // Validation\n  validationStatus: z.enum([\"pending\", \"passed\", \"failed\"]),\n  validationNotes: z.string().optional(),\n\n  // Applied\n  applied: z.boolean().default(false),\n  appliedAt: z.number().optional(),\n  actualImprovement: z.object({\n    tokenReduction: z.number().optional(),\n    latencyReduction: z.number().optional(),\n    costReduction: z.number().optional(),\n    qualityChange: z.number().optional(),\n  }).optional(),\n});\nexport type PromptOptimization = z.infer<typeof PromptOptimizationSchema>;\n\n// =============================================================================\n// Prompt Library\n// =============================================================================\n\nexport const PromptCollectionSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  description: z.string().optional(),\n  templateIds: z.array(z.string()),\n  chainIds: z.array(z.string()).default([]),\n  isPublic: z.boolean().default(false),\n  author: z.string().optional(),\n  tags: z.array(z.string()).default([]),\n  createdAt: z.number(),\n  updatedAt: z.number(),\n});\nexport type PromptCollection = z.infer<typeof PromptCollectionSchema>;\n\n// =============================================================================\n// Configuration\n// =============================================================================\n\nexport const PromptManagerConfigSchema = z.object({\n  // General\n  enabled: z.boolean().default(true),\n\n  // Versioning\n  autoVersionOnEdit: z.boolean().default(true),\n  maxVersionsToKeep: z.number().default(50),\n\n  // Validation\n  validateVariablesOnRender: z.boolean().default(true),\n  strictVariableValidation: z.boolean().default(false),\n\n  // Caching\n  cacheRenderedPrompts: z.boolean().default(true),\n  cacheTTLSeconds: z.number().default(300),\n\n  // Experiments\n  defaultConfidenceLevel: z.number().default(0.95),\n  minSampleSizePerVariant: z.number().default(100),\n\n  // Optimization\n  autoOptimizationEnabled: z.boolean().default(false),\n  optimizationThreshold: z.number().default(1000).describe(\"Min tokens to suggest optimization\"),\n\n  // Analytics\n  trackExecutions: z.boolean().default(true),\n  executionRetentionDays: z.number().default(30),\n\n  // Rate limiting\n  maxRendersPerMinute: z.number().default(1000),\n});\nexport type PromptManagerConfig = z.infer<typeof PromptManagerConfigSchema>;\n\n// =============================================================================\n// Events\n// =============================================================================\n\nexport type PromptManagerEvents = {\n  // Templates\n  templateCreated: (template: PromptTemplate) => void;\n  templateUpdated: (template: PromptTemplate) => void;\n  templatePublished: (template: PromptTemplate) => void;\n  templateDeprecated: (template: PromptTemplate) => void;\n  templateDeleted: (templateId: string) => void;\n\n  // Versions\n  versionCreated: (version: PromptVersion) => void;\n\n  // Execution\n  promptRendered: (templateId: string, variables: Record<string, unknown>) => void;\n  promptExecuted: (execution: PromptExecution) => void;\n  executionFailed: (execution: PromptExecution, error: Error) => void;\n\n  // Experiments\n  experimentCreated: (experiment: Experiment) => void;\n  experimentStarted: (experiment: Experiment) => void;\n  experimentCompleted: (experiment: Experiment, result: ExperimentResult) => void;\n  variantSelected: (experimentId: string, variantId: string, userId?: string) => void;\n\n  // Chains\n  chainExecutionStarted: (execution: ChainExecution) => void;\n  chainStepCompleted: (chainId: string, stepId: string) => void;\n  chainExecutionCompleted: (execution: ChainExecution) => void;\n  chainExecutionFailed: (execution: ChainExecution, error: Error) => void;\n\n  // Optimization\n  optimizationSuggested: (optimization: PromptOptimization) => void;\n  optimizationApplied: (optimization: PromptOptimization) => void;\n\n  // Errors\n  error: (error: Error) => void;\n};\n\n// =============================================================================\n// Storage Interface\n// =============================================================================\n\nexport interface PromptStorage {\n  // Templates\n  saveTemplate(template: PromptTemplate): Promise<void>;\n  getTemplate(id: string): Promise<PromptTemplate | null>;\n  getTemplateBySlug(slug: string): Promise<PromptTemplate | null>;\n  listTemplates(options?: {\n    status?: PromptStatus;\n    type?: PromptType;\n    category?: string;\n    tags?: string[];\n  }): Promise<PromptTemplate[]>;\n  deleteTemplate(id: string): Promise<void>;\n\n  // Versions\n  saveVersion(version: PromptVersion): Promise<void>;\n  getVersion(id: string): Promise<PromptVersion | null>;\n  listVersions(templateId: string): Promise<PromptVersion[]>;\n\n  // Executions\n  saveExecution(execution: PromptExecution): Promise<void>;\n  getExecution(id: string): Promise<PromptExecution | null>;\n  listExecutions(templateId: string, options?: {\n    limit?: number;\n    startTime?: number;\n    endTime?: number;\n  }): Promise<PromptExecution[]>;\n\n  // Experiments\n  saveExperiment(experiment: Experiment): Promise<void>;\n  getExperiment(id: string): Promise<Experiment | null>;\n  listExperiments(status?: ExperimentStatus): Promise<Experiment[]>;\n\n  // Chains\n  saveChain(chain: PromptChain): Promise<void>;\n  getChain(id: string): Promise<PromptChain | null>;\n  listChains(): Promise<PromptChain[]>;\n  saveChainExecution(execution: ChainExecution): Promise<void>;\n  getChainExecution(id: string): Promise<ChainExecution | null>;\n\n  // Collections\n  saveCollection(collection: PromptCollection): Promise<void>;\n  getCollection(id: string): Promise<PromptCollection | null>;\n  listCollections(): Promise<PromptCollection[]>;\n\n  // Optimizations\n  saveOptimization(optimization: PromptOptimization): Promise<void>;\n  getOptimizations(templateId: string): Promise<PromptOptimization[]>;\n}\n\n// =============================================================================\n// Helpers\n// =============================================================================\n\nexport function parseTemplateVariables(content: string): string[] {\n  const regex = /\\{\\{([^}]+)\\}\\}/g;\n  const variables: string[] = [];\n  let match;\n  while ((match = regex.exec(content)) !== null) {\n    const varName = match[1].trim().split(\"|\")[0].trim(); // Handle filters like {{var|default}}\n    if (!variables.includes(varName)) {\n      variables.push(varName);\n    }\n  }\n  return variables;\n}\n\nexport function renderTemplate(\n  content: string,\n  variables: Record<string, unknown>,\n  options: { strict?: boolean } = {}\n): string {\n  return content.replace(/\\{\\{([^}]+)\\}\\}/g, (match, expr) => {\n    const parts = expr.trim().split(\"|\");\n    const varName = parts[0].trim();\n    const defaultValue = parts[1]?.trim();\n\n    if (varName in variables) {\n      const value = variables[varName];\n      return String(value);\n    }\n\n    if (defaultValue !== undefined) {\n      return defaultValue;\n    }\n\n    if (options.strict) {\n      throw new Error(`Missing required variable: ${varName}`);\n    }\n\n    return match;\n  });\n}\n\nexport function validateVariables(\n  variables: Record<string, unknown>,\n  definitions: PromptVariable[]\n): { valid: boolean; errors: string[] } {\n  const errors: string[] = [];\n\n  for (const def of definitions) {\n    const value = variables[def.name];\n\n    // Check required\n    if (def.required && (value === undefined || value === null)) {\n      errors.push(`Missing required variable: ${def.name}`);\n      continue;\n    }\n\n    if (value === undefined || value === null) continue;\n\n    // Type checking\n    switch (def.type) {\n      case \"string\":\n        if (typeof value !== \"string\") {\n          errors.push(`${def.name} must be a string`);\n        } else if (def.validation) {\n          if (def.validation.minLength && value.length < def.validation.minLength) {\n            errors.push(`${def.name} must be at least ${def.validation.minLength} characters`);\n          }\n          if (def.validation.maxLength && value.length > def.validation.maxLength) {\n            errors.push(`${def.name} must be at most ${def.validation.maxLength} characters`);\n          }\n          if (def.validation.pattern && !new RegExp(def.validation.pattern).test(value)) {\n            errors.push(`${def.name} does not match required pattern`);\n          }\n        }\n        break;\n\n      case \"number\":\n        if (typeof value !== \"number\") {\n          errors.push(`${def.name} must be a number`);\n        } else if (def.validation) {\n          if (def.validation.min !== undefined && value < def.validation.min) {\n            errors.push(`${def.name} must be at least ${def.validation.min}`);\n          }\n          if (def.validation.max !== undefined && value > def.validation.max) {\n            errors.push(`${def.name} must be at most ${def.validation.max}`);\n          }\n        }\n        break;\n\n      case \"boolean\":\n        if (typeof value !== \"boolean\") {\n          errors.push(`${def.name} must be a boolean`);\n        }\n        break;\n\n      case \"array\":\n        if (!Array.isArray(value)) {\n          errors.push(`${def.name} must be an array`);\n        }\n        break;\n\n      case \"object\":\n      case \"json\":\n        if (typeof value !== \"object\" || value === null || Array.isArray(value)) {\n          errors.push(`${def.name} must be an object`);\n        }\n        break;\n    }\n\n    // Enum validation\n    if (def.validation?.enum && !def.validation.enum.includes(value)) {\n      errors.push(`${def.name} must be one of: ${def.validation.enum.join(\", \")}`);\n    }\n  }\n\n  return { valid: errors.length === 0, errors };\n}\n\nexport function incrementVersion(version: string, type: \"major\" | \"minor\" | \"patch\" = \"patch\"): string {\n  const parts = version.split(\".\").map(Number);\n  if (parts.length !== 3 || parts.some(isNaN)) {\n    return \"1.0.0\";\n  }\n\n  switch (type) {\n    case \"major\":\n      return `${parts[0] + 1}.0.0`;\n    case \"minor\":\n      return `${parts[0]}.${parts[1] + 1}.0`;\n    case \"patch\":\n    default:\n      return `${parts[0]}.${parts[1]}.${parts[2] + 1}`;\n  }\n}\n","/**\n * Prompt Manager Implementation\n * Phase 16C: AI Operations - Prompt Template Management\n */\n\nimport { EventEmitter } from \"eventemitter3\";\nimport { randomUUID } from \"crypto\";\nimport {\n  type PromptManagerConfig,\n  PromptManagerConfigSchema,\n  type PromptManagerEvents,\n  type PromptStorage,\n  type PromptTemplate,\n  type PromptStatus,\n  type PromptType,\n  type PromptVariable,\n  type PromptVersion,\n  type PromptExecution,\n  type Experiment,\n  type ExperimentStatus,\n  type ExperimentVariant,\n  type ExperimentResult,\n  type PromptChain,\n  type ChainExecution,\n  type PromptOptimization,\n  type OptimizationGoal,\n  type PromptCollection,\n  parseTemplateVariables,\n  renderTemplate,\n  validateVariables,\n  incrementVersion,\n} from \"./types.js\";\n\n// =============================================================================\n// In-Memory Storage\n// =============================================================================\n\nclass InMemoryPromptStorage implements PromptStorage {\n  private templates: Map<string, PromptTemplate> = new Map();\n  private versions: Map<string, PromptVersion> = new Map();\n  private executions: Map<string, PromptExecution> = new Map();\n  private experiments: Map<string, Experiment> = new Map();\n  private chains: Map<string, PromptChain> = new Map();\n  private chainExecutions: Map<string, ChainExecution> = new Map();\n  private collections: Map<string, PromptCollection> = new Map();\n  private optimizations: Map<string, PromptOptimization> = new Map();\n\n  async saveTemplate(template: PromptTemplate): Promise<void> {\n    this.templates.set(template.id, template);\n  }\n\n  async getTemplate(id: string): Promise<PromptTemplate | null> {\n    return this.templates.get(id) || null;\n  }\n\n  async getTemplateBySlug(slug: string): Promise<PromptTemplate | null> {\n    for (const template of this.templates.values()) {\n      if (template.slug === slug) return template;\n    }\n    return null;\n  }\n\n  async listTemplates(options?: {\n    status?: PromptStatus;\n    type?: PromptType;\n    category?: string;\n    tags?: string[];\n  }): Promise<PromptTemplate[]> {\n    return Array.from(this.templates.values()).filter((t) => {\n      if (options?.status && t.status !== options.status) return false;\n      if (options?.type && t.type !== options.type) return false;\n      if (options?.category && t.category !== options.category) return false;\n      if (options?.tags && !options.tags.some((tag) => t.tags.includes(tag))) return false;\n      return true;\n    });\n  }\n\n  async deleteTemplate(id: string): Promise<void> {\n    this.templates.delete(id);\n  }\n\n  async saveVersion(version: PromptVersion): Promise<void> {\n    this.versions.set(version.id, version);\n  }\n\n  async getVersion(id: string): Promise<PromptVersion | null> {\n    return this.versions.get(id) || null;\n  }\n\n  async listVersions(templateId: string): Promise<PromptVersion[]> {\n    return Array.from(this.versions.values())\n      .filter((v) => v.templateId === templateId)\n      .sort((a, b) => b.createdAt - a.createdAt);\n  }\n\n  async saveExecution(execution: PromptExecution): Promise<void> {\n    this.executions.set(execution.id, execution);\n  }\n\n  async getExecution(id: string): Promise<PromptExecution | null> {\n    return this.executions.get(id) || null;\n  }\n\n  async listExecutions(\n    templateId: string,\n    options?: { limit?: number; startTime?: number; endTime?: number }\n  ): Promise<PromptExecution[]> {\n    let results = Array.from(this.executions.values())\n      .filter((e) => e.templateId === templateId)\n      .filter((e) => !options?.startTime || e.timestamp >= options.startTime)\n      .filter((e) => !options?.endTime || e.timestamp <= options.endTime)\n      .sort((a, b) => b.timestamp - a.timestamp);\n\n    if (options?.limit) {\n      results = results.slice(0, options.limit);\n    }\n\n    return results;\n  }\n\n  async saveExperiment(experiment: Experiment): Promise<void> {\n    this.experiments.set(experiment.id, experiment);\n  }\n\n  async getExperiment(id: string): Promise<Experiment | null> {\n    return this.experiments.get(id) || null;\n  }\n\n  async listExperiments(status?: ExperimentStatus): Promise<Experiment[]> {\n    return Array.from(this.experiments.values()).filter((e) => {\n      if (status && e.status !== status) return false;\n      return true;\n    });\n  }\n\n  async saveChain(chain: PromptChain): Promise<void> {\n    this.chains.set(chain.id, chain);\n  }\n\n  async getChain(id: string): Promise<PromptChain | null> {\n    return this.chains.get(id) || null;\n  }\n\n  async listChains(): Promise<PromptChain[]> {\n    return Array.from(this.chains.values());\n  }\n\n  async saveChainExecution(execution: ChainExecution): Promise<void> {\n    this.chainExecutions.set(execution.id, execution);\n  }\n\n  async getChainExecution(id: string): Promise<ChainExecution | null> {\n    return this.chainExecutions.get(id) || null;\n  }\n\n  async saveCollection(collection: PromptCollection): Promise<void> {\n    this.collections.set(collection.id, collection);\n  }\n\n  async getCollection(id: string): Promise<PromptCollection | null> {\n    return this.collections.get(id) || null;\n  }\n\n  async listCollections(): Promise<PromptCollection[]> {\n    return Array.from(this.collections.values());\n  }\n\n  async saveOptimization(optimization: PromptOptimization): Promise<void> {\n    this.optimizations.set(optimization.id, optimization);\n  }\n\n  async getOptimizations(templateId: string): Promise<PromptOptimization[]> {\n    return Array.from(this.optimizations.values()).filter((o) => o.templateId === templateId);\n  }\n}\n\n// =============================================================================\n// Prompt Manager\n// =============================================================================\n\nexport class PromptManager extends EventEmitter<PromptManagerEvents> {\n  private config: PromptManagerConfig;\n  private storage: PromptStorage;\n  private promptCache: Map<string, { rendered: string; timestamp: number }> = new Map();\n\n  constructor(config: Partial<PromptManagerConfig> = {}, storage?: PromptStorage) {\n    super();\n    this.config = PromptManagerConfigSchema.parse(config);\n    this.storage = storage || new InMemoryPromptStorage();\n  }\n\n  // ===========================================================================\n  // Template Management\n  // ===========================================================================\n\n  async createTemplate(input: {\n    name: string;\n    slug?: string;\n    description?: string;\n    type: PromptType;\n    content: string;\n    systemPrompt?: string;\n    fewShotExamples?: { input: string; output: string; explanation?: string }[];\n    variables?: PromptVariable[];\n    recommendedModels?: string[];\n    maxTokens?: number;\n    temperature?: number;\n    topP?: number;\n    tags?: string[];\n    category?: string;\n    author?: string;\n  }): Promise<PromptTemplate> {\n    const slug = input.slug || this.generateSlug(input.name);\n\n    // Check for duplicate slug\n    const existing = await this.storage.getTemplateBySlug(slug);\n    if (existing) {\n      throw new Error(`Template with slug \"${slug}\" already exists`);\n    }\n\n    // Extract variables from content if not provided\n    const extractedVars = parseTemplateVariables(input.content);\n    const variables = input.variables || extractedVars.map((name) => ({\n      name,\n      type: \"string\" as const,\n      required: true,\n    }));\n\n    const template: PromptTemplate = {\n      id: randomUUID(),\n      name: input.name,\n      slug,\n      description: input.description,\n      type: input.type,\n      status: \"draft\",\n      content: input.content,\n      systemPrompt: input.systemPrompt,\n      fewShotExamples: input.fewShotExamples,\n      variables,\n      recommendedModels: input.recommendedModels,\n      maxTokens: input.maxTokens,\n      temperature: input.temperature,\n      topP: input.topP,\n      tags: input.tags || [],\n      category: input.category,\n      author: input.author,\n      version: \"1.0.0\",\n      usageCount: 0,\n      createdAt: Date.now(),\n      updatedAt: Date.now(),\n    };\n\n    await this.storage.saveTemplate(template);\n\n    // Create initial version\n    await this.createVersion(template, \"Initial version\");\n\n    this.emit(\"templateCreated\", template);\n    return template;\n  }\n\n  async updateTemplate(\n    id: string,\n    updates: Partial<{\n      name: string;\n      description: string;\n      content: string;\n      systemPrompt: string;\n      fewShotExamples: { input: string; output: string; explanation?: string }[];\n      variables: PromptVariable[];\n      recommendedModels: string[];\n      maxTokens: number;\n      temperature: number;\n      topP: number;\n      tags: string[];\n      category: string;\n    }>,\n    changelog?: string\n  ): Promise<PromptTemplate | null> {\n    const template = await this.storage.getTemplate(id);\n    if (!template) return null;\n\n    // Check if content changed (for versioning)\n    const contentChanged = updates.content && updates.content !== template.content;\n\n    const updated: PromptTemplate = {\n      ...template,\n      ...updates,\n      updatedAt: Date.now(),\n    };\n\n    // Auto-version on content change\n    if (contentChanged && this.config.autoVersionOnEdit) {\n      updated.version = incrementVersion(template.version);\n      await this.createVersion(updated, changelog || \"Content updated\");\n    }\n\n    await this.storage.saveTemplate(updated);\n    this.emit(\"templateUpdated\", updated);\n    return updated;\n  }\n\n  async publishTemplate(id: string): Promise<PromptTemplate | null> {\n    const template = await this.storage.getTemplate(id);\n    if (!template) return null;\n\n    template.status = \"active\";\n    template.publishedAt = Date.now();\n    template.updatedAt = Date.now();\n\n    await this.storage.saveTemplate(template);\n    this.emit(\"templatePublished\", template);\n    return template;\n  }\n\n  async deprecateTemplate(id: string): Promise<PromptTemplate | null> {\n    const template = await this.storage.getTemplate(id);\n    if (!template) return null;\n\n    template.status = \"deprecated\";\n    template.deprecatedAt = Date.now();\n    template.updatedAt = Date.now();\n\n    await this.storage.saveTemplate(template);\n    this.emit(\"templateDeprecated\", template);\n    return template;\n  }\n\n  async deleteTemplate(id: string): Promise<boolean> {\n    const template = await this.storage.getTemplate(id);\n    if (!template) return false;\n\n    await this.storage.deleteTemplate(id);\n    this.emit(\"templateDeleted\", id);\n    return true;\n  }\n\n  async getTemplate(id: string): Promise<PromptTemplate | null> {\n    return this.storage.getTemplate(id);\n  }\n\n  async getTemplateBySlug(slug: string): Promise<PromptTemplate | null> {\n    return this.storage.getTemplateBySlug(slug);\n  }\n\n  async listTemplates(options?: {\n    status?: PromptStatus;\n    type?: PromptType;\n    category?: string;\n    tags?: string[];\n  }): Promise<PromptTemplate[]> {\n    return this.storage.listTemplates(options);\n  }\n\n  // ===========================================================================\n  // Version Management\n  // ===========================================================================\n\n  private async createVersion(template: PromptTemplate, changelog?: string): Promise<PromptVersion> {\n    const version: PromptVersion = {\n      id: randomUUID(),\n      templateId: template.id,\n      version: template.version,\n      content: template.content,\n      systemPrompt: template.systemPrompt,\n      fewShotExamples: template.fewShotExamples,\n      variables: template.variables,\n      changelog,\n      author: template.author,\n      createdAt: Date.now(),\n      usageCount: 0,\n    };\n\n    await this.storage.saveVersion(version);\n    this.emit(\"versionCreated\", version);\n\n    // Clean up old versions\n    await this.cleanupOldVersions(template.id);\n\n    return version;\n  }\n\n  private async cleanupOldVersions(templateId: string): Promise<void> {\n    const versions = await this.storage.listVersions(templateId);\n    if (versions.length <= this.config.maxVersionsToKeep) return;\n\n    const toDelete = versions.slice(this.config.maxVersionsToKeep);\n    // In a real implementation, we'd delete these versions\n    // For in-memory, the list is already sorted by createdAt desc\n  }\n\n  async listVersions(templateId: string): Promise<PromptVersion[]> {\n    return this.storage.listVersions(templateId);\n  }\n\n  async getVersion(id: string): Promise<PromptVersion | null> {\n    return this.storage.getVersion(id);\n  }\n\n  async rollbackToVersion(templateId: string, versionId: string): Promise<PromptTemplate | null> {\n    const version = await this.storage.getVersion(versionId);\n    if (!version || version.templateId !== templateId) return null;\n\n    return this.updateTemplate(templateId, {\n      content: version.content,\n      systemPrompt: version.systemPrompt,\n      fewShotExamples: version.fewShotExamples,\n      variables: version.variables,\n    }, `Rollback to version ${version.version}`);\n  }\n\n  // ===========================================================================\n  // Prompt Rendering\n  // ===========================================================================\n\n  async render(\n    templateIdOrSlug: string,\n    variables: Record<string, unknown>,\n    options: { version?: string; strict?: boolean } = {}\n  ): Promise<{ rendered: string; template: PromptTemplate }> {\n    // Try by ID first, then by slug\n    let template = await this.storage.getTemplate(templateIdOrSlug);\n    if (!template) {\n      template = await this.storage.getTemplateBySlug(templateIdOrSlug);\n    }\n\n    if (!template) {\n      throw new Error(`Template not found: ${templateIdOrSlug}`);\n    }\n\n    // Validate variables\n    if (this.config.validateVariablesOnRender) {\n      const validation = validateVariables(variables, template.variables);\n      if (!validation.valid) {\n        if (this.config.strictVariableValidation || options.strict) {\n          throw new Error(`Variable validation failed: ${validation.errors.join(\", \")}`);\n        }\n      }\n    }\n\n    // Check cache\n    const cacheKey = `${template.id}:${JSON.stringify(variables)}`;\n    if (this.config.cacheRenderedPrompts) {\n      const cached = this.promptCache.get(cacheKey);\n      if (cached && Date.now() - cached.timestamp < this.config.cacheTTLSeconds * 1000) {\n        return { rendered: cached.rendered, template };\n      }\n    }\n\n    // Render\n    const rendered = renderTemplate(template.content, variables, { strict: options.strict });\n\n    // Update cache\n    if (this.config.cacheRenderedPrompts) {\n      this.promptCache.set(cacheKey, { rendered, timestamp: Date.now() });\n    }\n\n    // Update usage count\n    template.usageCount = (template.usageCount || 0) + 1;\n    template.updatedAt = Date.now();\n    await this.storage.saveTemplate(template);\n\n    this.emit(\"promptRendered\", template.id, variables);\n    return { rendered, template };\n  }\n\n  async renderWithSystem(\n    templateIdOrSlug: string,\n    variables: Record<string, unknown>,\n    options: { version?: string; strict?: boolean } = {}\n  ): Promise<{\n    systemPrompt: string | undefined;\n    userPrompt: string;\n    template: PromptTemplate;\n  }> {\n    const { rendered, template } = await this.render(templateIdOrSlug, variables, options);\n\n    let systemPrompt = template.systemPrompt;\n    if (systemPrompt) {\n      systemPrompt = renderTemplate(systemPrompt, variables, { strict: options.strict });\n    }\n\n    return {\n      systemPrompt,\n      userPrompt: rendered,\n      template,\n    };\n  }\n\n  // ===========================================================================\n  // Execution Tracking\n  // ===========================================================================\n\n  async trackExecution(input: {\n    templateId: string;\n    version: string;\n    variables: Record<string, unknown>;\n    renderedPrompt: string;\n    model: string;\n    provider: string;\n    response?: string;\n    functionCalls?: { name: string; arguments: Record<string, unknown>; result?: unknown }[];\n    inputTokens: number;\n    outputTokens: number;\n    latencyMs: number;\n    cost: number;\n    success: boolean;\n    errorCode?: string;\n    errorMessage?: string;\n    userId?: string;\n    sessionId?: string;\n    experimentId?: string;\n    variantId?: string;\n  }): Promise<PromptExecution> {\n    const execution: PromptExecution = {\n      id: randomUUID(),\n      templateId: input.templateId,\n      version: input.version,\n      timestamp: Date.now(),\n      variables: input.variables,\n      renderedPrompt: input.renderedPrompt,\n      model: input.model,\n      provider: input.provider,\n      response: input.response,\n      functionCalls: input.functionCalls,\n      inputTokens: input.inputTokens,\n      outputTokens: input.outputTokens,\n      totalTokens: input.inputTokens + input.outputTokens,\n      latencyMs: input.latencyMs,\n      cost: input.cost,\n      success: input.success,\n      errorCode: input.errorCode,\n      errorMessage: input.errorMessage,\n      userId: input.userId,\n      sessionId: input.sessionId,\n      experimentId: input.experimentId,\n      variantId: input.variantId,\n      flagged: false,\n    };\n\n    await this.storage.saveExecution(execution);\n\n    // Update template metrics\n    const template = await this.storage.getTemplate(input.templateId);\n    if (template) {\n      const executions = await this.storage.listExecutions(input.templateId, { limit: 100 });\n      template.avgTokens = executions.reduce((sum, e) => sum + e.totalTokens, 0) / executions.length;\n      template.avgLatencyMs = executions.reduce((sum, e) => sum + e.latencyMs, 0) / executions.length;\n      template.successRate = executions.filter((e) => e.success).length / executions.length;\n      await this.storage.saveTemplate(template);\n    }\n\n    // Update experiment metrics if part of experiment\n    if (input.experimentId && input.variantId) {\n      await this.updateExperimentMetrics(input.experimentId, input.variantId, execution);\n    }\n\n    this.emit(\"promptExecuted\", execution);\n    return execution;\n  }\n\n  async rateExecution(executionId: string, rating: number, feedback?: string): Promise<void> {\n    const execution = await this.storage.getExecution(executionId);\n    if (!execution) throw new Error(\"Execution not found\");\n\n    execution.rating = rating;\n    execution.feedback = feedback;\n    await this.storage.saveExecution(execution);\n  }\n\n  async flagExecution(executionId: string, reason: string): Promise<void> {\n    const execution = await this.storage.getExecution(executionId);\n    if (!execution) throw new Error(\"Execution not found\");\n\n    execution.flagged = true;\n    execution.flagReason = reason;\n    await this.storage.saveExecution(execution);\n  }\n\n  // ===========================================================================\n  // A/B Testing\n  // ===========================================================================\n\n  async createExperiment(input: {\n    name: string;\n    description?: string;\n    hypothesis?: string;\n    variants: {\n      name: string;\n      description?: string;\n      templateId: string;\n      version: string;\n      weight: number;\n    }[];\n    controlVariantIndex?: number;\n    sampleSize?: number;\n    confidenceLevel?: number;\n    minimumDetectableEffect?: number;\n    primaryMetric: \"conversion\" | \"rating\" | \"latency\" | \"cost\" | \"tokens\" | \"success_rate\";\n    secondaryMetrics?: (\"conversion\" | \"rating\" | \"latency\" | \"cost\" | \"tokens\" | \"success_rate\")[];\n    targetAudience?: {\n      userIds?: string[];\n      userPercentage?: number;\n    };\n    scheduledStart?: number;\n    scheduledEnd?: number;\n  }): Promise<Experiment> {\n    const variants: ExperimentVariant[] = input.variants.map((v) => ({\n      id: randomUUID(),\n      name: v.name,\n      description: v.description,\n      templateId: v.templateId,\n      version: v.version,\n      weight: v.weight,\n      impressions: 0,\n      conversions: 0,\n    }));\n\n    const experiment: Experiment = {\n      id: randomUUID(),\n      name: input.name,\n      description: input.description,\n      hypothesis: input.hypothesis,\n      status: \"draft\",\n      variants,\n      controlVariantId: variants[input.controlVariantIndex || 0].id,\n      sampleSize: input.sampleSize,\n      confidenceLevel: input.confidenceLevel || this.config.defaultConfidenceLevel,\n      minimumDetectableEffect: input.minimumDetectableEffect || 0.05,\n      targetAudience: input.targetAudience,\n      primaryMetric: input.primaryMetric,\n      secondaryMetrics: input.secondaryMetrics,\n      createdAt: Date.now(),\n      scheduledStart: input.scheduledStart,\n      scheduledEnd: input.scheduledEnd,\n    };\n\n    await this.storage.saveExperiment(experiment);\n    this.emit(\"experimentCreated\", experiment);\n    return experiment;\n  }\n\n  async startExperiment(id: string): Promise<Experiment | null> {\n    const experiment = await this.storage.getExperiment(id);\n    if (!experiment) return null;\n\n    experiment.status = \"running\";\n    experiment.startedAt = Date.now();\n    await this.storage.saveExperiment(experiment);\n\n    this.emit(\"experimentStarted\", experiment);\n    return experiment;\n  }\n\n  async pauseExperiment(id: string): Promise<Experiment | null> {\n    const experiment = await this.storage.getExperiment(id);\n    if (!experiment) return null;\n\n    experiment.status = \"paused\";\n    await this.storage.saveExperiment(experiment);\n    return experiment;\n  }\n\n  async completeExperiment(id: string, winningVariantId?: string, conclusionNotes?: string): Promise<Experiment | null> {\n    const experiment = await this.storage.getExperiment(id);\n    if (!experiment) return null;\n\n    experiment.status = \"completed\";\n    experiment.endedAt = Date.now();\n    experiment.winningVariantId = winningVariantId;\n    experiment.conclusionNotes = conclusionNotes;\n\n    // Calculate statistical significance\n    const result = await this.calculateExperimentResults(experiment);\n    experiment.statisticalSignificance = result.pValue;\n\n    await this.storage.saveExperiment(experiment);\n    this.emit(\"experimentCompleted\", experiment, result);\n    return experiment;\n  }\n\n  async selectVariant(experimentId: string, userId?: string): Promise<ExperimentVariant | null> {\n    const experiment = await this.storage.getExperiment(experimentId);\n    if (!experiment || experiment.status !== \"running\") return null;\n\n    // Check target audience\n    if (experiment.targetAudience) {\n      if (experiment.targetAudience.userIds && userId) {\n        if (!experiment.targetAudience.userIds.includes(userId)) {\n          return null;\n        }\n      }\n      if (experiment.targetAudience.userPercentage) {\n        // Simple hash-based bucketing\n        const bucket = userId ? this.hashToBucket(userId) : Math.random() * 100;\n        if (bucket > experiment.targetAudience.userPercentage) {\n          return null;\n        }\n      }\n    }\n\n    // Weighted random selection\n    const totalWeight = experiment.variants.reduce((sum, v) => sum + v.weight, 0);\n    let random = Math.random() * totalWeight;\n\n    for (const variant of experiment.variants) {\n      random -= variant.weight;\n      if (random <= 0) {\n        // Update impressions\n        variant.impressions++;\n        await this.storage.saveExperiment(experiment);\n        this.emit(\"variantSelected\", experimentId, variant.id, userId);\n        return variant;\n      }\n    }\n\n    return experiment.variants[0];\n  }\n\n  private hashToBucket(str: string): number {\n    let hash = 0;\n    for (let i = 0; i < str.length; i++) {\n      const char = str.charCodeAt(i);\n      hash = ((hash << 5) - hash) + char;\n      hash = hash & hash;\n    }\n    return Math.abs(hash) % 100;\n  }\n\n  private async updateExperimentMetrics(\n    experimentId: string,\n    variantId: string,\n    execution: PromptExecution\n  ): Promise<void> {\n    const experiment = await this.storage.getExperiment(experimentId);\n    if (!experiment) return;\n\n    const variant = experiment.variants.find((v) => v.id === variantId);\n    if (!variant) return;\n\n    // Update metrics\n    const executions = await this.storage.listExecutions(variant.templateId);\n    const variantExecs = executions.filter((e) => e.variantId === variantId);\n\n    if (variantExecs.length > 0) {\n      variant.avgLatencyMs = variantExecs.reduce((sum, e) => sum + e.latencyMs, 0) / variantExecs.length;\n      variant.avgTokens = variantExecs.reduce((sum, e) => sum + e.totalTokens, 0) / variantExecs.length;\n      variant.avgCost = variantExecs.reduce((sum, e) => sum + e.cost, 0) / variantExecs.length;\n      variant.successRate = variantExecs.filter((e) => e.success).length / variantExecs.length;\n      variant.avgRating = variantExecs.filter((e) => e.rating).reduce((sum, e) => sum + (e.rating || 0), 0) /\n        (variantExecs.filter((e) => e.rating).length || 1);\n    }\n\n    await this.storage.saveExperiment(experiment);\n  }\n\n  async calculateExperimentResults(experiment: Experiment): Promise<ExperimentResult> {\n    const variantResults = await Promise.all(\n      experiment.variants.map(async (variant) => {\n        const executions = await this.storage.listExecutions(variant.templateId);\n        const variantExecs = executions.filter((e) => e.variantId === variant.id);\n\n        return {\n          variantId: variant.id,\n          impressions: variant.impressions,\n          conversions: variant.conversions,\n          conversionRate: variant.impressions > 0 ? variant.conversions / variant.impressions : 0,\n          avgRating: variant.avgRating,\n          avgLatencyMs: variant.avgLatencyMs || 0,\n          avgTokens: variant.avgTokens || 0,\n          avgCost: variant.avgCost || 0,\n          successRate: variant.successRate || 0,\n        };\n      })\n    );\n\n    // Simple statistical significance calculation (chi-square approximation)\n    const control = variantResults.find((v) => experiment.variants.find((ev) => ev.id === v.variantId)?.id === experiment.controlVariantId);\n    const treatment = variantResults.find((v) => v.variantId !== experiment.controlVariantId);\n\n    let pValue = 1;\n    let effectSize = 0;\n    let isSignificant = false;\n\n    if (control && treatment && control.impressions > 0 && treatment.impressions > 0) {\n      // Calculate effect size\n      const getMetricValue = (r: typeof control) => {\n        switch (experiment.primaryMetric) {\n          case \"conversion\": return r.conversionRate;\n          case \"rating\": return r.avgRating || 0;\n          case \"latency\": return -r.avgLatencyMs; // Lower is better\n          case \"cost\": return -r.avgCost; // Lower is better\n          case \"tokens\": return -r.avgTokens; // Lower is better\n          case \"success_rate\": return r.successRate;\n          default: return 0;\n        }\n      };\n\n      const controlValue = getMetricValue(control);\n      const treatmentValue = getMetricValue(treatment);\n      effectSize = controlValue !== 0 ? (treatmentValue - controlValue) / Math.abs(controlValue) : 0;\n\n      // Simplified p-value (would need proper statistical test in production)\n      const totalSamples = control.impressions + treatment.impressions;\n      pValue = Math.max(0.001, Math.exp(-Math.abs(effectSize) * Math.sqrt(totalSamples) / 2));\n      isSignificant = pValue < (1 - experiment.confidenceLevel);\n    }\n\n    const recommendedVariant = isSignificant && treatment && effectSize > 0\n      ? treatment.variantId\n      : control?.variantId;\n\n    return {\n      experimentId: experiment.id,\n      calculatedAt: Date.now(),\n      variantResults,\n      isSignificant,\n      pValue,\n      confidenceInterval: {\n        lower: effectSize - 1.96 * Math.abs(effectSize) / 2,\n        upper: effectSize + 1.96 * Math.abs(effectSize) / 2,\n      },\n      effectSize,\n      recommendedVariant,\n      recommendation: isSignificant\n        ? `Variant \"${experiment.variants.find((v) => v.id === recommendedVariant)?.name}\" shows statistically significant improvement.`\n        : `No statistically significant difference detected. Consider running longer or increasing sample size.`,\n    };\n  }\n\n  // ===========================================================================\n  // Prompt Chains\n  // ===========================================================================\n\n  async createChain(input: {\n    name: string;\n    description?: string;\n    steps: {\n      name: string;\n      templateId: string;\n      inputMapping: Record<string, string>;\n      outputKey: string;\n      parseOutput?: \"text\" | \"json\" | \"lines\" | \"regex\";\n      parseConfig?: { regex?: string; jsonPath?: string };\n      condition?: string;\n      skipOnFailure?: boolean;\n      retryOnFailure?: number;\n    }[];\n    inputVariables: PromptVariable[];\n    outputMapping?: Record<string, string>;\n    maxSteps?: number;\n    timeoutMs?: number;\n    tags?: string[];\n    author?: string;\n  }): Promise<PromptChain> {\n    const steps = input.steps.map((s, i) => ({\n      id: randomUUID(),\n      name: s.name,\n      templateId: s.templateId,\n      order: i,\n      inputMapping: s.inputMapping,\n      outputKey: s.outputKey,\n      parseOutput: s.parseOutput || (\"text\" as const),\n      parseConfig: s.parseConfig,\n      condition: s.condition,\n      skipOnFailure: s.skipOnFailure || false,\n      retryOnFailure: s.retryOnFailure || 0,\n    }));\n\n    const chain: PromptChain = {\n      id: randomUUID(),\n      name: input.name,\n      description: input.description,\n      status: \"draft\",\n      steps,\n      startStepId: steps[0]?.id || \"\",\n      inputVariables: input.inputVariables,\n      outputMapping: input.outputMapping || {},\n      maxSteps: input.maxSteps || 10,\n      timeoutMs: input.timeoutMs || 60000,\n      parallelExecution: false,\n      tags: input.tags || [],\n      author: input.author,\n      createdAt: Date.now(),\n      updatedAt: Date.now(),\n    };\n\n    await this.storage.saveChain(chain);\n    return chain;\n  }\n\n  async executeChain(\n    chainId: string,\n    input: Record<string, unknown>,\n    executePrompt: (templateId: string, variables: Record<string, unknown>) => Promise<{\n      response: string;\n      tokens: number;\n      cost: number;\n    }>\n  ): Promise<ChainExecution> {\n    const chain = await this.storage.getChain(chainId);\n    if (!chain) throw new Error(\"Chain not found\");\n\n    const execution: ChainExecution = {\n      id: randomUUID(),\n      chainId,\n      timestamp: Date.now(),\n      input,\n      context: { ...input },\n      stepExecutions: [],\n      totalSteps: chain.steps.length,\n      completedSteps: 0,\n      totalTokens: 0,\n      totalCost: 0,\n      totalLatencyMs: 0,\n      status: \"running\",\n    };\n\n    this.emit(\"chainExecutionStarted\", execution);\n\n    try {\n      const sortedSteps = [...chain.steps].sort((a, b) => a.order - b.order);\n\n      for (const step of sortedSteps) {\n        if (execution.completedSteps >= chain.maxSteps) break;\n\n        // Check condition\n        if (step.condition) {\n          try {\n            // Simple condition evaluation (would use a proper expression evaluator in production)\n            const conditionResult = this.evaluateCondition(step.condition, execution.context);\n            if (!conditionResult) {\n              execution.stepExecutions.push({\n                stepId: step.id,\n                templateId: step.templateId,\n                startedAt: Date.now(),\n                completedAt: Date.now(),\n                status: \"skipped\",\n                input: {},\n              });\n              continue;\n            }\n          } catch {\n            // If condition evaluation fails, proceed with step\n          }\n        }\n\n        // Map inputs\n        const stepInput: Record<string, unknown> = {};\n        for (const [varName, contextKey] of Object.entries(step.inputMapping)) {\n          stepInput[varName] = execution.context[contextKey];\n        }\n\n        const stepExecution = {\n          stepId: step.id,\n          templateId: step.templateId,\n          startedAt: Date.now(),\n          status: \"running\" as const,\n          input: stepInput,\n        };\n        execution.stepExecutions.push(stepExecution);\n\n        try {\n          const result = await executePrompt(step.templateId, stepInput);\n\n          stepExecution.completedAt = Date.now();\n          stepExecution.status = \"completed\";\n          stepExecution.output = result.response;\n          stepExecution.tokens = result.tokens;\n          stepExecution.cost = result.cost;\n\n          // Parse output\n          let parsedOutput: unknown = result.response;\n          if (step.parseOutput === \"json\") {\n            try {\n              parsedOutput = JSON.parse(result.response);\n            } catch {\n              // Keep as string if JSON parse fails\n            }\n          } else if (step.parseOutput === \"lines\") {\n            parsedOutput = result.response.split(\"\\n\").filter((l) => l.trim());\n          } else if (step.parseOutput === \"regex\" && step.parseConfig?.regex) {\n            const match = result.response.match(new RegExp(step.parseConfig.regex));\n            parsedOutput = match ? match[1] || match[0] : result.response;\n          }\n\n          // Store in context\n          execution.context[step.outputKey] = parsedOutput;\n\n          execution.completedSteps++;\n          execution.totalTokens += result.tokens;\n          execution.totalCost += result.cost;\n          execution.totalLatencyMs += (stepExecution.completedAt - stepExecution.startedAt);\n\n          this.emit(\"chainStepCompleted\", chainId, step.id);\n        } catch (error) {\n          stepExecution.completedAt = Date.now();\n          stepExecution.status = \"failed\";\n          stepExecution.error = (error as Error).message;\n\n          if (!step.skipOnFailure) {\n            execution.status = \"failed\";\n            execution.error = `Step \"${step.name}\" failed: ${(error as Error).message}`;\n            break;\n          }\n        }\n      }\n\n      if (execution.status !== \"failed\") {\n        execution.status = \"completed\";\n\n        // Map output\n        execution.output = {};\n        for (const [outputKey, contextKey] of Object.entries(chain.outputMapping)) {\n          execution.output[outputKey] = execution.context[contextKey];\n        }\n      }\n    } catch (error) {\n      execution.status = \"failed\";\n      execution.error = (error as Error).message;\n      this.emit(\"chainExecutionFailed\", execution, error as Error);\n    }\n\n    await this.storage.saveChainExecution(execution);\n\n    if (execution.status === \"completed\") {\n      this.emit(\"chainExecutionCompleted\", execution);\n    }\n\n    return execution;\n  }\n\n  private evaluateCondition(condition: string, context: Record<string, unknown>): boolean {\n    // Simple condition evaluation - in production, use a proper expression parser\n    try {\n      const fn = new Function(...Object.keys(context), `return ${condition}`);\n      return Boolean(fn(...Object.values(context)));\n    } catch {\n      return true;\n    }\n  }\n\n  // ===========================================================================\n  // Optimization\n  // ===========================================================================\n\n  async suggestOptimization(\n    templateId: string,\n    goal: OptimizationGoal\n  ): Promise<PromptOptimization | null> {\n    const template = await this.storage.getTemplate(templateId);\n    if (!template) return null;\n\n    const executions = await this.storage.listExecutions(templateId, { limit: 100 });\n    if (executions.length < 10) return null;\n\n    const avgTokens = executions.reduce((sum, e) => sum + e.totalTokens, 0) / executions.length;\n    const avgLatency = executions.reduce((sum, e) => sum + e.latencyMs, 0) / executions.length;\n    const avgCost = executions.reduce((sum, e) => sum + e.cost, 0) / executions.length;\n    const successRate = executions.filter((e) => e.success).length / executions.length;\n    const avgRating = executions.filter((e) => e.rating).reduce((sum, e) => sum + (e.rating || 0), 0) /\n      (executions.filter((e) => e.rating).length || 1);\n\n    // Simple optimization suggestions\n    let optimizedContent = template.content;\n    const techniques: PromptOptimization[\"techniques\"] = [];\n\n    if (goal === \"reduce_tokens\" || goal === \"reduce_cost\") {\n      // Remove redundant whitespace\n      optimizedContent = optimizedContent.replace(/\\s+/g, \" \").trim();\n      techniques.push(\"compression\");\n\n      // Remove duplicate instructions (simplified)\n      const lines = optimizedContent.split(\"\\n\");\n      const uniqueLines = [...new Set(lines)];\n      if (uniqueLines.length < lines.length) {\n        optimizedContent = uniqueLines.join(\"\\n\");\n        techniques.push(\"deduplication\");\n      }\n    }\n\n    const optimization: PromptOptimization = {\n      id: randomUUID(),\n      templateId,\n      timestamp: Date.now(),\n      goal,\n      originalContent: template.content,\n      originalTokens: avgTokens,\n      originalMetrics: {\n        avgLatencyMs: avgLatency,\n        avgCost: avgCost,\n        successRate,\n        avgRating,\n      },\n      optimizedContent,\n      optimizedTokens: Math.round(avgTokens * 0.9), // Estimate\n      estimatedImprovement: {\n        tokenReduction: Math.round(avgTokens * 0.1),\n        costReduction: avgCost * 0.1,\n      },\n      techniques,\n      validationStatus: \"pending\",\n      applied: false,\n    };\n\n    await this.storage.saveOptimization(optimization);\n    this.emit(\"optimizationSuggested\", optimization);\n    return optimization;\n  }\n\n  async applyOptimization(optimizationId: string): Promise<boolean> {\n    const optimizations = await this.storage.getOptimizations(\"\");\n    const optimization = optimizations.find((o) => o.id === optimizationId);\n    if (!optimization) return false;\n\n    await this.updateTemplate(optimization.templateId, {\n      content: optimization.optimizedContent,\n    }, \"Applied optimization\");\n\n    optimization.applied = true;\n    optimization.appliedAt = Date.now();\n    await this.storage.saveOptimization(optimization);\n\n    this.emit(\"optimizationApplied\", optimization);\n    return true;\n  }\n\n  // ===========================================================================\n  // Utilities\n  // ===========================================================================\n\n  private generateSlug(name: string): string {\n    return name\n      .toLowerCase()\n      .replace(/[^a-z0-9]+/g, \"-\")\n      .replace(/^-|-$/g, \"\");\n  }\n}\n\n// =============================================================================\n// Singleton & Factory\n// =============================================================================\n\nlet defaultManager: PromptManager | null = null;\n\nexport function getPromptManager(): PromptManager {\n  if (!defaultManager) {\n    defaultManager = new PromptManager();\n  }\n  return defaultManager;\n}\n\nexport function createPromptManager(\n  config?: Partial<PromptManagerConfig>,\n  storage?: PromptStorage\n): PromptManager {\n  return new PromptManager(config, storage);\n}\n","/**\n * Model Evaluator Types\n * Phase 16D: AI Operations - Model Evaluation & Benchmarking\n */\n\nimport { z } from \"zod\";\n\n// =============================================================================\n// Model Registry\n// =============================================================================\n\nexport const ModelProviderSchema = z.enum([\n  \"openai\",\n  \"anthropic\",\n  \"google\",\n  \"cohere\",\n  \"mistral\",\n  \"azure\",\n  \"aws_bedrock\",\n  \"groq\",\n  \"together\",\n  \"perplexity\",\n  \"replicate\",\n  \"huggingface\",\n  \"local\",\n  \"custom\",\n]);\nexport type ModelProvider = z.infer<typeof ModelProviderSchema>;\n\nexport const ModelCapabilitySchema = z.enum([\n  \"text_generation\",\n  \"chat\",\n  \"code_generation\",\n  \"code_completion\",\n  \"vision\",\n  \"audio\",\n  \"embedding\",\n  \"function_calling\",\n  \"structured_output\",\n  \"reasoning\",\n  \"multilingual\",\n]);\nexport type ModelCapability = z.infer<typeof ModelCapabilitySchema>;\n\nexport const ModelInfoSchema = z.object({\n  id: z.string(),\n  provider: ModelProviderSchema,\n  name: z.string(),\n  displayName: z.string().optional(),\n  version: z.string().optional(),\n\n  // Capabilities\n  capabilities: z.array(ModelCapabilitySchema),\n\n  // Specifications\n  contextWindow: z.number(),\n  maxOutputTokens: z.number().optional(),\n  trainingCutoff: z.string().optional(),\n\n  // Pricing\n  inputPricePerMillion: z.number(),\n  outputPricePerMillion: z.number(),\n\n  // Performance characteristics\n  avgLatencyMs: z.number().optional(),\n  tokensPerSecond: z.number().optional(),\n\n  // Status\n  isAvailable: z.boolean().default(true),\n  deprecatedAt: z.number().optional(),\n\n  // Metadata\n  tags: z.array(z.string()).default([]),\n  notes: z.string().optional(),\n});\nexport type ModelInfo = z.infer<typeof ModelInfoSchema>;\n\n// =============================================================================\n// Evaluation Tasks\n// =============================================================================\n\nexport const EvalTaskTypeSchema = z.enum([\n  \"text_completion\",\n  \"question_answering\",\n  \"summarization\",\n  \"translation\",\n  \"code_generation\",\n  \"code_review\",\n  \"sentiment_analysis\",\n  \"classification\",\n  \"extraction\",\n  \"reasoning\",\n  \"math\",\n  \"creative_writing\",\n  \"instruction_following\",\n  \"conversation\",\n  \"custom\",\n]);\nexport type EvalTaskType = z.infer<typeof EvalTaskTypeSchema>;\n\nexport const EvalDifficultySchema = z.enum([\n  \"easy\",\n  \"medium\",\n  \"hard\",\n  \"expert\",\n]);\nexport type EvalDifficulty = z.infer<typeof EvalDifficultySchema>;\n\nexport const EvalTaskSchema = z.object({\n  id: z.string(),\n  type: EvalTaskTypeSchema,\n  name: z.string(),\n  description: z.string().optional(),\n  difficulty: EvalDifficultySchema.default(\"medium\"),\n\n  // Input\n  prompt: z.string(),\n  systemPrompt: z.string().optional(),\n  context: z.string().optional(),\n\n  // Expected output\n  expectedOutput: z.string().optional(),\n  acceptableOutputs: z.array(z.string()).optional(),\n  evaluationCriteria: z.array(z.string()).optional(),\n\n  // Evaluation config\n  metrics: z.array(z.string()).default([\"accuracy\", \"relevance\"]),\n  passingScore: z.number().default(0.7),\n\n  // Constraints\n  maxTokens: z.number().optional(),\n  timeoutMs: z.number().optional(),\n\n  // Metadata\n  tags: z.array(z.string()).default([]),\n  category: z.string().optional(),\n  weight: z.number().default(1).describe(\"Weight in benchmark scoring\"),\n  createdAt: z.number(),\n});\nexport type EvalTask = z.infer<typeof EvalTaskSchema>;\n\n// =============================================================================\n// Evaluation Metrics\n// =============================================================================\n\nexport const MetricTypeSchema = z.enum([\n  // Quality metrics\n  \"accuracy\",\n  \"relevance\",\n  \"coherence\",\n  \"fluency\",\n  \"completeness\",\n  \"correctness\",\n  \"creativity\",\n\n  // Code metrics\n  \"code_correctness\",\n  \"code_quality\",\n  \"test_pass_rate\",\n\n  // Similarity metrics\n  \"exact_match\",\n  \"fuzzy_match\",\n  \"semantic_similarity\",\n  \"bleu\",\n  \"rouge\",\n\n  // Performance metrics\n  \"latency\",\n  \"throughput\",\n  \"tokens_per_second\",\n\n  // Cost metrics\n  \"cost_per_request\",\n  \"cost_per_token\",\n\n  // Safety metrics\n  \"toxicity\",\n  \"bias\",\n  \"hallucination_rate\",\n\n  // Custom\n  \"custom\",\n]);\nexport type MetricType = z.infer<typeof MetricTypeSchema>;\n\nexport const MetricResultSchema = z.object({\n  metric: MetricTypeSchema,\n  score: z.number().min(0).max(1),\n  rawValue: z.unknown().optional(),\n  details: z.string().optional(),\n  confidence: z.number().min(0).max(1).optional(),\n});\nexport type MetricResult = z.infer<typeof MetricResultSchema>;\n\n// =============================================================================\n// Evaluation Results\n// =============================================================================\n\nexport const EvalResultSchema = z.object({\n  id: z.string(),\n  taskId: z.string(),\n  modelId: z.string(),\n  timestamp: z.number(),\n\n  // Input/Output\n  prompt: z.string(),\n  response: z.string(),\n  expectedOutput: z.string().optional(),\n\n  // Metrics\n  metrics: z.array(MetricResultSchema),\n  overallScore: z.number().min(0).max(1),\n  passed: z.boolean(),\n\n  // Performance\n  inputTokens: z.number(),\n  outputTokens: z.number(),\n  latencyMs: z.number(),\n  cost: z.number(),\n\n  // Evaluation metadata\n  evaluatorModel: z.string().optional(),\n  humanEvaluated: z.boolean().default(false),\n  humanScore: z.number().optional(),\n  humanNotes: z.string().optional(),\n\n  // Error handling\n  error: z.string().optional(),\n  timedOut: z.boolean().default(false),\n});\nexport type EvalResult = z.infer<typeof EvalResultSchema>;\n\n// =============================================================================\n// Benchmarks\n// =============================================================================\n\nexport const BenchmarkStatusSchema = z.enum([\n  \"draft\",\n  \"ready\",\n  \"running\",\n  \"completed\",\n  \"failed\",\n]);\nexport type BenchmarkStatus = z.infer<typeof BenchmarkStatusSchema>;\n\nexport const BenchmarkConfigSchema = z.object({\n  // Evaluation settings\n  runsPerTask: z.number().default(1),\n  temperature: z.number().default(0),\n  maxConcurrent: z.number().default(5),\n  timeoutMs: z.number().default(60000),\n\n  // Model selection\n  useEvaluatorModel: z.boolean().default(true),\n  evaluatorModelId: z.string().optional(),\n\n  // Metrics\n  primaryMetric: MetricTypeSchema.default(\"accuracy\"),\n  includePerformanceMetrics: z.boolean().default(true),\n  includeCostMetrics: z.boolean().default(true),\n\n  // Sampling\n  sampleSize: z.number().optional().describe(\"Subset of tasks to run\"),\n  randomSeed: z.number().optional(),\n});\nexport type BenchmarkConfig = z.infer<typeof BenchmarkConfigSchema>;\n\nexport const BenchmarkSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  description: z.string().optional(),\n  status: BenchmarkStatusSchema,\n\n  // Tasks\n  taskIds: z.array(z.string()),\n  taskCount: z.number(),\n\n  // Models to evaluate\n  modelIds: z.array(z.string()),\n\n  // Configuration\n  config: BenchmarkConfigSchema,\n\n  // Progress\n  completedTasks: z.number().default(0),\n  totalTasks: z.number().default(0),\n  startedAt: z.number().optional(),\n  completedAt: z.number().optional(),\n\n  // Metadata\n  tags: z.array(z.string()).default([]),\n  createdAt: z.number(),\n  createdBy: z.string().optional(),\n});\nexport type Benchmark = z.infer<typeof BenchmarkSchema>;\n\nexport const BenchmarkResultSchema = z.object({\n  benchmarkId: z.string(),\n  modelId: z.string(),\n  calculatedAt: z.number(),\n\n  // Aggregate scores\n  overallScore: z.number(),\n  passRate: z.number(),\n\n  // Per-metric scores\n  metricScores: z.record(MetricTypeSchema, z.number()),\n\n  // Per-task-type scores\n  taskTypeScores: z.record(EvalTaskTypeSchema, z.number()),\n\n  // Per-difficulty scores\n  difficultyScores: z.record(EvalDifficultySchema, z.number()),\n\n  // Performance\n  avgLatencyMs: z.number(),\n  avgTokensPerSecond: z.number(),\n  totalTokens: z.number(),\n  totalCost: z.number(),\n\n  // Individual results\n  resultIds: z.array(z.string()),\n  passedCount: z.number(),\n  failedCount: z.number(),\n  errorCount: z.number(),\n});\nexport type BenchmarkResult = z.infer<typeof BenchmarkResultSchema>;\n\n// =============================================================================\n// Model Comparison\n// =============================================================================\n\nexport const ModelRankingSchema = z.object({\n  modelId: z.string(),\n  rank: z.number(),\n  score: z.number(),\n  change: z.number().optional().describe(\"Change in rank from previous benchmark\"),\n});\nexport type ModelRanking = z.infer<typeof ModelRankingSchema>;\n\nexport const ComparisonResultSchema = z.object({\n  id: z.string(),\n  benchmarkId: z.string(),\n  timestamp: z.number(),\n\n  // Rankings\n  overallRankings: z.array(ModelRankingSchema),\n  rankingsByMetric: z.record(MetricTypeSchema, z.array(ModelRankingSchema)),\n  rankingsByTaskType: z.record(EvalTaskTypeSchema, z.array(ModelRankingSchema)),\n\n  // Best models\n  bestOverall: z.string(),\n  bestByCategory: z.record(z.string(), z.string()),\n\n  // Trade-offs\n  bestQualityPrice: z.string().optional().describe(\"Best quality/price ratio\"),\n  bestLatency: z.string().optional(),\n  bestForProduction: z.string().optional(),\n\n  // Statistical analysis\n  significantDifferences: z.array(z.object({\n    model1: z.string(),\n    model2: z.string(),\n    metric: MetricTypeSchema,\n    pValue: z.number(),\n    difference: z.number(),\n  })),\n});\nexport type ComparisonResult = z.infer<typeof ComparisonResultSchema>;\n\n// =============================================================================\n// Model Selection\n// =============================================================================\n\nexport const SelectionCriteriaSchema = z.object({\n  // Required capabilities\n  requiredCapabilities: z.array(ModelCapabilitySchema).optional(),\n\n  // Task type\n  taskType: EvalTaskTypeSchema.optional(),\n\n  // Quality thresholds\n  minOverallScore: z.number().min(0).max(1).optional(),\n  minMetricScores: z.record(MetricTypeSchema, z.number()).optional(),\n\n  // Performance constraints\n  maxLatencyMs: z.number().optional(),\n  minTokensPerSecond: z.number().optional(),\n\n  // Cost constraints\n  maxCostPerRequest: z.number().optional(),\n  maxCostPer1kTokens: z.number().optional(),\n\n  // Preferences\n  preferredProviders: z.array(ModelProviderSchema).optional(),\n  excludedProviders: z.array(ModelProviderSchema).optional(),\n  excludedModels: z.array(z.string()).optional(),\n\n  // Optimization target\n  optimizeFor: z.enum([\"quality\", \"cost\", \"latency\", \"balanced\"]).default(\"balanced\"),\n});\nexport type SelectionCriteria = z.infer<typeof SelectionCriteriaSchema>;\n\nexport const ModelRecommendationSchema = z.object({\n  modelId: z.string(),\n  score: z.number(),\n  rank: z.number(),\n  matchScore: z.number().describe(\"How well it matches criteria\"),\n\n  // Why recommended\n  strengths: z.array(z.string()),\n  weaknesses: z.array(z.string()),\n\n  // Trade-offs\n  qualityScore: z.number(),\n  costScore: z.number(),\n  latencyScore: z.number(),\n\n  // Estimated metrics\n  estimatedLatencyMs: z.number().optional(),\n  estimatedCostPerRequest: z.number().optional(),\n  estimatedAccuracy: z.number().optional(),\n\n  // Confidence\n  confidence: z.number().min(0).max(1),\n  dataPoints: z.number(),\n});\nexport type ModelRecommendation = z.infer<typeof ModelRecommendationSchema>;\n\n// =============================================================================\n// Evaluation Datasets\n// =============================================================================\n\nexport const DatasetSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  description: z.string().optional(),\n\n  // Content\n  taskType: EvalTaskTypeSchema,\n  tasks: z.array(EvalTaskSchema),\n  taskCount: z.number(),\n\n  // Metadata\n  source: z.string().optional(),\n  version: z.string().optional(),\n  tags: z.array(z.string()).default([]),\n  language: z.string().default(\"en\"),\n\n  // Quality\n  validated: z.boolean().default(false),\n  validatedBy: z.string().optional(),\n  validatedAt: z.number().optional(),\n\n  // Stats\n  avgDifficulty: z.number().optional(),\n  difficultyDistribution: z.record(EvalDifficultySchema, z.number()).optional(),\n\n  createdAt: z.number(),\n  updatedAt: z.number(),\n});\nexport type Dataset = z.infer<typeof DatasetSchema>;\n\n// =============================================================================\n// Configuration\n// =============================================================================\n\nexport const ModelEvaluatorConfigSchema = z.object({\n  // General\n  enabled: z.boolean().default(true),\n\n  // Default evaluator model\n  defaultEvaluatorModel: z.string().default(\"gpt-4o\"),\n\n  // Concurrency\n  maxConcurrentEvals: z.number().default(10),\n  maxConcurrentBenchmarks: z.number().default(3),\n\n  // Timeouts\n  defaultTimeoutMs: z.number().default(60000),\n  defaultTaskTimeoutMs: z.number().default(30000),\n\n  // Caching\n  cacheResults: z.boolean().default(true),\n  cacheExpirationHours: z.number().default(24),\n\n  // Auto-evaluation\n  autoEvaluateNewModels: z.boolean().default(false),\n  autoEvaluationDatasetId: z.string().optional(),\n\n  // Thresholds\n  defaultPassingScore: z.number().default(0.7),\n  significanceLevel: z.number().default(0.05),\n\n  // Cost limits\n  maxCostPerBenchmark: z.number().optional(),\n  maxCostPerDay: z.number().optional(),\n\n  // Retention\n  resultRetentionDays: z.number().default(90),\n});\nexport type ModelEvaluatorConfig = z.infer<typeof ModelEvaluatorConfigSchema>;\n\n// =============================================================================\n// Events\n// =============================================================================\n\nexport type ModelEvaluatorEvents = {\n  // Models\n  modelRegistered: (model: ModelInfo) => void;\n  modelUpdated: (model: ModelInfo) => void;\n  modelDeprecated: (modelId: string) => void;\n\n  // Tasks\n  taskCreated: (task: EvalTask) => void;\n  taskUpdated: (task: EvalTask) => void;\n\n  // Evaluation\n  evaluationStarted: (taskId: string, modelId: string) => void;\n  evaluationCompleted: (result: EvalResult) => void;\n  evaluationFailed: (taskId: string, modelId: string, error: Error) => void;\n\n  // Benchmarks\n  benchmarkCreated: (benchmark: Benchmark) => void;\n  benchmarkStarted: (benchmark: Benchmark) => void;\n  benchmarkProgress: (benchmarkId: string, completed: number, total: number) => void;\n  benchmarkCompleted: (benchmark: Benchmark, results: BenchmarkResult[]) => void;\n  benchmarkFailed: (benchmark: Benchmark, error: Error) => void;\n\n  // Comparisons\n  comparisonGenerated: (comparison: ComparisonResult) => void;\n\n  // Recommendations\n  recommendationGenerated: (recommendations: ModelRecommendation[]) => void;\n\n  // Errors\n  error: (error: Error) => void;\n};\n\n// =============================================================================\n// Storage Interface\n// =============================================================================\n\nexport interface ModelEvaluatorStorage {\n  // Models\n  saveModel(model: ModelInfo): Promise<void>;\n  getModel(id: string): Promise<ModelInfo | null>;\n  listModels(filters?: {\n    provider?: ModelProvider;\n    capabilities?: ModelCapability[];\n    available?: boolean;\n  }): Promise<ModelInfo[]>;\n\n  // Tasks\n  saveTask(task: EvalTask): Promise<void>;\n  getTask(id: string): Promise<EvalTask | null>;\n  listTasks(filters?: {\n    type?: EvalTaskType;\n    difficulty?: EvalDifficulty;\n    category?: string;\n  }): Promise<EvalTask[]>;\n\n  // Results\n  saveResult(result: EvalResult): Promise<void>;\n  getResult(id: string): Promise<EvalResult | null>;\n  listResults(filters: {\n    taskId?: string;\n    modelId?: string;\n    startTime?: number;\n    endTime?: number;\n  }): Promise<EvalResult[]>;\n\n  // Benchmarks\n  saveBenchmark(benchmark: Benchmark): Promise<void>;\n  getBenchmark(id: string): Promise<Benchmark | null>;\n  listBenchmarks(status?: BenchmarkStatus): Promise<Benchmark[]>;\n  saveBenchmarkResult(result: BenchmarkResult): Promise<void>;\n  getBenchmarkResults(benchmarkId: string): Promise<BenchmarkResult[]>;\n\n  // Comparisons\n  saveComparison(comparison: ComparisonResult): Promise<void>;\n  getComparison(id: string): Promise<ComparisonResult | null>;\n\n  // Datasets\n  saveDataset(dataset: Dataset): Promise<void>;\n  getDataset(id: string): Promise<Dataset | null>;\n  listDatasets(): Promise<Dataset[]>;\n}\n\n// =============================================================================\n// Built-in Evaluation Prompts\n// =============================================================================\n\nexport const EVALUATION_PROMPTS = {\n  accuracy: `Evaluate the accuracy of the following response compared to the expected output.\n\nExpected: {{expected}}\nActual: {{actual}}\n\nRate the accuracy on a scale of 0 to 1, where:\n- 0: Completely incorrect or irrelevant\n- 0.5: Partially correct with significant errors\n- 1: Fully correct and complete\n\nRespond with just a number between 0 and 1.`,\n\n  relevance: `Evaluate how relevant the response is to the given prompt.\n\nPrompt: {{prompt}}\nResponse: {{response}}\n\nRate the relevance on a scale of 0 to 1, where:\n- 0: Completely irrelevant\n- 0.5: Somewhat relevant but off-topic in parts\n- 1: Highly relevant and on-topic\n\nRespond with just a number between 0 and 1.`,\n\n  coherence: `Evaluate the coherence and logical flow of the following text.\n\nText: {{text}}\n\nRate the coherence on a scale of 0 to 1, where:\n- 0: Incoherent, illogical, or contradictory\n- 0.5: Somewhat coherent but with logical gaps\n- 1: Highly coherent with clear logical flow\n\nRespond with just a number between 0 and 1.`,\n\n  fluency: `Evaluate the fluency and readability of the following text.\n\nText: {{text}}\n\nRate the fluency on a scale of 0 to 1, where:\n- 0: Difficult to read, poor grammar/syntax\n- 0.5: Readable but with some awkward phrasing\n- 1: Excellent fluency, natural and easy to read\n\nRespond with just a number between 0 and 1.`,\n\n  code_correctness: `Evaluate the correctness of the following code solution.\n\nProblem: {{problem}}\nCode: {{code}}\nExpected behavior: {{expected}}\n\nRate the correctness on a scale of 0 to 1, where:\n- 0: Does not compile/run or produces wrong output\n- 0.5: Partially works but has bugs\n- 1: Fully correct and handles edge cases\n\nRespond with just a number between 0 and 1.`,\n};\n\n// =============================================================================\n// Common Datasets\n// =============================================================================\n\nexport const BUILT_IN_DATASETS = {\n  general_qa: {\n    name: \"General Q&A\",\n    description: \"General knowledge question answering\",\n    taskType: \"question_answering\" as const,\n  },\n  code_generation: {\n    name: \"Code Generation\",\n    description: \"Programming challenges and code generation tasks\",\n    taskType: \"code_generation\" as const,\n  },\n  summarization: {\n    name: \"Text Summarization\",\n    description: \"Document and text summarization tasks\",\n    taskType: \"summarization\" as const,\n  },\n  reasoning: {\n    name: \"Logical Reasoning\",\n    description: \"Logic puzzles and reasoning tasks\",\n    taskType: \"reasoning\" as const,\n  },\n  math: {\n    name: \"Math Problems\",\n    description: \"Mathematical problem solving\",\n    taskType: \"math\" as const,\n  },\n};\n\n// =============================================================================\n// Helpers\n// =============================================================================\n\nexport function calculateOverallScore(metrics: MetricResult[], weights?: Record<string, number>): number {\n  if (metrics.length === 0) return 0;\n\n  let totalWeight = 0;\n  let weightedSum = 0;\n\n  for (const metric of metrics) {\n    const weight = weights?.[metric.metric] || 1;\n    weightedSum += metric.score * weight;\n    totalWeight += weight;\n  }\n\n  return totalWeight > 0 ? weightedSum / totalWeight : 0;\n}\n\nexport function calculatePassRate(results: EvalResult[]): number {\n  if (results.length === 0) return 0;\n  return results.filter((r) => r.passed).length / results.length;\n}\n\nexport function compareModels(\n  results: BenchmarkResult[],\n  metric: MetricType\n): ModelRanking[] {\n  const scores = results.map((r) => ({\n    modelId: r.modelId,\n    score: r.metricScores[metric] || r.overallScore,\n  }));\n\n  scores.sort((a, b) => b.score - a.score);\n\n  return scores.map((s, i) => ({\n    modelId: s.modelId,\n    rank: i + 1,\n    score: s.score,\n  }));\n}\n\nexport function calculateStatisticalSignificance(\n  scores1: number[],\n  scores2: number[]\n): { significant: boolean; pValue: number } {\n  // Simplified t-test (would use proper statistical library in production)\n  if (scores1.length < 2 || scores2.length < 2) {\n    return { significant: false, pValue: 1 };\n  }\n\n  const mean1 = scores1.reduce((a, b) => a + b, 0) / scores1.length;\n  const mean2 = scores2.reduce((a, b) => a + b, 0) / scores2.length;\n\n  const variance1 = scores1.reduce((sum, x) => sum + Math.pow(x - mean1, 2), 0) / (scores1.length - 1);\n  const variance2 = scores2.reduce((sum, x) => sum + Math.pow(x - mean2, 2), 0) / (scores2.length - 1);\n\n  const pooledStdErr = Math.sqrt(variance1 / scores1.length + variance2 / scores2.length);\n\n  if (pooledStdErr === 0) {\n    return { significant: false, pValue: 1 };\n  }\n\n  const t = (mean1 - mean2) / pooledStdErr;\n  const df = scores1.length + scores2.length - 2;\n\n  // Approximate p-value (simplified)\n  const pValue = Math.exp(-Math.abs(t) * Math.sqrt(df) / 2);\n\n  return {\n    significant: pValue < 0.05,\n    pValue,\n  };\n}\n","/**\n * Model Evaluator Implementation\n * Phase 16D: AI Operations - Model Evaluation & Benchmarking\n */\n\nimport { EventEmitter } from \"eventemitter3\";\nimport { randomUUID } from \"crypto\";\nimport {\n  type ModelEvaluatorConfig,\n  ModelEvaluatorConfigSchema,\n  type ModelEvaluatorEvents,\n  type ModelEvaluatorStorage,\n  type ModelInfo,\n  type ModelProvider,\n  type ModelCapability,\n  type EvalTask,\n  type EvalTaskType,\n  type EvalDifficulty,\n  type EvalResult,\n  type MetricResult,\n  type MetricType,\n  type Benchmark,\n  type BenchmarkStatus,\n  type BenchmarkConfig,\n  type BenchmarkResult,\n  type ComparisonResult,\n  type ModelRanking,\n  type SelectionCriteria,\n  type ModelRecommendation,\n  type Dataset,\n  EVALUATION_PROMPTS,\n  calculateOverallScore,\n  calculatePassRate,\n  compareModels,\n  calculateStatisticalSignificance,\n} from \"./types.js\";\n\n// =============================================================================\n// In-Memory Storage\n// =============================================================================\n\nclass InMemoryModelEvaluatorStorage implements ModelEvaluatorStorage {\n  private models: Map<string, ModelInfo> = new Map();\n  private tasks: Map<string, EvalTask> = new Map();\n  private results: Map<string, EvalResult> = new Map();\n  private benchmarks: Map<string, Benchmark> = new Map();\n  private benchmarkResults: Map<string, BenchmarkResult[]> = new Map();\n  private comparisons: Map<string, ComparisonResult> = new Map();\n  private datasets: Map<string, Dataset> = new Map();\n\n  async saveModel(model: ModelInfo): Promise<void> {\n    this.models.set(model.id, model);\n  }\n\n  async getModel(id: string): Promise<ModelInfo | null> {\n    return this.models.get(id) || null;\n  }\n\n  async listModels(filters?: {\n    provider?: ModelProvider;\n    capabilities?: ModelCapability[];\n    available?: boolean;\n  }): Promise<ModelInfo[]> {\n    return Array.from(this.models.values()).filter((m) => {\n      if (filters?.provider && m.provider !== filters.provider) return false;\n      if (filters?.capabilities && !filters.capabilities.every((c) => m.capabilities.includes(c))) return false;\n      if (filters?.available !== undefined && m.isAvailable !== filters.available) return false;\n      return true;\n    });\n  }\n\n  async saveTask(task: EvalTask): Promise<void> {\n    this.tasks.set(task.id, task);\n  }\n\n  async getTask(id: string): Promise<EvalTask | null> {\n    return this.tasks.get(id) || null;\n  }\n\n  async listTasks(filters?: {\n    type?: EvalTaskType;\n    difficulty?: EvalDifficulty;\n    category?: string;\n  }): Promise<EvalTask[]> {\n    return Array.from(this.tasks.values()).filter((t) => {\n      if (filters?.type && t.type !== filters.type) return false;\n      if (filters?.difficulty && t.difficulty !== filters.difficulty) return false;\n      if (filters?.category && t.category !== filters.category) return false;\n      return true;\n    });\n  }\n\n  async saveResult(result: EvalResult): Promise<void> {\n    this.results.set(result.id, result);\n  }\n\n  async getResult(id: string): Promise<EvalResult | null> {\n    return this.results.get(id) || null;\n  }\n\n  async listResults(filters: {\n    taskId?: string;\n    modelId?: string;\n    startTime?: number;\n    endTime?: number;\n  }): Promise<EvalResult[]> {\n    return Array.from(this.results.values()).filter((r) => {\n      if (filters.taskId && r.taskId !== filters.taskId) return false;\n      if (filters.modelId && r.modelId !== filters.modelId) return false;\n      if (filters.startTime && r.timestamp < filters.startTime) return false;\n      if (filters.endTime && r.timestamp > filters.endTime) return false;\n      return true;\n    });\n  }\n\n  async saveBenchmark(benchmark: Benchmark): Promise<void> {\n    this.benchmarks.set(benchmark.id, benchmark);\n  }\n\n  async getBenchmark(id: string): Promise<Benchmark | null> {\n    return this.benchmarks.get(id) || null;\n  }\n\n  async listBenchmarks(status?: BenchmarkStatus): Promise<Benchmark[]> {\n    return Array.from(this.benchmarks.values()).filter((b) => {\n      if (status && b.status !== status) return false;\n      return true;\n    });\n  }\n\n  async saveBenchmarkResult(result: BenchmarkResult): Promise<void> {\n    const existing = this.benchmarkResults.get(result.benchmarkId) || [];\n    const index = existing.findIndex((r) => r.modelId === result.modelId);\n    if (index >= 0) {\n      existing[index] = result;\n    } else {\n      existing.push(result);\n    }\n    this.benchmarkResults.set(result.benchmarkId, existing);\n  }\n\n  async getBenchmarkResults(benchmarkId: string): Promise<BenchmarkResult[]> {\n    return this.benchmarkResults.get(benchmarkId) || [];\n  }\n\n  async saveComparison(comparison: ComparisonResult): Promise<void> {\n    this.comparisons.set(comparison.id, comparison);\n  }\n\n  async getComparison(id: string): Promise<ComparisonResult | null> {\n    return this.comparisons.get(id) || null;\n  }\n\n  async saveDataset(dataset: Dataset): Promise<void> {\n    this.datasets.set(dataset.id, dataset);\n  }\n\n  async getDataset(id: string): Promise<Dataset | null> {\n    return this.datasets.get(id) || null;\n  }\n\n  async listDatasets(): Promise<Dataset[]> {\n    return Array.from(this.datasets.values());\n  }\n}\n\n// =============================================================================\n// Model Evaluator\n// =============================================================================\n\nexport class ModelEvaluator extends EventEmitter<ModelEvaluatorEvents> {\n  private config: ModelEvaluatorConfig;\n  private storage: ModelEvaluatorStorage;\n  private runningBenchmarks: Set<string> = new Set();\n\n  constructor(config: Partial<ModelEvaluatorConfig> = {}, storage?: ModelEvaluatorStorage) {\n    super();\n    this.config = ModelEvaluatorConfigSchema.parse(config);\n    this.storage = storage || new InMemoryModelEvaluatorStorage();\n  }\n\n  // ===========================================================================\n  // Model Management\n  // ===========================================================================\n\n  async registerModel(input: Omit<ModelInfo, \"id\">): Promise<ModelInfo> {\n    const model: ModelInfo = {\n      ...input,\n      id: randomUUID(),\n    };\n\n    await this.storage.saveModel(model);\n    this.emit(\"modelRegistered\", model);\n    return model;\n  }\n\n  async updateModel(id: string, updates: Partial<Omit<ModelInfo, \"id\">>): Promise<ModelInfo | null> {\n    const model = await this.storage.getModel(id);\n    if (!model) return null;\n\n    const updated: ModelInfo = { ...model, ...updates };\n    await this.storage.saveModel(updated);\n    this.emit(\"modelUpdated\", updated);\n    return updated;\n  }\n\n  async deprecateModel(id: string): Promise<void> {\n    const model = await this.storage.getModel(id);\n    if (!model) return;\n\n    model.isAvailable = false;\n    model.deprecatedAt = Date.now();\n    await this.storage.saveModel(model);\n    this.emit(\"modelDeprecated\", id);\n  }\n\n  async getModel(id: string): Promise<ModelInfo | null> {\n    return this.storage.getModel(id);\n  }\n\n  async listModels(filters?: {\n    provider?: ModelProvider;\n    capabilities?: ModelCapability[];\n    available?: boolean;\n  }): Promise<ModelInfo[]> {\n    return this.storage.listModels(filters);\n  }\n\n  // ===========================================================================\n  // Task Management\n  // ===========================================================================\n\n  async createTask(input: Omit<EvalTask, \"id\" | \"createdAt\">): Promise<EvalTask> {\n    const task: EvalTask = {\n      ...input,\n      id: randomUUID(),\n      createdAt: Date.now(),\n    };\n\n    await this.storage.saveTask(task);\n    this.emit(\"taskCreated\", task);\n    return task;\n  }\n\n  async updateTask(id: string, updates: Partial<Omit<EvalTask, \"id\" | \"createdAt\">>): Promise<EvalTask | null> {\n    const task = await this.storage.getTask(id);\n    if (!task) return null;\n\n    const updated: EvalTask = { ...task, ...updates };\n    await this.storage.saveTask(updated);\n    this.emit(\"taskUpdated\", updated);\n    return updated;\n  }\n\n  async getTask(id: string): Promise<EvalTask | null> {\n    return this.storage.getTask(id);\n  }\n\n  async listTasks(filters?: {\n    type?: EvalTaskType;\n    difficulty?: EvalDifficulty;\n    category?: string;\n  }): Promise<EvalTask[]> {\n    return this.storage.listTasks(filters);\n  }\n\n  // ===========================================================================\n  // Single Evaluation\n  // ===========================================================================\n\n  async evaluate(\n    taskId: string,\n    modelId: string,\n    executeModel: (prompt: string, systemPrompt?: string) => Promise<{\n      response: string;\n      inputTokens: number;\n      outputTokens: number;\n      latencyMs: number;\n      cost: number;\n    }>,\n    options?: {\n      evaluatorExecute?: (prompt: string) => Promise<string>;\n    }\n  ): Promise<EvalResult> {\n    const task = await this.storage.getTask(taskId);\n    if (!task) throw new Error(\"Task not found\");\n\n    const model = await this.storage.getModel(modelId);\n    if (!model) throw new Error(\"Model not found\");\n\n    this.emit(\"evaluationStarted\", taskId, modelId);\n\n    let response: string = \"\";\n    let inputTokens = 0;\n    let outputTokens = 0;\n    let latencyMs = 0;\n    let cost = 0;\n    let error: string | undefined;\n    let timedOut = false;\n\n    try {\n      // Execute model\n      const timeoutPromise = new Promise<never>((_, reject) => {\n        setTimeout(() => reject(new Error(\"Timeout\")), task.timeoutMs || this.config.defaultTaskTimeoutMs);\n      });\n\n      const result = await Promise.race([\n        executeModel(task.prompt, task.systemPrompt),\n        timeoutPromise,\n      ]);\n\n      response = result.response;\n      inputTokens = result.inputTokens;\n      outputTokens = result.outputTokens;\n      latencyMs = result.latencyMs;\n      cost = result.cost;\n    } catch (e) {\n      error = (e as Error).message;\n      if (error === \"Timeout\") {\n        timedOut = true;\n      }\n    }\n\n    // Calculate metrics\n    const metrics: MetricResult[] = [];\n\n    if (!error && response) {\n      for (const metricName of task.metrics) {\n        const metric = metricName as MetricType;\n        const score = await this.calculateMetric(\n          metric,\n          task,\n          response,\n          options?.evaluatorExecute\n        );\n        metrics.push(score);\n      }\n    }\n\n    const overallScore = calculateOverallScore(metrics);\n    const passed = overallScore >= task.passingScore;\n\n    const result: EvalResult = {\n      id: randomUUID(),\n      taskId,\n      modelId,\n      timestamp: Date.now(),\n      prompt: task.prompt,\n      response,\n      expectedOutput: task.expectedOutput,\n      metrics,\n      overallScore,\n      passed,\n      inputTokens,\n      outputTokens,\n      latencyMs,\n      cost,\n      evaluatorModel: this.config.defaultEvaluatorModel,\n      humanEvaluated: false,\n      error,\n      timedOut,\n    };\n\n    await this.storage.saveResult(result);\n    this.emit(\"evaluationCompleted\", result);\n    return result;\n  }\n\n  private async calculateMetric(\n    metric: MetricType,\n    task: EvalTask,\n    response: string,\n    evaluatorExecute?: (prompt: string) => Promise<string>\n  ): Promise<MetricResult> {\n    switch (metric) {\n      case \"exact_match\":\n        return {\n          metric,\n          score: task.expectedOutput === response ? 1 : 0,\n        };\n\n      case \"fuzzy_match\":\n        return {\n          metric,\n          score: this.fuzzyMatch(task.expectedOutput || \"\", response),\n        };\n\n      case \"latency\":\n        // Latency is tracked separately, normalized score\n        return {\n          metric,\n          score: 1, // Will be calculated based on actual latency\n        };\n\n      case \"accuracy\":\n      case \"relevance\":\n      case \"coherence\":\n      case \"fluency\":\n        if (evaluatorExecute) {\n          return this.llmEvaluate(metric, task, response, evaluatorExecute);\n        }\n        return { metric, score: 0.5, details: \"No evaluator available\" };\n\n      default:\n        return { metric, score: 0.5, details: \"Metric not implemented\" };\n    }\n  }\n\n  private fuzzyMatch(expected: string, actual: string): number {\n    const expectedLower = expected.toLowerCase().trim();\n    const actualLower = actual.toLowerCase().trim();\n\n    if (expectedLower === actualLower) return 1;\n    if (actualLower.includes(expectedLower) || expectedLower.includes(actualLower)) return 0.8;\n\n    // Simple word overlap\n    const expectedWords = new Set(expectedLower.split(/\\s+/));\n    const actualWords = new Set(actualLower.split(/\\s+/));\n    const intersection = new Set([...expectedWords].filter((w) => actualWords.has(w)));\n\n    return intersection.size / Math.max(expectedWords.size, actualWords.size);\n  }\n\n  private async llmEvaluate(\n    metric: MetricType,\n    task: EvalTask,\n    response: string,\n    evaluatorExecute: (prompt: string) => Promise<string>\n  ): Promise<MetricResult> {\n    const promptTemplate = EVALUATION_PROMPTS[metric as keyof typeof EVALUATION_PROMPTS];\n    if (!promptTemplate) {\n      return { metric, score: 0.5, details: \"No evaluation prompt for metric\" };\n    }\n\n    const evalPrompt = promptTemplate\n      .replace(\"{{expected}}\", task.expectedOutput || \"\")\n      .replace(\"{{actual}}\", response)\n      .replace(\"{{prompt}}\", task.prompt)\n      .replace(\"{{response}}\", response)\n      .replace(\"{{text}}\", response);\n\n    try {\n      const result = await evaluatorExecute(evalPrompt);\n      const score = parseFloat(result.trim());\n\n      if (isNaN(score) || score < 0 || score > 1) {\n        return { metric, score: 0.5, details: \"Invalid score from evaluator\" };\n      }\n\n      return { metric, score };\n    } catch (e) {\n      return { metric, score: 0.5, details: `Evaluation failed: ${(e as Error).message}` };\n    }\n  }\n\n  // ===========================================================================\n  // Benchmarks\n  // ===========================================================================\n\n  async createBenchmark(input: {\n    name: string;\n    description?: string;\n    taskIds: string[];\n    modelIds: string[];\n    config?: Partial<BenchmarkConfig>;\n    tags?: string[];\n    createdBy?: string;\n  }): Promise<Benchmark> {\n    const benchmark: Benchmark = {\n      id: randomUUID(),\n      name: input.name,\n      description: input.description,\n      status: \"draft\",\n      taskIds: input.taskIds,\n      taskCount: input.taskIds.length,\n      modelIds: input.modelIds,\n      config: {\n        runsPerTask: 1,\n        temperature: 0,\n        maxConcurrent: 5,\n        timeoutMs: 60000,\n        useEvaluatorModel: true,\n        primaryMetric: \"accuracy\",\n        includePerformanceMetrics: true,\n        includeCostMetrics: true,\n        ...input.config,\n      },\n      completedTasks: 0,\n      totalTasks: input.taskIds.length * input.modelIds.length * (input.config?.runsPerTask || 1),\n      tags: input.tags || [],\n      createdAt: Date.now(),\n      createdBy: input.createdBy,\n    };\n\n    await this.storage.saveBenchmark(benchmark);\n    this.emit(\"benchmarkCreated\", benchmark);\n    return benchmark;\n  }\n\n  async runBenchmark(\n    benchmarkId: string,\n    executeModel: (modelId: string, prompt: string, systemPrompt?: string) => Promise<{\n      response: string;\n      inputTokens: number;\n      outputTokens: number;\n      latencyMs: number;\n      cost: number;\n    }>,\n    options?: {\n      evaluatorExecute?: (prompt: string) => Promise<string>;\n      onProgress?: (completed: number, total: number) => void;\n    }\n  ): Promise<BenchmarkResult[]> {\n    const benchmark = await this.storage.getBenchmark(benchmarkId);\n    if (!benchmark) throw new Error(\"Benchmark not found\");\n\n    if (this.runningBenchmarks.has(benchmarkId)) {\n      throw new Error(\"Benchmark is already running\");\n    }\n\n    this.runningBenchmarks.add(benchmarkId);\n\n    // Update status\n    benchmark.status = \"running\";\n    benchmark.startedAt = Date.now();\n    await this.storage.saveBenchmark(benchmark);\n    this.emit(\"benchmarkStarted\", benchmark);\n\n    const results: Map<string, EvalResult[]> = new Map();\n\n    try {\n      // Initialize results map\n      for (const modelId of benchmark.modelIds) {\n        results.set(modelId, []);\n      }\n\n      // Run evaluations\n      let completed = 0;\n      const tasks = await Promise.all(benchmark.taskIds.map((id) => this.storage.getTask(id)));\n      const validTasks = tasks.filter((t): t is EvalTask => t !== null);\n\n      for (const task of validTasks) {\n        for (const modelId of benchmark.modelIds) {\n          for (let run = 0; run < benchmark.config.runsPerTask; run++) {\n            try {\n              const result = await this.evaluate(\n                task.id,\n                modelId,\n                (prompt, systemPrompt) => executeModel(modelId, prompt, systemPrompt),\n                { evaluatorExecute: options?.evaluatorExecute }\n              );\n\n              results.get(modelId)!.push(result);\n            } catch (e) {\n              // Create failed result\n              const failedResult: EvalResult = {\n                id: randomUUID(),\n                taskId: task.id,\n                modelId,\n                timestamp: Date.now(),\n                prompt: task.prompt,\n                response: \"\",\n                metrics: [],\n                overallScore: 0,\n                passed: false,\n                inputTokens: 0,\n                outputTokens: 0,\n                latencyMs: 0,\n                cost: 0,\n                error: (e as Error).message,\n                timedOut: false,\n                humanEvaluated: false,\n              };\n              results.get(modelId)!.push(failedResult);\n            }\n\n            completed++;\n            benchmark.completedTasks = completed;\n            await this.storage.saveBenchmark(benchmark);\n\n            this.emit(\"benchmarkProgress\", benchmarkId, completed, benchmark.totalTasks);\n            options?.onProgress?.(completed, benchmark.totalTasks);\n          }\n        }\n      }\n\n      // Calculate and save results for each model\n      const benchmarkResults: BenchmarkResult[] = [];\n\n      for (const [modelId, modelResults] of results) {\n        const benchmarkResult = this.calculateBenchmarkResult(benchmarkId, modelId, modelResults);\n        await this.storage.saveBenchmarkResult(benchmarkResult);\n        benchmarkResults.push(benchmarkResult);\n      }\n\n      // Update benchmark status\n      benchmark.status = \"completed\";\n      benchmark.completedAt = Date.now();\n      await this.storage.saveBenchmark(benchmark);\n\n      this.emit(\"benchmarkCompleted\", benchmark, benchmarkResults);\n      return benchmarkResults;\n    } catch (e) {\n      benchmark.status = \"failed\";\n      await this.storage.saveBenchmark(benchmark);\n      this.emit(\"benchmarkFailed\", benchmark, e as Error);\n      throw e;\n    } finally {\n      this.runningBenchmarks.delete(benchmarkId);\n    }\n  }\n\n  private calculateBenchmarkResult(\n    benchmarkId: string,\n    modelId: string,\n    results: EvalResult[]\n  ): BenchmarkResult {\n    const passedResults = results.filter((r) => r.passed);\n    const errorResults = results.filter((r) => r.error);\n\n    // Aggregate metrics\n    const metricScores: Partial<Record<MetricType, number>> = {};\n    const metricCounts: Partial<Record<MetricType, number>> = {};\n\n    for (const result of results) {\n      for (const metric of result.metrics) {\n        metricScores[metric.metric] = (metricScores[metric.metric] || 0) + metric.score;\n        metricCounts[metric.metric] = (metricCounts[metric.metric] || 0) + 1;\n      }\n    }\n\n    for (const metric of Object.keys(metricScores) as MetricType[]) {\n      metricScores[metric] = metricScores[metric]! / (metricCounts[metric] || 1);\n    }\n\n    // Task type scores\n    const taskTypeScores: Partial<Record<EvalTaskType, number>> = {};\n    // Would need to load tasks to calculate this properly\n\n    // Difficulty scores\n    const difficultyScores: Partial<Record<EvalDifficulty, number>> = {};\n    // Would need to load tasks to calculate this properly\n\n    // Performance metrics\n    const validResults = results.filter((r) => !r.error);\n    const avgLatencyMs = validResults.length > 0\n      ? validResults.reduce((sum, r) => sum + r.latencyMs, 0) / validResults.length\n      : 0;\n    const totalTokens = results.reduce((sum, r) => sum + r.inputTokens + r.outputTokens, 0);\n    const totalCost = results.reduce((sum, r) => sum + r.cost, 0);\n    const totalLatency = validResults.reduce((sum, r) => sum + r.latencyMs, 0);\n    const avgTokensPerSecond = totalLatency > 0\n      ? (totalTokens / totalLatency) * 1000\n      : 0;\n\n    return {\n      benchmarkId,\n      modelId,\n      calculatedAt: Date.now(),\n      overallScore: results.length > 0\n        ? results.reduce((sum, r) => sum + r.overallScore, 0) / results.length\n        : 0,\n      passRate: calculatePassRate(results),\n      metricScores: metricScores as Record<MetricType, number>,\n      taskTypeScores: taskTypeScores as Record<EvalTaskType, number>,\n      difficultyScores: difficultyScores as Record<EvalDifficulty, number>,\n      avgLatencyMs,\n      avgTokensPerSecond,\n      totalTokens,\n      totalCost,\n      resultIds: results.map((r) => r.id),\n      passedCount: passedResults.length,\n      failedCount: results.length - passedResults.length - errorResults.length,\n      errorCount: errorResults.length,\n    };\n  }\n\n  async getBenchmark(id: string): Promise<Benchmark | null> {\n    return this.storage.getBenchmark(id);\n  }\n\n  async listBenchmarks(status?: BenchmarkStatus): Promise<Benchmark[]> {\n    return this.storage.listBenchmarks(status);\n  }\n\n  async getBenchmarkResults(benchmarkId: string): Promise<BenchmarkResult[]> {\n    return this.storage.getBenchmarkResults(benchmarkId);\n  }\n\n  // ===========================================================================\n  // Model Comparison\n  // ===========================================================================\n\n  async compareModels(benchmarkId: string): Promise<ComparisonResult> {\n    const benchmark = await this.storage.getBenchmark(benchmarkId);\n    if (!benchmark) throw new Error(\"Benchmark not found\");\n\n    const results = await this.storage.getBenchmarkResults(benchmarkId);\n    if (results.length === 0) throw new Error(\"No benchmark results found\");\n\n    // Overall rankings\n    const overallRankings = compareModels(results, benchmark.config.primaryMetric);\n\n    // Rankings by metric\n    const rankingsByMetric: Partial<Record<MetricType, ModelRanking[]>> = {};\n    const metrics = Object.keys(results[0]?.metricScores || {}) as MetricType[];\n    for (const metric of metrics) {\n      rankingsByMetric[metric] = compareModels(results, metric);\n    }\n\n    // Rankings by task type\n    const rankingsByTaskType: Partial<Record<EvalTaskType, ModelRanking[]>> = {};\n    // Would need task type data to calculate\n\n    // Best models\n    const bestOverall = overallRankings[0]?.modelId || \"\";\n\n    // Quality/price ratio\n    const qualityPriceScores = results.map((r) => ({\n      modelId: r.modelId,\n      score: r.overallScore / (r.totalCost + 0.001), // Avoid division by zero\n    }));\n    qualityPriceScores.sort((a, b) => b.score - a.score);\n    const bestQualityPrice = qualityPriceScores[0]?.modelId;\n\n    // Best latency\n    const latencyScores = [...results].sort((a, b) => a.avgLatencyMs - b.avgLatencyMs);\n    const bestLatency = latencyScores[0]?.modelId;\n\n    // Statistical significance\n    const significantDifferences: ComparisonResult[\"significantDifferences\"] = [];\n\n    for (let i = 0; i < results.length; i++) {\n      for (let j = i + 1; j < results.length; j++) {\n        const allResults = await this.storage.listResults({});\n        const scores1 = allResults\n          .filter((r) => r.modelId === results[i].modelId)\n          .map((r) => r.overallScore);\n        const scores2 = allResults\n          .filter((r) => r.modelId === results[j].modelId)\n          .map((r) => r.overallScore);\n\n        const { significant, pValue } = calculateStatisticalSignificance(scores1, scores2);\n\n        if (significant) {\n          significantDifferences.push({\n            model1: results[i].modelId,\n            model2: results[j].modelId,\n            metric: benchmark.config.primaryMetric,\n            pValue,\n            difference: results[i].overallScore - results[j].overallScore,\n          });\n        }\n      }\n    }\n\n    const comparison: ComparisonResult = {\n      id: randomUUID(),\n      benchmarkId,\n      timestamp: Date.now(),\n      overallRankings,\n      rankingsByMetric: rankingsByMetric as Record<MetricType, ModelRanking[]>,\n      rankingsByTaskType: rankingsByTaskType as Record<EvalTaskType, ModelRanking[]>,\n      bestOverall,\n      bestByCategory: {},\n      bestQualityPrice,\n      bestLatency,\n      bestForProduction: bestQualityPrice, // Simple heuristic\n      significantDifferences,\n    };\n\n    await this.storage.saveComparison(comparison);\n    this.emit(\"comparisonGenerated\", comparison);\n    return comparison;\n  }\n\n  // ===========================================================================\n  // Model Selection\n  // ===========================================================================\n\n  async recommendModels(criteria: SelectionCriteria): Promise<ModelRecommendation[]> {\n    const allModels = await this.storage.listModels({ available: true });\n\n    // Filter models by criteria\n    let candidates = allModels.filter((model) => {\n      // Required capabilities\n      if (criteria.requiredCapabilities) {\n        if (!criteria.requiredCapabilities.every((c) => model.capabilities.includes(c))) {\n          return false;\n        }\n      }\n\n      // Provider preferences\n      if (criteria.preferredProviders && !criteria.preferredProviders.includes(model.provider)) {\n        return false;\n      }\n      if (criteria.excludedProviders && criteria.excludedProviders.includes(model.provider)) {\n        return false;\n      }\n      if (criteria.excludedModels && criteria.excludedModels.includes(model.id)) {\n        return false;\n      }\n\n      // Performance constraints\n      if (criteria.maxLatencyMs && model.avgLatencyMs && model.avgLatencyMs > criteria.maxLatencyMs) {\n        return false;\n      }\n      if (criteria.minTokensPerSecond && model.tokensPerSecond && model.tokensPerSecond < criteria.minTokensPerSecond) {\n        return false;\n      }\n\n      return true;\n    });\n\n    // Get benchmark results for candidates\n    const benchmarks = await this.storage.listBenchmarks(\"completed\");\n    const modelResults: Map<string, BenchmarkResult[]> = new Map();\n\n    for (const benchmark of benchmarks) {\n      const results = await this.storage.getBenchmarkResults(benchmark.id);\n      for (const result of results) {\n        if (candidates.some((c) => c.id === result.modelId)) {\n          const existing = modelResults.get(result.modelId) || [];\n          existing.push(result);\n          modelResults.set(result.modelId, existing);\n        }\n      }\n    }\n\n    // Score and rank candidates\n    const recommendations: ModelRecommendation[] = candidates.map((model) => {\n      const results = modelResults.get(model.id) || [];\n\n      // Calculate scores\n      const avgOverallScore = results.length > 0\n        ? results.reduce((sum, r) => sum + r.overallScore, 0) / results.length\n        : 0.5;\n      const avgLatency = results.length > 0\n        ? results.reduce((sum, r) => sum + r.avgLatencyMs, 0) / results.length\n        : model.avgLatencyMs || 1000;\n      const avgCost = results.length > 0\n        ? results.reduce((sum, r) => sum + r.totalCost / r.resultIds.length, 0) / results.length\n        : (model.inputPricePerMillion + model.outputPricePerMillion) / 2000; // Estimate\n\n      // Apply score thresholds\n      let matchScore = 1;\n      if (criteria.minOverallScore && avgOverallScore < criteria.minOverallScore) {\n        matchScore *= 0.5;\n      }\n      if (criteria.maxCostPerRequest && avgCost > criteria.maxCostPerRequest) {\n        matchScore *= 0.5;\n      }\n\n      // Calculate component scores (0-1)\n      const qualityScore = avgOverallScore;\n      const costScore = 1 / (1 + avgCost * 10); // Normalize cost\n      const latencyScore = 1 / (1 + avgLatency / 1000); // Normalize latency\n\n      // Combined score based on optimization target\n      let score: number;\n      switch (criteria.optimizeFor) {\n        case \"quality\":\n          score = qualityScore * 0.7 + costScore * 0.15 + latencyScore * 0.15;\n          break;\n        case \"cost\":\n          score = qualityScore * 0.3 + costScore * 0.5 + latencyScore * 0.2;\n          break;\n        case \"latency\":\n          score = qualityScore * 0.3 + costScore * 0.2 + latencyScore * 0.5;\n          break;\n        default:\n          score = qualityScore * 0.4 + costScore * 0.3 + latencyScore * 0.3;\n      }\n\n      score *= matchScore;\n\n      // Generate strengths/weaknesses\n      const strengths: string[] = [];\n      const weaknesses: string[] = [];\n\n      if (qualityScore > 0.8) strengths.push(\"High quality outputs\");\n      else if (qualityScore < 0.5) weaknesses.push(\"Lower quality outputs\");\n\n      if (costScore > 0.8) strengths.push(\"Cost-effective\");\n      else if (costScore < 0.3) weaknesses.push(\"Higher cost\");\n\n      if (latencyScore > 0.8) strengths.push(\"Fast response times\");\n      else if (latencyScore < 0.3) weaknesses.push(\"Slower response times\");\n\n      if (model.contextWindow > 100000) strengths.push(\"Large context window\");\n      if (model.capabilities.includes(\"function_calling\")) strengths.push(\"Supports function calling\");\n      if (model.capabilities.includes(\"vision\")) strengths.push(\"Multimodal (vision)\");\n\n      return {\n        modelId: model.id,\n        score,\n        rank: 0, // Will be set after sorting\n        matchScore,\n        strengths,\n        weaknesses,\n        qualityScore,\n        costScore,\n        latencyScore,\n        estimatedLatencyMs: avgLatency,\n        estimatedCostPerRequest: avgCost,\n        estimatedAccuracy: avgOverallScore,\n        confidence: Math.min(results.length / 10, 1), // Higher confidence with more data\n        dataPoints: results.length,\n      };\n    });\n\n    // Sort and assign ranks\n    recommendations.sort((a, b) => b.score - a.score);\n    recommendations.forEach((r, i) => {\n      r.rank = i + 1;\n    });\n\n    this.emit(\"recommendationGenerated\", recommendations);\n    return recommendations;\n  }\n\n  // ===========================================================================\n  // Datasets\n  // ===========================================================================\n\n  async createDataset(input: Omit<Dataset, \"id\" | \"taskCount\" | \"createdAt\" | \"updatedAt\">): Promise<Dataset> {\n    const dataset: Dataset = {\n      ...input,\n      id: randomUUID(),\n      taskCount: input.tasks.length,\n      createdAt: Date.now(),\n      updatedAt: Date.now(),\n    };\n\n    // Save tasks\n    for (const task of dataset.tasks) {\n      await this.storage.saveTask(task);\n    }\n\n    await this.storage.saveDataset(dataset);\n    return dataset;\n  }\n\n  async getDataset(id: string): Promise<Dataset | null> {\n    return this.storage.getDataset(id);\n  }\n\n  async listDatasets(): Promise<Dataset[]> {\n    return this.storage.listDatasets();\n  }\n\n  // ===========================================================================\n  // Human Evaluation\n  // ===========================================================================\n\n  async addHumanEvaluation(\n    resultId: string,\n    score: number,\n    notes?: string\n  ): Promise<EvalResult | null> {\n    const result = await this.storage.getResult(resultId);\n    if (!result) return null;\n\n    result.humanEvaluated = true;\n    result.humanScore = score;\n    result.humanNotes = notes;\n\n    await this.storage.saveResult(result);\n    return result;\n  }\n\n  // ===========================================================================\n  // Utility Methods\n  // ===========================================================================\n\n  async getResults(filters: {\n    taskId?: string;\n    modelId?: string;\n    startTime?: number;\n    endTime?: number;\n  }): Promise<EvalResult[]> {\n    return this.storage.listResults(filters);\n  }\n\n  async getModelStats(modelId: string): Promise<{\n    totalEvaluations: number;\n    avgScore: number;\n    passRate: number;\n    avgLatencyMs: number;\n    avgCost: number;\n    byTaskType: Record<string, { count: number; avgScore: number }>;\n  }> {\n    const results = await this.storage.listResults({ modelId });\n\n    if (results.length === 0) {\n      return {\n        totalEvaluations: 0,\n        avgScore: 0,\n        passRate: 0,\n        avgLatencyMs: 0,\n        avgCost: 0,\n        byTaskType: {},\n      };\n    }\n\n    const validResults = results.filter((r) => !r.error);\n\n    return {\n      totalEvaluations: results.length,\n      avgScore: validResults.reduce((sum, r) => sum + r.overallScore, 0) / validResults.length,\n      passRate: calculatePassRate(results),\n      avgLatencyMs: validResults.reduce((sum, r) => sum + r.latencyMs, 0) / validResults.length,\n      avgCost: results.reduce((sum, r) => sum + r.cost, 0) / results.length,\n      byTaskType: {}, // Would need task data\n    };\n  }\n}\n\n// =============================================================================\n// Singleton & Factory\n// =============================================================================\n\nlet defaultEvaluator: ModelEvaluator | null = null;\n\nexport function getModelEvaluator(): ModelEvaluator {\n  if (!defaultEvaluator) {\n    defaultEvaluator = new ModelEvaluator();\n  }\n  return defaultEvaluator;\n}\n\nexport function createModelEvaluator(\n  config?: Partial<ModelEvaluatorConfig>,\n  storage?: ModelEvaluatorStorage\n): ModelEvaluator {\n  return new ModelEvaluator(config, storage);\n}\n"],"mappings":"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","names":["z","EventEmitter","EventEmitter","cacheMiddleware","z","EventEmitter","z","z","ScheduleSchema","OrganizationSchema","AuditEventSchema","z","MetricTypeSchema","MetricUnitSchema","SpanStatusSchema","SpanSchema","TraceSchema","EventEmitter","randomUUID","EventEmitter","randomUUID","instance","z","EventEmitter","randomUUID","EventEmitter","randomUUID","instance","EventEmitter","randomUUID","z","instance","EventEmitter","randomUUID","z","instance","EventEmitter","randomUUID","z","instance","z","HealthCheckTypeSchema","EventEmitter","EventEmitter","EventEmitter","EventEmitter","EventEmitter","randomUUID","EventEmitter","randomUUID","EventEmitter","EventEmitter","z","ProviderConfigSchema","EventEmitter","randomUUID","EventEmitter","randomUUID","z","EventEmitter","EventEmitter","z","EventEmitter","randomBytes","EventEmitter","result","randomBytes","z","EventEmitter","randomBytes","EventEmitter","randomBytes","csp","defaultManager","z","TraceContextSchema","SpanStatusCodeSchema","SpanStatusSchema","SpanKindSchema","SpanEventSchema","SpanLinkSchema","SpanSchema","SamplerTypeSchema","SamplerConfigSchema","ExporterTypeSchema","ExporterConfigSchema","EventEmitter","randomBytes","generateTraceId","randomBytes","generateSpanId","Tracer","EventEmitter","getTracer","createTracer","z","LogQuerySchema","EventEmitter","createHash","Logger","EventEmitter","createHash","z","TimeSeriesPointSchema","TimeSeriesSchema","EventEmitter","Counter","Gauge","Histogram","EventEmitter","defaultRegistry","z","EventEmitter","randomUUID","EventEmitter","randomUUID","defaultManager","z","EventEmitter","createHash","randomUUID","createHash","randomUUID","EventEmitter","variation","defaultManager","z","EventEmitter","randomUUID","EventEmitter","randomUUID","result","defaultManager","z","RegionStatusSchema","ReplicationModeSchema","ReplicationConfigSchema","ReplicationStatusSchema","FailoverEventSchema","EventEmitter","randomUUID","EventEmitter","randomUUID","defaultManager","z","EventEmitter","randomUUID","EventEmitter","randomUUID","defaultManager","z","EventEmitter","randomUUID","EventEmitter","randomUUID","z","EventEmitter","randomUUID","EventEmitter","randomUUID","defaultManager","z","EventEmitter","randomUUID","EventEmitter","randomUUID","defaultManager","z","ModelCapabilitySchema","MetricTypeSchema","EventEmitter","randomUUID","EventEmitter","randomUUID","result"]}