{"version":3,"sources":["../src/cli.ts"],"sourcesContent":["#!/usr/bin/env node\n/**\n * gICM Integration Hub CLI\n *\n * Commands:\n * - start: Start the integration hub\n * - status: Show hub status\n */\n\nimport { Command } from \"commander\";\nimport { IntegrationHub, setHubInstance } from \"./hub.js\";\n\nconst program = new Command();\n\nprogram\n  .name(\"gicm-hub\")\n  .description(\"gICM Integration Hub - Central event bus and API gateway\")\n  .version(\"0.1.0\");\n\n// ============================================================================\n// START COMMAND\n// ============================================================================\n\nprogram\n  .command(\"start\")\n  .description(\"Start the integration hub\")\n  .option(\"-p, --port <port>\", \"API port\", \"3001\")\n  .option(\"--no-workflows\", \"Disable automated workflows\")\n  .action(async (options) => {\n    console.log(\"Starting gICM Integration Hub...\\n\");\n\n    const hub = new IntegrationHub({\n      apiPort: parseInt(options.port, 10),\n      enableWorkflows: options.workflows !== false,\n    });\n\n    // Set global instance for engines to emit events\n    setHubInstance(hub);\n\n    // Handle shutdown\n    process.on(\"SIGINT\", async () => {\n      console.log(\"\\nShutting down...\");\n      await hub.stop();\n      process.exit(0);\n    });\n\n    process.on(\"SIGTERM\", async () => {\n      await hub.stop();\n      process.exit(0);\n    });\n\n    try {\n      await hub.start();\n\n      console.log(\"\\n\" + \"=\".repeat(50));\n      console.log(\"gICM Integration Hub is running!\");\n      console.log(\"=\".repeat(50));\n      console.log(\"\");\n      console.log(\"API Endpoints:\");\n      console.log(\"  REST:      http://localhost:\" + options.port + \"/api\");\n      console.log(\"  WebSocket: ws://localhost:\" + options.port + \"/ws\");\n      console.log(\"  Health:    http://localhost:\" + options.port + \"/health\");\n      console.log(\"\");\n      console.log(\"Press Ctrl+C to stop\");\n      console.log(\"\");\n    } catch (error) {\n      console.error(\"Failed to start hub:\", error);\n      process.exit(1);\n    }\n  });\n\n// ============================================================================\n// STATUS COMMAND\n// ============================================================================\n\nprogram\n  .command(\"status\")\n  .description(\"Show hub status (requires running hub)\")\n  .option(\"-p, --port <port>\", \"API port\", \"3001\")\n  .action(async (options) => {\n    const port = options.port;\n\n    try {\n      const response = await fetch(\"http://localhost:\" + port + \"/api/status\");\n      const data = await response.json() as {\n        ok: boolean;\n        engines: {\n          status: { healthy: number; degraded: number; offline: number };\n          details: Array<{ id: string; status: string }>;\n        };\n      };\n\n      console.log(\"gICM Integration Hub Status\\n\");\n      console.log(\"API Port:\", port);\n      console.log(\"Status:\", data.ok ? \"OK\" : \"DEGRADED\");\n      console.log(\"\");\n\n      console.log(\"Engine Status:\");\n      const { engines } = data;\n      console.log(\"  Healthy:\", engines.status.healthy);\n      console.log(\"  Degraded:\", engines.status.degraded);\n      console.log(\"  Offline:\", engines.status.offline);\n      console.log(\"\");\n\n      console.log(\"Engine Details:\");\n      for (const engine of engines.details) {\n        const statusIcon =\n          engine.status === \"healthy\" ? \"+\" :\n          engine.status === \"degraded\" ? \"!\" : \"-\";\n        console.log(\"  [\" + statusIcon + \"] \" + engine.id + \": \" + engine.status);\n      }\n    } catch (error) {\n      console.error(\"Failed to connect to hub on port\", port);\n      console.error(\"Is the hub running? Start it with: gicm-hub start\");\n      process.exit(1);\n    }\n  });\n\n// ============================================================================\n// EVENTS COMMAND\n// ============================================================================\n\nprogram\n  .command(\"events\")\n  .description(\"Show recent events\")\n  .option(\"-p, --port <port>\", \"API port\", \"3001\")\n  .option(\"-n, --limit <limit>\", \"Number of events\", \"20\")\n  .action(async (options) => {\n    const port = options.port;\n    const limit = options.limit;\n\n    try {\n      const response = await fetch(\n        \"http://localhost:\" + port + \"/api/events?limit=\" + limit\n      );\n      const data = await response.json() as {\n        count: number;\n        events: Array<{\n          timestamp: number;\n          source: string;\n          type: string;\n          payload: Record<string, unknown>;\n        }>;\n      };\n\n      console.log(\"Recent Events (\" + data.count + \")\\n\");\n\n      for (const event of data.events) {\n        const time = new Date(event.timestamp).toISOString().slice(11, 19);\n        console.log(\"[\" + time + \"] \" + event.source + \" -> \" + event.type);\n        if (Object.keys(event.payload).length > 0) {\n          console.log(\"        \" + JSON.stringify(event.payload));\n        }\n      }\n    } catch (error) {\n      console.error(\"Failed to connect to hub on port\", port);\n      process.exit(1);\n    }\n  });\n\nprogram.parse();\n"],"mappings":"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","names":[]}