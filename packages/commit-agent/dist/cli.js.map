{"version":3,"sources":["../src/commit-agent.ts","../src/git/operations.ts","../src/core/constants.ts","../src/git/diff-analyzer.ts","../src/message/generator.ts","../src/message/prompts.ts","../src/git/pr-creator.ts","../src/core/types.ts","../src/cli.ts"],"sourcesContent":["/**\n * Commit Agent\n *\n * AI-powered git commit message generation with full workflow automation\n */\n\nimport { BaseAgent } from \"@gicm/agent-core\";\nimport type { AgentConfig, AgentContext, AgentResult } from \"@gicm/agent-core\";\nimport { z } from \"zod\";\nimport { GitOperations } from \"./git/operations.js\";\nimport { DiffAnalyzer } from \"./git/diff-analyzer.js\";\nimport { MessageGenerator } from \"./message/generator.js\";\nimport { PRCreator } from \"./git/pr-creator.js\";\nimport type {\n  CommitAgentConfig,\n  CommitRequest,\n  CommitResult,\n  GeneratedMessage,\n  GitStatus,\n  DiffSummary,\n  PushOptions,\n  PushResult,\n  PROptions,\n  PRResult,\n  CommitRiskAssessment,\n} from \"./core/types.js\";\nimport { CommitAgentConfigSchema } from \"./core/types.js\";\n\nexport class CommitAgent extends BaseAgent {\n  private git: GitOperations;\n  private diffAnalyzer: DiffAnalyzer;\n  private messageGenerator: MessageGenerator;\n  private prCreator: PRCreator;\n  private commitConfig: CommitAgentConfig;\n\n  constructor(config: Partial<CommitAgentConfig> = {}) {\n    const validated = CommitAgentConfigSchema.parse(config);\n\n    super(\"commit-agent\", {\n      name: validated.name,\n      description: validated.description ?? \"AI-powered git commit workflow\",\n      llmProvider: validated.llmProvider,\n      llmModel: validated.llmModel,\n      apiKey: validated.apiKey,\n      temperature: validated.temperature,\n      maxTokens: validated.maxTokens,\n      verbose: validated.verbose,\n    });\n\n    this.commitConfig = validated;\n\n    // Initialize components\n    this.git = new GitOperations();\n    this.diffAnalyzer = new DiffAnalyzer();\n    this.messageGenerator = new MessageGenerator({\n      llmProvider: validated.llmProvider,\n      llmModel: validated.llmModel,\n      apiKey: validated.apiKey,\n      temperature: validated.temperature,\n      maxTokens: validated.maxTokens,\n      includeCoAuthor: validated.includeCoAuthors,\n      coAuthorName: validated.coAuthorName,\n      coAuthorEmail: validated.coAuthorEmail,\n    });\n    this.prCreator = new PRCreator({ apiKey: validated.apiKey });\n\n    // Register tools\n    this.initializeTools();\n  }\n\n  getSystemPrompt(): string {\n    return `You are a commit agent that helps developers create meaningful, well-structured git commits.\n\nYou follow the Conventional Commits specification and can:\n1. Analyze code changes to understand what was modified\n2. Generate appropriate commit messages based on the changes\n3. Stage, commit, and push changes\n4. Create pull requests with comprehensive descriptions\n\nYou always:\n- Use imperative mood in commit messages (\"add\" not \"added\")\n- Keep subject lines under 72 characters\n- Provide reasoning for your commit type choices\n- Consider the risk level of changes before auto-executing`;\n  }\n\n  async analyze(context: AgentContext): Promise<AgentResult> {\n    const action = (context.action ?? \"status\") as string;\n    const params = context.params ?? {};\n\n    this.log(`Executing action: ${action}`, params);\n\n    try {\n      switch (action) {\n        case \"status\":\n          return this.handleStatus();\n\n        case \"generate\":\n          return this.handleGenerate(params.staged as boolean);\n\n        case \"commit\":\n          return this.handleCommit(params as CommitRequest);\n\n        case \"push\":\n          return this.handlePush(params as PushOptions);\n\n        case \"create_pr\":\n          return this.handleCreatePR(params as PROptions);\n\n        case \"full\":\n          return this.handleFullWorkflow(params as CommitRequest);\n\n        default:\n          return this.createResult(false, null, `Unknown action: ${action}`);\n      }\n    } catch (error) {\n      const err = error as Error;\n      return this.createResult(false, null, err.message);\n    }\n  }\n\n  // ============================================================================\n  // PUBLIC API\n  // ============================================================================\n\n  /**\n   * Get current git status\n   */\n  async getStatus(): Promise<GitStatus> {\n    return this.git.getStatus();\n  }\n\n  /**\n   * Generate a commit message from current changes\n   */\n  async generateMessage(staged = true): Promise<GeneratedMessage> {\n    const diff = await this.getDiff(staged);\n\n    if (diff.files.length === 0) {\n      throw new Error(staged ? \"No staged changes to commit\" : \"No changes found\");\n    }\n\n    return this.messageGenerator.generate(diff);\n  }\n\n  /**\n   * Get diff with parsed file changes\n   */\n  async getDiff(staged = true): Promise<DiffSummary> {\n    const rawDiff = await this.git.getDiff(staged);\n    return this.diffAnalyzer.parseDiff(rawDiff, staged);\n  }\n\n  /**\n   * Assess risk of committing changes\n   */\n  async assessRisk(staged = true): Promise<CommitRiskAssessment> {\n    const diff = await this.getDiff(staged);\n    return this.diffAnalyzer.assessRisk(diff, this.commitConfig.criticalPaths);\n  }\n\n  /**\n   * Execute full commit workflow\n   */\n  async commit(request: Partial<CommitRequest> = {}): Promise<CommitResult> {\n    // Stage files if requested\n    if (request.all) {\n      await this.git.stageAll();\n    } else if (request.files?.length) {\n      await this.git.stage(request.files);\n    }\n\n    // Get diff for message generation\n    const diff = await this.getDiff(true);\n\n    if (diff.files.length === 0) {\n      return {\n        success: false,\n        error: \"No changes staged for commit\",\n        approvalRequired: false,\n        pushed: false,\n      };\n    }\n\n    // Assess risk\n    const risk = this.diffAnalyzer.assessRisk(diff, this.commitConfig.criticalPaths);\n\n    // Check if approval required\n    if (risk.recommendation !== \"auto_execute\" && !request.dryRun) {\n      return {\n        success: false,\n        diff,\n        riskScore: risk.totalScore,\n        approvalRequired: true,\n        pushed: false,\n        error: `Risk score ${risk.totalScore} exceeds auto-execute threshold. ${risk.recommendation} recommended.`,\n      };\n    }\n\n    // Generate or use provided message\n    let message: GeneratedMessage;\n    if (request.message) {\n      message = {\n        message: {\n          type: \"chore\",\n          subject: request.message,\n          breaking: false,\n          coAuthors: [],\n        },\n        fullText: request.message,\n        confidence: 1,\n        reasoning: \"User-provided message\",\n      };\n    } else {\n      message = await this.messageGenerator.generate(diff);\n    }\n\n    if (request.dryRun) {\n      return {\n        success: true,\n        message,\n        diff,\n        riskScore: risk.totalScore,\n        approvalRequired: false,\n        pushed: false,\n      };\n    }\n\n    // Create commit\n    const commitHash = await this.git.commit(message.fullText, { amend: request.amend });\n\n    const result: CommitResult = {\n      success: true,\n      commitHash,\n      message,\n      diff,\n      riskScore: risk.totalScore,\n      approvalRequired: false,\n      pushed: false,\n    };\n\n    // Push if requested\n    if (request.push) {\n      const pushResult = await this.push({ setUpstream: true });\n      result.pushed = pushResult.success;\n    }\n\n    // Create PR if requested\n    if (request.createPr && result.pushed) {\n      const prResult = await this.createPR({\n        title: request.prTitle,\n        body: request.prBody,\n        base: request.prBase,\n      });\n      result.prUrl = prResult.url;\n    }\n\n    return result;\n  }\n\n  /**\n   * Push to remote\n   */\n  async push(options: Partial<PushOptions> = {}): Promise<PushResult> {\n    try {\n      const { remote, branch } = await this.git.push({\n        remote: options.remote,\n        branch: options.branch,\n        force: options.force,\n        setUpstream: options.setUpstream,\n      });\n\n      return {\n        success: true,\n        remote,\n        branch,\n        commits: 1, // TODO: count actual commits pushed\n      };\n    } catch (error) {\n      const err = error as Error;\n      return {\n        success: false,\n        remote: options.remote ?? \"origin\",\n        branch: options.branch ?? \"unknown\",\n        commits: 0,\n        error: err.message,\n      };\n    }\n  }\n\n  /**\n   * Create a pull request\n   */\n  async createPR(options: Partial<PROptions> = {}): Promise<PRResult> {\n    // Generate PR content if not provided\n    if (!options.title || !options.body) {\n      const commits = await this.git.getRecentCommits(10);\n      const diff = await this.getDiff(false);\n      const generated = await this.prCreator.generatePR(commits, diff);\n\n      options.title = options.title ?? generated.title;\n      options.body = options.body ?? generated.body;\n    }\n\n    return this.prCreator.create(options);\n  }\n\n  // ============================================================================\n  // TOOL HANDLERS\n  // ============================================================================\n\n  private initializeTools(): void {\n    this.registerTool({\n      name: \"get_status\",\n      description: \"Get current git status\",\n      parameters: z.object({}),\n      execute: async () => this.getStatus(),\n    });\n\n    this.registerTool({\n      name: \"generate_message\",\n      description: \"Generate commit message from changes\",\n      parameters: z.object({\n        staged: z.boolean().default(true),\n      }),\n      execute: async (params) => {\n        const { staged } = params as { staged: boolean };\n        return this.generateMessage(staged);\n      },\n    });\n\n    this.registerTool({\n      name: \"commit\",\n      description: \"Create a commit\",\n      parameters: z.object({\n        message: z.string().optional(),\n        all: z.boolean().default(false),\n        push: z.boolean().default(false),\n        createPr: z.boolean().default(false),\n      }),\n      execute: async (params) => this.commit(params as CommitRequest),\n    });\n  }\n\n  // ============================================================================\n  // ACTION HANDLERS\n  // ============================================================================\n\n  private async handleStatus(): Promise<AgentResult> {\n    const status = await this.getStatus();\n    const risk = status.isClean ? null : await this.assessRisk(!status.isClean);\n\n    return this.createResult(\n      true,\n      { status, risk },\n      undefined,\n      1,\n      `Branch: ${status.branch}, Clean: ${status.isClean}`\n    );\n  }\n\n  private async handleGenerate(staged = true): Promise<AgentResult> {\n    const message = await this.generateMessage(staged);\n    return this.createResult(\n      true,\n      message,\n      undefined,\n      message.confidence,\n      message.reasoning\n    );\n  }\n\n  private async handleCommit(params: CommitRequest): Promise<AgentResult> {\n    const result = await this.commit(params);\n    return this.createResult(\n      result.success,\n      result,\n      result.error,\n      result.message?.confidence,\n      result.message?.reasoning\n    );\n  }\n\n  private async handlePush(params: PushOptions): Promise<AgentResult> {\n    const result = await this.push(params);\n    return this.createResult(\n      result.success,\n      result,\n      result.error,\n      1,\n      `Pushed to ${result.remote}/${result.branch}`\n    );\n  }\n\n  private async handleCreatePR(params: PROptions): Promise<AgentResult> {\n    const result = await this.createPR(params);\n    return this.createResult(\n      result.success,\n      result,\n      result.error,\n      1,\n      result.url ? `PR created: ${result.url}` : \"PR creation failed\"\n    );\n  }\n\n  private async handleFullWorkflow(params: CommitRequest): Promise<AgentResult> {\n    // Full workflow: stage all â†’ generate message â†’ commit â†’ push â†’ create PR\n    const fullParams: CommitRequest = {\n      ...params,\n      all: params.all ?? true,\n      push: params.push ?? true,\n      createPr: params.createPr ?? false,\n    };\n\n    const result = await this.commit(fullParams);\n    return this.createResult(\n      result.success,\n      result,\n      result.error,\n      result.message?.confidence,\n      result.message?.reasoning\n    );\n  }\n}\n","/**\n * Git Operations\n *\n * Executes git commands safely with structured output\n */\n\nimport { exec } from \"child_process\";\nimport { promisify } from \"util\";\nimport type { GitStatus, FileChange, FileChangeType } from \"../core/types.js\";\n\nconst execAsync = promisify(exec);\n\nexport interface GitExecOptions {\n  cwd?: string;\n  timeout?: number;\n}\n\nexport class GitOperations {\n  private cwd: string;\n  private timeout: number;\n\n  constructor(options: GitExecOptions = {}) {\n    this.cwd = options.cwd ?? process.cwd();\n    this.timeout = options.timeout ?? 30000;\n  }\n\n  /**\n   * Execute a git command\n   */\n  async exec(args: string[]): Promise<string> {\n    const command = `git ${args.join(\" \")}`;\n    try {\n      const { stdout } = await execAsync(command, {\n        cwd: this.cwd,\n        timeout: this.timeout,\n        maxBuffer: 10 * 1024 * 1024, // 10MB buffer for large diffs\n      });\n      return stdout.trim();\n    } catch (error) {\n      const err = error as { stderr?: string; message: string };\n      throw new Error(err.stderr || err.message);\n    }\n  }\n\n  /**\n   * Get current branch name\n   */\n  async getCurrentBranch(): Promise<string> {\n    return this.exec([\"rev-parse\", \"--abbrev-ref\", \"HEAD\"]);\n  }\n\n  /**\n   * Check if working directory is clean\n   */\n  async isClean(): Promise<boolean> {\n    const output = await this.exec([\"status\", \"--porcelain\"]);\n    return output.length === 0;\n  }\n\n  /**\n   * Get comprehensive git status\n   */\n  async getStatus(): Promise<GitStatus> {\n    const [branch, porcelain, remote] = await Promise.all([\n      this.getCurrentBranch(),\n      this.exec([\"status\", \"--porcelain=v2\", \"--branch\"]),\n      this.exec([\"remote\"]).catch(() => \"\"),\n    ]);\n\n    const lines = porcelain.split(\"\\n\").filter(Boolean);\n    const staged: FileChange[] = [];\n    const unstaged: FileChange[] = [];\n    const untracked: string[] = [];\n    let ahead = 0;\n    let behind = 0;\n\n    for (const line of lines) {\n      // Branch info\n      if (line.startsWith(\"# branch.ab\")) {\n        const match = line.match(/\\+(\\d+) -(\\d+)/);\n        if (match) {\n          ahead = parseInt(match[1], 10);\n          behind = parseInt(match[2], 10);\n        }\n        continue;\n      }\n\n      // Skip other branch lines\n      if (line.startsWith(\"#\")) continue;\n\n      // Untracked files\n      if (line.startsWith(\"?\")) {\n        untracked.push(line.substring(2));\n        continue;\n      }\n\n      // Changed files (format: XY path)\n      if (line.startsWith(\"1\") || line.startsWith(\"2\")) {\n        const parts = line.split(\"\\t\");\n        const statusPart = parts[0].split(\" \");\n        const xy = statusPart[1] || \"\";\n        const path = parts[parts.length - 1];\n\n        const indexStatus = xy[0];\n        const workStatus = xy[1];\n\n        // Staged changes\n        if (indexStatus !== \".\" && indexStatus !== \"?\") {\n          staged.push({\n            path,\n            type: this.parseStatusChar(indexStatus),\n            linesAdded: 0,\n            linesRemoved: 0,\n            binary: false,\n          });\n        }\n\n        // Unstaged changes\n        if (workStatus !== \".\" && workStatus !== \"?\") {\n          unstaged.push({\n            path,\n            type: this.parseStatusChar(workStatus),\n            linesAdded: 0,\n            linesRemoved: 0,\n            binary: false,\n          });\n        }\n      }\n    }\n\n    return {\n      branch,\n      ahead,\n      behind,\n      staged,\n      unstaged,\n      untracked,\n      isClean: staged.length === 0 && unstaged.length === 0 && untracked.length === 0,\n      hasRemote: remote.length > 0,\n    };\n  }\n\n  /**\n   * Get staged files\n   */\n  async getStagedFiles(): Promise<string[]> {\n    const output = await this.exec([\"diff\", \"--cached\", \"--name-only\"]);\n    return output ? output.split(\"\\n\").filter(Boolean) : [];\n  }\n\n  /**\n   * Get diff (staged or all)\n   */\n  async getDiff(staged = true): Promise<string> {\n    const args = [\"diff\"];\n    if (staged) args.push(\"--cached\");\n    args.push(\"--no-color\");\n    return this.exec(args);\n  }\n\n  /**\n   * Get diff with statistics\n   */\n  async getDiffStat(staged = true): Promise<string> {\n    const args = [\"diff\", \"--stat\"];\n    if (staged) args.push(\"--cached\");\n    return this.exec(args);\n  }\n\n  /**\n   * Stage files\n   */\n  async stage(files: string[]): Promise<void> {\n    if (files.length === 0) return;\n    await this.exec([\"add\", \"--\", ...files]);\n  }\n\n  /**\n   * Stage all changes\n   */\n  async stageAll(): Promise<void> {\n    await this.exec([\"add\", \"-A\"]);\n  }\n\n  /**\n   * Unstage files\n   */\n  async unstage(files: string[]): Promise<void> {\n    if (files.length === 0) return;\n    await this.exec([\"reset\", \"HEAD\", \"--\", ...files]);\n  }\n\n  /**\n   * Create a commit\n   */\n  async commit(message: string, options: { amend?: boolean } = {}): Promise<string> {\n    const args = [\"commit\", \"-m\", message];\n    if (options.amend) args.push(\"--amend\");\n\n    await this.exec(args);\n    return this.getLastCommitHash();\n  }\n\n  /**\n   * Get the last commit hash\n   */\n  async getLastCommitHash(): Promise<string> {\n    return this.exec([\"rev-parse\", \"HEAD\"]);\n  }\n\n  /**\n   * Get recent commit messages for style reference\n   */\n  async getRecentCommits(count = 5): Promise<string[]> {\n    const output = await this.exec([\n      \"log\",\n      `--format=%s`,\n      `-${count}`,\n    ]);\n    return output ? output.split(\"\\n\").filter(Boolean) : [];\n  }\n\n  /**\n   * Push to remote\n   */\n  async push(options: {\n    remote?: string;\n    branch?: string;\n    force?: boolean;\n    setUpstream?: boolean;\n  } = {}): Promise<{ remote: string; branch: string }> {\n    const remote = options.remote ?? \"origin\";\n    const branch = options.branch ?? await this.getCurrentBranch();\n\n    const args = [\"push\"];\n    if (options.force) args.push(\"--force\");\n    if (options.setUpstream) args.push(\"-u\");\n    args.push(remote, branch);\n\n    await this.exec(args);\n    return { remote, branch };\n  }\n\n  /**\n   * Check if remote branch exists\n   */\n  async remoteBranchExists(remote: string, branch: string): Promise<boolean> {\n    try {\n      await this.exec([\"ls-remote\", \"--exit-code\", remote, `refs/heads/${branch}`]);\n      return true;\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * Get remote URL\n   */\n  async getRemoteUrl(remote = \"origin\"): Promise<string> {\n    return this.exec([\"remote\", \"get-url\", remote]);\n  }\n\n  /**\n   * Parse status character to FileChangeType\n   */\n  private parseStatusChar(char: string): FileChangeType {\n    switch (char.toUpperCase()) {\n      case \"A\":\n        return \"added\";\n      case \"M\":\n        return \"modified\";\n      case \"D\":\n        return \"deleted\";\n      case \"R\":\n        return \"renamed\";\n      case \"C\":\n        return \"copied\";\n      default:\n        return \"modified\";\n    }\n  }\n}\n","/**\n * Constants for Commit Agent\n *\n * Risk weights, thresholds, and conventional commit mappings\n */\n\n// ============================================================================\n// RISK WEIGHTS\n// ============================================================================\n\nexport const RISK_WEIGHTS = {\n  linesChanged: 0.3, // 30% weight\n  filesChanged: 0.2, // 20% weight\n  criticalPaths: 0.25, // 25% weight\n  breakingChange: 0.2, // 20% weight\n  forcePush: 0.05, // 5% weight (always escalate if present)\n} as const;\n\n// ============================================================================\n// RISK THRESHOLDS\n// ============================================================================\n\nexport const RISK_THRESHOLDS = {\n  // Lines changed\n  linesLow: 50, // <50 lines = safe\n  linesMedium: 150, // 50-150 = low risk\n  linesHigh: 300, // 150-300 = medium risk\n  linesCritical: 500, // >500 = high risk\n\n  // Files changed\n  filesLow: 3, // <3 files = safe\n  filesMedium: 7, // 3-7 = low risk\n  filesHigh: 15, // 7-15 = medium risk\n  filesCritical: 25, // >25 = high risk\n\n  // Decision score thresholds\n  autoExecuteMax: 40, // 0-40 = auto execute\n  queueApprovalMax: 60, // 41-60 = queue approval\n  escalateMax: 80, // 61-80 = escalate\n  // >80 = reject (or escalate with urgency)\n} as const;\n\n// ============================================================================\n// CONVENTIONAL COMMIT TYPE DESCRIPTIONS\n// ============================================================================\n\nexport const COMMIT_TYPE_DESCRIPTIONS: Record<string, string> = {\n  feat: \"A new feature for the user\",\n  fix: \"A bug fix\",\n  docs: \"Documentation only changes\",\n  style: \"Changes that do not affect the meaning of the code (formatting, semicolons)\",\n  refactor: \"A code change that neither fixes a bug nor adds a feature\",\n  perf: \"A code change that improves performance\",\n  test: \"Adding missing tests or correcting existing tests\",\n  build: \"Changes that affect the build system or external dependencies\",\n  ci: \"Changes to CI configuration files and scripts\",\n  chore: \"Other changes that don't modify src or test files\",\n  revert: \"Reverts a previous commit\",\n} as const;\n\n// ============================================================================\n// FILE PATTERNS FOR RISK DETECTION\n// ============================================================================\n\nexport const CRITICAL_PATH_PATTERNS = [\n  // Core infrastructure\n  /^src\\/core\\//,\n  /^packages\\/agent-core\\//,\n  /^packages\\/autonomy\\//,\n\n  // Configuration\n  /\\.env/,\n  /^\\.github\\/workflows\\//,\n  /package\\.json$/,\n  /pnpm-workspace\\.yaml$/,\n  /tsconfig\\.json$/,\n\n  // Security-sensitive\n  /secret/i,\n  /credential/i,\n  /password/i,\n  /api[_-]?key/i,\n  /private[_-]?key/i,\n\n  // Database\n  /migration/i,\n  /schema\\.(sql|prisma|ts)$/,\n] as const;\n\nexport const BREAKING_CHANGE_INDICATORS = [\n  /^feat!/,\n  /^fix!/,\n  /BREAKING CHANGE:/i,\n  /\\bremove\\b.*\\bapi\\b/i,\n  /\\bdelete\\b.*\\bendpoint\\b/i,\n  /\\bdeprecate\\b/i,\n] as const;\n\n// ============================================================================\n// DEFAULT MESSAGES\n// ============================================================================\n\nexport const DEFAULT_CO_AUTHOR = \"Claude <noreply@anthropic.com>\";\n\nexport const COMMIT_FOOTER_TEMPLATE = `\nðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: ${DEFAULT_CO_AUTHOR}\n`.trim();\n","/**\n * Diff Analyzer\n *\n * Parses git diffs and extracts meaningful information for LLM context\n */\n\nimport type { DiffSummary, FileChange, FileChangeType, CommitRiskAssessment, CommitRiskFactor } from \"../core/types.js\";\nimport { RISK_WEIGHTS, RISK_THRESHOLDS, CRITICAL_PATH_PATTERNS, BREAKING_CHANGE_INDICATORS } from \"../core/constants.js\";\n\nexport interface DiffParseOptions {\n  includeContent?: boolean;\n  maxContentLength?: number;\n}\n\nexport class DiffAnalyzer {\n  /**\n   * Parse raw diff output into structured format\n   */\n  parseDiff(rawDiff: string, staged = true, options: DiffParseOptions = {}): DiffSummary {\n    const files = this.parseFileChanges(rawDiff);\n    const totalLinesAdded = files.reduce((sum, f) => sum + f.linesAdded, 0);\n    const totalLinesRemoved = files.reduce((sum, f) => sum + f.linesRemoved, 0);\n\n    let diffContent = rawDiff;\n    if (options.maxContentLength && diffContent.length > options.maxContentLength) {\n      diffContent = diffContent.substring(0, options.maxContentLength) + \"\\n... (truncated)\";\n    }\n\n    return {\n      files,\n      totalLinesAdded,\n      totalLinesRemoved,\n      totalFilesChanged: files.length,\n      diffContent: options.includeContent !== false ? diffContent : \"\",\n      staged,\n    };\n  }\n\n  /**\n   * Parse diff output to extract file changes\n   */\n  parseFileChanges(rawDiff: string): FileChange[] {\n    const files: FileChange[] = [];\n    const lines = rawDiff.split(\"\\n\");\n\n    let currentFile: Partial<FileChange> | null = null;\n    let linesAdded = 0;\n    let linesRemoved = 0;\n\n    for (const line of lines) {\n      // New file diff header\n      if (line.startsWith(\"diff --git\")) {\n        // Save previous file\n        if (currentFile?.path) {\n          files.push({\n            path: currentFile.path,\n            type: currentFile.type ?? \"modified\",\n            linesAdded,\n            linesRemoved,\n            binary: currentFile.binary ?? false,\n            oldPath: currentFile.oldPath,\n          });\n        }\n\n        // Parse file path from \"diff --git a/path b/path\"\n        const match = line.match(/diff --git a\\/(.+) b\\/(.+)/);\n        if (match) {\n          currentFile = {\n            path: match[2],\n            type: \"modified\",\n            binary: false,\n          };\n          if (match[1] !== match[2]) {\n            currentFile.oldPath = match[1];\n            currentFile.type = \"renamed\";\n          }\n        }\n        linesAdded = 0;\n        linesRemoved = 0;\n        continue;\n      }\n\n      // Detect new file\n      if (line.startsWith(\"new file mode\")) {\n        if (currentFile) currentFile.type = \"added\";\n        continue;\n      }\n\n      // Detect deleted file\n      if (line.startsWith(\"deleted file mode\")) {\n        if (currentFile) currentFile.type = \"deleted\";\n        continue;\n      }\n\n      // Detect binary file\n      if (line.includes(\"Binary files\") || line.includes(\"GIT binary patch\")) {\n        if (currentFile) currentFile.binary = true;\n        continue;\n      }\n\n      // Count added lines\n      if (line.startsWith(\"+\") && !line.startsWith(\"+++\")) {\n        linesAdded++;\n        continue;\n      }\n\n      // Count removed lines\n      if (line.startsWith(\"-\") && !line.startsWith(\"---\")) {\n        linesRemoved++;\n        continue;\n      }\n    }\n\n    // Save last file\n    if (currentFile?.path) {\n      files.push({\n        path: currentFile.path,\n        type: currentFile.type ?? \"modified\",\n        linesAdded,\n        linesRemoved,\n        binary: currentFile.binary ?? false,\n        oldPath: currentFile.oldPath,\n      });\n    }\n\n    return files;\n  }\n\n  /**\n   * Assess risk factors for a diff\n   */\n  assessRisk(diff: DiffSummary, criticalPaths: string[] = []): CommitRiskAssessment {\n    const factors: CommitRiskFactor[] = [];\n    const touchedCriticalPaths: string[] = [];\n\n    // Calculate lines changed score\n    const totalLines = diff.totalLinesAdded + diff.totalLinesRemoved;\n    const linesScore = this.calculateLinesScore(totalLines);\n    factors.push({\n      name: \"lines_changed\",\n      score: linesScore,\n      weight: RISK_WEIGHTS.linesChanged,\n      reason: `${totalLines} lines changed (+${diff.totalLinesAdded}/-${diff.totalLinesRemoved})`,\n    });\n\n    // Calculate files changed score\n    const filesScore = this.calculateFilesScore(diff.totalFilesChanged);\n    factors.push({\n      name: \"files_changed\",\n      score: filesScore,\n      weight: RISK_WEIGHTS.filesChanged,\n      reason: `${diff.totalFilesChanged} files changed`,\n    });\n\n    // Check for critical paths\n    const allCriticalPatterns = [\n      ...CRITICAL_PATH_PATTERNS,\n      ...criticalPaths.map((p) => new RegExp(p.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\"))),\n    ];\n\n    for (const file of diff.files) {\n      for (const pattern of allCriticalPatterns) {\n        if (pattern.test(file.path)) {\n          touchedCriticalPaths.push(file.path);\n          break;\n        }\n      }\n    }\n\n    const criticalPathsScore = touchedCriticalPaths.length > 0 ? 100 : 0;\n    factors.push({\n      name: \"critical_paths\",\n      score: criticalPathsScore,\n      weight: RISK_WEIGHTS.criticalPaths,\n      reason:\n        touchedCriticalPaths.length > 0\n          ? `Touches critical paths: ${touchedCriticalPaths.slice(0, 3).join(\", \")}${touchedCriticalPaths.length > 3 ? \"...\" : \"\"}`\n          : \"No critical paths affected\",\n    });\n\n    // Check for breaking changes\n    const isBreaking = this.detectBreakingChange(diff.diffContent);\n    const breakingScore = isBreaking ? 100 : 0;\n    factors.push({\n      name: \"breaking_change\",\n      score: breakingScore,\n      weight: RISK_WEIGHTS.breakingChange,\n      reason: isBreaking ? \"Contains breaking change indicators\" : \"No breaking changes detected\",\n    });\n\n    // Calculate total weighted score\n    const totalScore = Math.min(\n      100,\n      factors.reduce((sum, f) => sum + f.score * f.weight, 0)\n    );\n\n    // Determine recommendation\n    let recommendation: \"auto_execute\" | \"queue_approval\" | \"escalate\" | \"reject\";\n    if (totalScore <= RISK_THRESHOLDS.autoExecuteMax) {\n      recommendation = \"auto_execute\";\n    } else if (totalScore <= RISK_THRESHOLDS.queueApprovalMax) {\n      recommendation = \"queue_approval\";\n    } else if (totalScore <= RISK_THRESHOLDS.escalateMax) {\n      recommendation = \"escalate\";\n    } else {\n      recommendation = \"reject\";\n    }\n\n    return {\n      totalScore: Math.round(totalScore),\n      factors,\n      recommendation,\n      criticalPaths: touchedCriticalPaths,\n      isBreakingChange: isBreaking,\n    };\n  }\n\n  /**\n   * Create a summary for LLM context\n   */\n  createLLMContext(diff: DiffSummary, maxLength = 8000): string {\n    const sections: string[] = [];\n\n    // Summary section\n    sections.push(`## Summary\n- Files changed: ${diff.totalFilesChanged}\n- Lines added: ${diff.totalLinesAdded}\n- Lines removed: ${diff.totalLinesRemoved}\n`);\n\n    // File list\n    const fileList = diff.files\n      .map((f) => {\n        const indicator =\n          f.type === \"added\"\n            ? \"+\"\n            : f.type === \"deleted\"\n              ? \"-\"\n              : f.type === \"renamed\"\n                ? \"â†’\"\n                : \"M\";\n        return `  ${indicator} ${f.path} (+${f.linesAdded}/-${f.linesRemoved})`;\n      })\n      .join(\"\\n\");\n    sections.push(`## Files\\n${fileList}`);\n\n    // Diff content (truncated if needed)\n    let diffContent = diff.diffContent;\n    const headerLength = sections.join(\"\\n\\n\").length;\n    const availableLength = maxLength - headerLength - 100;\n\n    if (diffContent.length > availableLength) {\n      diffContent = diffContent.substring(0, availableLength) + \"\\n... (truncated)\";\n    }\n\n    sections.push(`## Diff\\n\\`\\`\\`diff\\n${diffContent}\\n\\`\\`\\``);\n\n    return sections.join(\"\\n\\n\");\n  }\n\n  /**\n   * Calculate risk score based on lines changed\n   */\n  private calculateLinesScore(lines: number): number {\n    if (lines <= RISK_THRESHOLDS.linesLow) return 0;\n    if (lines <= RISK_THRESHOLDS.linesMedium) return 25;\n    if (lines <= RISK_THRESHOLDS.linesHigh) return 50;\n    if (lines <= RISK_THRESHOLDS.linesCritical) return 75;\n    return 100;\n  }\n\n  /**\n   * Calculate risk score based on files changed\n   */\n  private calculateFilesScore(files: number): number {\n    if (files <= RISK_THRESHOLDS.filesLow) return 0;\n    if (files <= RISK_THRESHOLDS.filesMedium) return 25;\n    if (files <= RISK_THRESHOLDS.filesHigh) return 50;\n    if (files <= RISK_THRESHOLDS.filesCritical) return 75;\n    return 100;\n  }\n\n  /**\n   * Detect breaking change indicators in diff\n   */\n  private detectBreakingChange(diffContent: string): boolean {\n    for (const pattern of BREAKING_CHANGE_INDICATORS) {\n      if (pattern.test(diffContent)) return true;\n    }\n    return false;\n  }\n}\n","/**\n * Message Generator\n *\n * AI-powered commit message generation using LLM\n */\n\nimport type { LLMClient } from \"@gicm/agent-core\";\nimport { createLLMClient } from \"@gicm/agent-core\";\nimport type { DiffSummary, GeneratedMessage, CommitMessage, ConventionalType, CommitAgentConfig } from \"../core/types.js\";\nimport { COMMIT_FOOTER_TEMPLATE, COMMIT_TYPE_DESCRIPTIONS } from \"../core/constants.js\";\nimport { COMMIT_MESSAGE_SYSTEM_PROMPT, COMMIT_MESSAGE_USER_PROMPT, PR_BODY_SYSTEM_PROMPT, PR_BODY_USER_PROMPT } from \"./prompts.js\";\nimport { DiffAnalyzer } from \"../git/diff-analyzer.js\";\n\nexport interface GeneratorConfig {\n  llmProvider?: \"openai\" | \"anthropic\" | \"gemini\";\n  llmModel?: string;\n  apiKey?: string;\n  temperature?: number;\n  maxTokens?: number;\n  includeCoAuthor?: boolean;\n  coAuthorName?: string;\n  coAuthorEmail?: string;\n}\n\nexport class MessageGenerator {\n  private llmClient: LLMClient | null = null;\n  private diffAnalyzer: DiffAnalyzer;\n  private config: GeneratorConfig;\n\n  constructor(config: GeneratorConfig = {}) {\n    this.config = {\n      llmProvider: \"anthropic\",\n      temperature: 0.3,\n      maxTokens: 2048,\n      includeCoAuthor: true,\n      coAuthorName: \"Claude\",\n      coAuthorEmail: \"noreply@anthropic.com\",\n      ...config,\n    };\n\n    this.diffAnalyzer = new DiffAnalyzer();\n\n    // Initialize LLM client if API key provided\n    if (this.config.apiKey) {\n      this.llmClient = createLLMClient({\n        provider: this.config.llmProvider!,\n        model: this.config.llmModel,\n        apiKey: this.config.apiKey,\n        temperature: this.config.temperature!,\n        maxTokens: this.config.maxTokens!,\n      });\n    }\n  }\n\n  /**\n   * Generate a commit message from diff\n   */\n  async generate(diff: DiffSummary): Promise<GeneratedMessage> {\n    // If no LLM client, use fallback heuristics\n    if (!this.llmClient) {\n      return this.generateFallback(diff);\n    }\n\n    try {\n      const context = this.diffAnalyzer.createLLMContext(diff);\n      const prompt = COMMIT_MESSAGE_USER_PROMPT(context);\n\n      const response = await this.llmClient.chat([\n        { role: \"system\", content: COMMIT_MESSAGE_SYSTEM_PROMPT },\n        { role: \"user\", content: prompt },\n      ]);\n\n      const parsed = this.parseJSON<{\n        type: ConventionalType;\n        scope: string | null;\n        subject: string;\n        body: string | null;\n        breaking: boolean;\n        reasoning: string;\n      }>(response.content);\n\n      if (!parsed) {\n        return this.generateFallback(diff);\n      }\n\n      const message: CommitMessage = {\n        type: parsed.type,\n        scope: parsed.scope ?? undefined,\n        subject: parsed.subject,\n        body: parsed.body ?? undefined,\n        breaking: parsed.breaking ?? false,\n        coAuthors: this.config.includeCoAuthor\n          ? [`${this.config.coAuthorName} <${this.config.coAuthorEmail}>`]\n          : [],\n      };\n\n      return {\n        message,\n        fullText: this.formatMessage(message),\n        confidence: 0.9,\n        reasoning: parsed.reasoning,\n      };\n    } catch (error) {\n      console.error(\"LLM generation failed, using fallback:\", error);\n      return this.generateFallback(diff);\n    }\n  }\n\n  /**\n   * Generate PR body from commits and diff\n   */\n  async generatePRBody(\n    commits: string[],\n    diff: DiffSummary\n  ): Promise<{ title: string; body: string; labels: string[] }> {\n    const diffSummary = `${diff.totalFilesChanged} files, +${diff.totalLinesAdded}/-${diff.totalLinesRemoved} lines`;\n\n    if (!this.llmClient) {\n      // Fallback PR body\n      return {\n        title: commits[0] || \"Update\",\n        body: this.generateFallbackPRBody(commits, diff),\n        labels: [],\n      };\n    }\n\n    try {\n      const prompt = PR_BODY_USER_PROMPT(commits, diffSummary);\n\n      const response = await this.llmClient.chat([\n        { role: \"system\", content: PR_BODY_SYSTEM_PROMPT },\n        { role: \"user\", content: prompt },\n      ]);\n\n      const parsed = this.parseJSON<{\n        title: string;\n        body: string;\n        labels: string[];\n      }>(response.content);\n\n      if (!parsed) {\n        return {\n          title: commits[0] || \"Update\",\n          body: this.generateFallbackPRBody(commits, diff),\n          labels: [],\n        };\n      }\n\n      return parsed;\n    } catch (error) {\n      console.error(\"PR body generation failed:\", error);\n      return {\n        title: commits[0] || \"Update\",\n        body: this.generateFallbackPRBody(commits, diff),\n        labels: [],\n      };\n    }\n  }\n\n  /**\n   * Format a CommitMessage to full text\n   */\n  formatMessage(message: CommitMessage): string {\n    const parts: string[] = [];\n\n    // Header: type(scope)!: subject\n    let header = message.type;\n    if (message.scope) header += `(${message.scope})`;\n    if (message.breaking) header += \"!\";\n    header += `: ${message.subject}`;\n    parts.push(header);\n\n    // Body\n    if (message.body) {\n      parts.push(\"\"); // Empty line\n      parts.push(message.body);\n    }\n\n    // Footer with co-authors\n    parts.push(\"\"); // Empty line\n    parts.push(COMMIT_FOOTER_TEMPLATE);\n\n    return parts.join(\"\\n\");\n  }\n\n  /**\n   * Validate a commit message\n   */\n  validateMessage(message: CommitMessage): { valid: boolean; errors: string[] } {\n    const errors: string[] = [];\n\n    if (!message.type) {\n      errors.push(\"Missing commit type\");\n    }\n\n    if (!message.subject) {\n      errors.push(\"Missing commit subject\");\n    } else {\n      if (message.subject.length > 72) {\n        errors.push(`Subject too long (${message.subject.length}/72 chars)`);\n      }\n      if (message.subject.endsWith(\".\")) {\n        errors.push(\"Subject should not end with a period\");\n      }\n      if (!/^[a-z]/.test(message.subject)) {\n        errors.push(\"Subject should start with lowercase\");\n      }\n    }\n\n    return { valid: errors.length === 0, errors };\n  }\n\n  /**\n   * Generate fallback commit message without LLM\n   */\n  private generateFallback(diff: DiffSummary): GeneratedMessage {\n    // Determine type based on files\n    let type: ConventionalType = \"chore\";\n    let scope: string | undefined;\n\n    const paths = diff.files.map((f) => f.path);\n\n    // Detect type from file patterns\n    if (paths.some((p) => p.includes(\"test\") || p.includes(\"spec\"))) {\n      type = \"test\";\n    } else if (paths.some((p) => p.endsWith(\".md\") || p.includes(\"docs/\"))) {\n      type = \"docs\";\n    } else if (paths.some((p) => p.includes(\".github/\") || p.includes(\"ci\"))) {\n      type = \"ci\";\n    } else if (paths.some((p) => p.includes(\"package.json\") || p.includes(\"deps\"))) {\n      type = \"build\";\n    } else if (diff.files.some((f) => f.type === \"added\")) {\n      type = \"feat\";\n    } else {\n      type = \"chore\";\n    }\n\n    // Detect scope from common path prefix\n    const commonPrefix = this.findCommonPrefix(paths);\n    if (commonPrefix) {\n      scope = commonPrefix.split(\"/\")[0];\n      if (scope === \"src\" || scope === \"packages\") {\n        scope = commonPrefix.split(\"/\")[1] || undefined;\n      }\n    }\n\n    // Generate subject\n    const action =\n      diff.files[0]?.type === \"added\"\n        ? \"add\"\n        : diff.files[0]?.type === \"deleted\"\n          ? \"remove\"\n          : \"update\";\n    const target =\n      diff.files.length === 1\n        ? diff.files[0].path.split(\"/\").pop()\n        : `${diff.files.length} files`;\n    const subject = `${action} ${target}`;\n\n    const message: CommitMessage = {\n      type,\n      scope,\n      subject: subject.substring(0, 72),\n      breaking: false,\n      coAuthors: this.config.includeCoAuthor\n        ? [`${this.config.coAuthorName} <${this.config.coAuthorEmail}>`]\n        : [],\n    };\n\n    return {\n      message,\n      fullText: this.formatMessage(message),\n      confidence: 0.5,\n      reasoning: \"Generated using file pattern heuristics (no LLM available)\",\n    };\n  }\n\n  /**\n   * Generate fallback PR body\n   */\n  private generateFallbackPRBody(commits: string[], diff: DiffSummary): string {\n    return `## Summary\nThis PR includes ${commits.length} commit(s) affecting ${diff.totalFilesChanged} files.\n\n## Changes\n${diff.files.map((f) => `- ${f.type}: \\`${f.path}\\` (+${f.linesAdded}/-${f.linesRemoved})`).join(\"\\n\")}\n\n## Commits\n${commits.map((c) => `- ${c}`).join(\"\\n\")}\n\n---\nðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)\n`;\n  }\n\n  /**\n   * Find common path prefix\n   */\n  private findCommonPrefix(paths: string[]): string {\n    if (paths.length === 0) return \"\";\n    if (paths.length === 1) return paths[0].substring(0, paths[0].lastIndexOf(\"/\"));\n\n    const sorted = paths.slice().sort();\n    const first = sorted[0].split(\"/\");\n    const last = sorted[sorted.length - 1].split(\"/\");\n\n    const common: string[] = [];\n    for (let i = 0; i < Math.min(first.length, last.length); i++) {\n      if (first[i] === last[i]) {\n        common.push(first[i]);\n      } else {\n        break;\n      }\n    }\n\n    return common.join(\"/\");\n  }\n\n  /**\n   * Parse JSON from LLM response\n   */\n  private parseJSON<T>(text: string): T | null {\n    try {\n      // Try to extract JSON from markdown code block\n      const jsonMatch = text.match(/```(?:json)?\\s*([\\s\\S]*?)```/);\n      if (jsonMatch) {\n        return JSON.parse(jsonMatch[1].trim());\n      }\n\n      // Try direct parse\n      const start = text.indexOf(\"{\");\n      const end = text.lastIndexOf(\"}\");\n      if (start !== -1 && end !== -1) {\n        return JSON.parse(text.substring(start, end + 1));\n      }\n\n      return null;\n    } catch {\n      return null;\n    }\n  }\n}\n","/**\n * LLM Prompts for Commit Message Generation\n */\n\nexport const COMMIT_MESSAGE_SYSTEM_PROMPT = `You are an expert at writing clear, concise git commit messages following the Conventional Commits specification.\n\nYour task is to analyze code changes and generate appropriate commit messages.\n\n## Conventional Commit Format\n\\`\\`\\`\n<type>[optional scope]: <description>\n\n[optional body]\n\n[optional footer(s)]\n\\`\\`\\`\n\n## Commit Types\n- feat: A new feature for the user\n- fix: A bug fix\n- docs: Documentation only changes\n- style: Changes that do not affect the meaning of the code (formatting)\n- refactor: A code change that neither fixes a bug nor adds a feature\n- perf: A code change that improves performance\n- test: Adding missing tests or correcting existing tests\n- build: Changes that affect the build system or dependencies\n- ci: Changes to CI configuration files and scripts\n- chore: Other changes that don't modify src or test files\n- revert: Reverts a previous commit\n\n## Rules\n1. The description MUST be in imperative mood (\"add\" not \"added\", \"fix\" not \"fixed\")\n2. The description MUST NOT exceed 72 characters\n3. The description MUST NOT end with a period\n4. Use lowercase for the description (except proper nouns)\n5. The body should explain WHAT and WHY, not HOW\n6. Use \"!\" after the type/scope for breaking changes\n\n## Scope Guidelines\n- Use the package name for monorepo changes (e.g., \"commit-agent\", \"cli\")\n- Use the feature area for app changes (e.g., \"auth\", \"api\")\n- Omit scope if the change is global or unclear\n\n## Examples\n- feat(auth): add OAuth2 login support\n- fix(api): handle null response from user endpoint\n- docs: update installation instructions\n- refactor(core): simplify error handling logic\n- feat!: remove deprecated getUserById function\n\nRespond with a JSON object containing your analysis.`;\n\nexport const COMMIT_MESSAGE_USER_PROMPT = (diffContext: string) => `Analyze the following code changes and generate an appropriate commit message.\n\n${diffContext}\n\nRespond with a JSON object in this exact format:\n{\n  \"type\": \"feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert\",\n  \"scope\": \"optional scope or null\",\n  \"subject\": \"imperative description under 72 chars\",\n  \"body\": \"optional longer description or null\",\n  \"breaking\": false,\n  \"reasoning\": \"brief explanation of why you chose this type and description\"\n}`;\n\nexport const PR_BODY_SYSTEM_PROMPT = `You are an expert at writing clear, informative pull request descriptions.\n\nYour task is to analyze code changes and generate a comprehensive PR description.\n\n## PR Description Format\n\\`\\`\\`markdown\n## Summary\nBrief overview of what this PR does (1-3 sentences)\n\n## Changes\n- Bulleted list of specific changes\n- Group related changes together\n- Focus on WHAT changed, not HOW\n\n## Testing\n- How to test these changes\n- Any specific test commands\n- Edge cases to consider\n\n## Notes\n- Any additional context\n- Related issues or PRs\n- Breaking changes or migration steps\n\\`\\`\\`\n\n## Guidelines\n1. Be concise but comprehensive\n2. Focus on the user impact\n3. Highlight any breaking changes prominently\n4. Include testing instructions\n5. Reference related issues/PRs if mentioned in commits`;\n\nexport const PR_BODY_USER_PROMPT = (commits: string[], diffSummary: string) => `Generate a pull request description for the following changes.\n\n## Commits\n${commits.map((c) => `- ${c}`).join(\"\\n\")}\n\n## Changes Summary\n${diffSummary}\n\nRespond with a JSON object in this exact format:\n{\n  \"title\": \"PR title (similar to main commit message)\",\n  \"body\": \"Full markdown PR body following the template\",\n  \"labels\": [\"optional\", \"suggested\", \"labels\"]\n}`;\n","/**\n * PR Creator\n *\n * Creates pull requests via GitHub CLI (gh)\n */\n\nimport { exec } from \"child_process\";\nimport { promisify } from \"util\";\nimport type { PROptions, PRResult, DiffSummary } from \"../core/types.js\";\nimport { MessageGenerator } from \"../message/generator.js\";\n\nconst execAsync = promisify(exec);\n\nexport interface PRCreatorConfig {\n  cwd?: string;\n  timeout?: number;\n  apiKey?: string;\n}\n\nexport class PRCreator {\n  private cwd: string;\n  private timeout: number;\n  private messageGenerator: MessageGenerator;\n\n  constructor(config: PRCreatorConfig = {}) {\n    this.cwd = config.cwd ?? process.cwd();\n    this.timeout = config.timeout ?? 60000;\n    this.messageGenerator = new MessageGenerator({ apiKey: config.apiKey });\n  }\n\n  /**\n   * Create a pull request using gh CLI\n   */\n  async create(options: Partial<PROptions> = {}): Promise<PRResult> {\n    if (options.dryRun) {\n      return {\n        success: true,\n        title: options.title || \"PR Title\",\n        error: \"Dry run - PR not created\",\n      };\n    }\n\n    try {\n      // Check if gh CLI is available\n      await this.exec([\"gh\", \"--version\"]);\n\n      const args = [\"gh\", \"pr\", \"create\"];\n\n      if (options.title) {\n        args.push(\"--title\", options.title);\n      }\n\n      if (options.body) {\n        args.push(\"--body\", options.body);\n      }\n\n      if (options.base) {\n        args.push(\"--base\", options.base);\n      }\n\n      if (options.head) {\n        args.push(\"--head\", options.head);\n      }\n\n      if (options.draft) {\n        args.push(\"--draft\");\n      }\n\n      const output = await this.exec(args);\n\n      // Extract PR URL from output\n      const urlMatch = output.match(/https:\\/\\/github\\.com\\/[^\\s]+\\/pull\\/\\d+/);\n\n      return {\n        success: true,\n        url: urlMatch?.[0],\n        title: options.title,\n      };\n    } catch (error) {\n      const err = error as { stderr?: string; message: string };\n      return {\n        success: false,\n        error: err.stderr || err.message,\n      };\n    }\n  }\n\n  /**\n   * Generate PR title and body from commits and diff\n   */\n  async generatePR(\n    commits: string[],\n    diff: DiffSummary\n  ): Promise<{ title: string; body: string }> {\n    const result = await this.messageGenerator.generatePRBody(commits, diff);\n    return {\n      title: result.title,\n      body: result.body,\n    };\n  }\n\n  /**\n   * Check if there's an existing PR for the current branch\n   */\n  async existingPR(): Promise<{ exists: boolean; url?: string; number?: number }> {\n    try {\n      const output = await this.exec([\"gh\", \"pr\", \"view\", \"--json\", \"url,number\"]);\n      const data = JSON.parse(output);\n      return {\n        exists: true,\n        url: data.url,\n        number: data.number,\n      };\n    } catch {\n      return { exists: false };\n    }\n  }\n\n  /**\n   * Execute a command\n   */\n  private async exec(args: string[]): Promise<string> {\n    const command = args.join(\" \");\n    const { stdout } = await execAsync(command, {\n      cwd: this.cwd,\n      timeout: this.timeout,\n    });\n    return stdout.trim();\n  }\n}\n","/**\n * Core Types for Commit Agent\n *\n * Zod schemas + TypeScript types for git operations, commit messages, and results\n */\n\nimport { z } from \"zod\";\n\n// ============================================================================\n// FILE CHANGE TYPES\n// ============================================================================\n\nexport const FileChangeTypeSchema = z.enum([\n  \"added\",\n  \"modified\",\n  \"deleted\",\n  \"renamed\",\n  \"copied\",\n]);\nexport type FileChangeType = z.infer<typeof FileChangeTypeSchema>;\n\nexport const FileChangeSchema = z.object({\n  path: z.string(),\n  type: FileChangeTypeSchema,\n  linesAdded: z.number().default(0),\n  linesRemoved: z.number().default(0),\n  binary: z.boolean().default(false),\n  oldPath: z.string().optional(),\n});\nexport type FileChange = z.infer<typeof FileChangeSchema>;\n\nexport const DiffSummarySchema = z.object({\n  files: z.array(FileChangeSchema),\n  totalLinesAdded: z.number(),\n  totalLinesRemoved: z.number(),\n  totalFilesChanged: z.number(),\n  diffContent: z.string(),\n  staged: z.boolean(),\n});\nexport type DiffSummary = z.infer<typeof DiffSummarySchema>;\n\n// ============================================================================\n// GIT STATUS\n// ============================================================================\n\nexport const GitStatusSchema = z.object({\n  branch: z.string(),\n  ahead: z.number().default(0),\n  behind: z.number().default(0),\n  staged: z.array(FileChangeSchema),\n  unstaged: z.array(FileChangeSchema),\n  untracked: z.array(z.string()),\n  isClean: z.boolean(),\n  hasRemote: z.boolean(),\n});\nexport type GitStatus = z.infer<typeof GitStatusSchema>;\n\n// ============================================================================\n// CONVENTIONAL COMMIT TYPES\n// ============================================================================\n\nexport const ConventionalTypeSchema = z.enum([\n  \"feat\", // New feature\n  \"fix\", // Bug fix\n  \"docs\", // Documentation only\n  \"style\", // Code style (formatting, semicolons)\n  \"refactor\", // Code change that neither fixes nor adds\n  \"perf\", // Performance improvement\n  \"test\", // Adding or correcting tests\n  \"build\", // Build system or dependencies\n  \"ci\", // CI configuration\n  \"chore\", // Other changes (maintenance)\n  \"revert\", // Revert a previous commit\n]);\nexport type ConventionalType = z.infer<typeof ConventionalTypeSchema>;\n\nexport const CommitMessageSchema = z.object({\n  type: ConventionalTypeSchema,\n  scope: z.string().optional(),\n  subject: z.string().min(1).max(72),\n  body: z.string().optional(),\n  footer: z.string().optional(),\n  breaking: z.boolean().default(false),\n  coAuthors: z.array(z.string()).default([]),\n});\nexport type CommitMessage = z.infer<typeof CommitMessageSchema>;\n\nexport const GeneratedMessageSchema = z.object({\n  message: CommitMessageSchema,\n  fullText: z.string(),\n  confidence: z.number().min(0).max(1),\n  reasoning: z.string(),\n  alternatives: z.array(CommitMessageSchema).optional(),\n});\nexport type GeneratedMessage = z.infer<typeof GeneratedMessageSchema>;\n\n// ============================================================================\n// COMMIT REQUEST/RESULT\n// ============================================================================\n\nexport const CommitRequestSchema = z.object({\n  staged: z.boolean().default(true),\n  all: z.boolean().default(false),\n  files: z.array(z.string()).optional(),\n  message: z.string().optional(),\n  push: z.boolean().default(false),\n  createPr: z.boolean().default(false),\n  prTitle: z.string().optional(),\n  prBody: z.string().optional(),\n  prBase: z.string().default(\"main\"),\n  dryRun: z.boolean().default(false),\n  amend: z.boolean().default(false),\n});\nexport type CommitRequest = z.infer<typeof CommitRequestSchema>;\n\nexport const CommitResultSchema = z.object({\n  success: z.boolean(),\n  commitHash: z.string().optional(),\n  message: GeneratedMessageSchema.optional(),\n  diff: DiffSummarySchema.optional(),\n  pushed: z.boolean().default(false),\n  prUrl: z.string().optional(),\n  error: z.string().optional(),\n  riskScore: z.number().optional(),\n  approvalRequired: z.boolean().default(false),\n});\nexport type CommitResult = z.infer<typeof CommitResultSchema>;\n\n// ============================================================================\n// PUSH OPTIONS/RESULT\n// ============================================================================\n\nexport const PushOptionsSchema = z.object({\n  remote: z.string().default(\"origin\"),\n  branch: z.string().optional(),\n  force: z.boolean().default(false),\n  setUpstream: z.boolean().default(false),\n  dryRun: z.boolean().default(false),\n});\nexport type PushOptions = z.infer<typeof PushOptionsSchema>;\n\nexport const PushResultSchema = z.object({\n  success: z.boolean(),\n  remote: z.string(),\n  branch: z.string(),\n  commits: z.number(),\n  error: z.string().optional(),\n});\nexport type PushResult = z.infer<typeof PushResultSchema>;\n\n// ============================================================================\n// PR OPTIONS/RESULT\n// ============================================================================\n\nexport const PROptionsSchema = z.object({\n  title: z.string().optional(),\n  body: z.string().optional(),\n  base: z.string().default(\"main\"),\n  head: z.string().optional(),\n  draft: z.boolean().default(false),\n  dryRun: z.boolean().default(false),\n});\nexport type PROptions = z.infer<typeof PROptionsSchema>;\n\nexport const PRResultSchema = z.object({\n  success: z.boolean(),\n  url: z.string().optional(),\n  number: z.number().optional(),\n  title: z.string().optional(),\n  error: z.string().optional(),\n});\nexport type PRResult = z.infer<typeof PRResultSchema>;\n\n// ============================================================================\n// RISK ASSESSMENT\n// ============================================================================\n\nexport const CommitRiskFactorSchema = z.object({\n  name: z.string(),\n  score: z.number().min(0).max(100),\n  weight: z.number().min(0).max(1),\n  reason: z.string(),\n});\nexport type CommitRiskFactor = z.infer<typeof CommitRiskFactorSchema>;\n\nexport const CommitRiskAssessmentSchema = z.object({\n  totalScore: z.number().min(0).max(100),\n  factors: z.array(CommitRiskFactorSchema),\n  recommendation: z.enum([\"auto_execute\", \"queue_approval\", \"escalate\", \"reject\"]),\n  criticalPaths: z.array(z.string()),\n  isBreakingChange: z.boolean(),\n});\nexport type CommitRiskAssessment = z.infer<typeof CommitRiskAssessmentSchema>;\n\n// ============================================================================\n// AGENT CONFIG\n// ============================================================================\n\nexport const CommitAgentConfigSchema = z.object({\n  name: z.string().default(\"commit-agent\"),\n  description: z.string().optional(),\n  llmProvider: z.enum([\"openai\", \"anthropic\", \"gemini\"]).default(\"anthropic\"),\n  llmModel: z.string().optional(),\n  apiKey: z.string().optional(),\n  temperature: z.number().min(0).max(2).default(0.3),\n  maxTokens: z.number().default(2048),\n  verbose: z.boolean().default(false),\n  conventionalCommits: z.boolean().default(true),\n  signCommits: z.boolean().default(false),\n  includeCoAuthors: z.boolean().default(true),\n  coAuthorName: z.string().default(\"Claude\"),\n  coAuthorEmail: z.string().default(\"noreply@anthropic.com\"),\n  maxMessageLength: z.number().default(72),\n  // Risk thresholds\n  autoCommitMaxLines: z.number().default(100),\n  autoCommitMaxFiles: z.number().default(5),\n  criticalPaths: z.array(z.string()).default([\n    \"src/core/\",\n    \"src/config/\",\n    \".env\",\n    \"secrets\",\n    \"credentials\",\n    \"package.json\",\n    \"pnpm-workspace.yaml\",\n    \".github/workflows/\",\n  ]),\n});\nexport type CommitAgentConfig = z.infer<typeof CommitAgentConfigSchema>;\n","#!/usr/bin/env node\n/**\n * Commit Agent CLI\n *\n * Standalone CLI for the commit agent\n */\n\nimport { CommitAgent } from \"./commit-agent.js\";\n\nconst HELP = `\n@gicm/commit-agent - AI-powered git commit workflow\n\nUsage:\n  gicm-commit [command] [options]\n\nCommands:\n  status              Show git status with risk assessment\n  generate            Generate commit message from staged changes\n  commit              Create commit with AI-generated message\n  push                Push to remote\n  pr                  Create pull request\n\nOptions:\n  -a, --all           Stage all changes before commit\n  -m, --message <msg> Override AI-generated message\n  -p, --push          Push after commit\n  --pr                Create PR after push\n  --dry-run           Preview without executing\n  --amend             Amend previous commit\n  -v, --verbose       Verbose output\n  -h, --help          Show this help\n\nExamples:\n  gicm-commit status\n  gicm-commit generate\n  gicm-commit commit -a -p\n  gicm-commit commit -a -p --pr\n  gicm-commit commit -m \"fix: resolve null check\"\n`;\n\nasync function main() {\n  const args = process.argv.slice(2);\n\n  if (args.includes(\"-h\") || args.includes(\"--help\") || args.length === 0) {\n    console.log(HELP);\n    process.exit(0);\n  }\n\n  const command = args[0];\n  const flags = new Set(args.slice(1));\n\n  const verbose = flags.has(\"-v\") || flags.has(\"--verbose\");\n  const dryRun = flags.has(\"--dry-run\");\n  const all = flags.has(\"-a\") || flags.has(\"--all\");\n  const push = flags.has(\"-p\") || flags.has(\"--push\");\n  const createPr = flags.has(\"--pr\");\n  const amend = flags.has(\"--amend\");\n\n  // Extract message if provided\n  let message: string | undefined;\n  const messageIndex = args.findIndex((a) => a === \"-m\" || a === \"--message\");\n  if (messageIndex !== -1 && args[messageIndex + 1]) {\n    message = args[messageIndex + 1];\n  }\n\n  const agent = new CommitAgent({\n    apiKey: process.env.ANTHROPIC_API_KEY || process.env.OPENAI_API_KEY,\n    verbose,\n  });\n\n  try {\n    switch (command) {\n      case \"status\": {\n        const status = await agent.getStatus();\n        const risk = status.isClean ? null : await agent.assessRisk();\n\n        console.log(`\\nBranch: ${status.branch}`);\n        console.log(`Status: ${status.isClean ? \"Clean\" : \"Has changes\"}`);\n\n        if (!status.isClean) {\n          console.log(`\\nStaged (${status.staged.length}):`);\n          status.staged.forEach((f) => console.log(`  ${f.type}: ${f.path}`));\n\n          console.log(`\\nUnstaged (${status.unstaged.length}):`);\n          status.unstaged.forEach((f) => console.log(`  ${f.type}: ${f.path}`));\n\n          console.log(`\\nUntracked (${status.untracked.length}):`);\n          status.untracked.forEach((f) => console.log(`  ${f}`));\n\n          if (risk) {\n            console.log(`\\nRisk Score: ${risk.totalScore}/100`);\n            console.log(`Recommendation: ${risk.recommendation}`);\n          }\n        }\n        break;\n      }\n\n      case \"generate\": {\n        console.log(\"Analyzing changes...\");\n        const generated = await agent.generateMessage();\n\n        console.log(`\\nGenerated Message (confidence: ${Math.round(generated.confidence * 100)}%):`);\n        console.log(\"---\");\n        console.log(generated.fullText);\n        console.log(\"---\");\n        console.log(`\\nReasoning: ${generated.reasoning}`);\n        break;\n      }\n\n      case \"commit\": {\n        console.log(\"Creating commit...\");\n        const result = await agent.commit({\n          all,\n          push,\n          createPr,\n          message,\n          dryRun,\n          amend,\n        });\n\n        if (!result.success) {\n          console.error(`\\nError: ${result.error}`);\n          if (result.approvalRequired) {\n            console.log(`Risk score: ${result.riskScore}`);\n            console.log(\"This commit requires manual approval.\");\n          }\n          process.exit(1);\n        }\n\n        if (dryRun) {\n          console.log(\"\\n[DRY RUN] Would commit with message:\");\n          console.log(\"---\");\n          console.log(result.message?.fullText);\n          console.log(\"---\");\n        } else {\n          console.log(`\\nCommit created: ${result.commitHash?.substring(0, 7)}`);\n          if (result.pushed) {\n            console.log(\"Pushed to remote\");\n          }\n          if (result.prUrl) {\n            console.log(`PR created: ${result.prUrl}`);\n          }\n        }\n        break;\n      }\n\n      case \"push\": {\n        console.log(\"Pushing to remote...\");\n        const result = await agent.push({ setUpstream: true });\n\n        if (!result.success) {\n          console.error(`Error: ${result.error}`);\n          process.exit(1);\n        }\n\n        console.log(`Pushed to ${result.remote}/${result.branch}`);\n        break;\n      }\n\n      case \"pr\": {\n        console.log(\"Creating pull request...\");\n        const result = await agent.createPR({ dryRun });\n\n        if (!result.success) {\n          console.error(`Error: ${result.error}`);\n          process.exit(1);\n        }\n\n        if (result.url) {\n          console.log(`PR created: ${result.url}`);\n        }\n        break;\n      }\n\n      default:\n        console.error(`Unknown command: ${command}`);\n        console.log(HELP);\n        process.exit(1);\n    }\n  } catch (error) {\n    console.error(`Error: ${(error as Error).message}`);\n    process.exit(1);\n  }\n}\n\nmain();\n"],"mappings":";;;AAMA,SAAS,iBAAiB;AAE1B,SAAS,KAAAA,UAAS;;;ACFlB,SAAS,YAAY;AACrB,SAAS,iBAAiB;AAG1B,IAAM,YAAY,UAAU,IAAI;AAOzB,IAAM,gBAAN,MAAoB;AAAA,EACjB;AAAA,EACA;AAAA,EAER,YAAY,UAA0B,CAAC,GAAG;AACxC,SAAK,MAAM,QAAQ,OAAO,QAAQ,IAAI;AACtC,SAAK,UAAU,QAAQ,WAAW;AAAA,EACpC;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,KAAK,MAAiC;AAC1C,UAAM,UAAU,OAAO,KAAK,KAAK,GAAG,CAAC;AACrC,QAAI;AACF,YAAM,EAAE,OAAO,IAAI,MAAM,UAAU,SAAS;AAAA,QAC1C,KAAK,KAAK;AAAA,QACV,SAAS,KAAK;AAAA,QACd,WAAW,KAAK,OAAO;AAAA;AAAA,MACzB,CAAC;AACD,aAAO,OAAO,KAAK;AAAA,IACrB,SAAS,OAAO;AACd,YAAM,MAAM;AACZ,YAAM,IAAI,MAAM,IAAI,UAAU,IAAI,OAAO;AAAA,IAC3C;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,mBAAoC;AACxC,WAAO,KAAK,KAAK,CAAC,aAAa,gBAAgB,MAAM,CAAC;AAAA,EACxD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,UAA4B;AAChC,UAAM,SAAS,MAAM,KAAK,KAAK,CAAC,UAAU,aAAa,CAAC;AACxD,WAAO,OAAO,WAAW;AAAA,EAC3B;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,YAAgC;AACpC,UAAM,CAAC,QAAQ,WAAW,MAAM,IAAI,MAAM,QAAQ,IAAI;AAAA,MACpD,KAAK,iBAAiB;AAAA,MACtB,KAAK,KAAK,CAAC,UAAU,kBAAkB,UAAU,CAAC;AAAA,MAClD,KAAK,KAAK,CAAC,QAAQ,CAAC,EAAE,MAAM,MAAM,EAAE;AAAA,IACtC,CAAC;AAED,UAAM,QAAQ,UAAU,MAAM,IAAI,EAAE,OAAO,OAAO;AAClD,UAAM,SAAuB,CAAC;AAC9B,UAAM,WAAyB,CAAC;AAChC,UAAM,YAAsB,CAAC;AAC7B,QAAI,QAAQ;AACZ,QAAI,SAAS;AAEb,eAAW,QAAQ,OAAO;AAExB,UAAI,KAAK,WAAW,aAAa,GAAG;AAClC,cAAM,QAAQ,KAAK,MAAM,gBAAgB;AACzC,YAAI,OAAO;AACT,kBAAQ,SAAS,MAAM,CAAC,GAAG,EAAE;AAC7B,mBAAS,SAAS,MAAM,CAAC,GAAG,EAAE;AAAA,QAChC;AACA;AAAA,MACF;AAGA,UAAI,KAAK,WAAW,GAAG,EAAG;AAG1B,UAAI,KAAK,WAAW,GAAG,GAAG;AACxB,kBAAU,KAAK,KAAK,UAAU,CAAC,CAAC;AAChC;AAAA,MACF;AAGA,UAAI,KAAK,WAAW,GAAG,KAAK,KAAK,WAAW,GAAG,GAAG;AAChD,cAAM,QAAQ,KAAK,MAAM,GAAI;AAC7B,cAAM,aAAa,MAAM,CAAC,EAAE,MAAM,GAAG;AACrC,cAAM,KAAK,WAAW,CAAC,KAAK;AAC5B,cAAM,OAAO,MAAM,MAAM,SAAS,CAAC;AAEnC,cAAM,cAAc,GAAG,CAAC;AACxB,cAAM,aAAa,GAAG,CAAC;AAGvB,YAAI,gBAAgB,OAAO,gBAAgB,KAAK;AAC9C,iBAAO,KAAK;AAAA,YACV;AAAA,YACA,MAAM,KAAK,gBAAgB,WAAW;AAAA,YACtC,YAAY;AAAA,YACZ,cAAc;AAAA,YACd,QAAQ;AAAA,UACV,CAAC;AAAA,QACH;AAGA,YAAI,eAAe,OAAO,eAAe,KAAK;AAC5C,mBAAS,KAAK;AAAA,YACZ;AAAA,YACA,MAAM,KAAK,gBAAgB,UAAU;AAAA,YACrC,YAAY;AAAA,YACZ,cAAc;AAAA,YACd,QAAQ;AAAA,UACV,CAAC;AAAA,QACH;AAAA,MACF;AAAA,IACF;AAEA,WAAO;AAAA,MACL;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA,SAAS,OAAO,WAAW,KAAK,SAAS,WAAW,KAAK,UAAU,WAAW;AAAA,MAC9E,WAAW,OAAO,SAAS;AAAA,IAC7B;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,iBAAoC;AACxC,UAAM,SAAS,MAAM,KAAK,KAAK,CAAC,QAAQ,YAAY,aAAa,CAAC;AAClE,WAAO,SAAS,OAAO,MAAM,IAAI,EAAE,OAAO,OAAO,IAAI,CAAC;AAAA,EACxD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,QAAQ,SAAS,MAAuB;AAC5C,UAAM,OAAO,CAAC,MAAM;AACpB,QAAI,OAAQ,MAAK,KAAK,UAAU;AAChC,SAAK,KAAK,YAAY;AACtB,WAAO,KAAK,KAAK,IAAI;AAAA,EACvB;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,YAAY,SAAS,MAAuB;AAChD,UAAM,OAAO,CAAC,QAAQ,QAAQ;AAC9B,QAAI,OAAQ,MAAK,KAAK,UAAU;AAChC,WAAO,KAAK,KAAK,IAAI;AAAA,EACvB;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,MAAM,OAAgC;AAC1C,QAAI,MAAM,WAAW,EAAG;AACxB,UAAM,KAAK,KAAK,CAAC,OAAO,MAAM,GAAG,KAAK,CAAC;AAAA,EACzC;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,WAA0B;AAC9B,UAAM,KAAK,KAAK,CAAC,OAAO,IAAI,CAAC;AAAA,EAC/B;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,QAAQ,OAAgC;AAC5C,QAAI,MAAM,WAAW,EAAG;AACxB,UAAM,KAAK,KAAK,CAAC,SAAS,QAAQ,MAAM,GAAG,KAAK,CAAC;AAAA,EACnD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,OAAO,SAAiB,UAA+B,CAAC,GAAoB;AAChF,UAAM,OAAO,CAAC,UAAU,MAAM,OAAO;AACrC,QAAI,QAAQ,MAAO,MAAK,KAAK,SAAS;AAEtC,UAAM,KAAK,KAAK,IAAI;AACpB,WAAO,KAAK,kBAAkB;AAAA,EAChC;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,oBAAqC;AACzC,WAAO,KAAK,KAAK,CAAC,aAAa,MAAM,CAAC;AAAA,EACxC;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,iBAAiB,QAAQ,GAAsB;AACnD,UAAM,SAAS,MAAM,KAAK,KAAK;AAAA,MAC7B;AAAA,MACA;AAAA,MACA,IAAI,KAAK;AAAA,IACX,CAAC;AACD,WAAO,SAAS,OAAO,MAAM,IAAI,EAAE,OAAO,OAAO,IAAI,CAAC;AAAA,EACxD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,KAAK,UAKP,CAAC,GAAgD;AACnD,UAAM,SAAS,QAAQ,UAAU;AACjC,UAAM,SAAS,QAAQ,UAAU,MAAM,KAAK,iBAAiB;AAE7D,UAAM,OAAO,CAAC,MAAM;AACpB,QAAI,QAAQ,MAAO,MAAK,KAAK,SAAS;AACtC,QAAI,QAAQ,YAAa,MAAK,KAAK,IAAI;AACvC,SAAK,KAAK,QAAQ,MAAM;AAExB,UAAM,KAAK,KAAK,IAAI;AACpB,WAAO,EAAE,QAAQ,OAAO;AAAA,EAC1B;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,mBAAmB,QAAgB,QAAkC;AACzE,QAAI;AACF,YAAM,KAAK,KAAK,CAAC,aAAa,eAAe,QAAQ,cAAc,MAAM,EAAE,CAAC;AAC5E,aAAO;AAAA,IACT,QAAQ;AACN,aAAO;AAAA,IACT;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,aAAa,SAAS,UAA2B;AACrD,WAAO,KAAK,KAAK,CAAC,UAAU,WAAW,MAAM,CAAC;AAAA,EAChD;AAAA;AAAA;AAAA;AAAA,EAKQ,gBAAgB,MAA8B;AACpD,YAAQ,KAAK,YAAY,GAAG;AAAA,MAC1B,KAAK;AACH,eAAO;AAAA,MACT,KAAK;AACH,eAAO;AAAA,MACT,KAAK;AACH,eAAO;AAAA,MACT,KAAK;AACH,eAAO;AAAA,MACT,KAAK;AACH,eAAO;AAAA,MACT;AACE,eAAO;AAAA,IACX;AAAA,EACF;AACF;;;AC/QO,IAAM,eAAe;AAAA,EAC1B,cAAc;AAAA;AAAA,EACd,cAAc;AAAA;AAAA,EACd,eAAe;AAAA;AAAA,EACf,gBAAgB;AAAA;AAAA,EAChB,WAAW;AAAA;AACb;AAMO,IAAM,kBAAkB;AAAA;AAAA,EAE7B,UAAU;AAAA;AAAA,EACV,aAAa;AAAA;AAAA,EACb,WAAW;AAAA;AAAA,EACX,eAAe;AAAA;AAAA;AAAA,EAGf,UAAU;AAAA;AAAA,EACV,aAAa;AAAA;AAAA,EACb,WAAW;AAAA;AAAA,EACX,eAAe;AAAA;AAAA;AAAA,EAGf,gBAAgB;AAAA;AAAA,EAChB,kBAAkB;AAAA;AAAA,EAClB,aAAa;AAAA;AAAA;AAEf;AAwBO,IAAM,yBAAyB;AAAA;AAAA,EAEpC;AAAA,EACA;AAAA,EACA;AAAA;AAAA,EAGA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA;AAAA,EAGA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA;AAAA,EAGA;AAAA,EACA;AACF;AAEO,IAAM,6BAA6B;AAAA,EACxC;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF;AAMO,IAAM,oBAAoB;AAE1B,IAAM,yBAAyB;AAAA;AAAA;AAAA,kBAGpB,iBAAiB;AAAA,EACjC,KAAK;;;AC9FA,IAAM,eAAN,MAAmB;AAAA;AAAA;AAAA;AAAA,EAIxB,UAAU,SAAiB,SAAS,MAAM,UAA4B,CAAC,GAAgB;AACrF,UAAM,QAAQ,KAAK,iBAAiB,OAAO;AAC3C,UAAM,kBAAkB,MAAM,OAAO,CAAC,KAAK,MAAM,MAAM,EAAE,YAAY,CAAC;AACtE,UAAM,oBAAoB,MAAM,OAAO,CAAC,KAAK,MAAM,MAAM,EAAE,cAAc,CAAC;AAE1E,QAAI,cAAc;AAClB,QAAI,QAAQ,oBAAoB,YAAY,SAAS,QAAQ,kBAAkB;AAC7E,oBAAc,YAAY,UAAU,GAAG,QAAQ,gBAAgB,IAAI;AAAA,IACrE;AAEA,WAAO;AAAA,MACL;AAAA,MACA;AAAA,MACA;AAAA,MACA,mBAAmB,MAAM;AAAA,MACzB,aAAa,QAAQ,mBAAmB,QAAQ,cAAc;AAAA,MAC9D;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,iBAAiB,SAA+B;AAC9C,UAAM,QAAsB,CAAC;AAC7B,UAAM,QAAQ,QAAQ,MAAM,IAAI;AAEhC,QAAI,cAA0C;AAC9C,QAAI,aAAa;AACjB,QAAI,eAAe;AAEnB,eAAW,QAAQ,OAAO;AAExB,UAAI,KAAK,WAAW,YAAY,GAAG;AAEjC,YAAI,aAAa,MAAM;AACrB,gBAAM,KAAK;AAAA,YACT,MAAM,YAAY;AAAA,YAClB,MAAM,YAAY,QAAQ;AAAA,YAC1B;AAAA,YACA;AAAA,YACA,QAAQ,YAAY,UAAU;AAAA,YAC9B,SAAS,YAAY;AAAA,UACvB,CAAC;AAAA,QACH;AAGA,cAAM,QAAQ,KAAK,MAAM,4BAA4B;AACrD,YAAI,OAAO;AACT,wBAAc;AAAA,YACZ,MAAM,MAAM,CAAC;AAAA,YACb,MAAM;AAAA,YACN,QAAQ;AAAA,UACV;AACA,cAAI,MAAM,CAAC,MAAM,MAAM,CAAC,GAAG;AACzB,wBAAY,UAAU,MAAM,CAAC;AAC7B,wBAAY,OAAO;AAAA,UACrB;AAAA,QACF;AACA,qBAAa;AACb,uBAAe;AACf;AAAA,MACF;AAGA,UAAI,KAAK,WAAW,eAAe,GAAG;AACpC,YAAI,YAAa,aAAY,OAAO;AACpC;AAAA,MACF;AAGA,UAAI,KAAK,WAAW,mBAAmB,GAAG;AACxC,YAAI,YAAa,aAAY,OAAO;AACpC;AAAA,MACF;AAGA,UAAI,KAAK,SAAS,cAAc,KAAK,KAAK,SAAS,kBAAkB,GAAG;AACtE,YAAI,YAAa,aAAY,SAAS;AACtC;AAAA,MACF;AAGA,UAAI,KAAK,WAAW,GAAG,KAAK,CAAC,KAAK,WAAW,KAAK,GAAG;AACnD;AACA;AAAA,MACF;AAGA,UAAI,KAAK,WAAW,GAAG,KAAK,CAAC,KAAK,WAAW,KAAK,GAAG;AACnD;AACA;AAAA,MACF;AAAA,IACF;AAGA,QAAI,aAAa,MAAM;AACrB,YAAM,KAAK;AAAA,QACT,MAAM,YAAY;AAAA,QAClB,MAAM,YAAY,QAAQ;AAAA,QAC1B;AAAA,QACA;AAAA,QACA,QAAQ,YAAY,UAAU;AAAA,QAC9B,SAAS,YAAY;AAAA,MACvB,CAAC;AAAA,IACH;AAEA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,WAAW,MAAmB,gBAA0B,CAAC,GAAyB;AAChF,UAAM,UAA8B,CAAC;AACrC,UAAM,uBAAiC,CAAC;AAGxC,UAAM,aAAa,KAAK,kBAAkB,KAAK;AAC/C,UAAM,aAAa,KAAK,oBAAoB,UAAU;AACtD,YAAQ,KAAK;AAAA,MACX,MAAM;AAAA,MACN,OAAO;AAAA,MACP,QAAQ,aAAa;AAAA,MACrB,QAAQ,GAAG,UAAU,oBAAoB,KAAK,eAAe,KAAK,KAAK,iBAAiB;AAAA,IAC1F,CAAC;AAGD,UAAM,aAAa,KAAK,oBAAoB,KAAK,iBAAiB;AAClE,YAAQ,KAAK;AAAA,MACX,MAAM;AAAA,MACN,OAAO;AAAA,MACP,QAAQ,aAAa;AAAA,MACrB,QAAQ,GAAG,KAAK,iBAAiB;AAAA,IACnC,CAAC;AAGD,UAAM,sBAAsB;AAAA,MAC1B,GAAG;AAAA,MACH,GAAG,cAAc,IAAI,CAAC,MAAM,IAAI,OAAO,EAAE,QAAQ,uBAAuB,MAAM,CAAC,CAAC;AAAA,IAClF;AAEA,eAAW,QAAQ,KAAK,OAAO;AAC7B,iBAAW,WAAW,qBAAqB;AACzC,YAAI,QAAQ,KAAK,KAAK,IAAI,GAAG;AAC3B,+BAAqB,KAAK,KAAK,IAAI;AACnC;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAEA,UAAM,qBAAqB,qBAAqB,SAAS,IAAI,MAAM;AACnE,YAAQ,KAAK;AAAA,MACX,MAAM;AAAA,MACN,OAAO;AAAA,MACP,QAAQ,aAAa;AAAA,MACrB,QACE,qBAAqB,SAAS,IAC1B,2BAA2B,qBAAqB,MAAM,GAAG,CAAC,EAAE,KAAK,IAAI,CAAC,GAAG,qBAAqB,SAAS,IAAI,QAAQ,EAAE,KACrH;AAAA,IACR,CAAC;AAGD,UAAM,aAAa,KAAK,qBAAqB,KAAK,WAAW;AAC7D,UAAM,gBAAgB,aAAa,MAAM;AACzC,YAAQ,KAAK;AAAA,MACX,MAAM;AAAA,MACN,OAAO;AAAA,MACP,QAAQ,aAAa;AAAA,MACrB,QAAQ,aAAa,wCAAwC;AAAA,IAC/D,CAAC;AAGD,UAAM,aAAa,KAAK;AAAA,MACtB;AAAA,MACA,QAAQ,OAAO,CAAC,KAAK,MAAM,MAAM,EAAE,QAAQ,EAAE,QAAQ,CAAC;AAAA,IACxD;AAGA,QAAI;AACJ,QAAI,cAAc,gBAAgB,gBAAgB;AAChD,uBAAiB;AAAA,IACnB,WAAW,cAAc,gBAAgB,kBAAkB;AACzD,uBAAiB;AAAA,IACnB,WAAW,cAAc,gBAAgB,aAAa;AACpD,uBAAiB;AAAA,IACnB,OAAO;AACL,uBAAiB;AAAA,IACnB;AAEA,WAAO;AAAA,MACL,YAAY,KAAK,MAAM,UAAU;AAAA,MACjC;AAAA,MACA;AAAA,MACA,eAAe;AAAA,MACf,kBAAkB;AAAA,IACpB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,iBAAiB,MAAmB,YAAY,KAAc;AAC5D,UAAM,WAAqB,CAAC;AAG5B,aAAS,KAAK;AAAA,mBACC,KAAK,iBAAiB;AAAA,iBACxB,KAAK,eAAe;AAAA,mBAClB,KAAK,iBAAiB;AAAA,CACxC;AAGG,UAAM,WAAW,KAAK,MACnB,IAAI,CAAC,MAAM;AACV,YAAM,YACJ,EAAE,SAAS,UACP,MACA,EAAE,SAAS,YACT,MACA,EAAE,SAAS,YACT,WACA;AACV,aAAO,KAAK,SAAS,IAAI,EAAE,IAAI,MAAM,EAAE,UAAU,KAAK,EAAE,YAAY;AAAA,IACtE,CAAC,EACA,KAAK,IAAI;AACZ,aAAS,KAAK;AAAA,EAAa,QAAQ,EAAE;AAGrC,QAAI,cAAc,KAAK;AACvB,UAAM,eAAe,SAAS,KAAK,MAAM,EAAE;AAC3C,UAAM,kBAAkB,YAAY,eAAe;AAEnD,QAAI,YAAY,SAAS,iBAAiB;AACxC,oBAAc,YAAY,UAAU,GAAG,eAAe,IAAI;AAAA,IAC5D;AAEA,aAAS,KAAK;AAAA;AAAA,EAAwB,WAAW;AAAA,OAAU;AAE3D,WAAO,SAAS,KAAK,MAAM;AAAA,EAC7B;AAAA;AAAA;AAAA;AAAA,EAKQ,oBAAoB,OAAuB;AACjD,QAAI,SAAS,gBAAgB,SAAU,QAAO;AAC9C,QAAI,SAAS,gBAAgB,YAAa,QAAO;AACjD,QAAI,SAAS,gBAAgB,UAAW,QAAO;AAC/C,QAAI,SAAS,gBAAgB,cAAe,QAAO;AACnD,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,oBAAoB,OAAuB;AACjD,QAAI,SAAS,gBAAgB,SAAU,QAAO;AAC9C,QAAI,SAAS,gBAAgB,YAAa,QAAO;AACjD,QAAI,SAAS,gBAAgB,UAAW,QAAO;AAC/C,QAAI,SAAS,gBAAgB,cAAe,QAAO;AACnD,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,qBAAqB,aAA8B;AACzD,eAAW,WAAW,4BAA4B;AAChD,UAAI,QAAQ,KAAK,WAAW,EAAG,QAAO;AAAA,IACxC;AACA,WAAO;AAAA,EACT;AACF;;;AC5RA,SAAS,uBAAuB;;;ACHzB,IAAM,+BAA+B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAgDrC,IAAM,6BAA6B,CAAC,gBAAwB;AAAA;AAAA,EAEjE,WAAW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAYN,IAAM,wBAAwB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAgC9B,IAAM,sBAAsB,CAAC,SAAmB,gBAAwB;AAAA;AAAA;AAAA,EAG7E,QAAQ,IAAI,CAAC,MAAM,KAAK,CAAC,EAAE,EAAE,KAAK,IAAI,CAAC;AAAA;AAAA;AAAA,EAGvC,WAAW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;ADhFN,IAAM,mBAAN,MAAuB;AAAA,EACpB,YAA8B;AAAA,EAC9B;AAAA,EACA;AAAA,EAER,YAAY,SAA0B,CAAC,GAAG;AACxC,SAAK,SAAS;AAAA,MACZ,aAAa;AAAA,MACb,aAAa;AAAA,MACb,WAAW;AAAA,MACX,iBAAiB;AAAA,MACjB,cAAc;AAAA,MACd,eAAe;AAAA,MACf,GAAG;AAAA,IACL;AAEA,SAAK,eAAe,IAAI,aAAa;AAGrC,QAAI,KAAK,OAAO,QAAQ;AACtB,WAAK,YAAY,gBAAgB;AAAA,QAC/B,UAAU,KAAK,OAAO;AAAA,QACtB,OAAO,KAAK,OAAO;AAAA,QACnB,QAAQ,KAAK,OAAO;AAAA,QACpB,aAAa,KAAK,OAAO;AAAA,QACzB,WAAW,KAAK,OAAO;AAAA,MACzB,CAAC;AAAA,IACH;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,SAAS,MAA8C;AAE3D,QAAI,CAAC,KAAK,WAAW;AACnB,aAAO,KAAK,iBAAiB,IAAI;AAAA,IACnC;AAEA,QAAI;AACF,YAAM,UAAU,KAAK,aAAa,iBAAiB,IAAI;AACvD,YAAM,SAAS,2BAA2B,OAAO;AAEjD,YAAM,WAAW,MAAM,KAAK,UAAU,KAAK;AAAA,QACzC,EAAE,MAAM,UAAU,SAAS,6BAA6B;AAAA,QACxD,EAAE,MAAM,QAAQ,SAAS,OAAO;AAAA,MAClC,CAAC;AAED,YAAM,SAAS,KAAK,UAOjB,SAAS,OAAO;AAEnB,UAAI,CAAC,QAAQ;AACX,eAAO,KAAK,iBAAiB,IAAI;AAAA,MACnC;AAEA,YAAM,UAAyB;AAAA,QAC7B,MAAM,OAAO;AAAA,QACb,OAAO,OAAO,SAAS;AAAA,QACvB,SAAS,OAAO;AAAA,QAChB,MAAM,OAAO,QAAQ;AAAA,QACrB,UAAU,OAAO,YAAY;AAAA,QAC7B,WAAW,KAAK,OAAO,kBACnB,CAAC,GAAG,KAAK,OAAO,YAAY,KAAK,KAAK,OAAO,aAAa,GAAG,IAC7D,CAAC;AAAA,MACP;AAEA,aAAO;AAAA,QACL;AAAA,QACA,UAAU,KAAK,cAAc,OAAO;AAAA,QACpC,YAAY;AAAA,QACZ,WAAW,OAAO;AAAA,MACpB;AAAA,IACF,SAAS,OAAO;AACd,cAAQ,MAAM,0CAA0C,KAAK;AAC7D,aAAO,KAAK,iBAAiB,IAAI;AAAA,IACnC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,eACJ,SACA,MAC4D;AAC5D,UAAM,cAAc,GAAG,KAAK,iBAAiB,YAAY,KAAK,eAAe,KAAK,KAAK,iBAAiB;AAExG,QAAI,CAAC,KAAK,WAAW;AAEnB,aAAO;AAAA,QACL,OAAO,QAAQ,CAAC,KAAK;AAAA,QACrB,MAAM,KAAK,uBAAuB,SAAS,IAAI;AAAA,QAC/C,QAAQ,CAAC;AAAA,MACX;AAAA,IACF;AAEA,QAAI;AACF,YAAM,SAAS,oBAAoB,SAAS,WAAW;AAEvD,YAAM,WAAW,MAAM,KAAK,UAAU,KAAK;AAAA,QACzC,EAAE,MAAM,UAAU,SAAS,sBAAsB;AAAA,QACjD,EAAE,MAAM,QAAQ,SAAS,OAAO;AAAA,MAClC,CAAC;AAED,YAAM,SAAS,KAAK,UAIjB,SAAS,OAAO;AAEnB,UAAI,CAAC,QAAQ;AACX,eAAO;AAAA,UACL,OAAO,QAAQ,CAAC,KAAK;AAAA,UACrB,MAAM,KAAK,uBAAuB,SAAS,IAAI;AAAA,UAC/C,QAAQ,CAAC;AAAA,QACX;AAAA,MACF;AAEA,aAAO;AAAA,IACT,SAAS,OAAO;AACd,cAAQ,MAAM,8BAA8B,KAAK;AACjD,aAAO;AAAA,QACL,OAAO,QAAQ,CAAC,KAAK;AAAA,QACrB,MAAM,KAAK,uBAAuB,SAAS,IAAI;AAAA,QAC/C,QAAQ,CAAC;AAAA,MACX;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,cAAc,SAAgC;AAC5C,UAAM,QAAkB,CAAC;AAGzB,QAAI,SAAS,QAAQ;AACrB,QAAI,QAAQ,MAAO,WAAU,IAAI,QAAQ,KAAK;AAC9C,QAAI,QAAQ,SAAU,WAAU;AAChC,cAAU,KAAK,QAAQ,OAAO;AAC9B,UAAM,KAAK,MAAM;AAGjB,QAAI,QAAQ,MAAM;AAChB,YAAM,KAAK,EAAE;AACb,YAAM,KAAK,QAAQ,IAAI;AAAA,IACzB;AAGA,UAAM,KAAK,EAAE;AACb,UAAM,KAAK,sBAAsB;AAEjC,WAAO,MAAM,KAAK,IAAI;AAAA,EACxB;AAAA;AAAA;AAAA;AAAA,EAKA,gBAAgB,SAA8D;AAC5E,UAAM,SAAmB,CAAC;AAE1B,QAAI,CAAC,QAAQ,MAAM;AACjB,aAAO,KAAK,qBAAqB;AAAA,IACnC;AAEA,QAAI,CAAC,QAAQ,SAAS;AACpB,aAAO,KAAK,wBAAwB;AAAA,IACtC,OAAO;AACL,UAAI,QAAQ,QAAQ,SAAS,IAAI;AAC/B,eAAO,KAAK,qBAAqB,QAAQ,QAAQ,MAAM,YAAY;AAAA,MACrE;AACA,UAAI,QAAQ,QAAQ,SAAS,GAAG,GAAG;AACjC,eAAO,KAAK,sCAAsC;AAAA,MACpD;AACA,UAAI,CAAC,SAAS,KAAK,QAAQ,OAAO,GAAG;AACnC,eAAO,KAAK,qCAAqC;AAAA,MACnD;AAAA,IACF;AAEA,WAAO,EAAE,OAAO,OAAO,WAAW,GAAG,OAAO;AAAA,EAC9C;AAAA;AAAA;AAAA;AAAA,EAKQ,iBAAiB,MAAqC;AAE5D,QAAI,OAAyB;AAC7B,QAAI;AAEJ,UAAM,QAAQ,KAAK,MAAM,IAAI,CAAC,MAAM,EAAE,IAAI;AAG1C,QAAI,MAAM,KAAK,CAAC,MAAM,EAAE,SAAS,MAAM,KAAK,EAAE,SAAS,MAAM,CAAC,GAAG;AAC/D,aAAO;AAAA,IACT,WAAW,MAAM,KAAK,CAAC,MAAM,EAAE,SAAS,KAAK,KAAK,EAAE,SAAS,OAAO,CAAC,GAAG;AACtE,aAAO;AAAA,IACT,WAAW,MAAM,KAAK,CAAC,MAAM,EAAE,SAAS,UAAU,KAAK,EAAE,SAAS,IAAI,CAAC,GAAG;AACxE,aAAO;AAAA,IACT,WAAW,MAAM,KAAK,CAAC,MAAM,EAAE,SAAS,cAAc,KAAK,EAAE,SAAS,MAAM,CAAC,GAAG;AAC9E,aAAO;AAAA,IACT,WAAW,KAAK,MAAM,KAAK,CAAC,MAAM,EAAE,SAAS,OAAO,GAAG;AACrD,aAAO;AAAA,IACT,OAAO;AACL,aAAO;AAAA,IACT;AAGA,UAAM,eAAe,KAAK,iBAAiB,KAAK;AAChD,QAAI,cAAc;AAChB,cAAQ,aAAa,MAAM,GAAG,EAAE,CAAC;AACjC,UAAI,UAAU,SAAS,UAAU,YAAY;AAC3C,gBAAQ,aAAa,MAAM,GAAG,EAAE,CAAC,KAAK;AAAA,MACxC;AAAA,IACF;AAGA,UAAM,SACJ,KAAK,MAAM,CAAC,GAAG,SAAS,UACpB,QACA,KAAK,MAAM,CAAC,GAAG,SAAS,YACtB,WACA;AACR,UAAM,SACJ,KAAK,MAAM,WAAW,IAClB,KAAK,MAAM,CAAC,EAAE,KAAK,MAAM,GAAG,EAAE,IAAI,IAClC,GAAG,KAAK,MAAM,MAAM;AAC1B,UAAM,UAAU,GAAG,MAAM,IAAI,MAAM;AAEnC,UAAM,UAAyB;AAAA,MAC7B;AAAA,MACA;AAAA,MACA,SAAS,QAAQ,UAAU,GAAG,EAAE;AAAA,MAChC,UAAU;AAAA,MACV,WAAW,KAAK,OAAO,kBACnB,CAAC,GAAG,KAAK,OAAO,YAAY,KAAK,KAAK,OAAO,aAAa,GAAG,IAC7D,CAAC;AAAA,IACP;AAEA,WAAO;AAAA,MACL;AAAA,MACA,UAAU,KAAK,cAAc,OAAO;AAAA,MACpC,YAAY;AAAA,MACZ,WAAW;AAAA,IACb;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,uBAAuB,SAAmB,MAA2B;AAC3E,WAAO;AAAA,mBACQ,QAAQ,MAAM,wBAAwB,KAAK,iBAAiB;AAAA;AAAA;AAAA,EAG7E,KAAK,MAAM,IAAI,CAAC,MAAM,KAAK,EAAE,IAAI,OAAO,EAAE,IAAI,QAAQ,EAAE,UAAU,KAAK,EAAE,YAAY,GAAG,EAAE,KAAK,IAAI,CAAC;AAAA;AAAA;AAAA,EAGpG,QAAQ,IAAI,CAAC,MAAM,KAAK,CAAC,EAAE,EAAE,KAAK,IAAI,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA,EAKvC;AAAA;AAAA;AAAA;AAAA,EAKQ,iBAAiB,OAAyB;AAChD,QAAI,MAAM,WAAW,EAAG,QAAO;AAC/B,QAAI,MAAM,WAAW,EAAG,QAAO,MAAM,CAAC,EAAE,UAAU,GAAG,MAAM,CAAC,EAAE,YAAY,GAAG,CAAC;AAE9E,UAAM,SAAS,MAAM,MAAM,EAAE,KAAK;AAClC,UAAM,QAAQ,OAAO,CAAC,EAAE,MAAM,GAAG;AACjC,UAAM,OAAO,OAAO,OAAO,SAAS,CAAC,EAAE,MAAM,GAAG;AAEhD,UAAM,SAAmB,CAAC;AAC1B,aAAS,IAAI,GAAG,IAAI,KAAK,IAAI,MAAM,QAAQ,KAAK,MAAM,GAAG,KAAK;AAC5D,UAAI,MAAM,CAAC,MAAM,KAAK,CAAC,GAAG;AACxB,eAAO,KAAK,MAAM,CAAC,CAAC;AAAA,MACtB,OAAO;AACL;AAAA,MACF;AAAA,IACF;AAEA,WAAO,OAAO,KAAK,GAAG;AAAA,EACxB;AAAA;AAAA;AAAA;AAAA,EAKQ,UAAa,MAAwB;AAC3C,QAAI;AAEF,YAAM,YAAY,KAAK,MAAM,8BAA8B;AAC3D,UAAI,WAAW;AACb,eAAO,KAAK,MAAM,UAAU,CAAC,EAAE,KAAK,CAAC;AAAA,MACvC;AAGA,YAAM,QAAQ,KAAK,QAAQ,GAAG;AAC9B,YAAM,MAAM,KAAK,YAAY,GAAG;AAChC,UAAI,UAAU,MAAM,QAAQ,IAAI;AAC9B,eAAO,KAAK,MAAM,KAAK,UAAU,OAAO,MAAM,CAAC,CAAC;AAAA,MAClD;AAEA,aAAO;AAAA,IACT,QAAQ;AACN,aAAO;AAAA,IACT;AAAA,EACF;AACF;;;AE/UA,SAAS,QAAAC,aAAY;AACrB,SAAS,aAAAC,kBAAiB;AAI1B,IAAMC,aAAYC,WAAUC,KAAI;AAQzB,IAAM,YAAN,MAAgB;AAAA,EACb;AAAA,EACA;AAAA,EACA;AAAA,EAER,YAAY,SAA0B,CAAC,GAAG;AACxC,SAAK,MAAM,OAAO,OAAO,QAAQ,IAAI;AACrC,SAAK,UAAU,OAAO,WAAW;AACjC,SAAK,mBAAmB,IAAI,iBAAiB,EAAE,QAAQ,OAAO,OAAO,CAAC;AAAA,EACxE;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,OAAO,UAA8B,CAAC,GAAsB;AAChE,QAAI,QAAQ,QAAQ;AAClB,aAAO;AAAA,QACL,SAAS;AAAA,QACT,OAAO,QAAQ,SAAS;AAAA,QACxB,OAAO;AAAA,MACT;AAAA,IACF;AAEA,QAAI;AAEF,YAAM,KAAK,KAAK,CAAC,MAAM,WAAW,CAAC;AAEnC,YAAM,OAAO,CAAC,MAAM,MAAM,QAAQ;AAElC,UAAI,QAAQ,OAAO;AACjB,aAAK,KAAK,WAAW,QAAQ,KAAK;AAAA,MACpC;AAEA,UAAI,QAAQ,MAAM;AAChB,aAAK,KAAK,UAAU,QAAQ,IAAI;AAAA,MAClC;AAEA,UAAI,QAAQ,MAAM;AAChB,aAAK,KAAK,UAAU,QAAQ,IAAI;AAAA,MAClC;AAEA,UAAI,QAAQ,MAAM;AAChB,aAAK,KAAK,UAAU,QAAQ,IAAI;AAAA,MAClC;AAEA,UAAI,QAAQ,OAAO;AACjB,aAAK,KAAK,SAAS;AAAA,MACrB;AAEA,YAAM,SAAS,MAAM,KAAK,KAAK,IAAI;AAGnC,YAAM,WAAW,OAAO,MAAM,0CAA0C;AAExE,aAAO;AAAA,QACL,SAAS;AAAA,QACT,KAAK,WAAW,CAAC;AAAA,QACjB,OAAO,QAAQ;AAAA,MACjB;AAAA,IACF,SAAS,OAAO;AACd,YAAM,MAAM;AACZ,aAAO;AAAA,QACL,SAAS;AAAA,QACT,OAAO,IAAI,UAAU,IAAI;AAAA,MAC3B;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,WACJ,SACA,MAC0C;AAC1C,UAAM,SAAS,MAAM,KAAK,iBAAiB,eAAe,SAAS,IAAI;AACvE,WAAO;AAAA,MACL,OAAO,OAAO;AAAA,MACd,MAAM,OAAO;AAAA,IACf;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,aAA0E;AAC9E,QAAI;AACF,YAAM,SAAS,MAAM,KAAK,KAAK,CAAC,MAAM,MAAM,QAAQ,UAAU,YAAY,CAAC;AAC3E,YAAM,OAAO,KAAK,MAAM,MAAM;AAC9B,aAAO;AAAA,QACL,QAAQ;AAAA,QACR,KAAK,KAAK;AAAA,QACV,QAAQ,KAAK;AAAA,MACf;AAAA,IACF,QAAQ;AACN,aAAO,EAAE,QAAQ,MAAM;AAAA,IACzB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,KAAK,MAAiC;AAClD,UAAM,UAAU,KAAK,KAAK,GAAG;AAC7B,UAAM,EAAE,OAAO,IAAI,MAAMF,WAAU,SAAS;AAAA,MAC1C,KAAK,KAAK;AAAA,MACV,SAAS,KAAK;AAAA,IAChB,CAAC;AACD,WAAO,OAAO,KAAK;AAAA,EACrB;AACF;;;AC3HA,SAAS,SAAS;AAMX,IAAM,uBAAuB,EAAE,KAAK;AAAA,EACzC;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF,CAAC;AAGM,IAAM,mBAAmB,EAAE,OAAO;AAAA,EACvC,MAAM,EAAE,OAAO;AAAA,EACf,MAAM;AAAA,EACN,YAAY,EAAE,OAAO,EAAE,QAAQ,CAAC;AAAA,EAChC,cAAc,EAAE,OAAO,EAAE,QAAQ,CAAC;AAAA,EAClC,QAAQ,EAAE,QAAQ,EAAE,QAAQ,KAAK;AAAA,EACjC,SAAS,EAAE,OAAO,EAAE,SAAS;AAC/B,CAAC;AAGM,IAAM,oBAAoB,EAAE,OAAO;AAAA,EACxC,OAAO,EAAE,MAAM,gBAAgB;AAAA,EAC/B,iBAAiB,EAAE,OAAO;AAAA,EAC1B,mBAAmB,EAAE,OAAO;AAAA,EAC5B,mBAAmB,EAAE,OAAO;AAAA,EAC5B,aAAa,EAAE,OAAO;AAAA,EACtB,QAAQ,EAAE,QAAQ;AACpB,CAAC;AAOM,IAAM,kBAAkB,EAAE,OAAO;AAAA,EACtC,QAAQ,EAAE,OAAO;AAAA,EACjB,OAAO,EAAE,OAAO,EAAE,QAAQ,CAAC;AAAA,EAC3B,QAAQ,EAAE,OAAO,EAAE,QAAQ,CAAC;AAAA,EAC5B,QAAQ,EAAE,MAAM,gBAAgB;AAAA,EAChC,UAAU,EAAE,MAAM,gBAAgB;AAAA,EAClC,WAAW,EAAE,MAAM,EAAE,OAAO,CAAC;AAAA,EAC7B,SAAS,EAAE,QAAQ;AAAA,EACnB,WAAW,EAAE,QAAQ;AACvB,CAAC;AAOM,IAAM,yBAAyB,EAAE,KAAK;AAAA,EAC3C;AAAA;AAAA,EACA;AAAA;AAAA,EACA;AAAA;AAAA,EACA;AAAA;AAAA,EACA;AAAA;AAAA,EACA;AAAA;AAAA,EACA;AAAA;AAAA,EACA;AAAA;AAAA,EACA;AAAA;AAAA,EACA;AAAA;AAAA,EACA;AAAA;AACF,CAAC;AAGM,IAAM,sBAAsB,EAAE,OAAO;AAAA,EAC1C,MAAM;AAAA,EACN,OAAO,EAAE,OAAO,EAAE,SAAS;AAAA,EAC3B,SAAS,EAAE,OAAO,EAAE,IAAI,CAAC,EAAE,IAAI,EAAE;AAAA,EACjC,MAAM,EAAE,OAAO,EAAE,SAAS;AAAA,EAC1B,QAAQ,EAAE,OAAO,EAAE,SAAS;AAAA,EAC5B,UAAU,EAAE,QAAQ,EAAE,QAAQ,KAAK;AAAA,EACnC,WAAW,EAAE,MAAM,EAAE,OAAO,CAAC,EAAE,QAAQ,CAAC,CAAC;AAC3C,CAAC;AAGM,IAAM,yBAAyB,EAAE,OAAO;AAAA,EAC7C,SAAS;AAAA,EACT,UAAU,EAAE,OAAO;AAAA,EACnB,YAAY,EAAE,OAAO,EAAE,IAAI,CAAC,EAAE,IAAI,CAAC;AAAA,EACnC,WAAW,EAAE,OAAO;AAAA,EACpB,cAAc,EAAE,MAAM,mBAAmB,EAAE,SAAS;AACtD,CAAC;AAOM,IAAM,sBAAsB,EAAE,OAAO;AAAA,EAC1C,QAAQ,EAAE,QAAQ,EAAE,QAAQ,IAAI;AAAA,EAChC,KAAK,EAAE,QAAQ,EAAE,QAAQ,KAAK;AAAA,EAC9B,OAAO,EAAE,MAAM,EAAE,OAAO,CAAC,EAAE,SAAS;AAAA,EACpC,SAAS,EAAE,OAAO,EAAE,SAAS;AAAA,EAC7B,MAAM,EAAE,QAAQ,EAAE,QAAQ,KAAK;AAAA,EAC/B,UAAU,EAAE,QAAQ,EAAE,QAAQ,KAAK;AAAA,EACnC,SAAS,EAAE,OAAO,EAAE,SAAS;AAAA,EAC7B,QAAQ,EAAE,OAAO,EAAE,SAAS;AAAA,EAC5B,QAAQ,EAAE,OAAO,EAAE,QAAQ,MAAM;AAAA,EACjC,QAAQ,EAAE,QAAQ,EAAE,QAAQ,KAAK;AAAA,EACjC,OAAO,EAAE,QAAQ,EAAE,QAAQ,KAAK;AAClC,CAAC;AAGM,IAAM,qBAAqB,EAAE,OAAO;AAAA,EACzC,SAAS,EAAE,QAAQ;AAAA,EACnB,YAAY,EAAE,OAAO,EAAE,SAAS;AAAA,EAChC,SAAS,uBAAuB,SAAS;AAAA,EACzC,MAAM,kBAAkB,SAAS;AAAA,EACjC,QAAQ,EAAE,QAAQ,EAAE,QAAQ,KAAK;AAAA,EACjC,OAAO,EAAE,OAAO,EAAE,SAAS;AAAA,EAC3B,OAAO,EAAE,OAAO,EAAE,SAAS;AAAA,EAC3B,WAAW,EAAE,OAAO,EAAE,SAAS;AAAA,EAC/B,kBAAkB,EAAE,QAAQ,EAAE,QAAQ,KAAK;AAC7C,CAAC;AAOM,IAAM,oBAAoB,EAAE,OAAO;AAAA,EACxC,QAAQ,EAAE,OAAO,EAAE,QAAQ,QAAQ;AAAA,EACnC,QAAQ,EAAE,OAAO,EAAE,SAAS;AAAA,EAC5B,OAAO,EAAE,QAAQ,EAAE,QAAQ,KAAK;AAAA,EAChC,aAAa,EAAE,QAAQ,EAAE,QAAQ,KAAK;AAAA,EACtC,QAAQ,EAAE,QAAQ,EAAE,QAAQ,KAAK;AACnC,CAAC;AAGM,IAAM,mBAAmB,EAAE,OAAO;AAAA,EACvC,SAAS,EAAE,QAAQ;AAAA,EACnB,QAAQ,EAAE,OAAO;AAAA,EACjB,QAAQ,EAAE,OAAO;AAAA,EACjB,SAAS,EAAE,OAAO;AAAA,EAClB,OAAO,EAAE,OAAO,EAAE,SAAS;AAC7B,CAAC;AAOM,IAAM,kBAAkB,EAAE,OAAO;AAAA,EACtC,OAAO,EAAE,OAAO,EAAE,SAAS;AAAA,EAC3B,MAAM,EAAE,OAAO,EAAE,SAAS;AAAA,EAC1B,MAAM,EAAE,OAAO,EAAE,QAAQ,MAAM;AAAA,EAC/B,MAAM,EAAE,OAAO,EAAE,SAAS;AAAA,EAC1B,OAAO,EAAE,QAAQ,EAAE,QAAQ,KAAK;AAAA,EAChC,QAAQ,EAAE,QAAQ,EAAE,QAAQ,KAAK;AACnC,CAAC;AAGM,IAAM,iBAAiB,EAAE,OAAO;AAAA,EACrC,SAAS,EAAE,QAAQ;AAAA,EACnB,KAAK,EAAE,OAAO,EAAE,SAAS;AAAA,EACzB,QAAQ,EAAE,OAAO,EAAE,SAAS;AAAA,EAC5B,OAAO,EAAE,OAAO,EAAE,SAAS;AAAA,EAC3B,OAAO,EAAE,OAAO,EAAE,SAAS;AAC7B,CAAC;AAOM,IAAM,yBAAyB,EAAE,OAAO;AAAA,EAC7C,MAAM,EAAE,OAAO;AAAA,EACf,OAAO,EAAE,OAAO,EAAE,IAAI,CAAC,EAAE,IAAI,GAAG;AAAA,EAChC,QAAQ,EAAE,OAAO,EAAE,IAAI,CAAC,EAAE,IAAI,CAAC;AAAA,EAC/B,QAAQ,EAAE,OAAO;AACnB,CAAC;AAGM,IAAM,6BAA6B,EAAE,OAAO;AAAA,EACjD,YAAY,EAAE,OAAO,EAAE,IAAI,CAAC,EAAE,IAAI,GAAG;AAAA,EACrC,SAAS,EAAE,MAAM,sBAAsB;AAAA,EACvC,gBAAgB,EAAE,KAAK,CAAC,gBAAgB,kBAAkB,YAAY,QAAQ,CAAC;AAAA,EAC/E,eAAe,EAAE,MAAM,EAAE,OAAO,CAAC;AAAA,EACjC,kBAAkB,EAAE,QAAQ;AAC9B,CAAC;AAOM,IAAM,0BAA0B,EAAE,OAAO;AAAA,EAC9C,MAAM,EAAE,OAAO,EAAE,QAAQ,cAAc;AAAA,EACvC,aAAa,EAAE,OAAO,EAAE,SAAS;AAAA,EACjC,aAAa,EAAE,KAAK,CAAC,UAAU,aAAa,QAAQ,CAAC,EAAE,QAAQ,WAAW;AAAA,EAC1E,UAAU,EAAE,OAAO,EAAE,SAAS;AAAA,EAC9B,QAAQ,EAAE,OAAO,EAAE,SAAS;AAAA,EAC5B,aAAa,EAAE,OAAO,EAAE,IAAI,CAAC,EAAE,IAAI,CAAC,EAAE,QAAQ,GAAG;AAAA,EACjD,WAAW,EAAE,OAAO,EAAE,QAAQ,IAAI;AAAA,EAClC,SAAS,EAAE,QAAQ,EAAE,QAAQ,KAAK;AAAA,EAClC,qBAAqB,EAAE,QAAQ,EAAE,QAAQ,IAAI;AAAA,EAC7C,aAAa,EAAE,QAAQ,EAAE,QAAQ,KAAK;AAAA,EACtC,kBAAkB,EAAE,QAAQ,EAAE,QAAQ,IAAI;AAAA,EAC1C,cAAc,EAAE,OAAO,EAAE,QAAQ,QAAQ;AAAA,EACzC,eAAe,EAAE,OAAO,EAAE,QAAQ,uBAAuB;AAAA,EACzD,kBAAkB,EAAE,OAAO,EAAE,QAAQ,EAAE;AAAA;AAAA,EAEvC,oBAAoB,EAAE,OAAO,EAAE,QAAQ,GAAG;AAAA,EAC1C,oBAAoB,EAAE,OAAO,EAAE,QAAQ,CAAC;AAAA,EACxC,eAAe,EAAE,MAAM,EAAE,OAAO,CAAC,EAAE,QAAQ;AAAA,IACzC;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACF,CAAC;AACH,CAAC;;;APtMM,IAAM,cAAN,cAA0B,UAAU;AAAA,EACjC;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EAER,YAAY,SAAqC,CAAC,GAAG;AACnD,UAAM,YAAY,wBAAwB,MAAM,MAAM;AAEtD,UAAM,gBAAgB;AAAA,MACpB,MAAM,UAAU;AAAA,MAChB,aAAa,UAAU,eAAe;AAAA,MACtC,aAAa,UAAU;AAAA,MACvB,UAAU,UAAU;AAAA,MACpB,QAAQ,UAAU;AAAA,MAClB,aAAa,UAAU;AAAA,MACvB,WAAW,UAAU;AAAA,MACrB,SAAS,UAAU;AAAA,IACrB,CAAC;AAED,SAAK,eAAe;AAGpB,SAAK,MAAM,IAAI,cAAc;AAC7B,SAAK,eAAe,IAAI,aAAa;AACrC,SAAK,mBAAmB,IAAI,iBAAiB;AAAA,MAC3C,aAAa,UAAU;AAAA,MACvB,UAAU,UAAU;AAAA,MACpB,QAAQ,UAAU;AAAA,MAClB,aAAa,UAAU;AAAA,MACvB,WAAW,UAAU;AAAA,MACrB,iBAAiB,UAAU;AAAA,MAC3B,cAAc,UAAU;AAAA,MACxB,eAAe,UAAU;AAAA,IAC3B,CAAC;AACD,SAAK,YAAY,IAAI,UAAU,EAAE,QAAQ,UAAU,OAAO,CAAC;AAG3D,SAAK,gBAAgB;AAAA,EACvB;AAAA,EAEA,kBAA0B;AACxB,WAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAaT;AAAA,EAEA,MAAM,QAAQ,SAA6C;AACzD,UAAM,SAAU,QAAQ,UAAU;AAClC,UAAM,SAAS,QAAQ,UAAU,CAAC;AAElC,SAAK,IAAI,qBAAqB,MAAM,IAAI,MAAM;AAE9C,QAAI;AACF,cAAQ,QAAQ;AAAA,QACd,KAAK;AACH,iBAAO,KAAK,aAAa;AAAA,QAE3B,KAAK;AACH,iBAAO,KAAK,eAAe,OAAO,MAAiB;AAAA,QAErD,KAAK;AACH,iBAAO,KAAK,aAAa,MAAuB;AAAA,QAElD,KAAK;AACH,iBAAO,KAAK,WAAW,MAAqB;AAAA,QAE9C,KAAK;AACH,iBAAO,KAAK,eAAe,MAAmB;AAAA,QAEhD,KAAK;AACH,iBAAO,KAAK,mBAAmB,MAAuB;AAAA,QAExD;AACE,iBAAO,KAAK,aAAa,OAAO,MAAM,mBAAmB,MAAM,EAAE;AAAA,MACrE;AAAA,IACF,SAAS,OAAO;AACd,YAAM,MAAM;AACZ,aAAO,KAAK,aAAa,OAAO,MAAM,IAAI,OAAO;AAAA,IACnD;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,MAAM,YAAgC;AACpC,WAAO,KAAK,IAAI,UAAU;AAAA,EAC5B;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,gBAAgB,SAAS,MAAiC;AAC9D,UAAM,OAAO,MAAM,KAAK,QAAQ,MAAM;AAEtC,QAAI,KAAK,MAAM,WAAW,GAAG;AAC3B,YAAM,IAAI,MAAM,SAAS,gCAAgC,kBAAkB;AAAA,IAC7E;AAEA,WAAO,KAAK,iBAAiB,SAAS,IAAI;AAAA,EAC5C;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,QAAQ,SAAS,MAA4B;AACjD,UAAM,UAAU,MAAM,KAAK,IAAI,QAAQ,MAAM;AAC7C,WAAO,KAAK,aAAa,UAAU,SAAS,MAAM;AAAA,EACpD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,WAAW,SAAS,MAAqC;AAC7D,UAAM,OAAO,MAAM,KAAK,QAAQ,MAAM;AACtC,WAAO,KAAK,aAAa,WAAW,MAAM,KAAK,aAAa,aAAa;AAAA,EAC3E;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,OAAO,UAAkC,CAAC,GAA0B;AAExE,QAAI,QAAQ,KAAK;AACf,YAAM,KAAK,IAAI,SAAS;AAAA,IAC1B,WAAW,QAAQ,OAAO,QAAQ;AAChC,YAAM,KAAK,IAAI,MAAM,QAAQ,KAAK;AAAA,IACpC;AAGA,UAAM,OAAO,MAAM,KAAK,QAAQ,IAAI;AAEpC,QAAI,KAAK,MAAM,WAAW,GAAG;AAC3B,aAAO;AAAA,QACL,SAAS;AAAA,QACT,OAAO;AAAA,QACP,kBAAkB;AAAA,QAClB,QAAQ;AAAA,MACV;AAAA,IACF;AAGA,UAAM,OAAO,KAAK,aAAa,WAAW,MAAM,KAAK,aAAa,aAAa;AAG/E,QAAI,KAAK,mBAAmB,kBAAkB,CAAC,QAAQ,QAAQ;AAC7D,aAAO;AAAA,QACL,SAAS;AAAA,QACT;AAAA,QACA,WAAW,KAAK;AAAA,QAChB,kBAAkB;AAAA,QAClB,QAAQ;AAAA,QACR,OAAO,cAAc,KAAK,UAAU,oCAAoC,KAAK,cAAc;AAAA,MAC7F;AAAA,IACF;AAGA,QAAI;AACJ,QAAI,QAAQ,SAAS;AACnB,gBAAU;AAAA,QACR,SAAS;AAAA,UACP,MAAM;AAAA,UACN,SAAS,QAAQ;AAAA,UACjB,UAAU;AAAA,UACV,WAAW,CAAC;AAAA,QACd;AAAA,QACA,UAAU,QAAQ;AAAA,QAClB,YAAY;AAAA,QACZ,WAAW;AAAA,MACb;AAAA,IACF,OAAO;AACL,gBAAU,MAAM,KAAK,iBAAiB,SAAS,IAAI;AAAA,IACrD;AAEA,QAAI,QAAQ,QAAQ;AAClB,aAAO;AAAA,QACL,SAAS;AAAA,QACT;AAAA,QACA;AAAA,QACA,WAAW,KAAK;AAAA,QAChB,kBAAkB;AAAA,QAClB,QAAQ;AAAA,MACV;AAAA,IACF;AAGA,UAAM,aAAa,MAAM,KAAK,IAAI,OAAO,QAAQ,UAAU,EAAE,OAAO,QAAQ,MAAM,CAAC;AAEnF,UAAM,SAAuB;AAAA,MAC3B,SAAS;AAAA,MACT;AAAA,MACA;AAAA,MACA;AAAA,MACA,WAAW,KAAK;AAAA,MAChB,kBAAkB;AAAA,MAClB,QAAQ;AAAA,IACV;AAGA,QAAI,QAAQ,MAAM;AAChB,YAAM,aAAa,MAAM,KAAK,KAAK,EAAE,aAAa,KAAK,CAAC;AACxD,aAAO,SAAS,WAAW;AAAA,IAC7B;AAGA,QAAI,QAAQ,YAAY,OAAO,QAAQ;AACrC,YAAM,WAAW,MAAM,KAAK,SAAS;AAAA,QACnC,OAAO,QAAQ;AAAA,QACf,MAAM,QAAQ;AAAA,QACd,MAAM,QAAQ;AAAA,MAChB,CAAC;AACD,aAAO,QAAQ,SAAS;AAAA,IAC1B;AAEA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,KAAK,UAAgC,CAAC,GAAwB;AAClE,QAAI;AACF,YAAM,EAAE,QAAQ,OAAO,IAAI,MAAM,KAAK,IAAI,KAAK;AAAA,QAC7C,QAAQ,QAAQ;AAAA,QAChB,QAAQ,QAAQ;AAAA,QAChB,OAAO,QAAQ;AAAA,QACf,aAAa,QAAQ;AAAA,MACvB,CAAC;AAED,aAAO;AAAA,QACL,SAAS;AAAA,QACT;AAAA,QACA;AAAA,QACA,SAAS;AAAA;AAAA,MACX;AAAA,IACF,SAAS,OAAO;AACd,YAAM,MAAM;AACZ,aAAO;AAAA,QACL,SAAS;AAAA,QACT,QAAQ,QAAQ,UAAU;AAAA,QAC1B,QAAQ,QAAQ,UAAU;AAAA,QAC1B,SAAS;AAAA,QACT,OAAO,IAAI;AAAA,MACb;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,SAAS,UAA8B,CAAC,GAAsB;AAElE,QAAI,CAAC,QAAQ,SAAS,CAAC,QAAQ,MAAM;AACnC,YAAM,UAAU,MAAM,KAAK,IAAI,iBAAiB,EAAE;AAClD,YAAM,OAAO,MAAM,KAAK,QAAQ,KAAK;AACrC,YAAM,YAAY,MAAM,KAAK,UAAU,WAAW,SAAS,IAAI;AAE/D,cAAQ,QAAQ,QAAQ,SAAS,UAAU;AAC3C,cAAQ,OAAO,QAAQ,QAAQ,UAAU;AAAA,IAC3C;AAEA,WAAO,KAAK,UAAU,OAAO,OAAO;AAAA,EACtC;AAAA;AAAA;AAAA;AAAA,EAMQ,kBAAwB;AAC9B,SAAK,aAAa;AAAA,MAChB,MAAM;AAAA,MACN,aAAa;AAAA,MACb,YAAYG,GAAE,OAAO,CAAC,CAAC;AAAA,MACvB,SAAS,YAAY,KAAK,UAAU;AAAA,IACtC,CAAC;AAED,SAAK,aAAa;AAAA,MAChB,MAAM;AAAA,MACN,aAAa;AAAA,MACb,YAAYA,GAAE,OAAO;AAAA,QACnB,QAAQA,GAAE,QAAQ,EAAE,QAAQ,IAAI;AAAA,MAClC,CAAC;AAAA,MACD,SAAS,OAAO,WAAW;AACzB,cAAM,EAAE,OAAO,IAAI;AACnB,eAAO,KAAK,gBAAgB,MAAM;AAAA,MACpC;AAAA,IACF,CAAC;AAED,SAAK,aAAa;AAAA,MAChB,MAAM;AAAA,MACN,aAAa;AAAA,MACb,YAAYA,GAAE,OAAO;AAAA,QACnB,SAASA,GAAE,OAAO,EAAE,SAAS;AAAA,QAC7B,KAAKA,GAAE,QAAQ,EAAE,QAAQ,KAAK;AAAA,QAC9B,MAAMA,GAAE,QAAQ,EAAE,QAAQ,KAAK;AAAA,QAC/B,UAAUA,GAAE,QAAQ,EAAE,QAAQ,KAAK;AAAA,MACrC,CAAC;AAAA,MACD,SAAS,OAAO,WAAW,KAAK,OAAO,MAAuB;AAAA,IAChE,CAAC;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAMA,MAAc,eAAqC;AACjD,UAAM,SAAS,MAAM,KAAK,UAAU;AACpC,UAAM,OAAO,OAAO,UAAU,OAAO,MAAM,KAAK,WAAW,CAAC,OAAO,OAAO;AAE1E,WAAO,KAAK;AAAA,MACV;AAAA,MACA,EAAE,QAAQ,KAAK;AAAA,MACf;AAAA,MACA;AAAA,MACA,WAAW,OAAO,MAAM,YAAY,OAAO,OAAO;AAAA,IACpD;AAAA,EACF;AAAA,EAEA,MAAc,eAAe,SAAS,MAA4B;AAChE,UAAM,UAAU,MAAM,KAAK,gBAAgB,MAAM;AACjD,WAAO,KAAK;AAAA,MACV;AAAA,MACA;AAAA,MACA;AAAA,MACA,QAAQ;AAAA,MACR,QAAQ;AAAA,IACV;AAAA,EACF;AAAA,EAEA,MAAc,aAAa,QAA6C;AACtE,UAAM,SAAS,MAAM,KAAK,OAAO,MAAM;AACvC,WAAO,KAAK;AAAA,MACV,OAAO;AAAA,MACP;AAAA,MACA,OAAO;AAAA,MACP,OAAO,SAAS;AAAA,MAChB,OAAO,SAAS;AAAA,IAClB;AAAA,EACF;AAAA,EAEA,MAAc,WAAW,QAA2C;AAClE,UAAM,SAAS,MAAM,KAAK,KAAK,MAAM;AACrC,WAAO,KAAK;AAAA,MACV,OAAO;AAAA,MACP;AAAA,MACA,OAAO;AAAA,MACP;AAAA,MACA,aAAa,OAAO,MAAM,IAAI,OAAO,MAAM;AAAA,IAC7C;AAAA,EACF;AAAA,EAEA,MAAc,eAAe,QAAyC;AACpE,UAAM,SAAS,MAAM,KAAK,SAAS,MAAM;AACzC,WAAO,KAAK;AAAA,MACV,OAAO;AAAA,MACP;AAAA,MACA,OAAO;AAAA,MACP;AAAA,MACA,OAAO,MAAM,eAAe,OAAO,GAAG,KAAK;AAAA,IAC7C;AAAA,EACF;AAAA,EAEA,MAAc,mBAAmB,QAA6C;AAE5E,UAAM,aAA4B;AAAA,MAChC,GAAG;AAAA,MACH,KAAK,OAAO,OAAO;AAAA,MACnB,MAAM,OAAO,QAAQ;AAAA,MACrB,UAAU,OAAO,YAAY;AAAA,IAC/B;AAEA,UAAM,SAAS,MAAM,KAAK,OAAO,UAAU;AAC3C,WAAO,KAAK;AAAA,MACV,OAAO;AAAA,MACP;AAAA,MACA,OAAO;AAAA,MACP,OAAO,SAAS;AAAA,MAChB,OAAO,SAAS;AAAA,IAClB;AAAA,EACF;AACF;;;AQ9ZA,IAAM,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA+Bb,eAAe,OAAO;AACpB,QAAM,OAAO,QAAQ,KAAK,MAAM,CAAC;AAEjC,MAAI,KAAK,SAAS,IAAI,KAAK,KAAK,SAAS,QAAQ,KAAK,KAAK,WAAW,GAAG;AACvE,YAAQ,IAAI,IAAI;AAChB,YAAQ,KAAK,CAAC;AAAA,EAChB;AAEA,QAAM,UAAU,KAAK,CAAC;AACtB,QAAM,QAAQ,IAAI,IAAI,KAAK,MAAM,CAAC,CAAC;AAEnC,QAAM,UAAU,MAAM,IAAI,IAAI,KAAK,MAAM,IAAI,WAAW;AACxD,QAAM,SAAS,MAAM,IAAI,WAAW;AACpC,QAAM,MAAM,MAAM,IAAI,IAAI,KAAK,MAAM,IAAI,OAAO;AAChD,QAAM,OAAO,MAAM,IAAI,IAAI,KAAK,MAAM,IAAI,QAAQ;AAClD,QAAM,WAAW,MAAM,IAAI,MAAM;AACjC,QAAM,QAAQ,MAAM,IAAI,SAAS;AAGjC,MAAI;AACJ,QAAM,eAAe,KAAK,UAAU,CAAC,MAAM,MAAM,QAAQ,MAAM,WAAW;AAC1E,MAAI,iBAAiB,MAAM,KAAK,eAAe,CAAC,GAAG;AACjD,cAAU,KAAK,eAAe,CAAC;AAAA,EACjC;AAEA,QAAM,QAAQ,IAAI,YAAY;AAAA,IAC5B,QAAQ,QAAQ,IAAI,qBAAqB,QAAQ,IAAI;AAAA,IACrD;AAAA,EACF,CAAC;AAED,MAAI;AACF,YAAQ,SAAS;AAAA,MACf,KAAK,UAAU;AACb,cAAM,SAAS,MAAM,MAAM,UAAU;AACrC,cAAM,OAAO,OAAO,UAAU,OAAO,MAAM,MAAM,WAAW;AAE5D,gBAAQ,IAAI;AAAA,UAAa,OAAO,MAAM,EAAE;AACxC,gBAAQ,IAAI,WAAW,OAAO,UAAU,UAAU,aAAa,EAAE;AAEjE,YAAI,CAAC,OAAO,SAAS;AACnB,kBAAQ,IAAI;AAAA,UAAa,OAAO,OAAO,MAAM,IAAI;AACjD,iBAAO,OAAO,QAAQ,CAAC,MAAM,QAAQ,IAAI,KAAK,EAAE,IAAI,KAAK,EAAE,IAAI,EAAE,CAAC;AAElE,kBAAQ,IAAI;AAAA,YAAe,OAAO,SAAS,MAAM,IAAI;AACrD,iBAAO,SAAS,QAAQ,CAAC,MAAM,QAAQ,IAAI,KAAK,EAAE,IAAI,KAAK,EAAE,IAAI,EAAE,CAAC;AAEpE,kBAAQ,IAAI;AAAA,aAAgB,OAAO,UAAU,MAAM,IAAI;AACvD,iBAAO,UAAU,QAAQ,CAAC,MAAM,QAAQ,IAAI,KAAK,CAAC,EAAE,CAAC;AAErD,cAAI,MAAM;AACR,oBAAQ,IAAI;AAAA,cAAiB,KAAK,UAAU,MAAM;AAClD,oBAAQ,IAAI,mBAAmB,KAAK,cAAc,EAAE;AAAA,UACtD;AAAA,QACF;AACA;AAAA,MACF;AAAA,MAEA,KAAK,YAAY;AACf,gBAAQ,IAAI,sBAAsB;AAClC,cAAM,YAAY,MAAM,MAAM,gBAAgB;AAE9C,gBAAQ,IAAI;AAAA,iCAAoC,KAAK,MAAM,UAAU,aAAa,GAAG,CAAC,KAAK;AAC3F,gBAAQ,IAAI,KAAK;AACjB,gBAAQ,IAAI,UAAU,QAAQ;AAC9B,gBAAQ,IAAI,KAAK;AACjB,gBAAQ,IAAI;AAAA,aAAgB,UAAU,SAAS,EAAE;AACjD;AAAA,MACF;AAAA,MAEA,KAAK,UAAU;AACb,gBAAQ,IAAI,oBAAoB;AAChC,cAAM,SAAS,MAAM,MAAM,OAAO;AAAA,UAChC;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,QACF,CAAC;AAED,YAAI,CAAC,OAAO,SAAS;AACnB,kBAAQ,MAAM;AAAA,SAAY,OAAO,KAAK,EAAE;AACxC,cAAI,OAAO,kBAAkB;AAC3B,oBAAQ,IAAI,eAAe,OAAO,SAAS,EAAE;AAC7C,oBAAQ,IAAI,uCAAuC;AAAA,UACrD;AACA,kBAAQ,KAAK,CAAC;AAAA,QAChB;AAEA,YAAI,QAAQ;AACV,kBAAQ,IAAI,wCAAwC;AACpD,kBAAQ,IAAI,KAAK;AACjB,kBAAQ,IAAI,OAAO,SAAS,QAAQ;AACpC,kBAAQ,IAAI,KAAK;AAAA,QACnB,OAAO;AACL,kBAAQ,IAAI;AAAA,kBAAqB,OAAO,YAAY,UAAU,GAAG,CAAC,CAAC,EAAE;AACrE,cAAI,OAAO,QAAQ;AACjB,oBAAQ,IAAI,kBAAkB;AAAA,UAChC;AACA,cAAI,OAAO,OAAO;AAChB,oBAAQ,IAAI,eAAe,OAAO,KAAK,EAAE;AAAA,UAC3C;AAAA,QACF;AACA;AAAA,MACF;AAAA,MAEA,KAAK,QAAQ;AACX,gBAAQ,IAAI,sBAAsB;AAClC,cAAM,SAAS,MAAM,MAAM,KAAK,EAAE,aAAa,KAAK,CAAC;AAErD,YAAI,CAAC,OAAO,SAAS;AACnB,kBAAQ,MAAM,UAAU,OAAO,KAAK,EAAE;AACtC,kBAAQ,KAAK,CAAC;AAAA,QAChB;AAEA,gBAAQ,IAAI,aAAa,OAAO,MAAM,IAAI,OAAO,MAAM,EAAE;AACzD;AAAA,MACF;AAAA,MAEA,KAAK,MAAM;AACT,gBAAQ,IAAI,0BAA0B;AACtC,cAAM,SAAS,MAAM,MAAM,SAAS,EAAE,OAAO,CAAC;AAE9C,YAAI,CAAC,OAAO,SAAS;AACnB,kBAAQ,MAAM,UAAU,OAAO,KAAK,EAAE;AACtC,kBAAQ,KAAK,CAAC;AAAA,QAChB;AAEA,YAAI,OAAO,KAAK;AACd,kBAAQ,IAAI,eAAe,OAAO,GAAG,EAAE;AAAA,QACzC;AACA;AAAA,MACF;AAAA,MAEA;AACE,gBAAQ,MAAM,oBAAoB,OAAO,EAAE;AAC3C,gBAAQ,IAAI,IAAI;AAChB,gBAAQ,KAAK,CAAC;AAAA,